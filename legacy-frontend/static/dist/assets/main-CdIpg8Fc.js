var mg=Object.defineProperty;var Mu=d=>{throw TypeError(d)};var yg=(d,t,e)=>t in d?mg(d,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):d[t]=e;var L=(d,t,e)=>yg(d,typeof t!="symbol"?t+"":t,e),Gc=(d,t,e)=>t.has(d)||Mu("Cannot "+e);var r=(d,t,e)=>(Gc(d,t,"read from private field"),e?e.call(d):t.get(d)),g=(d,t,e)=>t.has(d)?Mu("Cannot add the same private member more than once"):t instanceof WeakSet?t.add(d):t.set(d,e),f=(d,t,e,s)=>(Gc(d,t,"write to private field"),s?s.call(d,e):t.set(d,e),e),m=(d,t,e)=>(Gc(d,t,"access private method"),e);var ee=(d,t,e,s)=>({set _(i){f(d,t,i,e)},get _(){return r(d,t,s)}});const oe=typeof process=="object"&&process+""=="[object process]"&&!process.versions.nw&&!(process.versions.electron&&process.type&&process.type!=="browser"),td=[.001,0,0,.001,0,0],jc=1.35,De={ANY:1,DISPLAY:2,PRINT:4,ANNOTATIONS_FORMS:16,ANNOTATIONS_STORAGE:32,ANNOTATIONS_DISABLE:64,IS_EDITING:128,OPLIST:256},Ii={DISABLE:0,ENABLE:1,ENABLE_FORMS:2,ENABLE_STORAGE:3},nf="pdfjs_internal_editor_",z={DISABLE:-1,NONE:0,FREETEXT:3,HIGHLIGHT:9,STAMP:13,INK:15,SIGNATURE:101,COMMENT:102},Y={RESIZE:1,CREATE:2,FREETEXT_SIZE:11,FREETEXT_COLOR:12,FREETEXT_OPACITY:13,INK_COLOR:21,INK_THICKNESS:22,INK_OPACITY:23,HIGHLIGHT_COLOR:31,HIGHLIGHT_THICKNESS:32,HIGHLIGHT_FREE:33,HIGHLIGHT_SHOW_ALL:34,DRAW_STEP:41},bg={PRINT:4,MODIFY_CONTENTS:8,COPY:16,MODIFY_ANNOTATIONS:32,FILL_INTERACTIVE_FORMS:256,COPY_FOR_ACCESSIBILITY:512,ASSEMBLE:1024,PRINT_HIGH_QUALITY:2048},Yt={FILL:0,STROKE:1,FILL_STROKE:2,INVISIBLE:3,FILL_STROKE_MASK:3,ADD_TO_PATH_FLAG:4},xh={GRAYSCALE_1BPP:1,RGB_24BPP:2,RGBA_32BPP:3},St={TEXT:1,LINK:2,FREETEXT:3,LINE:4,SQUARE:5,CIRCLE:6,POLYGON:7,POLYLINE:8,HIGHLIGHT:9,UNDERLINE:10,SQUIGGLY:11,STRIKEOUT:12,STAMP:13,CARET:14,INK:15,POPUP:16,FILEATTACHMENT:17,SOUND:18,MOVIE:19,WIDGET:20,SCREEN:21,PRINTERMARK:22,TRAPNET:23,WATERMARK:24,THREED:25,REDACT:26},Vr={SOLID:1,DASHED:2,BEVELED:3,INSET:4,UNDERLINE:5},Nc={ERRORS:0,WARNINGS:1,INFOS:5},nc={dependency:1,setLineWidth:2,setLineCap:3,setLineJoin:4,setMiterLimit:5,setDash:6,setRenderingIntent:7,setFlatness:8,setGState:9,save:10,restore:11,transform:12,moveTo:13,lineTo:14,curveTo:15,curveTo2:16,curveTo3:17,closePath:18,rectangle:19,stroke:20,closeStroke:21,fill:22,eoFill:23,fillStroke:24,eoFillStroke:25,closeFillStroke:26,closeEOFillStroke:27,endPath:28,clip:29,eoClip:30,beginText:31,endText:32,setCharSpacing:33,setWordSpacing:34,setHScale:35,setLeading:36,setFont:37,setTextRenderingMode:38,setTextRise:39,moveText:40,setLeadingMoveText:41,setTextMatrix:42,nextLine:43,showText:44,showSpacedText:45,nextLineShowText:46,nextLineSetSpacingShowText:47,setCharWidth:48,setCharWidthAndBounds:49,setStrokeColorSpace:50,setFillColorSpace:51,setStrokeColor:52,setStrokeColorN:53,setFillColor:54,setFillColorN:55,setStrokeGray:56,setFillGray:57,setStrokeRGBColor:58,setFillRGBColor:59,setStrokeCMYKColor:60,setFillCMYKColor:61,shadingFill:62,beginInlineImage:63,beginImageData:64,endInlineImage:65,paintXObject:66,markPoint:67,markPointProps:68,beginMarkedContent:69,beginMarkedContentProps:70,endMarkedContent:71,beginCompat:72,endCompat:73,paintFormXObjectBegin:74,paintFormXObjectEnd:75,beginGroup:76,endGroup:77,beginAnnotation:80,endAnnotation:81,paintImageMaskXObject:83,paintImageMaskXObjectGroup:84,paintImageXObject:85,paintInlineImageXObject:86,paintInlineImageXObjectGroup:87,paintImageXObjectRepeat:88,paintImageMaskXObjectRepeat:89,paintSolidColorImageMask:90,constructPath:91,setStrokeTransparent:92,setFillTransparent:93,rawFillPath:94},Ah={moveTo:0,lineTo:1,curveTo:2,closePath:3},Ag={NEED_PASSWORD:1,INCORRECT_PASSWORD:2};let Fc=Nc.WARNINGS;function vg(d){Number.isInteger(d)&&(Fc=d)}function wg(){return Fc}function Bc(d){Fc>=Nc.INFOS&&console.log(`Info: ${d}`)}function V(d){Fc>=Nc.WARNINGS&&console.log(`Warning: ${d}`)}function at(d){throw new Error(d)}function _t(d,t){d||at(t)}function Sg(d){switch(d==null?void 0:d.protocol){case"http:":case"https:":case"ftp:":case"mailto:":case"tel:":return!0;default:return!1}}function rf(d,t=null,e=null){if(!d)return null;if(e&&typeof d=="string"){if(e.addDefaultProtocol&&d.startsWith("www.")){const i=d.match(/\./g);(i==null?void 0:i.length)>=2&&(d=`http://${d}`)}if(e.tryConvertEncoding)try{d=xg(d)}catch{}}const s=t?URL.parse(d,t):URL.parse(d);return Sg(s)?s:null}function af(d,t,e=!1){const s=URL.parse(d);return s?(s.hash=t,s.href):e&&rf(d,"http://example.com")?d.split("#",1)[0]+`${t?`#${t}`:""}`:""}function q(d,t,e,s=!1){return Object.defineProperty(d,t,{value:e,enumerable:!s,configurable:!0,writable:!1}),e}const $r=(function(){function t(e,s){this.message=e,this.name=s}return t.prototype=new Error,t.constructor=t,t})();class Nu extends $r{constructor(t,e){super(t,"PasswordException"),this.code=e}}class Wc extends $r{constructor(t,e){super(t,"UnknownErrorException"),this.details=e}}class ed extends $r{constructor(t){super(t,"InvalidPDFException")}}class rc extends $r{constructor(t,e,s){super(t,"ResponseException"),this.status=e,this.missing=s}}class Eg extends $r{constructor(t){super(t,"FormatError")}}class An extends $r{constructor(t){super(t,"AbortException")}}function of(d){(typeof d!="object"||(d==null?void 0:d.length)===void 0)&&at("Invalid argument for bytesToString");const t=d.length,e=8192;if(t<e)return String.fromCharCode.apply(null,d);const s=[];for(let i=0;i<t;i+=e){const n=Math.min(i+e,t),a=d.subarray(i,n);s.push(String.fromCharCode.apply(null,a))}return s.join("")}function fh(d){typeof d!="string"&&at("Invalid argument for stringToBytes");const t=d.length,e=new Uint8Array(t);for(let s=0;s<t;++s)e[s]=d.charCodeAt(s)&255;return e}function _g(d){return String.fromCharCode(d>>24&255,d>>16&255,d>>8&255,d&255)}function Cg(){const d=new Uint8Array(4);return d[0]=1,new Uint32Array(d.buffer,0,1)[0]===1}function Tg(){try{return new Function(""),!0}catch{return!1}}class Xt{static get isLittleEndian(){return q(this,"isLittleEndian",Cg())}static get isEvalSupported(){return q(this,"isEvalSupported",Tg())}static get isOffscreenCanvasSupported(){return q(this,"isOffscreenCanvasSupported",typeof OffscreenCanvas<"u")}static get isImageDecoderSupported(){return q(this,"isImageDecoderSupported",typeof ImageDecoder<"u")}static get platform(){const{platform:t,userAgent:e}=navigator;return q(this,"platform",{isAndroid:e.includes("Android"),isLinux:t.includes("Linux"),isMac:t.includes("Mac"),isWindows:t.includes("Win"),isFirefox:e.includes("Firefox")})}static get isCSSRoundSupported(){var t,e;return q(this,"isCSSRoundSupported",(e=(t=globalThis.CSS)==null?void 0:t.supports)==null?void 0:e.call(t,"width: round(1.5px, 1px)"))}}const qc=Array.from(Array(256).keys(),d=>d.toString(16).padStart(2,"0"));var Ei,Lh,sd;class H{static makeHexColor(t,e,s){return`#${qc[t]}${qc[e]}${qc[s]}`}static scaleMinMax(t,e){let s;t[0]?(t[0]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[0],e[2]*=t[0],t[3]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[3],e[3]*=t[3]):(s=e[0],e[0]=e[1],e[1]=s,s=e[2],e[2]=e[3],e[3]=s,t[1]<0&&(s=e[1],e[1]=e[3],e[3]=s),e[1]*=t[1],e[3]*=t[1],t[2]<0&&(s=e[0],e[0]=e[2],e[2]=s),e[0]*=t[2],e[2]*=t[2]),e[0]+=t[4],e[1]+=t[5],e[2]+=t[4],e[3]+=t[5]}static transform(t,e){return[t[0]*e[0]+t[2]*e[1],t[1]*e[0]+t[3]*e[1],t[0]*e[2]+t[2]*e[3],t[1]*e[2]+t[3]*e[3],t[0]*e[4]+t[2]*e[5]+t[4],t[1]*e[4]+t[3]*e[5]+t[5]]}static applyTransform(t,e,s=0){const i=t[s],n=t[s+1];t[s]=i*e[0]+n*e[2]+e[4],t[s+1]=i*e[1]+n*e[3]+e[5]}static applyTransformToBezier(t,e,s=0){const i=e[0],n=e[1],a=e[2],o=e[3],l=e[4],h=e[5];for(let c=0;c<6;c+=2){const u=t[s+c],p=t[s+c+1];t[s+c]=u*i+p*a+l,t[s+c+1]=u*n+p*o+h}}static applyInverseTransform(t,e){const s=t[0],i=t[1],n=e[0]*e[3]-e[1]*e[2];t[0]=(s*e[3]-i*e[2]+e[2]*e[5]-e[4]*e[3])/n,t[1]=(-s*e[1]+i*e[0]+e[4]*e[1]-e[5]*e[0])/n}static axialAlignedBoundingBox(t,e,s){const i=e[0],n=e[1],a=e[2],o=e[3],l=e[4],h=e[5],c=t[0],u=t[1],p=t[2],y=t[3];let A=i*c+l,b=A,w=i*p+l,v=w,E=o*u+h,S=E,_=o*y+h,C=_;if(n!==0||a!==0){const T=n*c,x=n*p,I=a*u,P=a*y;A+=I,v+=I,w+=P,b+=P,E+=T,C+=T,_+=x,S+=x}s[0]=Math.min(s[0],A,w,b,v),s[1]=Math.min(s[1],E,_,S,C),s[2]=Math.max(s[2],A,w,b,v),s[3]=Math.max(s[3],E,_,S,C)}static inverseTransform(t){const e=t[0]*t[3]-t[1]*t[2];return[t[3]/e,-t[1]/e,-t[2]/e,t[0]/e,(t[2]*t[5]-t[4]*t[3])/e,(t[4]*t[1]-t[5]*t[0])/e]}static singularValueDecompose2dScale(t,e){const s=t[0],i=t[1],n=t[2],a=t[3],o=s**2+i**2,l=s*n+i*a,h=n**2+a**2,c=(o+h)/2,u=Math.sqrt(c**2-(o*h-l**2));e[0]=Math.sqrt(c+u||1),e[1]=Math.sqrt(c-u||1)}static normalizeRect(t){const e=t.slice(0);return t[0]>t[2]&&(e[0]=t[2],e[2]=t[0]),t[1]>t[3]&&(e[1]=t[3],e[3]=t[1]),e}static intersect(t,e){const s=Math.max(Math.min(t[0],t[2]),Math.min(e[0],e[2])),i=Math.min(Math.max(t[0],t[2]),Math.max(e[0],e[2]));if(s>i)return null;const n=Math.max(Math.min(t[1],t[3]),Math.min(e[1],e[3])),a=Math.min(Math.max(t[1],t[3]),Math.max(e[1],e[3]));return n>a?null:[s,n,i,a]}static pointBoundingBox(t,e,s){s[0]=Math.min(s[0],t),s[1]=Math.min(s[1],e),s[2]=Math.max(s[2],t),s[3]=Math.max(s[3],e)}static rectBoundingBox(t,e,s,i,n){n[0]=Math.min(n[0],t,s),n[1]=Math.min(n[1],e,i),n[2]=Math.max(n[2],t,s),n[3]=Math.max(n[3],e,i)}static bezierBoundingBox(t,e,s,i,n,a,o,l,h){h[0]=Math.min(h[0],t,o),h[1]=Math.min(h[1],e,l),h[2]=Math.max(h[2],t,o),h[3]=Math.max(h[3],e,l),m(this,Ei,sd).call(this,t,s,n,o,e,i,a,l,3*(-t+3*(s-n)+o),6*(t-2*s+n),3*(s-t),h),m(this,Ei,sd).call(this,t,s,n,o,e,i,a,l,3*(-e+3*(i-a)+l),6*(e-2*i+a),3*(i-e),h)}}Ei=new WeakSet,Lh=function(t,e,s,i,n,a,o,l,h,c){if(h<=0||h>=1)return;const u=1-h,p=h*h,y=p*h,A=u*(u*(u*t+3*h*e)+3*p*s)+y*i,b=u*(u*(u*n+3*h*a)+3*p*o)+y*l;c[0]=Math.min(c[0],A),c[1]=Math.min(c[1],b),c[2]=Math.max(c[2],A),c[3]=Math.max(c[3],b)},sd=function(t,e,s,i,n,a,o,l,h,c,u,p){if(Math.abs(h)<1e-12){Math.abs(c)>=1e-12&&m(this,Ei,Lh).call(this,t,e,s,i,n,a,o,l,-u/c,p);return}const y=c**2-4*u*h;if(y<0)return;const A=Math.sqrt(y),b=2*h;m(this,Ei,Lh).call(this,t,e,s,i,n,a,o,l,(-c+A)/b,p),m(this,Ei,Lh).call(this,t,e,s,i,n,a,o,l,(-c-A)/b,p)},g(H,Ei);function xg(d){return decodeURIComponent(escape(d))}let Xc=null,Fu=null;function Lg(d){return Xc||(Xc=/([\u00a0\u00b5\u037e\u0eb3\u2000-\u200a\u202f\u2126\ufb00-\ufb04\ufb06\ufb20-\ufb36\ufb38-\ufb3c\ufb3e\ufb40-\ufb41\ufb43-\ufb44\ufb46-\ufba1\ufba4-\ufba9\ufbae-\ufbb1\ufbd3-\ufbdc\ufbde-\ufbe7\ufbea-\ufbf8\ufbfc-\ufbfd\ufc00-\ufc5d\ufc64-\ufcf1\ufcf5-\ufd3d\ufd88\ufdf4\ufdfa-\ufdfb\ufe71\ufe77\ufe79\ufe7b\ufe7d]+)|(\ufb05+)/gu,Fu=new Map([["ﬅ","ſt"]])),d.replaceAll(Xc,(t,e,s)=>e?e.normalize("NFKC"):Fu.get(s))}function lf(){if(typeof crypto.randomUUID=="function")return crypto.randomUUID();const d=new Uint8Array(32);return crypto.getRandomValues(d),of(d)}const bu="pdfjs_internal_id_";function Ig(d,t,e){if(!Array.isArray(e)||e.length<2)return!1;const[s,i,...n]=e;if(!d(s)&&!Number.isInteger(s)||!t(i))return!1;const a=n.length;let o=!0;switch(i.name){case"XYZ":if(a<2||a>3)return!1;break;case"Fit":case"FitB":return a===0;case"FitH":case"FitBH":case"FitV":case"FitBV":if(a>1)return!1;break;case"FitR":if(a!==4)return!1;o=!1;break;default:return!1}for(const l of n)if(!(typeof l=="number"||o&&l===null))return!1;return!0}function le(d,t,e){return Math.min(Math.max(d,t),e)}function hf(d){return Uint8Array.prototype.toBase64?d.toBase64():btoa(of(d))}function Pg(d){return Uint8Array.fromBase64?Uint8Array.fromBase64(d):fh(atob(d))}typeof Promise.try!="function"&&(Promise.try=function(d,...t){return new Promise(e=>{e(d(...t))})});typeof Math.sumPrecise!="function"&&(Math.sumPrecise=function(d){return d.reduce((t,e)=>t+e,0)});const $s="http://www.w3.org/2000/svg",Ln=class Ln{};L(Ln,"CSS",96),L(Ln,"PDF",72),L(Ln,"PDF_TO_CSS_UNITS",Ln.CSS/Ln.PDF);let vn=Ln;async function ph(d,t="text"){if(mo(d,document.baseURI)){const e=await fetch(d);if(!e.ok)throw new Error(e.statusText);switch(t){case"arraybuffer":return e.arrayBuffer();case"blob":return e.blob();case"json":return e.json()}return e.text()}return new Promise((e,s)=>{const i=new XMLHttpRequest;i.open("GET",d,!0),i.responseType=t,i.onreadystatechange=()=>{if(i.readyState===XMLHttpRequest.DONE){if(i.status===200||i.status===0){switch(t){case"arraybuffer":case"blob":case"json":e(i.response);return}e(i.responseText);return}s(new Error(i.statusText))}},i.send(null)})}class gh{constructor({viewBox:t,userUnit:e,scale:s,rotation:i,offsetX:n=0,offsetY:a=0,dontFlip:o=!1}){this.viewBox=t,this.userUnit=e,this.scale=s,this.rotation=i,this.offsetX=n,this.offsetY=a,s*=e;const l=(t[2]+t[0])/2,h=(t[3]+t[1])/2;let c,u,p,y;switch(i%=360,i<0&&(i+=360),i){case 180:c=-1,u=0,p=0,y=1;break;case 90:c=0,u=1,p=1,y=0;break;case 270:c=0,u=-1,p=-1,y=0;break;case 0:c=1,u=0,p=0,y=-1;break;default:throw new Error("PageViewport: Invalid rotation, must be a multiple of 90 degrees.")}o&&(p=-p,y=-y);let A,b,w,v;c===0?(A=Math.abs(h-t[1])*s+n,b=Math.abs(l-t[0])*s+a,w=(t[3]-t[1])*s,v=(t[2]-t[0])*s):(A=Math.abs(l-t[0])*s+n,b=Math.abs(h-t[1])*s+a,w=(t[2]-t[0])*s,v=(t[3]-t[1])*s),this.transform=[c*s,u*s,p*s,y*s,A-c*s*l-p*s*h,b-u*s*l-y*s*h],this.width=w,this.height=v}get rawDims(){const t=this.viewBox;return q(this,"rawDims",{pageWidth:t[2]-t[0],pageHeight:t[3]-t[1],pageX:t[0],pageY:t[1]})}clone({scale:t=this.scale,rotation:e=this.rotation,offsetX:s=this.offsetX,offsetY:i=this.offsetY,dontFlip:n=!1}={}){return new gh({viewBox:this.viewBox.slice(),userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:n})}convertToViewportPoint(t,e){const s=[t,e];return H.applyTransform(s,this.transform),s}convertToViewportRectangle(t){const e=[t[0],t[1]];H.applyTransform(e,this.transform);const s=[t[2],t[3]];return H.applyTransform(s,this.transform),[e[0],e[1],s[0],s[1]]}convertToPdfPoint(t,e){const s=[t,e];return H.applyInverseTransform(s,this.transform),s}}class Au extends $r{constructor(t,e=0){super(t,"RenderingCancelledException"),this.extraDelay=e}}function Oc(d){const t=d.length;let e=0;for(;e<t&&d[e].trim()==="";)e++;return d.substring(e,e+5).toLowerCase()==="data:"}function vu(d){return typeof d=="string"&&/\.pdf$/i.test(d)}function Rg(d){return[d]=d.split(/[#?]/,1),d.substring(d.lastIndexOf("/")+1)}function kg(d,t="document.pdf"){if(typeof d!="string")return t;if(Oc(d))return V('getPdfFilenameFromUrl: ignore "data:"-URL for performance reasons.'),t;const s=(o=>{try{return new URL(o)}catch{try{return new URL(decodeURIComponent(o))}catch{try{return new URL(o,"https://foo.bar")}catch{try{return new URL(decodeURIComponent(o),"https://foo.bar")}catch{return null}}}}})(d);if(!s)return t;const i=o=>{try{let l=decodeURIComponent(o);return l.includes("/")?(l=l.split("/").at(-1),l.test(/^\.pdf$/i)?l:o):l}catch{return o}},n=/\.pdf$/i,a=s.pathname.split("/").at(-1);if(n.test(a))return i(a);if(s.searchParams.size>0){const o=Array.from(s.searchParams.values()).reverse();for(const h of o)if(n.test(h))return i(h);const l=Array.from(s.searchParams.keys()).reverse();for(const h of l)if(n.test(h))return i(h)}if(s.hash){const l=/[^/?#=]+\.pdf\b(?!.*\.pdf\b)/i.exec(s.hash);if(l)return i(l[0])}return t}class Bu{constructor(){L(this,"started",Object.create(null));L(this,"times",[])}time(t){t in this.started&&V(`Timer is already running for ${t}`),this.started[t]=Date.now()}timeEnd(t){t in this.started||V(`Timer has not been started for ${t}`),this.times.push({name:t,start:this.started[t],end:Date.now()}),delete this.started[t]}toString(){const t=[];let e=0;for(const{name:s}of this.times)e=Math.max(s.length,e);for(const{name:s,start:i,end:n}of this.times)t.push(`${s.padEnd(e)} ${n-i}ms
`);return t.join("")}}function mo(d,t){const e=t?URL.parse(d,t):URL.parse(d);return(e==null?void 0:e.protocol)==="http:"||(e==null?void 0:e.protocol)==="https:"}function Ye(d){d.preventDefault()}function Et(d){d.preventDefault(),d.stopPropagation()}function Dg(d){console.log("Deprecated API usage: "+d)}var Oo;class ac{static toDateObject(t){if(t instanceof Date)return t;if(!t||typeof t!="string")return null;r(this,Oo)||f(this,Oo,new RegExp("^D:(\\d{4})(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?(\\d{2})?([Z|+|-])?(\\d{2})?'?(\\d{2})?'?"));const e=r(this,Oo).exec(t);if(!e)return null;const s=parseInt(e[1],10);let i=parseInt(e[2],10);i=i>=1&&i<=12?i-1:0;let n=parseInt(e[3],10);n=n>=1&&n<=31?n:1;let a=parseInt(e[4],10);a=a>=0&&a<=23?a:0;let o=parseInt(e[5],10);o=o>=0&&o<=59?o:0;let l=parseInt(e[6],10);l=l>=0&&l<=59?l:0;const h=e[7]||"Z";let c=parseInt(e[8],10);c=c>=0&&c<=23?c:0;let u=parseInt(e[9],10)||0;return u=u>=0&&u<=59?u:0,h==="-"?(a+=c,o+=u):h==="+"&&(a-=c,o-=u),new Date(Date.UTC(s,i,n,a,o,l))}}Oo=new WeakMap,g(ac,Oo);function Mg(d,{scale:t=1,rotation:e=0}){const{width:s,height:i}=d.attributes.style,n=[0,0,parseInt(s),parseInt(i)];return new gh({viewBox:n,userUnit:1,scale:t,rotation:e})}function $c(d){if(d.startsWith("#")){const t=parseInt(d.slice(1),16);return[(t&16711680)>>16,(t&65280)>>8,t&255]}return d.startsWith("rgb(")?d.slice(4,-1).split(",").map(t=>parseInt(t)):d.startsWith("rgba(")?d.slice(5,-1).split(",").map(t=>parseInt(t)).slice(0,3):(V(`Not a valid color format: "${d}"`),[0,0,0])}function Ng(d){const t=document.createElement("span");t.style.visibility="hidden",t.style.colorScheme="only light",document.body.append(t);for(const e of d.keys()){t.style.color=e;const s=window.getComputedStyle(t).color;d.set(e,$c(s))}t.remove()}function pt(d){const{a:t,b:e,c:s,d:i,e:n,f:a}=d.getTransform();return[t,e,s,i,n,a]}function us(d){const{a:t,b:e,c:s,d:i,e:n,f:a}=d.getTransform().invertSelf();return[t,e,s,i,n,a]}function Fr(d,t,e=!1,s=!0){if(t instanceof gh){const{pageWidth:i,pageHeight:n}=t.rawDims,{style:a}=d,o=Xt.isCSSRoundSupported,l=`var(--total-scale-factor) * ${i}px`,h=`var(--total-scale-factor) * ${n}px`,c=o?`round(down, ${l}, var(--scale-round-x))`:`calc(${l})`,u=o?`round(down, ${h}, var(--scale-round-y))`:`calc(${h})`;!e||t.rotation%180===0?(a.width=c,a.height=u):(a.width=u,a.height=c)}s&&d.setAttribute("data-main-rotation",t.rotation)}class Fs{constructor(){const{pixelRatio:t}=Fs;this.sx=t,this.sy=t}get scaled(){return this.sx!==1||this.sy!==1}get symmetric(){return this.sx===this.sy}limitCanvas(t,e,s,i,n=-1){let a=1/0,o=1/0,l=1/0;s=Fs.capPixels(s,n),s>0&&(a=Math.sqrt(s/(t*e))),i!==-1&&(o=i/t,l=i/e);const h=Math.min(a,o,l);return this.sx>h||this.sy>h?(this.sx=h,this.sy=h,!0):!1}static get pixelRatio(){return globalThis.devicePixelRatio||1}static capPixels(t,e){if(e>=0){const s=Math.ceil(window.screen.availWidth*window.screen.availHeight*this.pixelRatio**2*(1+e/100));return t>0?Math.min(t,s):s}return t}}const id=["image/apng","image/avif","image/bmp","image/gif","image/jpeg","image/png","image/svg+xml","image/webp","image/x-icon"];var Pi,Ri,$e,Gs,$o,ea,sa,Ho,mc,cf,qt,df,uf,Gr,yo;const zs=class zs{constructor(t){g(this,qt);g(this,Pi,null);g(this,Ri,null);g(this,$e);g(this,Gs,null);g(this,$o,null);g(this,ea,null);g(this,sa,null);f(this,$e,t),r(zs,Ho)||f(zs,Ho,Object.freeze({freetext:"pdfjs-editor-remove-freetext-button",highlight:"pdfjs-editor-remove-highlight-button",ink:"pdfjs-editor-remove-ink-button",stamp:"pdfjs-editor-remove-stamp-button",signature:"pdfjs-editor-remove-signature-button"}))}render(){const t=f(this,Pi,document.createElement("div"));t.classList.add("editToolbar","hidden"),t.setAttribute("role","toolbar");const e=r(this,$e)._uiManager._signal;t.addEventListener("contextmenu",Ye,{signal:e}),t.addEventListener("pointerdown",m(zs,mc,cf),{signal:e});const s=f(this,Gs,document.createElement("div"));s.className="buttons",t.append(s);const i=r(this,$e).toolbarPosition;if(i){const{style:n}=t,a=r(this,$e)._uiManager.direction==="ltr"?1-i[0]:i[0];n.insetInlineEnd=`${100*a}%`,n.top=`calc(${100*i[1]}% + var(--editor-toolbar-vert-offset))`}return t}get div(){return r(this,Pi)}hide(){var t;r(this,Pi).classList.add("hidden"),(t=r(this,Ri))==null||t.hideDropdown()}show(){var t,e;r(this,Pi).classList.remove("hidden"),(t=r(this,$o))==null||t.shown(),(e=r(this,ea))==null||e.shown()}addDeleteButton(){const{editorType:t,_uiManager:e}=r(this,$e),s=document.createElement("button");s.className="delete",s.tabIndex=0,s.setAttribute("data-l10n-id",r(zs,Ho)[t]),m(this,qt,Gr).call(this,s),s.addEventListener("click",i=>{e.delete()},{signal:e._signal}),r(this,Gs).append(s)}async addAltText(t){const e=await t.render();m(this,qt,Gr).call(this,e),r(this,Gs).append(e,r(this,qt,yo)),f(this,$o,t)}addComment(t){if(r(this,ea))return;const e=t.render();e&&(m(this,qt,Gr).call(this,e),r(this,Gs).prepend(e,r(this,qt,yo)),f(this,ea,t),t.toolbar=this)}addColorPicker(t){if(r(this,Ri))return;f(this,Ri,t);const e=t.renderButton();m(this,qt,Gr).call(this,e),r(this,Gs).append(e,r(this,qt,yo))}async addEditSignatureButton(t){const e=f(this,sa,await t.renderEditButton(r(this,$e)));m(this,qt,Gr).call(this,e),r(this,Gs).append(e,r(this,qt,yo))}async addButton(t,e){switch(t){case"colorPicker":this.addColorPicker(e);break;case"altText":await this.addAltText(e);break;case"editSignature":await this.addEditSignatureButton(e);break;case"delete":this.addDeleteButton();break;case"comment":this.addComment(e);break}}updateEditSignatureButton(t){r(this,sa)&&(r(this,sa).title=t)}remove(){var t;r(this,Pi).remove(),(t=r(this,Ri))==null||t.destroy(),f(this,Ri,null)}};Pi=new WeakMap,Ri=new WeakMap,$e=new WeakMap,Gs=new WeakMap,$o=new WeakMap,ea=new WeakMap,sa=new WeakMap,Ho=new WeakMap,mc=new WeakSet,cf=function(t){t.stopPropagation()},qt=new WeakSet,df=function(t){r(this,$e)._focusEventsAllowed=!1,Et(t)},uf=function(t){r(this,$e)._focusEventsAllowed=!0,Et(t)},Gr=function(t){const e=r(this,$e)._uiManager._signal;t.addEventListener("focusin",m(this,qt,df).bind(this),{capture:!0,signal:e}),t.addEventListener("focusout",m(this,qt,uf).bind(this),{capture:!0,signal:e}),t.addEventListener("contextmenu",Ye,{signal:e})},yo=function(){const t=document.createElement("div");return t.className="divider",t},g(zs,mc),g(zs,Ho,null);let nd=zs;var Uo,Rn,kn,wn,ff,pf,gf;class Fg{constructor(t){g(this,wn);g(this,Uo,null);g(this,Rn,null);g(this,kn);f(this,kn,t)}show(t,e,s){const[i,n]=m(this,wn,pf).call(this,e,s),{style:a}=r(this,Rn)||f(this,Rn,m(this,wn,ff).call(this));t.append(r(this,Rn)),a.insetInlineEnd=`${100*i}%`,a.top=`calc(${100*n}% + var(--editor-toolbar-vert-offset))`}hide(){r(this,Rn).remove()}}Uo=new WeakMap,Rn=new WeakMap,kn=new WeakMap,wn=new WeakSet,ff=function(){const t=f(this,Rn,document.createElement("div"));t.className="editToolbar",t.setAttribute("role","toolbar"),t.addEventListener("contextmenu",Ye,{signal:r(this,kn)._signal});const e=f(this,Uo,document.createElement("div"));return e.className="buttons",t.append(e),m(this,wn,gf).call(this),t},pf=function(t,e){let s=0,i=0;for(const n of t){const a=n.y+n.height;if(a<s)continue;const o=n.x+(e?n.width:0);if(a>s){i=o,s=a;continue}e?o>i&&(i=o):o<i&&(i=o)}return[e?1-i:i,s]},gf=function(){const t=document.createElement("button");t.className="highlightButton",t.tabIndex=0,t.setAttribute("data-l10n-id","pdfjs-highlight-floating-button1");const e=document.createElement("span");t.append(e),e.className="visuallyHidden",e.setAttribute("data-l10n-id","pdfjs-highlight-floating-button-label");const s=r(this,kn)._signal;t.addEventListener("contextmenu",Ye,{signal:s}),t.addEventListener("click",()=>{r(this,kn).highlightSelection("floating_button")},{signal:s}),r(this,Uo).append(t)};function mf(d,t,e){for(const s of e)t.addEventListener(s,d[s].bind(d))}var yc;class Bg{constructor(){g(this,yc,0)}get id(){return`${nf}${ee(this,yc)._++}`}}yc=new WeakMap;var ia,zo,Jt,na,Ih;const Lu=class Lu{constructor(){g(this,na);g(this,ia,lf());g(this,zo,0);g(this,Jt,null)}static get _isSVGFittingCanvas(){const t='data:image/svg+xml;charset=UTF-8,<svg viewBox="0 0 1 1" width="1" height="1" xmlns="http://www.w3.org/2000/svg"><rect width="1" height="1" style="fill:red;"/></svg>',s=new OffscreenCanvas(1,3).getContext("2d",{willReadFrequently:!0}),i=new Image;i.src=t;const n=i.decode().then(()=>(s.drawImage(i,0,0,1,1,0,0,1,3),new Uint32Array(s.getImageData(0,0,1,1).data.buffer)[0]===0));return q(this,"_isSVGFittingCanvas",n)}async getFromFile(t){const{lastModified:e,name:s,size:i,type:n}=t;return m(this,na,Ih).call(this,`${e}_${s}_${i}_${n}`,t)}async getFromUrl(t){return m(this,na,Ih).call(this,t,t)}async getFromBlob(t,e){const s=await e;return m(this,na,Ih).call(this,t,s)}async getFromId(t){r(this,Jt)||f(this,Jt,new Map);const e=r(this,Jt).get(t);if(!e)return null;if(e.bitmap)return e.refCounter+=1,e;if(e.file)return this.getFromFile(e.file);if(e.blobPromise){const{blobPromise:s}=e;return delete e.blobPromise,this.getFromBlob(e.id,s)}return this.getFromUrl(e.url)}getFromCanvas(t,e){r(this,Jt)||f(this,Jt,new Map);let s=r(this,Jt).get(t);if(s!=null&&s.bitmap)return s.refCounter+=1,s;const i=new OffscreenCanvas(e.width,e.height);return i.getContext("2d").drawImage(e,0,0),s={bitmap:i.transferToImageBitmap(),id:`image_${r(this,ia)}_${ee(this,zo)._++}`,refCounter:1,isSvg:!1},r(this,Jt).set(t,s),r(this,Jt).set(s.id,s),s}getSvgUrl(t){const e=r(this,Jt).get(t);return e!=null&&e.isSvg?e.svgUrl:null}deleteId(t){var i;r(this,Jt)||f(this,Jt,new Map);const e=r(this,Jt).get(t);if(!e||(e.refCounter-=1,e.refCounter!==0))return;const{bitmap:s}=e;if(!e.url&&!e.file){const n=new OffscreenCanvas(s.width,s.height);n.getContext("bitmaprenderer").transferFromImageBitmap(s),e.blobPromise=n.convertToBlob()}(i=s.close)==null||i.call(s),e.bitmap=null}isValidId(t){return t.startsWith(`image_${r(this,ia)}_`)}};ia=new WeakMap,zo=new WeakMap,Jt=new WeakMap,na=new WeakSet,Ih=async function(t,e){r(this,Jt)||f(this,Jt,new Map);let s=r(this,Jt).get(t);if(s===null)return null;if(s!=null&&s.bitmap)return s.refCounter+=1,s;try{s||(s={bitmap:null,id:`image_${r(this,ia)}_${ee(this,zo)._++}`,refCounter:0,isSvg:!1});let i;if(typeof e=="string"?(s.url=e,i=await ph(e,"blob")):e instanceof File?i=s.file=e:e instanceof Blob&&(i=e),i.type==="image/svg+xml"){const n=Lu._isSVGFittingCanvas,a=new FileReader,o=new Image,l=new Promise((h,c)=>{o.onload=()=>{s.bitmap=o,s.isSvg=!0,h()},a.onload=async()=>{const u=s.svgUrl=a.result;o.src=await n?`${u}#svgView(preserveAspectRatio(none))`:u},o.onerror=a.onerror=c});a.readAsDataURL(i),await l}else s.bitmap=await createImageBitmap(i);s.refCounter=1}catch(i){V(i),s=null}return r(this,Jt).set(t,s),s&&r(this,Jt).set(s.id,s),s};let rd=Lu;var bt,ki,Vo,ft;class Og{constructor(t=128){g(this,bt,[]);g(this,ki,!1);g(this,Vo);g(this,ft,-1);f(this,Vo,t)}add({cmd:t,undo:e,post:s,mustExec:i,type:n=NaN,overwriteIfSameType:a=!1,keepUndo:o=!1}){if(i&&t(),r(this,ki))return;const l={cmd:t,undo:e,post:s,type:n};if(r(this,ft)===-1){r(this,bt).length>0&&(r(this,bt).length=0),f(this,ft,0),r(this,bt).push(l);return}if(a&&r(this,bt)[r(this,ft)].type===n){o&&(l.undo=r(this,bt)[r(this,ft)].undo),r(this,bt)[r(this,ft)]=l;return}const h=r(this,ft)+1;h===r(this,Vo)?r(this,bt).splice(0,1):(f(this,ft,h),h<r(this,bt).length&&r(this,bt).splice(h)),r(this,bt).push(l)}undo(){if(r(this,ft)===-1)return;f(this,ki,!0);const{undo:t,post:e}=r(this,bt)[r(this,ft)];t(),e==null||e(),f(this,ki,!1),f(this,ft,r(this,ft)-1)}redo(){if(r(this,ft)<r(this,bt).length-1){f(this,ft,r(this,ft)+1),f(this,ki,!0);const{cmd:t,post:e}=r(this,bt)[r(this,ft)];t(),e==null||e(),f(this,ki,!1)}}hasSomethingToUndo(){return r(this,ft)!==-1}hasSomethingToRedo(){return r(this,ft)<r(this,bt).length-1}cleanType(t){if(r(this,ft)!==-1){for(let e=r(this,ft);e>=0;e--)if(r(this,bt)[e].type!==t){r(this,bt).splice(e+1,r(this,ft)-e),f(this,ft,e);return}r(this,bt).length=0,f(this,ft,-1)}}destroy(){f(this,bt,null)}}bt=new WeakMap,ki=new WeakMap,Vo=new WeakMap,ft=new WeakMap;var bc,yf;class mh{constructor(t){g(this,bc);this.buffer=[],this.callbacks=new Map,this.allKeys=new Set;const{isMac:e}=Xt.platform;for(const[s,i,n={}]of t)for(const a of s){const o=a.startsWith("mac+");e&&o?(this.callbacks.set(a.slice(4),{callback:i,options:n}),this.allKeys.add(a.split("+").at(-1))):!e&&!o&&(this.callbacks.set(a,{callback:i,options:n}),this.allKeys.add(a.split("+").at(-1)))}}exec(t,e){if(!this.allKeys.has(e.key))return;const s=this.callbacks.get(m(this,bc,yf).call(this,e));if(!s)return;const{callback:i,options:{bubbles:n=!1,args:a=[],checker:o=null}}=s;o&&!o(t,e)||(i.bind(t,...a,e)(),n||Et(e))}}bc=new WeakSet,yf=function(t){t.altKey&&this.buffer.push("alt"),t.ctrlKey&&this.buffer.push("ctrl"),t.metaKey&&this.buffer.push("meta"),t.shiftKey&&this.buffer.push("shift"),this.buffer.push(t.key);const e=this.buffer.join("+");return this.buffer.length=0,e};const Ac=class Ac{get _colors(){const t=new Map([["CanvasText",null],["Canvas",null]]);return Ng(t),q(this,"_colors",t)}convert(t){const e=$c(t);if(!window.matchMedia("(forced-colors: active)").matches)return e;for(const[s,i]of this._colors)if(i.every((n,a)=>n===e[a]))return Ac._colorsMapping.get(s);return e}getHexCode(t){const e=this._colors.get(t);return e?H.makeHexColor(...e):t}};L(Ac,"_colorsMapping",new Map([["CanvasText",[0,0,0]],["Canvas",[255,255,255]]]));let ad=Ac;var ra,be,Lt,$t,aa,js,oa,He,Dn,Di,Mi,la,Mn,gs,Je,Nn,Go,jo,ha,Wo,ms,Ni,ca,Fi,ys,vc,Bi,qo,Oi,Fn,da,$i,Xo,kt,st,Ws,Hi,Ui,Yo,Ko,zi,bs,qs,Jo,Qo,Ue,R,Ph,od,bf,Af,Rh,vf,wf,Sf,ld,Ef,hd,cd,_f,se,Hs,Cf,Tf,dd,xf,bo,ud;const Qr=class Qr{constructor(t,e,s,i,n,a,o,l,h,c,u,p,y,A,b,w){g(this,R);g(this,ra,new AbortController);g(this,be,null);g(this,Lt,new Map);g(this,$t,new Map);g(this,aa,null);g(this,js,null);g(this,oa,null);g(this,He,new Og);g(this,Dn,null);g(this,Di,null);g(this,Mi,null);g(this,la,0);g(this,Mn,new Set);g(this,gs,null);g(this,Je,null);g(this,Nn,new Set);L(this,"_editorUndoBar",null);g(this,Go,!1);g(this,jo,!1);g(this,ha,!1);g(this,Wo,null);g(this,ms,null);g(this,Ni,null);g(this,ca,null);g(this,Fi,!1);g(this,ys,null);g(this,vc,new Bg);g(this,Bi,!1);g(this,qo,!1);g(this,Oi,null);g(this,Fn,null);g(this,da,null);g(this,$i,null);g(this,Xo,null);g(this,kt,z.NONE);g(this,st,new Set);g(this,Ws,null);g(this,Hi,null);g(this,Ui,null);g(this,Yo,null);g(this,Ko,{isEditing:!1,isEmpty:!0,hasSomethingToUndo:!1,hasSomethingToRedo:!1,hasSelectedEditor:!1,hasSelectedText:!1});g(this,zi,[0,0]);g(this,bs,null);g(this,qs,null);g(this,Jo,null);g(this,Qo,null);g(this,Ue,null);const v=this._signal=r(this,ra).signal;f(this,qs,t),f(this,Jo,e),f(this,Qo,s),f(this,aa,i),f(this,Dn,n),f(this,Hi,a),this._eventBus=o,o._on("editingaction",this.onEditingAction.bind(this),{signal:v}),o._on("pagechanging",this.onPageChanging.bind(this),{signal:v}),o._on("scalechanging",this.onScaleChanging.bind(this),{signal:v}),o._on("rotationchanging",this.onRotationChanging.bind(this),{signal:v}),o._on("setpreference",this.onSetPreference.bind(this),{signal:v}),o._on("switchannotationeditorparams",E=>this.updateParams(E.type,E.value),{signal:v}),m(this,R,vf).call(this),m(this,R,_f).call(this),m(this,R,ld).call(this),f(this,js,l.annotationStorage),f(this,Wo,l.filterFactory),f(this,Ui,h),f(this,ca,c||null),f(this,Go,u),f(this,jo,p),f(this,ha,y),f(this,Xo,A||null),this.viewParameters={realScale:vn.PDF_TO_CSS_UNITS,rotation:0},this.isShiftKeyDown=!1,this._editorUndoBar=b||null,this._supportsPinchToZoom=w!==!1}static get _keyboardManager(){const t=Qr.prototype,e=a=>r(a,qs).contains(document.activeElement)&&document.activeElement.tagName!=="BUTTON"&&a.hasSomethingToControl(),s=(a,{target:o})=>{if(o instanceof HTMLInputElement){const{type:l}=o;return l!=="text"&&l!=="number"}return!0},i=this.TRANSLATE_SMALL,n=this.TRANSLATE_BIG;return q(this,"_keyboardManager",new mh([[["ctrl+a","mac+meta+a"],t.selectAll,{checker:s}],[["ctrl+z","mac+meta+z"],t.undo,{checker:s}],[["ctrl+y","ctrl+shift+z","mac+meta+shift+z","ctrl+shift+Z","mac+meta+shift+Z"],t.redo,{checker:s}],[["Backspace","alt+Backspace","ctrl+Backspace","shift+Backspace","mac+Backspace","mac+alt+Backspace","mac+ctrl+Backspace","Delete","ctrl+Delete","shift+Delete","mac+Delete"],t.delete,{checker:s}],[["Enter","mac+Enter"],t.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&r(a,qs).contains(o)&&!a.isEnterHandled}],[[" ","mac+ "],t.addNewEditorFromKeyboard,{checker:(a,{target:o})=>!(o instanceof HTMLButtonElement)&&r(a,qs).contains(document.activeElement)}],[["Escape","mac+Escape"],t.unselectAll],[["ArrowLeft","mac+ArrowLeft"],t.translateSelectedEditors,{args:[-i,0],checker:e}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t.translateSelectedEditors,{args:[-n,0],checker:e}],[["ArrowRight","mac+ArrowRight"],t.translateSelectedEditors,{args:[i,0],checker:e}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t.translateSelectedEditors,{args:[n,0],checker:e}],[["ArrowUp","mac+ArrowUp"],t.translateSelectedEditors,{args:[0,-i],checker:e}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t.translateSelectedEditors,{args:[0,-n],checker:e}],[["ArrowDown","mac+ArrowDown"],t.translateSelectedEditors,{args:[0,i],checker:e}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t.translateSelectedEditors,{args:[0,n],checker:e}]]))}destroy(){var t,e,s,i,n,a,o,l,h;(t=r(this,Ue))==null||t.resolve(),f(this,Ue,null),(e=r(this,ra))==null||e.abort(),f(this,ra,null),this._signal=null;for(const c of r(this,$t).values())c.destroy();r(this,$t).clear(),r(this,Lt).clear(),r(this,Nn).clear(),(s=r(this,$i))==null||s.clear(),f(this,be,null),r(this,st).clear(),r(this,He).destroy(),(i=r(this,aa))==null||i.destroy(),(n=r(this,Dn))==null||n.destroy(),(a=r(this,Hi))==null||a.destroy(),(o=r(this,ys))==null||o.hide(),f(this,ys,null),(l=r(this,da))==null||l.destroy(),f(this,da,null),r(this,ms)&&(clearTimeout(r(this,ms)),f(this,ms,null)),r(this,bs)&&(clearTimeout(r(this,bs)),f(this,bs,null)),(h=this._editorUndoBar)==null||h.destroy()}combinedSignal(t){return AbortSignal.any([this._signal,t.signal])}get mlManager(){return r(this,Xo)}get useNewAltTextFlow(){return r(this,jo)}get useNewAltTextWhenAddingImage(){return r(this,ha)}get hcmFilter(){return q(this,"hcmFilter",r(this,Ui)?r(this,Wo).addHCMFilter(r(this,Ui).foreground,r(this,Ui).background):"none")}get direction(){return q(this,"direction",getComputedStyle(r(this,qs)).direction)}get _highlightColors(){return q(this,"_highlightColors",r(this,ca)?new Map(r(this,ca).split(",").map(t=>(t=t.split("=").map(e=>e.trim()),t[1]=t[1].toUpperCase(),t))):null)}get highlightColors(){const{_highlightColors:t}=this;if(!t)return q(this,"highlightColors",null);const e=new Map,s=!!r(this,Ui);for(const[i,n]of t){const a=i.endsWith("_HCM");if(s&&a){e.set(i.replace("_HCM",""),n);continue}!s&&!a&&e.set(i,n)}return q(this,"highlightColors",e)}get highlightColorNames(){return q(this,"highlightColorNames",this.highlightColors?new Map(Array.from(this.highlightColors,t=>t.reverse())):null)}getNonHCMColor(t){if(!this._highlightColors)return t;const e=this.highlightColorNames.get(t);return this._highlightColors.get(e)||t}getNonHCMColorName(t){return this.highlightColorNames.get(t)||t}setCurrentDrawingSession(t){t?(this.unselectAll(),this.disableUserSelect(!0)):this.disableUserSelect(!1),f(this,Mi,t)}setMainHighlightColorPicker(t){f(this,da,t)}editAltText(t,e=!1){var s;(s=r(this,aa))==null||s.editAltText(this,t,e)}hasCommentManager(){return!!r(this,Dn)}editComment(t,e){var s;(s=r(this,Dn))==null||s.open(this,t,e)}getSignature(t){var e;(e=r(this,Hi))==null||e.getSignature({uiManager:this,editor:t})}get signatureManager(){return r(this,Hi)}switchToMode(t,e){this._eventBus.on("annotationeditormodechanged",e,{once:!0,signal:this._signal}),this._eventBus.dispatch("showannotationeditorui",{source:this,mode:t})}setPreference(t,e){this._eventBus.dispatch("setpreference",{source:this,name:t,value:e})}onSetPreference({name:t,value:e}){switch(t){case"enableNewAltTextWhenAddingImage":f(this,ha,e);break}}onPageChanging({pageNumber:t}){f(this,la,t-1)}focusMainContainer(){r(this,qs).focus()}findParent(t,e){for(const s of r(this,$t).values()){const{x:i,y:n,width:a,height:o}=s.div.getBoundingClientRect();if(t>=i&&t<=i+a&&e>=n&&e<=n+o)return s}return null}disableUserSelect(t=!1){r(this,Jo).classList.toggle("noUserSelect",t)}addShouldRescale(t){r(this,Nn).add(t)}removeShouldRescale(t){r(this,Nn).delete(t)}onScaleChanging({scale:t}){var e;this.commitOrRemove(),this.viewParameters.realScale=t*vn.PDF_TO_CSS_UNITS;for(const s of r(this,Nn))s.onScaleChanging();(e=r(this,Mi))==null||e.onScaleChanging()}onRotationChanging({pagesRotation:t}){this.commitOrRemove(),this.viewParameters.rotation=t}highlightSelection(t=""){const e=document.getSelection();if(!e||e.isCollapsed)return;const{anchorNode:s,anchorOffset:i,focusNode:n,focusOffset:a}=e,o=e.toString(),h=m(this,R,Ph).call(this,e).closest(".textLayer"),c=this.getSelectionBoxes(h);if(!c)return;e.empty();const u=m(this,R,od).call(this,h),p=r(this,kt)===z.NONE,y=()=>{u==null||u.createAndAddNewEditor({x:0,y:0},!1,{methodOfCreation:t,boxes:c,anchorNode:s,anchorOffset:i,focusNode:n,focusOffset:a,text:o}),p&&this.showAllEditors("highlight",!0,!0)};if(p){this.switchToMode(z.HIGHLIGHT,y);return}y()}addToAnnotationStorage(t){!t.isEmpty()&&r(this,js)&&!r(this,js).has(t.id)&&r(this,js).setValue(t.id,t)}a11yAlert(t,e=null){const s=r(this,Qo);s&&(s.setAttribute("data-l10n-id",t),e?s.setAttribute("data-l10n-args",JSON.stringify(e)):s.removeAttribute("data-l10n-args"))}blur(){if(this.isShiftKeyDown=!1,r(this,Fi)&&(f(this,Fi,!1),m(this,R,Rh).call(this,"main_toolbar")),!this.hasSelection)return;const{activeElement:t}=document;for(const e of r(this,st))if(e.div.contains(t)){f(this,Fn,[e,t]),e._focusEventsAllowed=!1;break}}focus(){if(!r(this,Fn))return;const[t,e]=r(this,Fn);f(this,Fn,null),e.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:this._signal}),e.focus()}addEditListeners(){m(this,R,ld).call(this),m(this,R,hd).call(this)}removeEditListeners(){m(this,R,Ef).call(this),m(this,R,cd).call(this)}dragOver(t){for(const{type:e}of t.dataTransfer.items)for(const s of r(this,Je))if(s.isHandlingMimeForPasting(e)){t.dataTransfer.dropEffect="copy",t.preventDefault();return}}drop(t){for(const e of t.dataTransfer.items)for(const s of r(this,Je))if(s.isHandlingMimeForPasting(e.type)){s.paste(e,this.currentLayer),t.preventDefault();return}}copy(t){var s;if(t.preventDefault(),(s=r(this,be))==null||s.commitOrRemove(),!this.hasSelection)return;const e=[];for(const i of r(this,st)){const n=i.serialize(!0);n&&e.push(n)}e.length!==0&&t.clipboardData.setData("application/pdfjs",JSON.stringify(e))}cut(t){this.copy(t),this.delete()}async paste(t){t.preventDefault();const{clipboardData:e}=t;for(const n of e.items)for(const a of r(this,Je))if(a.isHandlingMimeForPasting(n.type)){a.paste(n,this.currentLayer);return}let s=e.getData("application/pdfjs");if(!s)return;try{s=JSON.parse(s)}catch(n){V(`paste: "${n.message}".`);return}if(!Array.isArray(s))return;this.unselectAll();const i=this.currentLayer;try{const n=[];for(const l of s){const h=await i.deserialize(l);if(!h)return;n.push(h)}const a=()=>{for(const l of n)m(this,R,dd).call(this,l);m(this,R,ud).call(this,n)},o=()=>{for(const l of n)l.remove()};this.addCommands({cmd:a,undo:o,mustExec:!0})}catch(n){V(`paste: "${n.message}".`)}}keydown(t){!this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!0),r(this,kt)!==z.NONE&&!this.isEditorHandlingKeyboard&&Qr._keyboardManager.exec(this,t)}keyup(t){this.isShiftKeyDown&&t.key==="Shift"&&(this.isShiftKeyDown=!1,r(this,Fi)&&(f(this,Fi,!1),m(this,R,Rh).call(this,"main_toolbar")))}onEditingAction({name:t}){switch(t){case"undo":case"redo":case"delete":case"selectAll":this[t]();break;case"highlightSelection":this.highlightSelection("context_menu");break}}setEditingState(t){t?(m(this,R,wf).call(this),m(this,R,hd).call(this),m(this,R,se).call(this,{isEditing:r(this,kt)!==z.NONE,isEmpty:m(this,R,bo).call(this),hasSomethingToUndo:r(this,He).hasSomethingToUndo(),hasSomethingToRedo:r(this,He).hasSomethingToRedo(),hasSelectedEditor:!1})):(m(this,R,Sf).call(this),m(this,R,cd).call(this),m(this,R,se).call(this,{isEditing:!1}),this.disableUserSelect(!1))}registerEditorTypes(t){if(!r(this,Je)){f(this,Je,t);for(const e of r(this,Je))m(this,R,Hs).call(this,e.defaultPropertiesToUpdate)}}getId(){return r(this,vc).id}get currentLayer(){return r(this,$t).get(r(this,la))}getLayer(t){return r(this,$t).get(t)}get currentPageIndex(){return r(this,la)}addLayer(t){r(this,$t).set(t.pageIndex,t),r(this,Bi)?t.enable():t.disable()}removeLayer(t){r(this,$t).delete(t.pageIndex)}async updateMode(t,e=null,s=!1,i=!1,n=!1){var a,o,l;if(r(this,kt)!==t&&!(r(this,Ue)&&(await r(this,Ue).promise,!r(this,Ue)))){if(f(this,Ue,Promise.withResolvers()),(a=r(this,Mi))==null||a.commitOrRemove(),f(this,kt,t),t===z.NONE){this.setEditingState(!1),m(this,R,Tf).call(this),(o=this._editorUndoBar)==null||o.hide(),r(this,Ue).resolve();return}t===z.SIGNATURE&&await((l=r(this,Hi))==null?void 0:l.loadSignatures()),this.setEditingState(!0),await m(this,R,Cf).call(this),this.unselectAll();for(const h of r(this,$t).values())h.updateMode(t);if(!e){s&&this.addNewEditorFromKeyboard(),r(this,Ue).resolve();return}for(const h of r(this,Lt).values())h.annotationElementId===e||h.id===e?(this.setSelected(h),n?h.editComment():i&&h.enterInEditMode()):h.unselect();r(this,Ue).resolve()}}addNewEditorFromKeyboard(){this.currentLayer.canCreateNewEmptyEditor()&&this.currentLayer.addNewEditor()}updateToolbar(t){t.mode!==r(this,kt)&&this._eventBus.dispatch("switchannotationeditormode",{source:this,...t})}updateParams(t,e){if(r(this,Je)){switch(t){case Y.CREATE:this.currentLayer.addNewEditor(e);return;case Y.HIGHLIGHT_SHOW_ALL:this._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:{type:"highlight",action:"toggle_visibility"}}}),(r(this,Yo)||f(this,Yo,new Map)).set(t,e),this.showAllEditors("highlight",e);break}if(this.hasSelection)for(const s of r(this,st))s.updateParams(t,e);else for(const s of r(this,Je))s.updateDefaultParams(t,e)}}showAllEditors(t,e,s=!1){var n;for(const a of r(this,Lt).values())a.editorType===t&&a.show(e);(((n=r(this,Yo))==null?void 0:n.get(Y.HIGHLIGHT_SHOW_ALL))??!0)!==e&&m(this,R,Hs).call(this,[[Y.HIGHLIGHT_SHOW_ALL,e]])}enableWaiting(t=!1){if(r(this,qo)!==t){f(this,qo,t);for(const e of r(this,$t).values())t?e.disableClick():e.enableClick(),e.div.classList.toggle("waiting",t)}}getEditors(t){const e=[];for(const s of r(this,Lt).values())s.pageIndex===t&&e.push(s);return e}getEditor(t){return r(this,Lt).get(t)}addEditor(t){r(this,Lt).set(t.id,t)}removeEditor(t){var e,s;t.div.contains(document.activeElement)&&(r(this,ms)&&clearTimeout(r(this,ms)),f(this,ms,setTimeout(()=>{this.focusMainContainer(),f(this,ms,null)},0))),r(this,Lt).delete(t.id),t.annotationElementId&&((e=r(this,$i))==null||e.delete(t.annotationElementId)),this.unselect(t),(!t.annotationElementId||!r(this,Mn).has(t.annotationElementId))&&((s=r(this,js))==null||s.remove(t.id))}addDeletedAnnotationElement(t){r(this,Mn).add(t.annotationElementId),this.addChangedExistingAnnotation(t),t.deleted=!0}isDeletedAnnotationElement(t){return r(this,Mn).has(t)}removeDeletedAnnotationElement(t){r(this,Mn).delete(t.annotationElementId),this.removeChangedExistingAnnotation(t),t.deleted=!1}setActiveEditor(t){r(this,be)!==t&&(f(this,be,t),t&&m(this,R,Hs).call(this,t.propertiesToUpdate))}updateUI(t){r(this,R,xf)===t&&m(this,R,Hs).call(this,t.propertiesToUpdate)}updateUIForDefaultProperties(t){m(this,R,Hs).call(this,t.defaultPropertiesToUpdate)}toggleSelected(t){if(r(this,st).has(t)){r(this,st).delete(t),t.unselect(),m(this,R,se).call(this,{hasSelectedEditor:this.hasSelection});return}r(this,st).add(t),t.select(),m(this,R,Hs).call(this,t.propertiesToUpdate),m(this,R,se).call(this,{hasSelectedEditor:!0})}setSelected(t){var e;this.updateToolbar({mode:t.mode,editId:t.id}),(e=r(this,Mi))==null||e.commitOrRemove();for(const s of r(this,st))s!==t&&s.unselect();r(this,st).clear(),r(this,st).add(t),t.select(),m(this,R,Hs).call(this,t.propertiesToUpdate),m(this,R,se).call(this,{hasSelectedEditor:!0})}isSelected(t){return r(this,st).has(t)}get firstSelectedEditor(){return r(this,st).values().next().value}unselect(t){t.unselect(),r(this,st).delete(t),m(this,R,se).call(this,{hasSelectedEditor:this.hasSelection})}get hasSelection(){return r(this,st).size!==0}get isEnterHandled(){return r(this,st).size===1&&this.firstSelectedEditor.isEnterHandled}undo(){var t;r(this,He).undo(),m(this,R,se).call(this,{hasSomethingToUndo:r(this,He).hasSomethingToUndo(),hasSomethingToRedo:!0,isEmpty:m(this,R,bo).call(this)}),(t=this._editorUndoBar)==null||t.hide()}redo(){r(this,He).redo(),m(this,R,se).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:r(this,He).hasSomethingToRedo(),isEmpty:m(this,R,bo).call(this)})}addCommands(t){r(this,He).add(t),m(this,R,se).call(this,{hasSomethingToUndo:!0,hasSomethingToRedo:!1,isEmpty:m(this,R,bo).call(this)})}cleanUndoStack(t){r(this,He).cleanType(t)}delete(){var n;this.commitOrRemove();const t=(n=this.currentLayer)==null?void 0:n.endDrawingSession(!0);if(!this.hasSelection&&!t)return;const e=t?[t]:[...r(this,st)],s=()=>{var a;(a=this._editorUndoBar)==null||a.show(i,e.length===1?e[0].editorType:e.length);for(const o of e)o.remove()},i=()=>{for(const a of e)m(this,R,dd).call(this,a)};this.addCommands({cmd:s,undo:i,mustExec:!0})}commitOrRemove(){var t;(t=r(this,be))==null||t.commitOrRemove()}hasSomethingToControl(){return r(this,be)||this.hasSelection}selectAll(){for(const t of r(this,st))t.commit();m(this,R,ud).call(this,r(this,Lt).values())}unselectAll(){var t;if(!(r(this,be)&&(r(this,be).commitOrRemove(),r(this,kt)!==z.NONE))&&!((t=r(this,Mi))!=null&&t.commitOrRemove())&&this.hasSelection){for(const e of r(this,st))e.unselect();r(this,st).clear(),m(this,R,se).call(this,{hasSelectedEditor:!1})}}translateSelectedEditors(t,e,s=!1){if(s||this.commitOrRemove(),!this.hasSelection)return;r(this,zi)[0]+=t,r(this,zi)[1]+=e;const[i,n]=r(this,zi),a=[...r(this,st)],o=1e3;r(this,bs)&&clearTimeout(r(this,bs)),f(this,bs,setTimeout(()=>{f(this,bs,null),r(this,zi)[0]=r(this,zi)[1]=0,this.addCommands({cmd:()=>{for(const l of a)r(this,Lt).has(l.id)&&(l.translateInPage(i,n),l.translationDone())},undo:()=>{for(const l of a)r(this,Lt).has(l.id)&&(l.translateInPage(-i,-n),l.translationDone())},mustExec:!1})},o));for(const l of a)l.translateInPage(t,e),l.translationDone()}setUpDragSession(){if(this.hasSelection){this.disableUserSelect(!0),f(this,gs,new Map);for(const t of r(this,st))r(this,gs).set(t,{savedX:t.x,savedY:t.y,savedPageIndex:t.pageIndex,newX:0,newY:0,newPageIndex:-1})}}endDragSession(){if(!r(this,gs))return!1;this.disableUserSelect(!1);const t=r(this,gs);f(this,gs,null);let e=!1;for(const[{x:i,y:n,pageIndex:a},o]of t)o.newX=i,o.newY=n,o.newPageIndex=a,e||(e=i!==o.savedX||n!==o.savedY||a!==o.savedPageIndex);if(!e)return!1;const s=(i,n,a,o)=>{if(r(this,Lt).has(i.id)){const l=r(this,$t).get(o);l?i._setParentAndPosition(l,n,a):(i.pageIndex=o,i.x=n,i.y=a)}};return this.addCommands({cmd:()=>{for(const[i,{newX:n,newY:a,newPageIndex:o}]of t)s(i,n,a,o)},undo:()=>{for(const[i,{savedX:n,savedY:a,savedPageIndex:o}]of t)s(i,n,a,o)},mustExec:!0}),!0}dragSelectedEditors(t,e){if(r(this,gs))for(const s of r(this,gs).keys())s.drag(t,e)}rebuild(t){if(t.parent===null){const e=this.getLayer(t.pageIndex);e?(e.changeParent(t),e.addOrRebuild(t)):(this.addEditor(t),this.addToAnnotationStorage(t),t.rebuild())}else t.parent.addOrRebuild(t)}get isEditorHandlingKeyboard(){var t;return((t=this.getActive())==null?void 0:t.shouldGetKeyboardEvents())||r(this,st).size===1&&this.firstSelectedEditor.shouldGetKeyboardEvents()}isActive(t){return r(this,be)===t}getActive(){return r(this,be)}getMode(){return r(this,kt)}get imageManager(){return q(this,"imageManager",new rd)}getSelectionBoxes(t){if(!t)return null;const e=document.getSelection();for(let h=0,c=e.rangeCount;h<c;h++)if(!t.contains(e.getRangeAt(h).commonAncestorContainer))return null;const{x:s,y:i,width:n,height:a}=t.getBoundingClientRect();let o;switch(t.getAttribute("data-main-rotation")){case"90":o=(h,c,u,p)=>({x:(c-i)/a,y:1-(h+u-s)/n,width:p/a,height:u/n});break;case"180":o=(h,c,u,p)=>({x:1-(h+u-s)/n,y:1-(c+p-i)/a,width:u/n,height:p/a});break;case"270":o=(h,c,u,p)=>({x:1-(c+p-i)/a,y:(h-s)/n,width:p/a,height:u/n});break;default:o=(h,c,u,p)=>({x:(h-s)/n,y:(c-i)/a,width:u/n,height:p/a});break}const l=[];for(let h=0,c=e.rangeCount;h<c;h++){const u=e.getRangeAt(h);if(!u.collapsed)for(const{x:p,y,width:A,height:b}of u.getClientRects())A===0||b===0||l.push(o(p,y,A,b))}return l.length===0?null:l}addChangedExistingAnnotation({annotationElementId:t,id:e}){(r(this,oa)||f(this,oa,new Map)).set(t,e)}removeChangedExistingAnnotation({annotationElementId:t}){var e;(e=r(this,oa))==null||e.delete(t)}renderAnnotationElement(t){var i;const e=(i=r(this,oa))==null?void 0:i.get(t.data.id);if(!e)return;const s=r(this,js).getRawValue(e);s&&(r(this,kt)===z.NONE&&!s.hasBeenModified||s.renderAnnotationElement(t))}setMissingCanvas(t,e,s){var n;const i=(n=r(this,$i))==null?void 0:n.get(t);i&&(i.setCanvas(e,s),r(this,$i).delete(t))}addMissingCanvas(t,e){(r(this,$i)||f(this,$i,new Map)).set(t,e)}};ra=new WeakMap,be=new WeakMap,Lt=new WeakMap,$t=new WeakMap,aa=new WeakMap,js=new WeakMap,oa=new WeakMap,He=new WeakMap,Dn=new WeakMap,Di=new WeakMap,Mi=new WeakMap,la=new WeakMap,Mn=new WeakMap,gs=new WeakMap,Je=new WeakMap,Nn=new WeakMap,Go=new WeakMap,jo=new WeakMap,ha=new WeakMap,Wo=new WeakMap,ms=new WeakMap,Ni=new WeakMap,ca=new WeakMap,Fi=new WeakMap,ys=new WeakMap,vc=new WeakMap,Bi=new WeakMap,qo=new WeakMap,Oi=new WeakMap,Fn=new WeakMap,da=new WeakMap,$i=new WeakMap,Xo=new WeakMap,kt=new WeakMap,st=new WeakMap,Ws=new WeakMap,Hi=new WeakMap,Ui=new WeakMap,Yo=new WeakMap,Ko=new WeakMap,zi=new WeakMap,bs=new WeakMap,qs=new WeakMap,Jo=new WeakMap,Qo=new WeakMap,Ue=new WeakMap,R=new WeakSet,Ph=function({anchorNode:t}){return t.nodeType===Node.TEXT_NODE?t.parentElement:t},od=function(t){const{currentLayer:e}=this;if(e.hasTextLayer(t))return e;for(const s of r(this,$t).values())if(s.hasTextLayer(t))return s;return null},bf=function(){const t=document.getSelection();if(!t||t.isCollapsed)return;const s=m(this,R,Ph).call(this,t).closest(".textLayer"),i=this.getSelectionBoxes(s);i&&(r(this,ys)||f(this,ys,new Fg(this)),r(this,ys).show(s,i,this.direction==="ltr"))},Af=function(){var n,a,o;const t=document.getSelection();if(!t||t.isCollapsed){r(this,Ws)&&((n=r(this,ys))==null||n.hide(),f(this,Ws,null),m(this,R,se).call(this,{hasSelectedText:!1}));return}const{anchorNode:e}=t;if(e===r(this,Ws))return;const i=m(this,R,Ph).call(this,t).closest(".textLayer");if(!i){r(this,Ws)&&((a=r(this,ys))==null||a.hide(),f(this,Ws,null),m(this,R,se).call(this,{hasSelectedText:!1}));return}if((o=r(this,ys))==null||o.hide(),f(this,Ws,e),m(this,R,se).call(this,{hasSelectedText:!0}),!(r(this,kt)!==z.HIGHLIGHT&&r(this,kt)!==z.NONE)&&(r(this,kt)===z.HIGHLIGHT&&this.showAllEditors("highlight",!0,!0),f(this,Fi,this.isShiftKeyDown),!this.isShiftKeyDown)){const l=r(this,kt)===z.HIGHLIGHT?m(this,R,od).call(this,i):null;l==null||l.toggleDrawing();const h=new AbortController,c=this.combinedSignal(h),u=p=>{p.type==="pointerup"&&p.button!==0||(h.abort(),l==null||l.toggleDrawing(!0),p.type==="pointerup"&&m(this,R,Rh).call(this,"main_toolbar"))};window.addEventListener("pointerup",u,{signal:c}),window.addEventListener("blur",u,{signal:c})}},Rh=function(t=""){r(this,kt)===z.HIGHLIGHT?this.highlightSelection(t):r(this,Go)&&m(this,R,bf).call(this)},vf=function(){document.addEventListener("selectionchange",m(this,R,Af).bind(this),{signal:this._signal})},wf=function(){if(r(this,Ni))return;f(this,Ni,new AbortController);const t=this.combinedSignal(r(this,Ni));window.addEventListener("focus",this.focus.bind(this),{signal:t}),window.addEventListener("blur",this.blur.bind(this),{signal:t})},Sf=function(){var t;(t=r(this,Ni))==null||t.abort(),f(this,Ni,null)},ld=function(){if(r(this,Oi))return;f(this,Oi,new AbortController);const t=this.combinedSignal(r(this,Oi));window.addEventListener("keydown",this.keydown.bind(this),{signal:t}),window.addEventListener("keyup",this.keyup.bind(this),{signal:t})},Ef=function(){var t;(t=r(this,Oi))==null||t.abort(),f(this,Oi,null)},hd=function(){if(r(this,Di))return;f(this,Di,new AbortController);const t=this.combinedSignal(r(this,Di));document.addEventListener("copy",this.copy.bind(this),{signal:t}),document.addEventListener("cut",this.cut.bind(this),{signal:t}),document.addEventListener("paste",this.paste.bind(this),{signal:t})},cd=function(){var t;(t=r(this,Di))==null||t.abort(),f(this,Di,null)},_f=function(){const t=this._signal;document.addEventListener("dragover",this.dragOver.bind(this),{signal:t}),document.addEventListener("drop",this.drop.bind(this),{signal:t})},se=function(t){Object.entries(t).some(([s,i])=>r(this,Ko)[s]!==i)&&(this._eventBus.dispatch("annotationeditorstateschanged",{source:this,details:Object.assign(r(this,Ko),t)}),r(this,kt)===z.HIGHLIGHT&&t.hasSelectedEditor===!1&&m(this,R,Hs).call(this,[[Y.HIGHLIGHT_FREE,!0]]))},Hs=function(t){this._eventBus.dispatch("annotationeditorparamschanged",{source:this,details:t})},Cf=async function(){if(!r(this,Bi)){f(this,Bi,!0);const t=[];for(const e of r(this,$t).values())t.push(e.enable());await Promise.all(t);for(const e of r(this,Lt).values())e.enable()}},Tf=function(){if(this.unselectAll(),r(this,Bi)){f(this,Bi,!1);for(const t of r(this,$t).values())t.disable();for(const t of r(this,Lt).values())t.disable()}},dd=function(t){const e=r(this,$t).get(t.pageIndex);e?e.addOrRebuild(t):(this.addEditor(t),this.addToAnnotationStorage(t))},xf=function(){let t=null;for(t of r(this,st));return t},bo=function(){if(r(this,Lt).size===0)return!0;if(r(this,Lt).size===1)for(const t of r(this,Lt).values())return t.isEmpty();return!1},ud=function(t){for(const e of r(this,st))e.unselect();r(this,st).clear();for(const e of t)e.isEmpty()||(r(this,st).add(e),e.select());m(this,R,se).call(this,{hasSelectedEditor:this.hasSelection})},L(Qr,"TRANSLATE_SMALL",1),L(Qr,"TRANSLATE_BIG",10);let Br=Qr;var Dt,As,Qe,ua,vs,Ae,fa,ws,fe,Xs,Bn,Ss,Vi,ls,Ao,kh;const ie=class ie{constructor(t){g(this,ls);g(this,Dt,null);g(this,As,!1);g(this,Qe,null);g(this,ua,null);g(this,vs,null);g(this,Ae,null);g(this,fa,!1);g(this,ws,null);g(this,fe,null);g(this,Xs,null);g(this,Bn,null);g(this,Ss,!1);f(this,fe,t),f(this,Ss,t._uiManager.useNewAltTextFlow),r(ie,Vi)||f(ie,Vi,Object.freeze({added:"pdfjs-editor-new-alt-text-added-button","added-label":"pdfjs-editor-new-alt-text-added-button-label",missing:"pdfjs-editor-new-alt-text-missing-button","missing-label":"pdfjs-editor-new-alt-text-missing-button-label",review:"pdfjs-editor-new-alt-text-to-review-button","review-label":"pdfjs-editor-new-alt-text-to-review-button-label"}))}static initialize(t){ie._l10n??(ie._l10n=t)}async render(){const t=f(this,Qe,document.createElement("button"));t.className="altText",t.tabIndex="0";const e=f(this,ua,document.createElement("span"));t.append(e),r(this,Ss)?(t.classList.add("new"),t.setAttribute("data-l10n-id",r(ie,Vi).missing),e.setAttribute("data-l10n-id",r(ie,Vi)["missing-label"])):(t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button"),e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-button-label"));const s=r(this,fe)._uiManager._signal;t.addEventListener("contextmenu",Ye,{signal:s}),t.addEventListener("pointerdown",n=>n.stopPropagation(),{signal:s});const i=n=>{n.preventDefault(),r(this,fe)._uiManager.editAltText(r(this,fe)),r(this,Ss)&&r(this,fe)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_clicked",data:{label:r(this,ls,Ao)}})};return t.addEventListener("click",i,{capture:!0,signal:s}),t.addEventListener("keydown",n=>{n.target===t&&n.key==="Enter"&&(f(this,fa,!0),i(n))},{signal:s}),await m(this,ls,kh).call(this),t}finish(){r(this,Qe)&&(r(this,Qe).focus({focusVisible:r(this,fa)}),f(this,fa,!1))}isEmpty(){return r(this,Ss)?r(this,Dt)===null:!r(this,Dt)&&!r(this,As)}hasData(){return r(this,Ss)?r(this,Dt)!==null||!!r(this,Xs):this.isEmpty()}get guessedText(){return r(this,Xs)}async setGuessedText(t){r(this,Dt)===null&&(f(this,Xs,t),f(this,Bn,await ie._l10n.get("pdfjs-editor-new-alt-text-generated-alt-text-with-disclaimer",{generatedAltText:t})),m(this,ls,kh).call(this))}toggleAltTextBadge(t=!1){var e;if(!r(this,Ss)||r(this,Dt)){(e=r(this,ws))==null||e.remove(),f(this,ws,null);return}if(!r(this,ws)){const s=f(this,ws,document.createElement("div"));s.className="noAltTextBadge",r(this,fe).div.append(s)}r(this,ws).classList.toggle("hidden",!t)}serialize(t){let e=r(this,Dt);return!t&&r(this,Xs)===e&&(e=r(this,Bn)),{altText:e,decorative:r(this,As),guessedText:r(this,Xs),textWithDisclaimer:r(this,Bn)}}get data(){return{altText:r(this,Dt),decorative:r(this,As)}}set data({altText:t,decorative:e,guessedText:s,textWithDisclaimer:i,cancel:n=!1}){s&&(f(this,Xs,s),f(this,Bn,i)),!(r(this,Dt)===t&&r(this,As)===e)&&(n||(f(this,Dt,t),f(this,As,e)),m(this,ls,kh).call(this))}toggle(t=!1){r(this,Qe)&&(!t&&r(this,Ae)&&(clearTimeout(r(this,Ae)),f(this,Ae,null)),r(this,Qe).disabled=!t)}shown(){r(this,fe)._reportTelemetry({action:"pdfjs.image.alt_text.image_status_label_displayed",data:{label:r(this,ls,Ao)}})}destroy(){var t,e;(t=r(this,Qe))==null||t.remove(),f(this,Qe,null),f(this,ua,null),f(this,vs,null),(e=r(this,ws))==null||e.remove(),f(this,ws,null)}};Dt=new WeakMap,As=new WeakMap,Qe=new WeakMap,ua=new WeakMap,vs=new WeakMap,Ae=new WeakMap,fa=new WeakMap,ws=new WeakMap,fe=new WeakMap,Xs=new WeakMap,Bn=new WeakMap,Ss=new WeakMap,Vi=new WeakMap,ls=new WeakSet,Ao=function(){return r(this,Dt)&&"added"||r(this,Dt)===null&&this.guessedText&&"review"||"missing"},kh=async function(){var i,n,a;const t=r(this,Qe);if(!t)return;if(r(this,Ss)){if(t.classList.toggle("done",!!r(this,Dt)),t.setAttribute("data-l10n-id",r(ie,Vi)[r(this,ls,Ao)]),(i=r(this,ua))==null||i.setAttribute("data-l10n-id",r(ie,Vi)[`${r(this,ls,Ao)}-label`]),!r(this,Dt)){(n=r(this,vs))==null||n.remove();return}}else{if(!r(this,Dt)&&!r(this,As)){t.classList.remove("done"),(a=r(this,vs))==null||a.remove();return}t.classList.add("done"),t.setAttribute("data-l10n-id","pdfjs-editor-alt-text-edit-button")}let e=r(this,vs);if(!e){f(this,vs,e=document.createElement("span")),e.className="tooltip",e.setAttribute("role","tooltip"),e.id=`alt-text-tooltip-${r(this,fe).id}`;const o=100,l=r(this,fe)._uiManager._signal;l.addEventListener("abort",()=>{clearTimeout(r(this,Ae)),f(this,Ae,null)},{once:!0}),t.addEventListener("mouseenter",()=>{f(this,Ae,setTimeout(()=>{f(this,Ae,null),r(this,vs).classList.add("show"),r(this,fe)._reportTelemetry({action:"alt_text_tooltip"})},o))},{signal:l}),t.addEventListener("mouseleave",()=>{var h;r(this,Ae)&&(clearTimeout(r(this,Ae)),f(this,Ae,null)),(h=r(this,vs))==null||h.classList.remove("show")},{signal:l})}r(this,As)?e.setAttribute("data-l10n-id","pdfjs-editor-alt-text-decorative-tooltip"):(e.removeAttribute("data-l10n-id"),e.textContent=r(this,Dt)),e.parentNode||t.append(e);const s=r(this,fe).getElementForAltText();s==null||s.setAttribute("aria-describedby",e.id)},g(ie,Vi,null),L(ie,"_l10n",null);let oc=ie;var Es,On,Ze,Zo,Ys,pa,Gi;class vh{constructor(t){g(this,Es,null);g(this,On,!1);g(this,Ze,null);g(this,Zo,null);g(this,Ys,null);g(this,pa,null);g(this,Gi,!1);f(this,Ze,t),this.toolbar=null}render(){if(!r(this,Ze)._uiManager.hasCommentManager())return null;const t=f(this,Es,document.createElement("button"));t.className="comment",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-edit-comment-button");const e=r(this,Ze)._uiManager._signal;t.addEventListener("contextmenu",Ye,{signal:e}),t.addEventListener("pointerdown",i=>i.stopPropagation(),{signal:e});const s=i=>{i.preventDefault(),this.edit()};return t.addEventListener("click",s,{capture:!0,signal:e}),t.addEventListener("keydown",i=>{i.target===t&&i.key==="Enter"&&(f(this,On,!0),s(i))},{signal:e}),t}edit(){const{bottom:t,left:e,right:s}=r(this,Ze).getClientDimensions(),i={top:t};r(this,Ze)._uiManager.direction==="ltr"?i.right=s:i.left=e,r(this,Ze)._uiManager.editComment(r(this,Ze),i)}finish(){r(this,Es)&&(r(this,Es).focus({focusVisible:r(this,On)}),f(this,On,!1))}isDeleted(){return r(this,Gi)||r(this,Ys)===""}hasBeenEdited(){return this.isDeleted()||r(this,Ys)!==r(this,Zo)}serialize(){return this.data}get data(){return{text:r(this,Ys),date:r(this,pa),deleted:r(this,Gi)}}set data(t){if(t===null){f(this,Ys,""),f(this,Gi,!0);return}f(this,Ys,t),f(this,pa,new Date),f(this,Gi,!1)}setInitialText(t){f(this,Zo,t),this.data=t}toggle(t=!1){r(this,Es)&&(r(this,Es).disabled=!t)}shown(){}destroy(){var t;(t=r(this,Es))==null||t.remove(),f(this,Es,null),f(this,Ys,""),f(this,pa,null),f(this,Ze,null),f(this,On,!1),f(this,Gi,!1)}}Es=new WeakMap,On=new WeakMap,Ze=new WeakMap,Zo=new WeakMap,Ys=new WeakMap,pa=new WeakMap,Gi=new WeakMap;var ga,$n,tl,el,sl,il,nl,Ks,Hn,Js,Un,Qs,Sn,Lf,If,Pf;const Iu=class Iu{constructor({container:t,isPinchingDisabled:e=null,isPinchingStopped:s=null,onPinchStart:i=null,onPinching:n=null,onPinchEnd:a=null,signal:o}){g(this,Sn);g(this,ga);g(this,$n,!1);g(this,tl,null);g(this,el);g(this,sl);g(this,il);g(this,nl);g(this,Ks,null);g(this,Hn);g(this,Js,null);g(this,Un);g(this,Qs,null);f(this,ga,t),f(this,tl,s),f(this,el,e),f(this,sl,i),f(this,il,n),f(this,nl,a),f(this,Un,new AbortController),f(this,Hn,AbortSignal.any([o,r(this,Un).signal])),t.addEventListener("touchstart",m(this,Sn,Lf).bind(this),{passive:!1,signal:r(this,Hn)})}get MIN_TOUCH_DISTANCE_TO_PINCH(){return 35/Fs.pixelRatio}destroy(){var t,e;(t=r(this,Un))==null||t.abort(),f(this,Un,null),(e=r(this,Ks))==null||e.abort(),f(this,Ks,null)}};ga=new WeakMap,$n=new WeakMap,tl=new WeakMap,el=new WeakMap,sl=new WeakMap,il=new WeakMap,nl=new WeakMap,Ks=new WeakMap,Hn=new WeakMap,Js=new WeakMap,Un=new WeakMap,Qs=new WeakMap,Sn=new WeakSet,Lf=function(t){var i,n,a;if((i=r(this,el))!=null&&i.call(this))return;if(t.touches.length===1){if(r(this,Ks))return;const o=f(this,Ks,new AbortController),l=AbortSignal.any([r(this,Hn),o.signal]),h=r(this,ga),c={capture:!0,signal:l,passive:!1},u=p=>{var y;p.pointerType==="touch"&&((y=r(this,Ks))==null||y.abort(),f(this,Ks,null))};h.addEventListener("pointerdown",p=>{p.pointerType==="touch"&&(Et(p),u(p))},c),h.addEventListener("pointerup",u,c),h.addEventListener("pointercancel",u,c);return}if(!r(this,Qs)){f(this,Qs,new AbortController);const o=AbortSignal.any([r(this,Hn),r(this,Qs).signal]),l=r(this,ga),h={signal:o,capture:!1,passive:!1};l.addEventListener("touchmove",m(this,Sn,If).bind(this),h);const c=m(this,Sn,Pf).bind(this);l.addEventListener("touchend",c,h),l.addEventListener("touchcancel",c,h),h.capture=!0,l.addEventListener("pointerdown",Et,h),l.addEventListener("pointermove",Et,h),l.addEventListener("pointercancel",Et,h),l.addEventListener("pointerup",Et,h),(n=r(this,sl))==null||n.call(this)}if(Et(t),t.touches.length!==2||(a=r(this,tl))!=null&&a.call(this)){f(this,Js,null);return}let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]),f(this,Js,{touch0X:e.screenX,touch0Y:e.screenY,touch1X:s.screenX,touch1Y:s.screenY})},If=function(t){var _;if(!r(this,Js)||t.touches.length!==2)return;Et(t);let[e,s]=t.touches;e.identifier>s.identifier&&([e,s]=[s,e]);const{screenX:i,screenY:n}=e,{screenX:a,screenY:o}=s,l=r(this,Js),{touch0X:h,touch0Y:c,touch1X:u,touch1Y:p}=l,y=u-h,A=p-c,b=a-i,w=o-n,v=Math.hypot(b,w)||1,E=Math.hypot(y,A)||1;if(!r(this,$n)&&Math.abs(E-v)<=Iu.MIN_TOUCH_DISTANCE_TO_PINCH)return;if(l.touch0X=i,l.touch0Y=n,l.touch1X=a,l.touch1Y=o,!r(this,$n)){f(this,$n,!0);return}const S=[(i+a)/2,(n+o)/2];(_=r(this,il))==null||_.call(this,S,E,v)},Pf=function(t){var e;t.touches.length>=2||(r(this,Qs)&&(r(this,Qs).abort(),f(this,Qs,null),(e=r(this,nl))==null||e.call(this)),r(this,Js)&&(Et(t),f(this,Js,null),f(this,$n,!1)))};let lc=Iu;var zn,ts,ct,Ht,ma,ji,rl,Vn,Ut,Gn,Zs,Wi,al,jn,ve,ol,Wn,ti,_s,ya,ba,ze,qn,ll,wc,U,fd,hl,pd,Dh,Rf,kf,gd,Mh,md,Df,Mf,Nf,yd,Ff,bd,Bf,Of,$f,Ad,vo;const j=class j{constructor(t){g(this,U);g(this,zn,null);g(this,ts,null);g(this,ct,null);g(this,Ht,null);g(this,ma,!1);g(this,ji,null);g(this,rl,"");g(this,Vn,!1);g(this,Ut,null);g(this,Gn,null);g(this,Zs,null);g(this,Wi,null);g(this,al,"");g(this,jn,!1);g(this,ve,null);g(this,ol,!1);g(this,Wn,!1);g(this,ti,!1);g(this,_s,null);g(this,ya,0);g(this,ba,0);g(this,ze,null);g(this,qn,null);L(this,"isSelected",!1);L(this,"_isCopy",!1);L(this,"_editToolbar",null);L(this,"_initialOptions",Object.create(null));L(this,"_initialData",null);L(this,"_isVisible",!0);L(this,"_uiManager",null);L(this,"_focusEventsAllowed",!0);g(this,ll,!1);g(this,wc,j._zIndex++);this.parent=t.parent,this.id=t.id,this.width=this.height=null,this.pageIndex=t.parent.pageIndex,this.name=t.name,this.div=null,this._uiManager=t.uiManager,this.annotationElementId=null,this._willKeepAspectRatio=!1,this._initialOptions.isCentered=t.isCentered,this._structTreeParentId=null,this.annotationElementId=t.annotationElementId||null;const{rotation:e,rawDims:{pageWidth:s,pageHeight:i,pageX:n,pageY:a}}=this.parent.viewport;this.rotation=e,this.pageRotation=(360+e-this._uiManager.viewParameters.rotation)%360,this.pageDimensions=[s,i],this.pageTranslation=[n,a];const[o,l]=this.parentDimensions;this.x=t.x/o,this.y=t.y/l,this.isAttachedToDOM=!1,this.deleted=!1}static get _resizerKeyboardManager(){const t=j.prototype._resizeWithKeyboard,e=Br.TRANSLATE_SMALL,s=Br.TRANSLATE_BIG;return q(this,"_resizerKeyboardManager",new mh([[["ArrowLeft","mac+ArrowLeft"],t,{args:[-e,0]}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],t,{args:[-s,0]}],[["ArrowRight","mac+ArrowRight"],t,{args:[e,0]}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],t,{args:[s,0]}],[["ArrowUp","mac+ArrowUp"],t,{args:[0,-e]}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],t,{args:[0,-s]}],[["ArrowDown","mac+ArrowDown"],t,{args:[0,e]}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],t,{args:[0,s]}],[["Escape","mac+Escape"],j.prototype._stopResizingWithKeyboard]]))}get editorType(){return Object.getPrototypeOf(this).constructor._type}get mode(){return Object.getPrototypeOf(this).constructor._editorType}static get isDrawer(){return!1}static get _defaultLineColor(){return q(this,"_defaultLineColor",this._colorManager.getHexCode("CanvasText"))}static deleteAnnotationElement(t){const e=new $g({id:t.parent.getNextId(),parent:t.parent,uiManager:t._uiManager});e.annotationElementId=t.annotationElementId,e.deleted=!0,e._uiManager.addToAnnotationStorage(e)}static initialize(t,e){if(j._l10n??(j._l10n=t),j._l10nResizer||(j._l10nResizer=Object.freeze({topLeft:"pdfjs-editor-resizer-top-left",topMiddle:"pdfjs-editor-resizer-top-middle",topRight:"pdfjs-editor-resizer-top-right",middleRight:"pdfjs-editor-resizer-middle-right",bottomRight:"pdfjs-editor-resizer-bottom-right",bottomMiddle:"pdfjs-editor-resizer-bottom-middle",bottomLeft:"pdfjs-editor-resizer-bottom-left",middleLeft:"pdfjs-editor-resizer-middle-left"})),j._borderLineWidth!==-1)return;const s=getComputedStyle(document.documentElement);j._borderLineWidth=parseFloat(s.getPropertyValue("--outline-width"))||0}static updateDefaultParams(t,e){}static get defaultPropertiesToUpdate(){return[]}static isHandlingMimeForPasting(t){return!1}static paste(t,e){at("Not implemented")}get propertiesToUpdate(){return[]}get _isDraggable(){return r(this,ll)}set _isDraggable(t){var e;f(this,ll,t),(e=this.div)==null||e.classList.toggle("draggable",t)}get isEnterHandled(){return!0}center(){const[t,e]=this.pageDimensions;switch(this.parentRotation){case 90:this.x-=this.height*e/(t*2),this.y+=this.width*t/(e*2);break;case 180:this.x+=this.width/2,this.y+=this.height/2;break;case 270:this.x+=this.height*e/(t*2),this.y-=this.width*t/(e*2);break;default:this.x-=this.width/2,this.y-=this.height/2;break}this.fixAndSetPosition()}addCommands(t){this._uiManager.addCommands(t)}get currentLayer(){return this._uiManager.currentLayer}setInBackground(){this.div.style.zIndex=0}setInForeground(){this.div.style.zIndex=r(this,wc)}setParent(t){t!==null?(this.pageIndex=t.pageIndex,this.pageDimensions=t.pageDimensions):m(this,U,vo).call(this),this.parent=t}focusin(t){this._focusEventsAllowed&&(r(this,jn)?f(this,jn,!1):this.parent.setSelected(this))}focusout(t){var s;if(!this._focusEventsAllowed||!this.isAttachedToDOM)return;const e=t.relatedTarget;e!=null&&e.closest(`#${this.id}`)||(t.preventDefault(),(s=this.parent)!=null&&s.isMultipleSelection||this.commitOrRemove())}commitOrRemove(){this.isEmpty()?this.remove():this.commit()}commit(){this.isInEditMode()&&this.addToAnnotationStorage()}addToAnnotationStorage(){this._uiManager.addToAnnotationStorage(this)}setAt(t,e,s,i){const[n,a]=this.parentDimensions;[s,i]=this.screenToPageTranslation(s,i),this.x=(t+s)/n,this.y=(e+i)/a,this.fixAndSetPosition()}_moveAfterPaste(t,e){const[s,i]=this.parentDimensions;this.setAt(t*s,e*i,this.width*s,this.height*i),this._onTranslated()}translate(t,e){m(this,U,fd).call(this,this.parentDimensions,t,e)}translateInPage(t,e){r(this,ve)||f(this,ve,[this.x,this.y,this.width,this.height]),m(this,U,fd).call(this,this.pageDimensions,t,e),this.div.scrollIntoView({block:"nearest"})}translationDone(){this._onTranslated(this.x,this.y)}drag(t,e){r(this,ve)||f(this,ve,[this.x,this.y,this.width,this.height]);const{div:s,parentDimensions:[i,n]}=this;if(this.x+=t/i,this.y+=e/n,this.parent&&(this.x<0||this.x>1||this.y<0||this.y>1)){const{x:u,y:p}=this.div.getBoundingClientRect();this.parent.findNewParent(this,u,p)&&(this.x-=Math.floor(this.x),this.y-=Math.floor(this.y))}let{x:a,y:o}=this;const[l,h]=this.getBaseTranslation();a+=l,o+=h;const{style:c}=s;c.left=`${(100*a).toFixed(2)}%`,c.top=`${(100*o).toFixed(2)}%`,this._onTranslating(a,o),s.scrollIntoView({block:"nearest"})}_onTranslating(t,e){}_onTranslated(t,e){}get _hasBeenMoved(){return!!r(this,ve)&&(r(this,ve)[0]!==this.x||r(this,ve)[1]!==this.y)}get _hasBeenResized(){return!!r(this,ve)&&(r(this,ve)[2]!==this.width||r(this,ve)[3]!==this.height)}getBaseTranslation(){const[t,e]=this.parentDimensions,{_borderLineWidth:s}=j,i=s/t,n=s/e;switch(this.rotation){case 90:return[-i,n];case 180:return[i,n];case 270:return[i,-n];default:return[-i,-n]}}get _mustFixPosition(){return!0}fixAndSetPosition(t=this.rotation){const{div:{style:e},pageDimensions:[s,i]}=this;let{x:n,y:a,width:o,height:l}=this;if(o*=s,l*=i,n*=s,a*=i,this._mustFixPosition)switch(t){case 0:n=le(n,0,s-o),a=le(a,0,i-l);break;case 90:n=le(n,0,s-l),a=le(a,o,i);break;case 180:n=le(n,o,s),a=le(a,l,i);break;case 270:n=le(n,l,s),a=le(a,0,i-o);break}this.x=n/=s,this.y=a/=i;const[h,c]=this.getBaseTranslation();n+=h,a+=c,e.left=`${(100*n).toFixed(2)}%`,e.top=`${(100*a).toFixed(2)}%`,this.moveInDOM()}screenToPageTranslation(t,e){var s;return m(s=j,hl,pd).call(s,t,e,this.parentRotation)}pageTranslationToScreen(t,e){var s;return m(s=j,hl,pd).call(s,t,e,360-this.parentRotation)}get parentScale(){return this._uiManager.viewParameters.realScale}get parentRotation(){return(this._uiManager.viewParameters.rotation+this.pageRotation)%360}get parentDimensions(){const{parentScale:t,pageDimensions:[e,s]}=this;return[e*t,s*t]}setDims(t,e){const[s,i]=this.parentDimensions,{style:n}=this.div;n.width=`${(100*t/s).toFixed(2)}%`,r(this,Vn)||(n.height=`${(100*e/i).toFixed(2)}%`)}fixDims(){const{style:t}=this.div,{height:e,width:s}=t,i=s.endsWith("%"),n=!r(this,Vn)&&e.endsWith("%");if(i&&n)return;const[a,o]=this.parentDimensions;i||(t.width=`${(100*parseFloat(s)/a).toFixed(2)}%`),!r(this,Vn)&&!n&&(t.height=`${(100*parseFloat(e)/o).toFixed(2)}%`)}getInitialTranslation(){return[0,0]}_onResized(){}static _round(t){return Math.round(t*1e4)/1e4}_onResizing(){}altTextFinish(){var t;(t=r(this,ct))==null||t.finish()}get toolbarButtons(){return null}async addEditToolbar(){if(this._editToolbar||r(this,Wn))return this._editToolbar;this._editToolbar=new nd(this),this.div.append(this._editToolbar.render()),this._editToolbar.addButton("comment",this.addCommentButton());const{toolbarButtons:t}=this;if(t)for(const[e,s]of t)await this._editToolbar.addButton(e,s);return this._editToolbar.addButton("delete"),this._editToolbar}removeEditToolbar(){var t;this._editToolbar&&(this._editToolbar.remove(),this._editToolbar=null,(t=r(this,ct))==null||t.destroy())}addContainer(t){var s;const e=(s=this._editToolbar)==null?void 0:s.div;e?e.before(t):this.div.append(t)}getClientDimensions(){return this.div.getBoundingClientRect()}createAltText(){return r(this,ct)||(oc.initialize(j._l10n),f(this,ct,new oc(this)),r(this,zn)&&(r(this,ct).data=r(this,zn),f(this,zn,null))),r(this,ct)}get altTextData(){var t;return(t=r(this,ct))==null?void 0:t.data}set altTextData(t){r(this,ct)&&(r(this,ct).data=t)}get guessedAltText(){var t;return(t=r(this,ct))==null?void 0:t.guessedText}async setGuessedAltText(t){var e;await((e=r(this,ct))==null?void 0:e.setGuessedText(t))}serializeAltText(t){var e;return(e=r(this,ct))==null?void 0:e.serialize(t)}hasAltText(){return!!r(this,ct)&&!r(this,ct).isEmpty()}hasAltTextData(){var t;return((t=r(this,ct))==null?void 0:t.hasData())??!1}addCommentButton(){return r(this,Ht)?r(this,Ht):f(this,Ht,new vh(this))}get commentColor(){return null}get comment(){const t=r(this,Ht);return{text:t.data.text,date:t.data.date,deleted:t.isDeleted(),color:this.commentColor}}set comment(t){r(this,Ht)||f(this,Ht,new vh(this)),r(this,Ht).data=t}setCommentData(t){r(this,Ht)||f(this,Ht,new vh(this)),r(this,Ht).setInitialText(t)}get hasEditedComment(){var t;return(t=r(this,Ht))==null?void 0:t.hasBeenEdited()}async editComment(){r(this,Ht)||f(this,Ht,new vh(this)),r(this,Ht).edit()}addComment(t){this.hasEditedComment&&(t.popup={contents:this.comment.text,deleted:this.comment.deleted})}render(){var a;const t=this.div=document.createElement("div");t.setAttribute("data-editor-rotation",(360-this.rotation)%360),t.className=this.name,t.setAttribute("id",this.id),t.tabIndex=r(this,ma)?-1:0,t.setAttribute("role","application"),this.defaultL10nId&&t.setAttribute("data-l10n-id",this.defaultL10nId),this._isVisible||t.classList.add("hidden"),this.setInForeground(),m(this,U,bd).call(this);const[e,s]=this.parentDimensions;this.parentRotation%180!==0&&(t.style.maxWidth=`${(100*s/e).toFixed(2)}%`,t.style.maxHeight=`${(100*e/s).toFixed(2)}%`);const[i,n]=this.getInitialTranslation();return this.translate(i,n),mf(this,t,["keydown","pointerdown","dblclick"]),this.isResizable&&this._uiManager._supportsPinchToZoom&&(r(this,qn)||f(this,qn,new lc({container:t,isPinchingDisabled:()=>!this.isSelected,onPinchStart:m(this,U,Df).bind(this),onPinching:m(this,U,Mf).bind(this),onPinchEnd:m(this,U,Nf).bind(this),signal:this._uiManager._signal}))),(a=this._uiManager._editorUndoBar)==null||a.hide(),t}pointerdown(t){const{isMac:e}=Xt.platform;if(t.button!==0||t.ctrlKey&&e){t.preventDefault();return}if(f(this,jn,!0),this._isDraggable){m(this,U,Ff).call(this,t);return}m(this,U,yd).call(this,t)}_onStartDragging(){}_onStopDragging(){}moveInDOM(){r(this,_s)&&clearTimeout(r(this,_s)),f(this,_s,setTimeout(()=>{var t;f(this,_s,null),(t=this.parent)==null||t.moveEditorInDOM(this)},0))}_setParentAndPosition(t,e,s){t.changeParent(this),this.x=e,this.y=s,this.fixAndSetPosition(),this._onTranslated()}getRect(t,e,s=this.rotation){const i=this.parentScale,[n,a]=this.pageDimensions,[o,l]=this.pageTranslation,h=t/i,c=e/i,u=this.x*n,p=this.y*a,y=this.width*n,A=this.height*a;switch(s){case 0:return[u+h+o,a-p-c-A+l,u+h+y+o,a-p-c+l];case 90:return[u+c+o,a-p+h+l,u+c+A+o,a-p+h+y+l];case 180:return[u-h-y+o,a-p+c+l,u-h+o,a-p+c+A+l];case 270:return[u-c-A+o,a-p-h-y+l,u-c+o,a-p-h+l];default:throw new Error("Invalid rotation")}}getRectInCurrentCoords(t,e){const[s,i,n,a]=t,o=n-s,l=a-i;switch(this.rotation){case 0:return[s,e-a,o,l];case 90:return[s,e-i,l,o];case 180:return[n,e-i,o,l];case 270:return[n,e-a,l,o];default:throw new Error("Invalid rotation")}}onceAdded(t){}isEmpty(){return!1}enableEditMode(){return this.isInEditMode()?!1:(this.parent.setEditingState(!1),f(this,Wn,!0),!0)}disableEditMode(){return this.isInEditMode()?(this.parent.setEditingState(!0),f(this,Wn,!1),!0):!1}isInEditMode(){return r(this,Wn)}shouldGetKeyboardEvents(){return r(this,ti)}needsToBeRebuilt(){return this.div&&!this.isAttachedToDOM}get isOnScreen(){const{top:t,left:e,bottom:s,right:i}=this.getClientDimensions(),{innerHeight:n,innerWidth:a}=window;return e<a&&i>0&&t<n&&s>0}rebuild(){m(this,U,bd).call(this)}rotate(t){}resize(){}serializeDeleted(){var t;return{id:this.annotationElementId,deleted:!0,pageIndex:this.pageIndex,popupRef:((t=this._initialData)==null?void 0:t.popupRef)||""}}serialize(t=!1,e=null){at("An editor must be serializable")}static async deserialize(t,e,s){const i=new this.prototype.constructor({parent:e,id:e.getNextId(),uiManager:s,annotationElementId:t.annotationElementId});i.rotation=t.rotation,f(i,zn,t.accessibilityData),i._isCopy=t.isCopy||!1;const[n,a]=i.pageDimensions,[o,l,h,c]=i.getRectInCurrentCoords(t.rect,a);return i.x=o/n,i.y=l/a,i.width=h/n,i.height=c/a,i}get hasBeenModified(){return!!this.annotationElementId&&(this.deleted||this.serialize()!==null)}remove(){var t,e;if((t=r(this,Wi))==null||t.abort(),f(this,Wi,null),this.isEmpty()||this.commit(),this.parent?this.parent.remove(this):this._uiManager.removeEditor(this),r(this,_s)&&(clearTimeout(r(this,_s)),f(this,_s,null)),m(this,U,vo).call(this),this.removeEditToolbar(),r(this,ze)){for(const s of r(this,ze).values())clearTimeout(s);f(this,ze,null)}this.parent=null,(e=r(this,qn))==null||e.destroy(),f(this,qn,null)}get isResizable(){return!1}makeResizable(){this.isResizable&&(m(this,U,Rf).call(this),r(this,Ut).classList.remove("hidden"))}get toolbarPosition(){return null}keydown(t){if(!this.isResizable||t.target!==this.div||t.key!=="Enter")return;this._uiManager.setSelected(this),f(this,Zs,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const e=r(this,Ut).children;if(!r(this,ts)){f(this,ts,Array.from(e));const a=m(this,U,Bf).bind(this),o=m(this,U,Of).bind(this),l=this._uiManager._signal;for(const h of r(this,ts)){const c=h.getAttribute("data-resizer-name");h.setAttribute("role","spinbutton"),h.addEventListener("keydown",a,{signal:l}),h.addEventListener("blur",o,{signal:l}),h.addEventListener("focus",m(this,U,$f).bind(this,c),{signal:l}),h.setAttribute("data-l10n-id",j._l10nResizer[c])}}const s=r(this,ts)[0];let i=0;for(const a of e){if(a===s)break;i++}const n=(360-this.rotation+this.parentRotation)%360/90*(r(this,ts).length/4);if(n!==i){if(n<i)for(let o=0;o<i-n;o++)r(this,Ut).append(r(this,Ut).firstChild);else if(n>i)for(let o=0;o<n-i;o++)r(this,Ut).firstChild.before(r(this,Ut).lastChild);let a=0;for(const o of e){const h=r(this,ts)[a++].getAttribute("data-resizer-name");o.setAttribute("data-l10n-id",j._l10nResizer[h])}}m(this,U,Ad).call(this,0),f(this,ti,!0),r(this,Ut).firstChild.focus({focusVisible:!0}),t.preventDefault(),t.stopImmediatePropagation()}_resizeWithKeyboard(t,e){r(this,ti)&&m(this,U,md).call(this,r(this,al),{deltaX:t,deltaY:e,fromKeyboard:!0})}_stopResizingWithKeyboard(){m(this,U,vo).call(this),this.div.focus()}select(){var t,e,s;if(!(this.isSelected&&this._editToolbar)){if(this.isSelected=!0,this.makeResizable(),(t=this.div)==null||t.classList.add("selectedEditor"),!this._editToolbar){this.addEditToolbar().then(()=>{var i,n;(i=this.div)!=null&&i.classList.contains("selectedEditor")&&((n=this._editToolbar)==null||n.show())});return}(e=this._editToolbar)==null||e.show(),(s=r(this,ct))==null||s.toggleAltTextBadge(!1)}}unselect(){var t,e,s,i,n;this.isSelected&&(this.isSelected=!1,(t=r(this,Ut))==null||t.classList.add("hidden"),(e=this.div)==null||e.classList.remove("selectedEditor"),(s=this.div)!=null&&s.contains(document.activeElement)&&this._uiManager.currentLayer.div.focus({preventScroll:!0}),(i=this._editToolbar)==null||i.hide(),(n=r(this,ct))==null||n.toggleAltTextBadge(!0))}updateParams(t,e){}disableEditing(){}enableEditing(){}get canChangeContent(){return!1}enterInEditMode(){this.canChangeContent&&(this.enableEditMode(),this.div.focus())}dblclick(t){this.enterInEditMode(),this.parent.updateToolbar({mode:this.constructor._editorType,editId:this.id})}getElementForAltText(){return this.div}get contentDiv(){return this.div}get isEditing(){return r(this,ol)}set isEditing(t){f(this,ol,t),this.parent&&(t?(this.parent.setSelected(this),this.parent.setActiveEditor(this)):this.parent.setActiveEditor(null))}setAspectRatio(t,e){f(this,Vn,!0);const s=t/e,{style:i}=this.div;i.aspectRatio=s,i.height="auto"}static get MIN_SIZE(){return 16}static canCreateNewEmptyEditor(){return!0}get telemetryInitialData(){return{action:"added"}}get telemetryFinalData(){return null}_reportTelemetry(t,e=!1){if(e){r(this,ze)||f(this,ze,new Map);const{action:s}=t;let i=r(this,ze).get(s);i&&clearTimeout(i),i=setTimeout(()=>{this._reportTelemetry(t),r(this,ze).delete(s),r(this,ze).size===0&&f(this,ze,null)},j._telemetryTimeout),r(this,ze).set(s,i);return}t.type||(t.type=this.editorType),this._uiManager._eventBus.dispatch("reporttelemetry",{source:this,details:{type:"editing",data:t}})}show(t=this._isVisible){this.div.classList.toggle("hidden",!t),this._isVisible=t}enable(){this.div&&(this.div.tabIndex=0),f(this,ma,!1)}disable(){this.div&&(this.div.tabIndex=-1),f(this,ma,!0)}renderAnnotationElement(t){let e=t.container.querySelector(".annotationContent");if(!e)e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),t.container.prepend(e);else if(e.nodeName==="CANVAS"){const s=e;e=document.createElement("div"),e.classList.add("annotationContent",this.editorType),s.before(e)}return e}resetAnnotationElement(t){const{firstChild:e}=t.container;(e==null?void 0:e.nodeName)==="DIV"&&e.classList.contains("annotationContent")&&e.remove()}};zn=new WeakMap,ts=new WeakMap,ct=new WeakMap,Ht=new WeakMap,ma=new WeakMap,ji=new WeakMap,rl=new WeakMap,Vn=new WeakMap,Ut=new WeakMap,Gn=new WeakMap,Zs=new WeakMap,Wi=new WeakMap,al=new WeakMap,jn=new WeakMap,ve=new WeakMap,ol=new WeakMap,Wn=new WeakMap,ti=new WeakMap,_s=new WeakMap,ya=new WeakMap,ba=new WeakMap,ze=new WeakMap,qn=new WeakMap,ll=new WeakMap,wc=new WeakMap,U=new WeakSet,fd=function([t,e],s,i){[s,i]=this.screenToPageTranslation(s,i),this.x+=s/t,this.y+=i/e,this._onTranslating(this.x,this.y),this.fixAndSetPosition()},hl=new WeakSet,pd=function(t,e,s){switch(s){case 90:return[e,-t];case 180:return[-t,-e];case 270:return[-e,t];default:return[t,e]}},Dh=function(t){switch(t){case 90:{const[e,s]=this.pageDimensions;return[0,-e/s,s/e,0]}case 180:return[-1,0,0,-1];case 270:{const[e,s]=this.pageDimensions;return[0,e/s,-s/e,0]}default:return[1,0,0,1]}},Rf=function(){if(r(this,Ut))return;f(this,Ut,document.createElement("div")),r(this,Ut).classList.add("resizers");const t=this._willKeepAspectRatio?["topLeft","topRight","bottomRight","bottomLeft"]:["topLeft","topMiddle","topRight","middleRight","bottomRight","bottomMiddle","bottomLeft","middleLeft"],e=this._uiManager._signal;for(const s of t){const i=document.createElement("div");r(this,Ut).append(i),i.classList.add("resizer",s),i.setAttribute("data-resizer-name",s),i.addEventListener("pointerdown",m(this,U,kf).bind(this,s),{signal:e}),i.addEventListener("contextmenu",Ye,{signal:e}),i.tabIndex=-1}this.div.prepend(r(this,Ut))},kf=function(t,e){var c;e.preventDefault();const{isMac:s}=Xt.platform;if(e.button!==0||e.ctrlKey&&s)return;(c=r(this,ct))==null||c.toggle(!1);const i=this._isDraggable;this._isDraggable=!1,f(this,Gn,[e.screenX,e.screenY]);const n=new AbortController,a=this._uiManager.combinedSignal(n);this.parent.togglePointerEvents(!1),window.addEventListener("pointermove",m(this,U,md).bind(this,t),{passive:!0,capture:!0,signal:a}),window.addEventListener("touchmove",Et,{passive:!1,signal:a}),window.addEventListener("contextmenu",Ye,{signal:a}),f(this,Zs,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height});const o=this.parent.div.style.cursor,l=this.div.style.cursor;this.div.style.cursor=this.parent.div.style.cursor=window.getComputedStyle(e.target).cursor;const h=()=>{var u;n.abort(),this.parent.togglePointerEvents(!0),(u=r(this,ct))==null||u.toggle(!0),this._isDraggable=i,this.parent.div.style.cursor=o,this.div.style.cursor=l,m(this,U,Mh).call(this)};window.addEventListener("pointerup",h,{signal:a}),window.addEventListener("blur",h,{signal:a})},gd=function(t,e,s,i){this.width=s,this.height=i,this.x=t,this.y=e;const[n,a]=this.parentDimensions;this.setDims(n*s,a*i),this.fixAndSetPosition(),this._onResized()},Mh=function(){if(!r(this,Zs))return;const{savedX:t,savedY:e,savedWidth:s,savedHeight:i}=r(this,Zs);f(this,Zs,null);const n=this.x,a=this.y,o=this.width,l=this.height;n===t&&a===e&&o===s&&l===i||this.addCommands({cmd:m(this,U,gd).bind(this,n,a,o,l),undo:m(this,U,gd).bind(this,t,e,s,i),mustExec:!0})},md=function(t,e){const[s,i]=this.parentDimensions,n=this.x,a=this.y,o=this.width,l=this.height,h=j.MIN_SIZE/s,c=j.MIN_SIZE/i,u=m(this,U,Dh).call(this,this.rotation),p=(B,$)=>[u[0]*B+u[2]*$,u[1]*B+u[3]*$],y=m(this,U,Dh).call(this,360-this.rotation),A=(B,$)=>[y[0]*B+y[2]*$,y[1]*B+y[3]*$];let b,w,v=!1,E=!1;switch(t){case"topLeft":v=!0,b=(B,$)=>[0,0],w=(B,$)=>[B,$];break;case"topMiddle":b=(B,$)=>[B/2,0],w=(B,$)=>[B/2,$];break;case"topRight":v=!0,b=(B,$)=>[B,0],w=(B,$)=>[0,$];break;case"middleRight":E=!0,b=(B,$)=>[B,$/2],w=(B,$)=>[0,$/2];break;case"bottomRight":v=!0,b=(B,$)=>[B,$],w=(B,$)=>[0,0];break;case"bottomMiddle":b=(B,$)=>[B/2,$],w=(B,$)=>[B/2,0];break;case"bottomLeft":v=!0,b=(B,$)=>[0,$],w=(B,$)=>[B,0];break;case"middleLeft":E=!0,b=(B,$)=>[0,$/2],w=(B,$)=>[B,$/2];break}const S=b(o,l),_=w(o,l);let C=p(..._);const T=j._round(n+C[0]),x=j._round(a+C[1]);let I=1,P=1,D,k;if(e.fromKeyboard)({deltaX:D,deltaY:k}=e);else{const{screenX:B,screenY:$}=e,[Be,Os]=r(this,Gn);[D,k]=this.screenToPageTranslation(B-Be,$-Os),r(this,Gn)[0]=B,r(this,Gn)[1]=$}if([D,k]=A(D/s,k/i),v){const B=Math.hypot(o,l);I=P=Math.max(Math.min(Math.hypot(_[0]-S[0]-D,_[1]-S[1]-k)/B,1/o,1/l),h/o,c/l)}else E?I=le(Math.abs(_[0]-S[0]-D),h,1)/o:P=le(Math.abs(_[1]-S[1]-k),c,1)/l;const Z=j._round(o*I),it=j._round(l*P);C=p(...w(Z,it));const X=T-C[0],te=x-C[1];r(this,ve)||f(this,ve,[this.x,this.y,this.width,this.height]),this.width=Z,this.height=it,this.x=X,this.y=te,this.setDims(s*Z,i*it),this.fixAndSetPosition(),this._onResizing()},Df=function(){var t;f(this,Zs,{savedX:this.x,savedY:this.y,savedWidth:this.width,savedHeight:this.height}),(t=r(this,ct))==null||t.toggle(!1),this.parent.togglePointerEvents(!1)},Mf=function(t,e,s){let n=.7*(s/e)+1-.7;if(n===1)return;const a=m(this,U,Dh).call(this,this.rotation),o=(T,x)=>[a[0]*T+a[2]*x,a[1]*T+a[3]*x],[l,h]=this.parentDimensions,c=this.x,u=this.y,p=this.width,y=this.height,A=j.MIN_SIZE/l,b=j.MIN_SIZE/h;n=Math.max(Math.min(n,1/p,1/y),A/p,b/y);const w=j._round(p*n),v=j._round(y*n);if(w===p&&v===y)return;r(this,ve)||f(this,ve,[c,u,p,y]);const E=o(p/2,y/2),S=j._round(c+E[0]),_=j._round(u+E[1]),C=o(w/2,v/2);this.x=S-C[0],this.y=_-C[1],this.width=w,this.height=v,this.setDims(l*w,h*v),this.fixAndSetPosition(),this._onResizing()},Nf=function(){var t;(t=r(this,ct))==null||t.toggle(!0),this.parent.togglePointerEvents(!0),m(this,U,Mh).call(this)},yd=function(t){const{isMac:e}=Xt.platform;t.ctrlKey&&!e||t.shiftKey||t.metaKey&&e?this.parent.toggleSelected(this):this.parent.setSelected(this)},Ff=function(t){const{isSelected:e}=this;this._uiManager.setUpDragSession();let s=!1;const i=new AbortController,n=this._uiManager.combinedSignal(i),a={capture:!0,passive:!1,signal:n},o=h=>{i.abort(),f(this,ji,null),f(this,jn,!1),this._uiManager.endDragSession()||m(this,U,yd).call(this,h),s&&this._onStopDragging()};e&&(f(this,ya,t.clientX),f(this,ba,t.clientY),f(this,ji,t.pointerId),f(this,rl,t.pointerType),window.addEventListener("pointermove",h=>{s||(s=!0,this._onStartDragging());const{clientX:c,clientY:u,pointerId:p}=h;if(p!==r(this,ji)){Et(h);return}const[y,A]=this.screenToPageTranslation(c-r(this,ya),u-r(this,ba));f(this,ya,c),f(this,ba,u),this._uiManager.dragSelectedEditors(y,A)},a),window.addEventListener("touchmove",Et,a),window.addEventListener("pointerdown",h=>{h.pointerType===r(this,rl)&&(r(this,qn)||h.isPrimary)&&o(h),Et(h)},a));const l=h=>{if(!r(this,ji)||r(this,ji)===h.pointerId){o(h);return}Et(h)};window.addEventListener("pointerup",l,{signal:n}),window.addEventListener("blur",l,{signal:n})},bd=function(){if(r(this,Wi)||!this.div)return;f(this,Wi,new AbortController);const t=this._uiManager.combinedSignal(r(this,Wi));this.div.addEventListener("focusin",this.focusin.bind(this),{signal:t}),this.div.addEventListener("focusout",this.focusout.bind(this),{signal:t})},Bf=function(t){j._resizerKeyboardManager.exec(this,t)},Of=function(t){var e;r(this,ti)&&((e=t.relatedTarget)==null?void 0:e.parentNode)!==r(this,Ut)&&m(this,U,vo).call(this)},$f=function(t){f(this,al,r(this,ti)?t:"")},Ad=function(t){if(r(this,ts))for(const e of r(this,ts))e.tabIndex=t},vo=function(){f(this,ti,!1),m(this,U,Ad).call(this,-1),m(this,U,Mh).call(this)},g(j,hl),L(j,"_l10n",null),L(j,"_l10nResizer",null),L(j,"_borderLineWidth",-1),L(j,"_colorManager",new ad),L(j,"_zIndex",1),L(j,"_telemetryTimeout",1e3);let lt=j;class $g extends lt{constructor(t){super(t),this.annotationElementId=t.annotationElementId,this.deleted=!0}serialize(){return this.serializeDeleted()}}const Ou=3285377520,Oe=4294901760,fs=65535;class Hf{constructor(t){this.h1=t?t&4294967295:Ou,this.h2=t?t&4294967295:Ou}update(t){let e,s;if(typeof t=="string"){e=new Uint8Array(t.length*2),s=0;for(let b=0,w=t.length;b<w;b++){const v=t.charCodeAt(b);v<=255?e[s++]=v:(e[s++]=v>>>8,e[s++]=v&255)}}else if(ArrayBuffer.isView(t))e=t.slice(),s=e.byteLength;else throw new Error("Invalid data format, must be a string or TypedArray.");const i=s>>2,n=s-i*4,a=new Uint32Array(e.buffer,0,i);let o=0,l=0,h=this.h1,c=this.h2;const u=3432918353,p=461845907,y=u&fs,A=p&fs;for(let b=0;b<i;b++)b&1?(o=a[b],o=o*u&Oe|o*y&fs,o=o<<15|o>>>17,o=o*p&Oe|o*A&fs,h^=o,h=h<<13|h>>>19,h=h*5+3864292196):(l=a[b],l=l*u&Oe|l*y&fs,l=l<<15|l>>>17,l=l*p&Oe|l*A&fs,c^=l,c=c<<13|c>>>19,c=c*5+3864292196);switch(o=0,n){case 3:o^=e[i*4+2]<<16;case 2:o^=e[i*4+1]<<8;case 1:o^=e[i*4],o=o*u&Oe|o*y&fs,o=o<<15|o>>>17,o=o*p&Oe|o*A&fs,i&1?h^=o:c^=o}this.h1=h,this.h2=c}hexdigest(){let t=this.h1,e=this.h2;return t^=e>>>1,t=t*3981806797&Oe|t*36045&fs,e=e*4283543511&Oe|((e<<16|t>>>16)*2950163797&Oe)>>>16,t^=e>>>1,t=t*444984403&Oe|t*60499&fs,e=e*3301882366&Oe|((e<<16|t>>>16)*3120437893&Oe)>>>16,t^=e>>>1,(t>>>0).toString(16).padStart(8,"0")+(e>>>0).toString(16).padStart(8,"0")}}const vd=Object.freeze({map:null,hash:"",transfer:void 0});var Xn,Yn,zt,Sc,Uf;class wu{constructor(){g(this,Sc);g(this,Xn,!1);g(this,Yn,null);g(this,zt,new Map);this.onSetModified=null,this.onResetModified=null,this.onAnnotationEditor=null}getValue(t,e){const s=r(this,zt).get(t);return s===void 0?e:Object.assign(e,s)}getRawValue(t){return r(this,zt).get(t)}remove(t){if(r(this,zt).delete(t),r(this,zt).size===0&&this.resetModified(),typeof this.onAnnotationEditor=="function"){for(const e of r(this,zt).values())if(e instanceof lt)return;this.onAnnotationEditor(null)}}setValue(t,e){const s=r(this,zt).get(t);let i=!1;if(s!==void 0)for(const[n,a]of Object.entries(e))s[n]!==a&&(i=!0,s[n]=a);else i=!0,r(this,zt).set(t,e);i&&m(this,Sc,Uf).call(this),e instanceof lt&&typeof this.onAnnotationEditor=="function"&&this.onAnnotationEditor(e.constructor._type)}has(t){return r(this,zt).has(t)}get size(){return r(this,zt).size}resetModified(){r(this,Xn)&&(f(this,Xn,!1),typeof this.onResetModified=="function"&&this.onResetModified())}get print(){return new zf(this)}get serializable(){if(r(this,zt).size===0)return vd;const t=new Map,e=new Hf,s=[],i=Object.create(null);let n=!1;for(const[a,o]of r(this,zt)){const l=o instanceof lt?o.serialize(!1,i):o;l&&(t.set(a,l),e.update(`${a}:${JSON.stringify(l)}`),n||(n=!!l.bitmap))}if(n)for(const a of t.values())a.bitmap&&s.push(a.bitmap);return t.size>0?{map:t,hash:e.hexdigest(),transfer:s}:vd}get editorStats(){let t=null;const e=new Map;for(const s of r(this,zt).values()){if(!(s instanceof lt))continue;const i=s.telemetryFinalData;if(!i)continue;const{type:n}=i;e.has(n)||e.set(n,Object.getPrototypeOf(s).constructor),t||(t=Object.create(null));const a=t[n]||(t[n]=new Map);for(const[o,l]of Object.entries(i)){if(o==="type")continue;let h=a.get(o);h||(h=new Map,a.set(o,h));const c=h.get(l)??0;h.set(l,c+1)}}for(const[s,i]of e)t[s]=i.computeTelemetryFinalData(t[s]);return t}resetModifiedIds(){f(this,Yn,null)}get modifiedIds(){if(r(this,Yn))return r(this,Yn);const t=[];for(const e of r(this,zt).values())!(e instanceof lt)||!e.annotationElementId||!e.serialize()||t.push(e.annotationElementId);return f(this,Yn,{ids:new Set(t),hash:t.join(",")})}[Symbol.iterator](){return r(this,zt).entries()}}Xn=new WeakMap,Yn=new WeakMap,zt=new WeakMap,Sc=new WeakSet,Uf=function(){r(this,Xn)||(f(this,Xn,!0),typeof this.onSetModified=="function"&&this.onSetModified())};var cl;class zf extends wu{constructor(e){super();g(this,cl);const{map:s,hash:i,transfer:n}=e.serializable,a=structuredClone(s,n?{transfer:n}:null);f(this,cl,{map:a,hash:i,transfer:n})}get print(){at("Should not call PrintAnnotationStorage.print")}get serializable(){return r(this,cl)}get modifiedIds(){return q(this,"modifiedIds",{ids:new Set,hash:""})}}cl=new WeakMap;var Aa;class Hg{constructor({ownerDocument:t=globalThis.document,styleElement:e=null}){g(this,Aa,new Set);this._document=t,this.nativeFontFaces=new Set,this.styleElement=null,this.loadingRequests=[],this.loadTestFontId=0}addNativeFontFace(t){this.nativeFontFaces.add(t),this._document.fonts.add(t)}removeNativeFontFace(t){this.nativeFontFaces.delete(t),this._document.fonts.delete(t)}insertRule(t){this.styleElement||(this.styleElement=this._document.createElement("style"),this._document.documentElement.getElementsByTagName("head")[0].append(this.styleElement));const e=this.styleElement.sheet;e.insertRule(t,e.cssRules.length)}clear(){for(const t of this.nativeFontFaces)this._document.fonts.delete(t);this.nativeFontFaces.clear(),r(this,Aa).clear(),this.styleElement&&(this.styleElement.remove(),this.styleElement=null)}async loadSystemFont({systemFontInfo:t,disableFontFace:e,_inspectFont:s}){if(!(!t||r(this,Aa).has(t.loadedName))){if(_t(!e,"loadSystemFont shouldn't be called when `disableFontFace` is set."),this.isFontLoadingAPISupported){const{loadedName:i,src:n,style:a}=t,o=new FontFace(i,n,a);this.addNativeFontFace(o);try{await o.load(),r(this,Aa).add(i),s==null||s(t)}catch{V(`Cannot load system font: ${t.baseFontName}, installing it could help to improve PDF rendering.`),this.removeNativeFontFace(o)}return}at("Not implemented: loadSystemFont without the Font Loading API.")}}async bind(t){if(t.attached||t.missingFile&&!t.systemFontInfo)return;if(t.attached=!0,t.systemFontInfo){await this.loadSystemFont(t);return}if(this.isFontLoadingAPISupported){const s=t.createNativeFontFace();if(s){this.addNativeFontFace(s);try{await s.loaded}catch(i){throw V(`Failed to load font '${s.family}': '${i}'.`),t.disableFontFace=!0,i}}return}const e=t.createFontFaceRule();if(e){if(this.insertRule(e),this.isSyncFontLoadingSupported)return;await new Promise(s=>{const i=this._queueLoadingCallback(s);this._prepareFontLoadEvent(t,i)})}}get isFontLoadingAPISupported(){var e;const t=!!((e=this._document)!=null&&e.fonts);return q(this,"isFontLoadingAPISupported",t)}get isSyncFontLoadingSupported(){return q(this,"isSyncFontLoadingSupported",oe||Xt.platform.isFirefox)}_queueLoadingCallback(t){function e(){for(_t(!i.done,"completeRequest() cannot be called twice."),i.done=!0;s.length>0&&s[0].done;){const n=s.shift();setTimeout(n.callback,0)}}const{loadingRequests:s}=this,i={done:!1,complete:e,callback:t};return s.push(i),i}get _loadTestFont(){const t=atob("T1RUTwALAIAAAwAwQ0ZGIDHtZg4AAAOYAAAAgUZGVE1lkzZwAAAEHAAAABxHREVGABQAFQAABDgAAAAeT1MvMlYNYwkAAAEgAAAAYGNtYXABDQLUAAACNAAAAUJoZWFk/xVFDQAAALwAAAA2aGhlYQdkA+oAAAD0AAAAJGhtdHgD6AAAAAAEWAAAAAZtYXhwAAJQAAAAARgAAAAGbmFtZVjmdH4AAAGAAAAAsXBvc3T/hgAzAAADeAAAACAAAQAAAAEAALZRFsRfDzz1AAsD6AAAAADOBOTLAAAAAM4KHDwAAAAAA+gDIQAAAAgAAgAAAAAAAAABAAADIQAAAFoD6AAAAAAD6AABAAAAAAAAAAAAAAAAAAAAAQAAUAAAAgAAAAQD6AH0AAUAAAKKArwAAACMAooCvAAAAeAAMQECAAACAAYJAAAAAAAAAAAAAQAAAAAAAAAAAAAAAFBmRWQAwAAuAC4DIP84AFoDIQAAAAAAAQAAAAAAAAAAACAAIAABAAAADgCuAAEAAAAAAAAAAQAAAAEAAAAAAAEAAQAAAAEAAAAAAAIAAQAAAAEAAAAAAAMAAQAAAAEAAAAAAAQAAQAAAAEAAAAAAAUAAQAAAAEAAAAAAAYAAQAAAAMAAQQJAAAAAgABAAMAAQQJAAEAAgABAAMAAQQJAAIAAgABAAMAAQQJAAMAAgABAAMAAQQJAAQAAgABAAMAAQQJAAUAAgABAAMAAQQJAAYAAgABWABYAAAAAAAAAwAAAAMAAAAcAAEAAAAAADwAAwABAAAAHAAEACAAAAAEAAQAAQAAAC7//wAAAC7////TAAEAAAAAAAABBgAAAQAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAEAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAMAAAAAAAD/gwAyAAAAAQAAAAAAAAAAAAAAAAAAAAABAAQEAAEBAQJYAAEBASH4DwD4GwHEAvgcA/gXBIwMAYuL+nz5tQXkD5j3CBLnEQACAQEBIVhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYWFhYAAABAQAADwACAQEEE/t3Dov6fAH6fAT+fPp8+nwHDosMCvm1Cvm1DAz6fBQAAAAAAAABAAAAAMmJbzEAAAAAzgTjFQAAAADOBOQpAAEAAAAAAAAADAAUAAQAAAABAAAAAgABAAAAAAAAAAAD6AAAAAAAAA==");return q(this,"_loadTestFont",t)}_prepareFontLoadEvent(t,e){function s(_,C){return _.charCodeAt(C)<<24|_.charCodeAt(C+1)<<16|_.charCodeAt(C+2)<<8|_.charCodeAt(C+3)&255}function i(_,C,T,x){const I=_.substring(0,C),P=_.substring(C+T);return I+x+P}let n,a;const o=this._document.createElement("canvas");o.width=1,o.height=1;const l=o.getContext("2d");let h=0;function c(_,C){if(++h>30){V("Load test font never loaded."),C();return}if(l.font="30px "+_,l.fillText(".",0,20),l.getImageData(0,0,1,1).data[3]>0){C();return}setTimeout(c.bind(null,_,C))}const u=`lt${Date.now()}${this.loadTestFontId++}`;let p=this._loadTestFont;p=i(p,976,u.length,u);const A=16,b=1482184792;let w=s(p,A);for(n=0,a=u.length-3;n<a;n+=4)w=w-b+s(u,n)|0;n<u.length&&(w=w-b+s(u+"XXX",n)|0),p=i(p,A,4,_g(w));const v=`url(data:font/opentype;base64,${btoa(p)});`,E=`@font-face {font-family:"${u}";src:${v}}`;this.insertRule(E);const S=this._document.createElement("div");S.style.visibility="hidden",S.style.width=S.style.height="10px",S.style.position="absolute",S.style.top=S.style.left="0px";for(const _ of[t.loadedName,u]){const C=this._document.createElement("span");C.textContent="Hi",C.style.fontFamily=_,S.append(C)}this._document.body.append(S),c(u,()=>{S.remove(),e.complete()})}}Aa=new WeakMap;class Ug{constructor(t,e=null){this.compiledGlyphs=Object.create(null);for(const s in t)this[s]=t[s];this._inspectFont=e}createNativeFontFace(){var e;if(!this.data||this.disableFontFace)return null;let t;if(!this.cssFontInfo)t=new FontFace(this.loadedName,this.data,{});else{const s={weight:this.cssFontInfo.fontWeight};this.cssFontInfo.italicAngle&&(s.style=`oblique ${this.cssFontInfo.italicAngle}deg`),t=new FontFace(this.cssFontInfo.fontFamily,this.data,s)}return(e=this._inspectFont)==null||e.call(this,this),t}createFontFaceRule(){var s;if(!this.data||this.disableFontFace)return null;const t=`url(data:${this.mimetype};base64,${hf(this.data)});`;let e;if(!this.cssFontInfo)e=`@font-face {font-family:"${this.loadedName}";src:${t}}`;else{let i=`font-weight: ${this.cssFontInfo.fontWeight};`;this.cssFontInfo.italicAngle&&(i+=`font-style: oblique ${this.cssFontInfo.italicAngle}deg;`),e=`@font-face {font-family:"${this.cssFontInfo.fontFamily}";${i}src:${t}}`}return(s=this._inspectFont)==null||s.call(this,this,t),e}getPathGenerator(t,e){if(this.compiledGlyphs[e]!==void 0)return this.compiledGlyphs[e];const s=this.loadedName+"_path_"+e;let i;try{i=t.get(s)}catch(a){V(`getPathGenerator - ignoring character: "${a}".`)}const n=new Path2D(i||"");return this.fontExtraProperties||t.delete(s),this.compiledGlyphs[e]=n}}function zg(d){if(d instanceof URL)return d.href;if(typeof d=="string"){if(oe)return d;const t=URL.parse(d,window.location);if(t)return t.href}throw new Error("Invalid PDF url data: either string or URL-object is expected in the url property.")}function Vg(d){if(oe&&typeof Buffer<"u"&&d instanceof Buffer)throw new Error("Please provide binary data as `Uint8Array`, rather than `Buffer`.");if(d instanceof Uint8Array&&d.byteLength===d.buffer.byteLength)return d;if(typeof d=="string")return fh(d);if(d instanceof ArrayBuffer||ArrayBuffer.isView(d)||typeof d=="object"&&!isNaN(d==null?void 0:d.length))return new Uint8Array(d);throw new Error("Invalid PDF binary data: either TypedArray, string, or array-like object is expected in the data property.")}function wh(d){if(typeof d!="string")return null;if(d.endsWith("/"))return d;throw new Error(`Invalid factory url: "${d}" must include trailing slash.`)}const wd=d=>typeof d=="object"&&Number.isInteger(d==null?void 0:d.num)&&d.num>=0&&Number.isInteger(d==null?void 0:d.gen)&&d.gen>=0,Gg=d=>typeof d=="object"&&typeof(d==null?void 0:d.name)=="string",jg=Ig.bind(null,wd,Gg);var ei,Ec;class Wg{constructor(){g(this,ei,new Map);g(this,Ec,Promise.resolve())}postMessage(t,e){const s={data:structuredClone(t,e?{transfer:e}:null)};r(this,Ec).then(()=>{for(const[i]of r(this,ei))i.call(this,s)})}addEventListener(t,e,s=null){let i=null;if((s==null?void 0:s.signal)instanceof AbortSignal){const{signal:n}=s;if(n.aborted){V("LoopbackPort - cannot use an `aborted` signal.");return}const a=()=>this.removeEventListener(t,e);i=()=>n.removeEventListener("abort",a),n.addEventListener("abort",a)}r(this,ei).set(e,i)}removeEventListener(t,e){const s=r(this,ei).get(e);s==null||s(),r(this,ei).delete(e)}terminate(){for(const[,t]of r(this,ei))t==null||t();r(this,ei).clear()}}ei=new WeakMap,Ec=new WeakMap;const Sh={DATA:1,ERROR:2},wt={CANCEL:1,CANCEL_COMPLETE:2,CLOSE:3,ENQUEUE:4,ERROR:5,PULL:6,PULL_COMPLETE:7,START_COMPLETE:8};function $u(){}function de(d){if(d instanceof An||d instanceof ed||d instanceof Nu||d instanceof rc||d instanceof Wc)return d;switch(d instanceof Error||typeof d=="object"&&d!==null||at('wrapReason: Expected "reason" to be a (possibly cloned) Error.'),d.name){case"AbortException":return new An(d.message);case"InvalidPDFException":return new ed(d.message);case"PasswordException":return new Nu(d.message,d.code);case"ResponseException":return new rc(d.message,d.status,d.missing);case"UnknownErrorException":return new Wc(d.message,d.details)}return new Wc(d.message,d.toString())}var va,Xe,Vf,Gf,jf,Nh;class wo{constructor(t,e,s){g(this,Xe);g(this,va,new AbortController);this.sourceName=t,this.targetName=e,this.comObj=s,this.callbackId=1,this.streamId=1,this.streamSinks=Object.create(null),this.streamControllers=Object.create(null),this.callbackCapabilities=Object.create(null),this.actionHandler=Object.create(null),s.addEventListener("message",m(this,Xe,Vf).bind(this),{signal:r(this,va).signal})}on(t,e){const s=this.actionHandler;if(s[t])throw new Error(`There is already an actionName called "${t}"`);s[t]=e}send(t,e,s){this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,data:e},s)}sendWithPromise(t,e,s){const i=this.callbackId++,n=Promise.withResolvers();this.callbackCapabilities[i]=n;try{this.comObj.postMessage({sourceName:this.sourceName,targetName:this.targetName,action:t,callbackId:i,data:e},s)}catch(a){n.reject(a)}return n.promise}sendWithStream(t,e,s,i){const n=this.streamId++,a=this.sourceName,o=this.targetName,l=this.comObj;return new ReadableStream({start:h=>{const c=Promise.withResolvers();return this.streamControllers[n]={controller:h,startCall:c,pullCall:null,cancelCall:null,isClosed:!1},l.postMessage({sourceName:a,targetName:o,action:t,streamId:n,data:e,desiredSize:h.desiredSize},i),c.promise},pull:h=>{const c=Promise.withResolvers();return this.streamControllers[n].pullCall=c,l.postMessage({sourceName:a,targetName:o,stream:wt.PULL,streamId:n,desiredSize:h.desiredSize}),c.promise},cancel:h=>{_t(h instanceof Error,"cancel must have a valid reason");const c=Promise.withResolvers();return this.streamControllers[n].cancelCall=c,this.streamControllers[n].isClosed=!0,l.postMessage({sourceName:a,targetName:o,stream:wt.CANCEL,streamId:n,reason:de(h)}),c.promise}},s)}destroy(){var t;(t=r(this,va))==null||t.abort(),f(this,va,null)}}va=new WeakMap,Xe=new WeakSet,Vf=function({data:t}){if(t.targetName!==this.sourceName)return;if(t.stream){m(this,Xe,jf).call(this,t);return}if(t.callback){const s=t.callbackId,i=this.callbackCapabilities[s];if(!i)throw new Error(`Cannot resolve callback ${s}`);if(delete this.callbackCapabilities[s],t.callback===Sh.DATA)i.resolve(t.data);else if(t.callback===Sh.ERROR)i.reject(de(t.reason));else throw new Error("Unexpected callback case");return}const e=this.actionHandler[t.action];if(!e)throw new Error(`Unknown action from worker: ${t.action}`);if(t.callbackId){const s=this.sourceName,i=t.sourceName,n=this.comObj;Promise.try(e,t.data).then(function(a){n.postMessage({sourceName:s,targetName:i,callback:Sh.DATA,callbackId:t.callbackId,data:a})},function(a){n.postMessage({sourceName:s,targetName:i,callback:Sh.ERROR,callbackId:t.callbackId,reason:de(a)})});return}if(t.streamId){m(this,Xe,Gf).call(this,t);return}e(t.data)},Gf=function(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,n=this.comObj,a=this,o=this.actionHandler[t.action],l={enqueue(h,c=1,u){if(this.isCancelled)return;const p=this.desiredSize;this.desiredSize-=c,p>0&&this.desiredSize<=0&&(this.sinkCapability=Promise.withResolvers(),this.ready=this.sinkCapability.promise),n.postMessage({sourceName:s,targetName:i,stream:wt.ENQUEUE,streamId:e,chunk:h},u)},close(){this.isCancelled||(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:wt.CLOSE,streamId:e}),delete a.streamSinks[e])},error(h){_t(h instanceof Error,"error must have a valid reason"),!this.isCancelled&&(this.isCancelled=!0,n.postMessage({sourceName:s,targetName:i,stream:wt.ERROR,streamId:e,reason:de(h)}))},sinkCapability:Promise.withResolvers(),onPull:null,onCancel:null,isCancelled:!1,desiredSize:t.desiredSize,ready:null};l.sinkCapability.resolve(),l.ready=l.sinkCapability.promise,this.streamSinks[e]=l,Promise.try(o,t.data,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:wt.START_COMPLETE,streamId:e,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:wt.START_COMPLETE,streamId:e,reason:de(h)})})},jf=function(t){const e=t.streamId,s=this.sourceName,i=t.sourceName,n=this.comObj,a=this.streamControllers[e],o=this.streamSinks[e];switch(t.stream){case wt.START_COMPLETE:t.success?a.startCall.resolve():a.startCall.reject(de(t.reason));break;case wt.PULL_COMPLETE:t.success?a.pullCall.resolve():a.pullCall.reject(de(t.reason));break;case wt.PULL:if(!o){n.postMessage({sourceName:s,targetName:i,stream:wt.PULL_COMPLETE,streamId:e,success:!0});break}o.desiredSize<=0&&t.desiredSize>0&&o.sinkCapability.resolve(),o.desiredSize=t.desiredSize,Promise.try(o.onPull||$u).then(function(){n.postMessage({sourceName:s,targetName:i,stream:wt.PULL_COMPLETE,streamId:e,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:wt.PULL_COMPLETE,streamId:e,reason:de(h)})});break;case wt.ENQUEUE:if(_t(a,"enqueue should have stream controller"),a.isClosed)break;a.controller.enqueue(t.chunk);break;case wt.CLOSE:if(_t(a,"close should have stream controller"),a.isClosed)break;a.isClosed=!0,a.controller.close(),m(this,Xe,Nh).call(this,a,e);break;case wt.ERROR:_t(a,"error should have stream controller"),a.controller.error(de(t.reason)),m(this,Xe,Nh).call(this,a,e);break;case wt.CANCEL_COMPLETE:t.success?a.cancelCall.resolve():a.cancelCall.reject(de(t.reason)),m(this,Xe,Nh).call(this,a,e);break;case wt.CANCEL:if(!o)break;const l=de(t.reason);Promise.try(o.onCancel||$u,l).then(function(){n.postMessage({sourceName:s,targetName:i,stream:wt.CANCEL_COMPLETE,streamId:e,success:!0})},function(h){n.postMessage({sourceName:s,targetName:i,stream:wt.CANCEL_COMPLETE,streamId:e,reason:de(h)})}),o.sinkCapability.reject(l),o.isCancelled=!0,delete this.streamSinks[e];break;default:throw new Error("Unexpected stream case")}},Nh=async function(t,e){var s,i,n;await Promise.allSettled([(s=t.startCall)==null?void 0:s.promise,(i=t.pullCall)==null?void 0:i.promise,(n=t.cancelCall)==null?void 0:n.promise]),delete this.streamControllers[e]};var dl;class Wf{constructor({enableHWA:t=!1}){g(this,dl,!1);f(this,dl,t)}create(t,e){if(t<=0||e<=0)throw new Error("Invalid canvas size");const s=this._createCanvas(t,e);return{canvas:s,context:s.getContext("2d",{willReadFrequently:!r(this,dl)})}}reset(t,e,s){if(!t.canvas)throw new Error("Canvas is not specified");if(e<=0||s<=0)throw new Error("Invalid canvas size");t.canvas.width=e,t.canvas.height=s}destroy(t){if(!t.canvas)throw new Error("Canvas is not specified");t.canvas.width=0,t.canvas.height=0,t.canvas=null,t.context=null}_createCanvas(t,e){at("Abstract method `_createCanvas` called.")}}dl=new WeakMap;class qg extends Wf{constructor({ownerDocument:t=globalThis.document,enableHWA:e=!1}){super({enableHWA:e}),this._document=t}_createCanvas(t,e){const s=this._document.createElement("canvas");return s.width=t,s.height=e,s}}class qf{constructor({baseUrl:t=null,isCompressed:e=!0}){this.baseUrl=t,this.isCompressed=e}async fetch({name:t}){if(!this.baseUrl)throw new Error("Ensure that the `cMapUrl` and `cMapPacked` API parameters are provided.");if(!t)throw new Error("CMap name must be specified.");const e=this.baseUrl+t+(this.isCompressed?".bcmap":"");return this._fetch(e).then(s=>({cMapData:s,isCompressed:this.isCompressed})).catch(s=>{throw new Error(`Unable to load ${this.isCompressed?"binary ":""}CMap at: ${e}`)})}async _fetch(t){at("Abstract method `_fetch` called.")}}class Hu extends qf{async _fetch(t){const e=await ph(t,this.isCompressed?"arraybuffer":"text");return e instanceof ArrayBuffer?new Uint8Array(e):fh(e)}}class Xf{addFilter(t){return"none"}addHCMFilter(t,e){return"none"}addAlphaFilter(t){return"none"}addLuminosityFilter(t){return"none"}addHighlightHCMFilter(t,e,s,i,n){return"none"}destroy(t=!1){}}var Kn,wa,si,ii,Qt,Jn,Qn,M,Kt,So,jr,Fh,Wr,Yf,Sd,qr,Eo,_o,Ed,Co;class Xg extends Xf{constructor({docId:e,ownerDocument:s=globalThis.document}){super();g(this,M);g(this,Kn);g(this,wa);g(this,si);g(this,ii);g(this,Qt);g(this,Jn);g(this,Qn,0);f(this,ii,e),f(this,Qt,s)}addFilter(e){if(!e)return"none";let s=r(this,M,Kt).get(e);if(s)return s;const[i,n,a]=m(this,M,Fh).call(this,e),o=e.length===1?i:`${i}${n}${a}`;if(s=r(this,M,Kt).get(o),s)return r(this,M,Kt).set(e,s),s;const l=`g_${r(this,ii)}_transfer_map_${ee(this,Qn)._++}`,h=m(this,M,Wr).call(this,l);r(this,M,Kt).set(e,h),r(this,M,Kt).set(o,h);const c=m(this,M,qr).call(this,l);return m(this,M,_o).call(this,i,n,a,c),h}addHCMFilter(e,s){var A;const i=`${e}-${s}`,n="base";let a=r(this,M,So).get(n);if((a==null?void 0:a.key)===i||(a?((A=a.filter)==null||A.remove(),a.key=i,a.url="none",a.filter=null):(a={key:i,url:"none",filter:null},r(this,M,So).set(n,a)),!e||!s))return a.url;const o=m(this,M,Co).call(this,e);e=H.makeHexColor(...o);const l=m(this,M,Co).call(this,s);if(s=H.makeHexColor(...l),r(this,M,jr).style.color="",e==="#000000"&&s==="#ffffff"||e===s)return a.url;const h=new Array(256);for(let b=0;b<=255;b++){const w=b/255;h[b]=w<=.03928?w/12.92:((w+.055)/1.055)**2.4}const c=h.join(","),u=`g_${r(this,ii)}_hcm_filter`,p=a.filter=m(this,M,qr).call(this,u);m(this,M,_o).call(this,c,c,c,p),m(this,M,Sd).call(this,p);const y=(b,w)=>{const v=o[b]/255,E=l[b]/255,S=new Array(w+1);for(let _=0;_<=w;_++)S[_]=v+_/w*(E-v);return S.join(",")};return m(this,M,_o).call(this,y(0,5),y(1,5),y(2,5),p),a.url=m(this,M,Wr).call(this,u),a.url}addAlphaFilter(e){let s=r(this,M,Kt).get(e);if(s)return s;const[i]=m(this,M,Fh).call(this,[e]),n=`alpha_${i}`;if(s=r(this,M,Kt).get(n),s)return r(this,M,Kt).set(e,s),s;const a=`g_${r(this,ii)}_alpha_map_${ee(this,Qn)._++}`,o=m(this,M,Wr).call(this,a);r(this,M,Kt).set(e,o),r(this,M,Kt).set(n,o);const l=m(this,M,qr).call(this,a);return m(this,M,Ed).call(this,i,l),o}addLuminosityFilter(e){let s=r(this,M,Kt).get(e||"luminosity");if(s)return s;let i,n;if(e?([i]=m(this,M,Fh).call(this,[e]),n=`luminosity_${i}`):n="luminosity",s=r(this,M,Kt).get(n),s)return r(this,M,Kt).set(e,s),s;const a=`g_${r(this,ii)}_luminosity_map_${ee(this,Qn)._++}`,o=m(this,M,Wr).call(this,a);r(this,M,Kt).set(e,o),r(this,M,Kt).set(n,o);const l=m(this,M,qr).call(this,a);return m(this,M,Yf).call(this,l),e&&m(this,M,Ed).call(this,i,l),o}addHighlightHCMFilter(e,s,i,n,a){var E;const o=`${s}-${i}-${n}-${a}`;let l=r(this,M,So).get(e);if((l==null?void 0:l.key)===o||(l?((E=l.filter)==null||E.remove(),l.key=o,l.url="none",l.filter=null):(l={key:o,url:"none",filter:null},r(this,M,So).set(e,l)),!s||!i))return l.url;const[h,c]=[s,i].map(m(this,M,Co).bind(this));let u=Math.round(.2126*h[0]+.7152*h[1]+.0722*h[2]),p=Math.round(.2126*c[0]+.7152*c[1]+.0722*c[2]),[y,A]=[n,a].map(m(this,M,Co).bind(this));p<u&&([u,p,y,A]=[p,u,A,y]),r(this,M,jr).style.color="";const b=(S,_,C)=>{const T=new Array(256),x=(p-u)/C,I=S/255,P=(_-S)/(255*C);let D=0;for(let k=0;k<=C;k++){const Z=Math.round(u+k*x),it=I+k*P;for(let X=D;X<=Z;X++)T[X]=it;D=Z+1}for(let k=D;k<256;k++)T[k]=T[D-1];return T.join(",")},w=`g_${r(this,ii)}_hcm_${e}_filter`,v=l.filter=m(this,M,qr).call(this,w);return m(this,M,Sd).call(this,v),m(this,M,_o).call(this,b(y[0],A[0],5),b(y[1],A[1],5),b(y[2],A[2],5),v),l.url=m(this,M,Wr).call(this,w),l.url}destroy(e=!1){var s,i,n,a;e&&((s=r(this,Jn))!=null&&s.size)||((i=r(this,si))==null||i.parentNode.parentNode.remove(),f(this,si,null),(n=r(this,wa))==null||n.clear(),f(this,wa,null),(a=r(this,Jn))==null||a.clear(),f(this,Jn,null),f(this,Qn,0))}}Kn=new WeakMap,wa=new WeakMap,si=new WeakMap,ii=new WeakMap,Qt=new WeakMap,Jn=new WeakMap,Qn=new WeakMap,M=new WeakSet,Kt=function(){return r(this,wa)||f(this,wa,new Map)},So=function(){return r(this,Jn)||f(this,Jn,new Map)},jr=function(){if(!r(this,si)){const e=r(this,Qt).createElement("div"),{style:s}=e;s.visibility="hidden",s.contain="strict",s.width=s.height=0,s.position="absolute",s.top=s.left=0,s.zIndex=-1;const i=r(this,Qt).createElementNS($s,"svg");i.setAttribute("width",0),i.setAttribute("height",0),f(this,si,r(this,Qt).createElementNS($s,"defs")),e.append(i),i.append(r(this,si)),r(this,Qt).body.append(e)}return r(this,si)},Fh=function(e){if(e.length===1){const h=e[0],c=new Array(256);for(let p=0;p<256;p++)c[p]=h[p]/255;const u=c.join(",");return[u,u,u]}const[s,i,n]=e,a=new Array(256),o=new Array(256),l=new Array(256);for(let h=0;h<256;h++)a[h]=s[h]/255,o[h]=i[h]/255,l[h]=n[h]/255;return[a.join(","),o.join(","),l.join(",")]},Wr=function(e){if(r(this,Kn)===void 0){f(this,Kn,"");const s=r(this,Qt).URL;s!==r(this,Qt).baseURI&&(Oc(s)?V('#createUrl: ignore "data:"-URL for performance reasons.'):f(this,Kn,af(s,"")))}return`url(${r(this,Kn)}#${e})`},Yf=function(e){const s=r(this,Qt).createElementNS($s,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0.3 0.59 0.11 0 0"),e.append(s)},Sd=function(e){const s=r(this,Qt).createElementNS($s,"feColorMatrix");s.setAttribute("type","matrix"),s.setAttribute("values","0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0.2126 0.7152 0.0722 0 0 0 0 0 1 0"),e.append(s)},qr=function(e){const s=r(this,Qt).createElementNS($s,"filter");return s.setAttribute("color-interpolation-filters","sRGB"),s.setAttribute("id",e),r(this,M,jr).append(s),s},Eo=function(e,s,i){const n=r(this,Qt).createElementNS($s,s);n.setAttribute("type","discrete"),n.setAttribute("tableValues",i),e.append(n)},_o=function(e,s,i,n){const a=r(this,Qt).createElementNS($s,"feComponentTransfer");n.append(a),m(this,M,Eo).call(this,a,"feFuncR",e),m(this,M,Eo).call(this,a,"feFuncG",s),m(this,M,Eo).call(this,a,"feFuncB",i)},Ed=function(e,s){const i=r(this,Qt).createElementNS($s,"feComponentTransfer");s.append(i),m(this,M,Eo).call(this,i,"feFuncA",e)},Co=function(e){return r(this,M,jr).style.color=e,$c(getComputedStyle(r(this,M,jr)).getPropertyValue("color"))};class Kf{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `standardFontDataUrl` API parameter is provided.");if(!t)throw new Error("Font filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load font data at: ${e}`)})}async _fetch(t){at("Abstract method `_fetch` called.")}}class Uu extends Kf{async _fetch(t){const e=await ph(t,"arraybuffer");return new Uint8Array(e)}}class Jf{constructor({baseUrl:t=null}){this.baseUrl=t}async fetch({filename:t}){if(!this.baseUrl)throw new Error("Ensure that the `wasmUrl` API parameter is provided.");if(!t)throw new Error("Wasm filename must be specified.");const e=`${this.baseUrl}${t}`;return this._fetch(e).catch(s=>{throw new Error(`Unable to load wasm data at: ${e}`)})}async _fetch(t){at("Abstract method `_fetch` called.")}}class zu extends Jf{async _fetch(t){const e=await ph(t,"arraybuffer");return new Uint8Array(e)}}oe&&V("Please use the `legacy` build in Node.js environments.");async function Su(d){const e=await process.getBuiltinModule("fs").promises.readFile(d);return new Uint8Array(e)}class Yg extends Xf{}class Kg extends Wf{_createCanvas(t,e){return process.getBuiltinModule("module").createRequire(import.meta.url)("@napi-rs/canvas").createCanvas(t,e)}}class Jg extends qf{async _fetch(t){return Su(t)}}class Qg extends Kf{async _fetch(t){return Su(t)}}class Zg extends Jf{async _fetch(t){return Su(t)}}const jt={FILL:"Fill",STROKE:"Stroke",SHADING:"Shading"};function _d(d,t){if(!t)return;const e=t[2]-t[0],s=t[3]-t[1],i=new Path2D;i.rect(t[0],t[1],e,s),d.clip(i)}class Eu{isModifyingCurrentTransform(){return!1}getPattern(){at("Abstract method `getPattern` called.")}}class tm extends Eu{constructor(t){super(),this._type=t[1],this._bbox=t[2],this._colorStops=t[3],this._p0=t[4],this._p1=t[5],this._r0=t[6],this._r1=t[7],this.matrix=null}_createGradient(t){let e;this._type==="axial"?e=t.createLinearGradient(this._p0[0],this._p0[1],this._p1[0],this._p1[1]):this._type==="radial"&&(e=t.createRadialGradient(this._p0[0],this._p0[1],this._r0,this._p1[0],this._p1[1],this._r1));for(const s of this._colorStops)e.addColorStop(s[0],s[1]);return e}getPattern(t,e,s,i){let n;if(i===jt.STROKE||i===jt.FILL){const a=e.current.getClippedPathBoundingBox(i,pt(t))||[0,0,0,0],o=Math.ceil(a[2]-a[0])||1,l=Math.ceil(a[3]-a[1])||1,h=e.cachedCanvases.getCanvas("pattern",o,l),c=h.context;c.clearRect(0,0,c.canvas.width,c.canvas.height),c.beginPath(),c.rect(0,0,c.canvas.width,c.canvas.height),c.translate(-a[0],-a[1]),s=H.transform(s,[1,0,0,1,a[0],a[1]]),c.transform(...e.baseTransform),this.matrix&&c.transform(...this.matrix),_d(c,this._bbox),c.fillStyle=this._createGradient(c),c.fill(),n=t.createPattern(h.canvas,"no-repeat");const u=new DOMMatrix(s);n.setTransform(u)}else _d(t,this._bbox),n=this._createGradient(t);return n}}function Yc(d,t,e,s,i,n,a,o){const l=t.coords,h=t.colors,c=d.data,u=d.width*4;let p;l[e+1]>l[s+1]&&(p=e,e=s,s=p,p=n,n=a,a=p),l[s+1]>l[i+1]&&(p=s,s=i,i=p,p=a,a=o,o=p),l[e+1]>l[s+1]&&(p=e,e=s,s=p,p=n,n=a,a=p);const y=(l[e]+t.offsetX)*t.scaleX,A=(l[e+1]+t.offsetY)*t.scaleY,b=(l[s]+t.offsetX)*t.scaleX,w=(l[s+1]+t.offsetY)*t.scaleY,v=(l[i]+t.offsetX)*t.scaleX,E=(l[i+1]+t.offsetY)*t.scaleY;if(A>=E)return;const S=h[n],_=h[n+1],C=h[n+2],T=h[a],x=h[a+1],I=h[a+2],P=h[o],D=h[o+1],k=h[o+2],Z=Math.round(A),it=Math.round(E);let X,te,B,$,Be,Os,_n,ds;for(let Rt=Z;Rt<=it;Rt++){if(Rt<w){const gt=Rt<A?0:(A-Rt)/(A-w);X=y-(y-b)*gt,te=S-(S-T)*gt,B=_-(_-x)*gt,$=C-(C-I)*gt}else{let gt;Rt>E?gt=1:w===E?gt=0:gt=(w-Rt)/(w-E),X=b-(b-v)*gt,te=T-(T-P)*gt,B=x-(x-D)*gt,$=I-(I-k)*gt}let yt;Rt<A?yt=0:Rt>E?yt=1:yt=(A-Rt)/(A-E),Be=y-(y-v)*yt,Os=S-(S-P)*yt,_n=_-(_-D)*yt,ds=C-(C-k)*yt;const Ur=Math.round(Math.min(X,Be)),Ti=Math.round(Math.max(X,Be));let xi=u*Rt+Ur*4;for(let gt=Ur;gt<=Ti;gt++)yt=(X-gt)/(X-Be),yt<0?yt=0:yt>1&&(yt=1),c[xi++]=te-(te-Os)*yt|0,c[xi++]=B-(B-_n)*yt|0,c[xi++]=$-($-ds)*yt|0,c[xi++]=255}}function em(d,t,e){const s=t.coords,i=t.colors;let n,a;switch(t.type){case"lattice":const o=t.verticesPerRow,l=Math.floor(s.length/o)-1,h=o-1;for(n=0;n<l;n++){let c=n*o;for(let u=0;u<h;u++,c++)Yc(d,e,s[c],s[c+1],s[c+o],i[c],i[c+1],i[c+o]),Yc(d,e,s[c+o+1],s[c+1],s[c+o],i[c+o+1],i[c+1],i[c+o])}break;case"triangles":for(n=0,a=s.length;n<a;n+=3)Yc(d,e,s[n],s[n+1],s[n+2],i[n],i[n+1],i[n+2]);break;default:throw new Error("illegal figure")}}class sm extends Eu{constructor(t){super(),this._coords=t[2],this._colors=t[3],this._figures=t[4],this._bounds=t[5],this._bbox=t[6],this._background=t[7],this.matrix=null}_createMeshCanvas(t,e,s){const o=Math.floor(this._bounds[0]),l=Math.floor(this._bounds[1]),h=Math.ceil(this._bounds[2])-o,c=Math.ceil(this._bounds[3])-l,u=Math.min(Math.ceil(Math.abs(h*t[0]*1.1)),3e3),p=Math.min(Math.ceil(Math.abs(c*t[1]*1.1)),3e3),y=h/u,A=c/p,b={coords:this._coords,colors:this._colors,offsetX:-o,offsetY:-l,scaleX:1/y,scaleY:1/A},w=u+4,v=p+4,E=s.getCanvas("mesh",w,v),S=E.context,_=S.createImageData(u,p);if(e){const T=_.data;for(let x=0,I=T.length;x<I;x+=4)T[x]=e[0],T[x+1]=e[1],T[x+2]=e[2],T[x+3]=255}for(const T of this._figures)em(_,T,b);return S.putImageData(_,2,2),{canvas:E.canvas,offsetX:o-2*y,offsetY:l-2*A,scaleX:y,scaleY:A}}isModifyingCurrentTransform(){return!0}getPattern(t,e,s,i){_d(t,this._bbox);const n=new Float32Array(2);if(i===jt.SHADING)H.singularValueDecompose2dScale(pt(t),n);else if(this.matrix){H.singularValueDecompose2dScale(this.matrix,n);const[o,l]=n;H.singularValueDecompose2dScale(e.baseTransform,n),n[0]*=o,n[1]*=l}else H.singularValueDecompose2dScale(e.baseTransform,n);const a=this._createMeshCanvas(n,i===jt.SHADING?null:this._background,e.cachedCanvases);return i!==jt.SHADING&&(t.setTransform(...e.baseTransform),this.matrix&&t.transform(...this.matrix)),t.translate(a.offsetX,a.offsetY),t.scale(a.scaleX,a.scaleY),t.createPattern(a.canvas,"no-repeat")}}class im extends Eu{getPattern(){return"hotpink"}}function nm(d){switch(d[0]){case"RadialAxial":return new tm(d);case"Mesh":return new sm(d);case"Dummy":return new im}throw new Error(`Unknown IR type: ${d[0]}`)}const Vu={COLORED:1,UNCOLORED:2},_c=class _c{constructor(t,e,s,i){this.color=t[1],this.operatorList=t[2],this.matrix=t[3],this.bbox=t[4],this.xstep=t[5],this.ystep=t[6],this.paintType=t[7],this.tilingType=t[8],this.ctx=e,this.canvasGraphicsFactory=s,this.baseTransform=i}createPatternCanvas(t){const{bbox:e,operatorList:s,paintType:i,tilingType:n,color:a,canvasGraphicsFactory:o}=this;let{xstep:l,ystep:h}=this;l=Math.abs(l),h=Math.abs(h),Bc("TilingType: "+n);const c=e[0],u=e[1],p=e[2],y=e[3],A=p-c,b=y-u,w=new Float32Array(2);H.singularValueDecompose2dScale(this.matrix,w);const[v,E]=w;H.singularValueDecompose2dScale(this.baseTransform,w);const S=v*w[0],_=E*w[1];let C=A,T=b,x=!1,I=!1;const P=Math.ceil(l*S),D=Math.ceil(h*_),k=Math.ceil(A*S),Z=Math.ceil(b*_);P>=k?C=l:x=!0,D>=Z?T=h:I=!0;const it=this.getSizeAndScale(C,this.ctx.canvas.width,S),X=this.getSizeAndScale(T,this.ctx.canvas.height,_),te=t.cachedCanvases.getCanvas("pattern",it.size,X.size),B=te.context,$=o.createCanvasGraphics(B);if($.groupLevel=t.groupLevel,this.setFillAndStrokeStyleToContext($,i,a),B.translate(-it.scale*c,-X.scale*u),$.transform(it.scale,0,0,X.scale,0,0),B.save(),this.clipBbox($,c,u,p,y),$.baseTransform=pt($.ctx),$.executeOperatorList(s),$.endDrawing(),B.restore(),x||I){const Be=te.canvas;x&&(C=l),I&&(T=h);const Os=this.getSizeAndScale(C,this.ctx.canvas.width,S),_n=this.getSizeAndScale(T,this.ctx.canvas.height,_),ds=Os.size,Rt=_n.size,yt=t.cachedCanvases.getCanvas("pattern-workaround",ds,Rt),Ur=yt.context,Ti=x?Math.floor(A/l):0,xi=I?Math.floor(b/h):0;for(let gt=0;gt<=Ti;gt++)for(let co=0;co<=xi;co++)Ur.drawImage(Be,ds*gt,Rt*co,ds,Rt,0,0,ds,Rt);return{canvas:yt.canvas,scaleX:Os.scale,scaleY:_n.scale,offsetX:c,offsetY:u}}return{canvas:te.canvas,scaleX:it.scale,scaleY:X.scale,offsetX:c,offsetY:u}}getSizeAndScale(t,e,s){const i=Math.max(_c.MAX_PATTERN_SIZE,e);let n=Math.ceil(t*s);return n>=i?n=i:s=n/t,{scale:s,size:n}}clipBbox(t,e,s,i,n){const a=i-e,o=n-s;t.ctx.rect(e,s,a,o),H.axialAlignedBoundingBox([e,s,i,n],pt(t.ctx),t.current.minMax),t.clip(),t.endPath()}setFillAndStrokeStyleToContext(t,e,s){const i=t.ctx,n=t.current;switch(e){case Vu.COLORED:const{fillStyle:a,strokeStyle:o}=this.ctx;i.fillStyle=n.fillColor=a,i.strokeStyle=n.strokeColor=o;break;case Vu.UNCOLORED:i.fillStyle=i.strokeStyle=s,n.fillColor=n.strokeColor=s;break;default:throw new Eg(`Unsupported paint type: ${e}`)}}isModifyingCurrentTransform(){return!1}getPattern(t,e,s,i){let n=s;i!==jt.SHADING&&(n=H.transform(n,e.baseTransform),this.matrix&&(n=H.transform(n,this.matrix)));const a=this.createPatternCanvas(e);let o=new DOMMatrix(n);o=o.translate(a.offsetX,a.offsetY),o=o.scale(1/a.scaleX,1/a.scaleY);const l=t.createPattern(a.canvas,"repeat");return l.setTransform(o),l}};L(_c,"MAX_PATTERN_SIZE",3e3);let Cd=_c;function rm({src:d,srcPos:t=0,dest:e,width:s,height:i,nonBlackColor:n=4294967295,inverseDecode:a=!1}){const o=Xt.isLittleEndian?4278190080:255,[l,h]=a?[n,o]:[o,n],c=s>>3,u=s&7,p=d.length;e=new Uint32Array(e.buffer);let y=0;for(let A=0;A<i;A++){for(const w=t+c;t<w;t++){const v=t<p?d[t]:255;e[y++]=v&128?h:l,e[y++]=v&64?h:l,e[y++]=v&32?h:l,e[y++]=v&16?h:l,e[y++]=v&8?h:l,e[y++]=v&4?h:l,e[y++]=v&2?h:l,e[y++]=v&1?h:l}if(u===0)continue;const b=t<p?d[t++]:255;for(let w=0;w<u;w++)e[y++]=b&1<<7-w?h:l}return{srcPos:t,destPos:y}}const Gu=16,ju=100,am=15,Wu=10,me=16,Kc=new DOMMatrix,Me=new Float32Array(2),Jr=new Float32Array([1/0,1/0,-1/0,-1/0]);function om(d,t){if(d._removeMirroring)throw new Error("Context is already forwarding operations.");d.__originalSave=d.save,d.__originalRestore=d.restore,d.__originalRotate=d.rotate,d.__originalScale=d.scale,d.__originalTranslate=d.translate,d.__originalTransform=d.transform,d.__originalSetTransform=d.setTransform,d.__originalResetTransform=d.resetTransform,d.__originalClip=d.clip,d.__originalMoveTo=d.moveTo,d.__originalLineTo=d.lineTo,d.__originalBezierCurveTo=d.bezierCurveTo,d.__originalRect=d.rect,d.__originalClosePath=d.closePath,d.__originalBeginPath=d.beginPath,d._removeMirroring=()=>{d.save=d.__originalSave,d.restore=d.__originalRestore,d.rotate=d.__originalRotate,d.scale=d.__originalScale,d.translate=d.__originalTranslate,d.transform=d.__originalTransform,d.setTransform=d.__originalSetTransform,d.resetTransform=d.__originalResetTransform,d.clip=d.__originalClip,d.moveTo=d.__originalMoveTo,d.lineTo=d.__originalLineTo,d.bezierCurveTo=d.__originalBezierCurveTo,d.rect=d.__originalRect,d.closePath=d.__originalClosePath,d.beginPath=d.__originalBeginPath,delete d._removeMirroring},d.save=function(){t.save(),this.__originalSave()},d.restore=function(){t.restore(),this.__originalRestore()},d.translate=function(e,s){t.translate(e,s),this.__originalTranslate(e,s)},d.scale=function(e,s){t.scale(e,s),this.__originalScale(e,s)},d.transform=function(e,s,i,n,a,o){t.transform(e,s,i,n,a,o),this.__originalTransform(e,s,i,n,a,o)},d.setTransform=function(e,s,i,n,a,o){t.setTransform(e,s,i,n,a,o),this.__originalSetTransform(e,s,i,n,a,o)},d.resetTransform=function(){t.resetTransform(),this.__originalResetTransform()},d.rotate=function(e){t.rotate(e),this.__originalRotate(e)},d.clip=function(e){t.clip(e),this.__originalClip(e)},d.moveTo=function(e,s){t.moveTo(e,s),this.__originalMoveTo(e,s)},d.lineTo=function(e,s){t.lineTo(e,s),this.__originalLineTo(e,s)},d.bezierCurveTo=function(e,s,i,n,a,o){t.bezierCurveTo(e,s,i,n,a,o),this.__originalBezierCurveTo(e,s,i,n,a,o)},d.rect=function(e,s,i,n){t.rect(e,s,i,n),this.__originalRect(e,s,i,n)},d.closePath=function(){t.closePath(),this.__originalClosePath()},d.beginPath=function(){t.beginPath(),this.__originalBeginPath()}}class lm{constructor(t){this.canvasFactory=t,this.cache=Object.create(null)}getCanvas(t,e,s){let i;return this.cache[t]!==void 0?(i=this.cache[t],this.canvasFactory.reset(i,e,s)):(i=this.canvasFactory.create(e,s),this.cache[t]=i),i}delete(t){delete this.cache[t]}clear(){for(const t in this.cache){const e=this.cache[t];this.canvasFactory.destroy(e),delete this.cache[t]}}}function Eh(d,t,e,s,i,n,a,o,l,h){const[c,u,p,y,A,b]=pt(d);if(u===0&&p===0){const E=a*c+A,S=Math.round(E),_=o*y+b,C=Math.round(_),T=(a+l)*c+A,x=Math.abs(Math.round(T)-S)||1,I=(o+h)*y+b,P=Math.abs(Math.round(I)-C)||1;return d.setTransform(Math.sign(c),0,0,Math.sign(y),S,C),d.drawImage(t,e,s,i,n,0,0,x,P),d.setTransform(c,u,p,y,A,b),[x,P]}if(c===0&&y===0){const E=o*p+A,S=Math.round(E),_=a*u+b,C=Math.round(_),T=(o+h)*p+A,x=Math.abs(Math.round(T)-S)||1,I=(a+l)*u+b,P=Math.abs(Math.round(I)-C)||1;return d.setTransform(0,Math.sign(u),Math.sign(p),0,S,C),d.drawImage(t,e,s,i,n,0,0,P,x),d.setTransform(c,u,p,y,A,b),[P,x]}d.drawImage(t,e,s,i,n,a,o,l,h);const w=Math.hypot(c,u),v=Math.hypot(p,y);return[w*l,v*h]}class qu{constructor(t,e){L(this,"alphaIsShape",!1);L(this,"fontSize",0);L(this,"fontSizeScale",1);L(this,"textMatrix",null);L(this,"textMatrixScale",1);L(this,"fontMatrix",td);L(this,"leading",0);L(this,"x",0);L(this,"y",0);L(this,"lineX",0);L(this,"lineY",0);L(this,"charSpacing",0);L(this,"wordSpacing",0);L(this,"textHScale",1);L(this,"textRenderingMode",Yt.FILL);L(this,"textRise",0);L(this,"fillColor","#000000");L(this,"strokeColor","#000000");L(this,"patternFill",!1);L(this,"patternStroke",!1);L(this,"fillAlpha",1);L(this,"strokeAlpha",1);L(this,"lineWidth",1);L(this,"activeSMask",null);L(this,"transferMaps","none");this.clipBox=new Float32Array([0,0,t,e]),this.minMax=Jr.slice()}clone(){const t=Object.create(this);return t.clipBox=this.clipBox.slice(),t.minMax=this.minMax.slice(),t}getPathBoundingBox(t=jt.FILL,e=null){const s=this.minMax.slice();if(t===jt.STROKE){e||at("Stroke bounding box must include transform."),H.singularValueDecompose2dScale(e,Me);const i=Me[0]*this.lineWidth/2,n=Me[1]*this.lineWidth/2;s[0]-=i,s[1]-=n,s[2]+=i,s[3]+=n}return s}updateClipFromPath(){const t=H.intersect(this.clipBox,this.getPathBoundingBox());this.startNewPathAndClipBox(t||[0,0,0,0])}isEmptyClip(){return this.minMax[0]===1/0}startNewPathAndClipBox(t){this.clipBox.set(t,0),this.minMax.set(Jr,0)}getClippedPathBoundingBox(t=jt.FILL,e=null){return H.intersect(this.clipBox,this.getPathBoundingBox(t,e))}}function Xu(d,t){if(t instanceof ImageData){d.putImageData(t,0,0);return}const e=t.height,s=t.width,i=e%me,n=(e-i)/me,a=i===0?n:n+1,o=d.createImageData(s,me);let l=0,h;const c=t.data,u=o.data;let p,y,A,b;if(t.kind===xh.GRAYSCALE_1BPP){const w=c.byteLength,v=new Uint32Array(u.buffer,0,u.byteLength>>2),E=v.length,S=s+7>>3,_=4294967295,C=Xt.isLittleEndian?4278190080:255;for(p=0;p<a;p++){for(A=p<n?me:i,h=0,y=0;y<A;y++){const T=w-l;let x=0;const I=T>S?s:T*8-7,P=I&-8;let D=0,k=0;for(;x<P;x+=8)k=c[l++],v[h++]=k&128?_:C,v[h++]=k&64?_:C,v[h++]=k&32?_:C,v[h++]=k&16?_:C,v[h++]=k&8?_:C,v[h++]=k&4?_:C,v[h++]=k&2?_:C,v[h++]=k&1?_:C;for(;x<I;x++)D===0&&(k=c[l++],D=128),v[h++]=k&D?_:C,D>>=1}for(;h<E;)v[h++]=0;d.putImageData(o,0,p*me)}}else if(t.kind===xh.RGBA_32BPP){for(y=0,b=s*me*4,p=0;p<n;p++)u.set(c.subarray(l,l+b)),l+=b,d.putImageData(o,0,y),y+=me;p<a&&(b=s*i*4,u.set(c.subarray(l,l+b)),d.putImageData(o,0,y))}else if(t.kind===xh.RGB_24BPP)for(A=me,b=s*A,p=0;p<a;p++){for(p>=n&&(A=i,b=s*A),h=0,y=b;y--;)u[h++]=c[l++],u[h++]=c[l++],u[h++]=c[l++],u[h++]=255;d.putImageData(o,0,p*me)}else throw new Error(`bad image kind: ${t.kind}`)}function Yu(d,t){if(t.bitmap){d.drawImage(t.bitmap,0,0);return}const e=t.height,s=t.width,i=e%me,n=(e-i)/me,a=i===0?n:n+1,o=d.createImageData(s,me);let l=0;const h=t.data,c=o.data;for(let u=0;u<a;u++){const p=u<n?me:i;({srcPos:l}=rm({src:h,srcPos:l,dest:c,width:s,height:p,nonBlackColor:0})),d.putImageData(o,0,u*me)}}function uo(d,t){const e=["strokeStyle","fillStyle","fillRule","globalAlpha","lineWidth","lineCap","lineJoin","miterLimit","globalCompositeOperation","font","filter"];for(const s of e)d[s]!==void 0&&(t[s]=d[s]);d.setLineDash!==void 0&&(t.setLineDash(d.getLineDash()),t.lineDashOffset=d.lineDashOffset)}function _h(d){d.strokeStyle=d.fillStyle="#000000",d.fillRule="nonzero",d.globalAlpha=1,d.lineWidth=1,d.lineCap="butt",d.lineJoin="miter",d.miterLimit=10,d.globalCompositeOperation="source-over",d.font="10px sans-serif",d.setLineDash!==void 0&&(d.setLineDash([]),d.lineDashOffset=0);const{filter:t}=d;t!=="none"&&t!==""&&(d.filter="none")}function Ku(d,t){if(t)return!0;H.singularValueDecompose2dScale(d,Me);const e=Math.fround(Fs.pixelRatio*vn.PDF_TO_CSS_UNITS);return Me[0]<=e&&Me[1]<=e}const hm=["butt","round","square"],cm=["miter","round","bevel"],dm={},Ju={};var cs,Td,xd,Ld;const Pu=class Pu{constructor(t,e,s,i,n,{optionalContentConfig:a,markedContentStack:o=null},l,h){g(this,cs);this.ctx=t,this.current=new qu(this.ctx.canvas.width,this.ctx.canvas.height),this.stateStack=[],this.pendingClip=null,this.pendingEOFill=!1,this.res=null,this.xobjs=null,this.commonObjs=e,this.objs=s,this.canvasFactory=i,this.filterFactory=n,this.groupStack=[],this.baseTransform=null,this.baseTransformStack=[],this.groupLevel=0,this.smaskStack=[],this.smaskCounter=0,this.tempSMask=null,this.suspendedCtx=null,this.contentVisible=!0,this.markedContentStack=o||[],this.optionalContentConfig=a,this.cachedCanvases=new lm(this.canvasFactory),this.cachedPatterns=new Map,this.annotationCanvasMap=l,this.viewportScale=1,this.outputScaleX=1,this.outputScaleY=1,this.pageColors=h,this._cachedScaleForStroking=[-1,0],this._cachedGetSinglePixelWidth=null,this._cachedBitmapsMap=new Map}getObject(t,e=null){return typeof t=="string"?t.startsWith("g_")?this.commonObjs.get(t):this.objs.get(t):e}beginDrawing({transform:t,viewport:e,transparency:s=!1,background:i=null}){const n=this.ctx.canvas.width,a=this.ctx.canvas.height,o=this.ctx.fillStyle;if(this.ctx.fillStyle=i||"#ffffff",this.ctx.fillRect(0,0,n,a),this.ctx.fillStyle=o,s){const l=this.cachedCanvases.getCanvas("transparent",n,a);this.compositeCtx=this.ctx,this.transparentCanvas=l.canvas,this.ctx=l.context,this.ctx.save(),this.ctx.transform(...pt(this.compositeCtx))}this.ctx.save(),_h(this.ctx),t&&(this.ctx.transform(...t),this.outputScaleX=t[0],this.outputScaleY=t[0]),this.ctx.transform(...e.transform),this.viewportScale=e.scale,this.baseTransform=pt(this.ctx)}executeOperatorList(t,e,s,i){const n=t.argsArray,a=t.fnArray;let o=e||0;const l=n.length;if(l===o)return o;const h=l-o>Wu&&typeof s=="function",c=h?Date.now()+am:0;let u=0;const p=this.commonObjs,y=this.objs;let A;for(;;){if(i!==void 0&&o===i.nextBreakPoint)return i.breakIt(o,s),o;if(A=a[o],A!==nc.dependency)this[A].apply(this,n[o]);else for(const b of n[o]){const w=b.startsWith("g_")?p:y;if(!w.has(b))return w.get(b,s),o}if(o++,o===l)return o;if(h&&++u>Wu){if(Date.now()>c)return s(),o;u=0}}}endDrawing(){m(this,cs,Td).call(this),this.cachedCanvases.clear(),this.cachedPatterns.clear();for(const t of this._cachedBitmapsMap.values()){for(const e of t.values())typeof HTMLCanvasElement<"u"&&e instanceof HTMLCanvasElement&&(e.width=e.height=0);t.clear()}this._cachedBitmapsMap.clear(),m(this,cs,xd).call(this)}_scaleImage(t,e){const s=t.width??t.displayWidth,i=t.height??t.displayHeight;let n=Math.max(Math.hypot(e[0],e[1]),1),a=Math.max(Math.hypot(e[2],e[3]),1),o=s,l=i,h="prescale1",c,u;for(;n>2&&o>1||a>2&&l>1;){let p=o,y=l;n>2&&o>1&&(p=o>=16384?Math.floor(o/2)-1||1:Math.ceil(o/2),n/=o/p),a>2&&l>1&&(y=l>=16384?Math.floor(l/2)-1||1:Math.ceil(l)/2,a/=l/y),c=this.cachedCanvases.getCanvas(h,p,y),u=c.context,u.clearRect(0,0,p,y),u.drawImage(t,0,0,o,l,0,0,p,y),t=c.canvas,o=p,l=y,h=h==="prescale1"?"prescale2":"prescale1"}return{img:t,paintWidth:o,paintHeight:l}}_createMaskCanvas(t){const e=this.ctx,{width:s,height:i}=t,n=this.current.fillColor,a=this.current.patternFill,o=pt(e);let l,h,c,u;if((t.bitmap||t.data)&&t.count>1){const P=t.bitmap||t.data.buffer;h=JSON.stringify(a?o:[o.slice(0,4),n]),l=this._cachedBitmapsMap.get(P),l||(l=new Map,this._cachedBitmapsMap.set(P,l));const D=l.get(h);if(D&&!a){const k=Math.round(Math.min(o[0],o[2])+o[4]),Z=Math.round(Math.min(o[1],o[3])+o[5]);return{canvas:D,offsetX:k,offsetY:Z}}c=D}c||(u=this.cachedCanvases.getCanvas("maskCanvas",s,i),Yu(u.context,t));let p=H.transform(o,[1/s,0,0,-1/i,0,0]);p=H.transform(p,[1,0,0,1,0,-i]);const y=Jr.slice();H.axialAlignedBoundingBox([0,0,s,i],p,y);const[A,b,w,v]=y,E=Math.round(w-A)||1,S=Math.round(v-b)||1,_=this.cachedCanvases.getCanvas("fillCanvas",E,S),C=_.context,T=A,x=b;C.translate(-T,-x),C.transform(...p),c||(c=this._scaleImage(u.canvas,us(C)),c=c.img,l&&a&&l.set(h,c)),C.imageSmoothingEnabled=Ku(pt(C),t.interpolate),Eh(C,c,0,0,c.width,c.height,0,0,s,i),C.globalCompositeOperation="source-in";const I=H.transform(us(C),[1,0,0,1,-T,-x]);return C.fillStyle=a?n.getPattern(e,this,I,jt.FILL):n,C.fillRect(0,0,s,i),l&&!a&&(this.cachedCanvases.delete("fillCanvas"),l.set(h,_.canvas)),{canvas:_.canvas,offsetX:Math.round(T),offsetY:Math.round(x)}}setLineWidth(t){t!==this.current.lineWidth&&(this._cachedScaleForStroking[0]=-1),this.current.lineWidth=t,this.ctx.lineWidth=t}setLineCap(t){this.ctx.lineCap=hm[t]}setLineJoin(t){this.ctx.lineJoin=cm[t]}setMiterLimit(t){this.ctx.miterLimit=t}setDash(t,e){const s=this.ctx;s.setLineDash!==void 0&&(s.setLineDash(t),s.lineDashOffset=e)}setRenderingIntent(t){}setFlatness(t){}setGState(t){for(const[e,s]of t)switch(e){case"LW":this.setLineWidth(s);break;case"LC":this.setLineCap(s);break;case"LJ":this.setLineJoin(s);break;case"ML":this.setMiterLimit(s);break;case"D":this.setDash(s[0],s[1]);break;case"RI":this.setRenderingIntent(s);break;case"FL":this.setFlatness(s);break;case"Font":this.setFont(s[0],s[1]);break;case"CA":this.current.strokeAlpha=s;break;case"ca":this.ctx.globalAlpha=this.current.fillAlpha=s;break;case"BM":this.ctx.globalCompositeOperation=s;break;case"SMask":this.current.activeSMask=s?this.tempSMask:null,this.tempSMask=null,this.checkSMaskState();break;case"TR":this.ctx.filter=this.current.transferMaps=this.filterFactory.addFilter(s);break}}get inSMaskMode(){return!!this.suspendedCtx}checkSMaskState(){const t=this.inSMaskMode;this.current.activeSMask&&!t?this.beginSMaskMode():!this.current.activeSMask&&t&&this.endSMaskMode()}beginSMaskMode(){if(this.inSMaskMode)throw new Error("beginSMaskMode called while already in smask mode");const t=this.ctx.canvas.width,e=this.ctx.canvas.height,s="smaskGroupAt"+this.groupLevel,i=this.cachedCanvases.getCanvas(s,t,e);this.suspendedCtx=this.ctx;const n=this.ctx=i.context;n.setTransform(this.suspendedCtx.getTransform()),uo(this.suspendedCtx,n),om(n,this.suspendedCtx),this.setGState([["BM","source-over"]])}endSMaskMode(){if(!this.inSMaskMode)throw new Error("endSMaskMode called while not in smask mode");this.ctx._removeMirroring(),uo(this.ctx,this.suspendedCtx),this.ctx=this.suspendedCtx,this.suspendedCtx=null}compose(t){if(!this.current.activeSMask)return;t?(t[0]=Math.floor(t[0]),t[1]=Math.floor(t[1]),t[2]=Math.ceil(t[2]),t[3]=Math.ceil(t[3])):t=[0,0,this.ctx.canvas.width,this.ctx.canvas.height];const e=this.current.activeSMask,s=this.suspendedCtx;this.composeSMask(s,e,this.ctx,t),this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.clearRect(0,0,this.ctx.canvas.width,this.ctx.canvas.height),this.ctx.restore()}composeSMask(t,e,s,i){const n=i[0],a=i[1],o=i[2]-n,l=i[3]-a;o===0||l===0||(this.genericComposeSMask(e.context,s,o,l,e.subtype,e.backdrop,e.transferMap,n,a,e.offsetX,e.offsetY),t.save(),t.globalAlpha=1,t.globalCompositeOperation="source-over",t.setTransform(1,0,0,1,0,0),t.drawImage(s.canvas,0,0),t.restore())}genericComposeSMask(t,e,s,i,n,a,o,l,h,c,u){let p=t.canvas,y=l-c,A=h-u;if(a)if(y<0||A<0||y+s>p.width||A+i>p.height){const w=this.cachedCanvases.getCanvas("maskExtension",s,i),v=w.context;v.drawImage(p,-y,-A),v.globalCompositeOperation="destination-atop",v.fillStyle=a,v.fillRect(0,0,s,i),v.globalCompositeOperation="source-over",p=w.canvas,y=A=0}else{t.save(),t.globalAlpha=1,t.setTransform(1,0,0,1,0,0);const w=new Path2D;w.rect(y,A,s,i),t.clip(w),t.globalCompositeOperation="destination-atop",t.fillStyle=a,t.fillRect(y,A,s,i),t.restore()}e.save(),e.globalAlpha=1,e.setTransform(1,0,0,1,0,0),n==="Alpha"&&o?e.filter=this.filterFactory.addAlphaFilter(o):n==="Luminosity"&&(e.filter=this.filterFactory.addLuminosityFilter(o));const b=new Path2D;b.rect(l,h,s,i),e.clip(b),e.globalCompositeOperation="destination-in",e.drawImage(p,y,A,s,i,l,h,s,i),e.restore()}save(){this.inSMaskMode&&uo(this.ctx,this.suspendedCtx),this.ctx.save();const t=this.current;this.stateStack.push(t),this.current=t.clone()}restore(){if(this.stateStack.length===0){this.inSMaskMode&&this.endSMaskMode();return}this.current=this.stateStack.pop(),this.ctx.restore(),this.inSMaskMode&&uo(this.suspendedCtx,this.ctx),this.checkSMaskState(),this.pendingClip=null,this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}transform(t,e,s,i,n,a){this.ctx.transform(t,e,s,i,n,a),this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null}constructPath(t,e,s){let[i]=e;if(!s){i||(i=e[0]=new Path2D),this[t](i);return}if(!(i instanceof Path2D)){const n=e[0]=new Path2D;for(let a=0,o=i.length;a<o;)switch(i[a++]){case Ah.moveTo:n.moveTo(i[a++],i[a++]);break;case Ah.lineTo:n.lineTo(i[a++],i[a++]);break;case Ah.curveTo:n.bezierCurveTo(i[a++],i[a++],i[a++],i[a++],i[a++],i[a++]);break;case Ah.closePath:n.closePath();break;default:V(`Unrecognized drawing path operator: ${i[a-1]}`);break}i=n}H.axialAlignedBoundingBox(s,pt(this.ctx),this.current.minMax),this[t](i)}closePath(){this.ctx.closePath()}stroke(t,e=!0){const s=this.ctx,i=this.current.strokeColor;if(s.globalAlpha=this.current.strokeAlpha,this.contentVisible)if(typeof i=="object"&&(i!=null&&i.getPattern)){const n=i.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.strokeStyle=i.getPattern(s,this,us(s),jt.STROKE),n){const a=new Path2D;a.addPath(t,s.getTransform().invertSelf().multiplySelf(n)),t=a}this.rescaleAndStroke(t,!1),s.restore()}else this.rescaleAndStroke(t,!0);e&&this.consumePath(t,this.current.getClippedPathBoundingBox(jt.STROKE,pt(this.ctx))),s.globalAlpha=this.current.fillAlpha}closeStroke(t){this.stroke(t)}fill(t,e=!0){const s=this.ctx,i=this.current.fillColor,n=this.current.patternFill;let a=!1;if(n){const l=i.isModifyingCurrentTransform()?s.getTransform():null;if(s.save(),s.fillStyle=i.getPattern(s,this,us(s),jt.FILL),l){const h=new Path2D;h.addPath(t,s.getTransform().invertSelf().multiplySelf(l)),t=h}a=!0}const o=this.current.getClippedPathBoundingBox();this.contentVisible&&o!==null&&(this.pendingEOFill?(s.fill(t,"evenodd"),this.pendingEOFill=!1):s.fill(t)),a&&s.restore(),e&&this.consumePath(t,o)}eoFill(t){this.pendingEOFill=!0,this.fill(t)}fillStroke(t){this.fill(t,!1),this.stroke(t,!1),this.consumePath(t)}eoFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}closeFillStroke(t){this.fillStroke(t)}closeEOFillStroke(t){this.pendingEOFill=!0,this.fillStroke(t)}endPath(t){this.consumePath(t)}rawFillPath(t){this.ctx.fill(t)}clip(){this.pendingClip=dm}eoClip(){this.pendingClip=Ju}beginText(){this.current.textMatrix=null,this.current.textMatrixScale=1,this.current.x=this.current.lineX=0,this.current.y=this.current.lineY=0}endText(){const t=this.pendingTextPaths,e=this.ctx;if(t===void 0)return;const s=new Path2D,i=e.getTransform().invertSelf();for(const{transform:n,x:a,y:o,fontSize:l,path:h}of t)h&&s.addPath(h,new DOMMatrix(n).preMultiplySelf(i).translate(a,o).scale(l,-l));e.clip(s),delete this.pendingTextPaths}setCharSpacing(t){this.current.charSpacing=t}setWordSpacing(t){this.current.wordSpacing=t}setHScale(t){this.current.textHScale=t/100}setLeading(t){this.current.leading=-t}setFont(t,e){var c;const s=this.commonObjs.get(t),i=this.current;if(!s)throw new Error(`Can't find font for ${t}`);if(i.fontMatrix=s.fontMatrix||td,(i.fontMatrix[0]===0||i.fontMatrix[3]===0)&&V("Invalid font matrix for font "+t),e<0?(e=-e,i.fontDirection=-1):i.fontDirection=1,this.current.font=s,this.current.fontSize=e,s.isType3Font)return;const n=s.loadedName||"sans-serif",a=((c=s.systemFontInfo)==null?void 0:c.css)||`"${n}", ${s.fallbackName}`;let o="normal";s.black?o="900":s.bold&&(o="bold");const l=s.italic?"italic":"normal";let h=e;e<Gu?h=Gu:e>ju&&(h=ju),this.current.fontSizeScale=e/h,this.ctx.font=`${l} ${o} ${h}px ${a}`}setTextRenderingMode(t){this.current.textRenderingMode=t}setTextRise(t){this.current.textRise=t}moveText(t,e){this.current.x=this.current.lineX+=t,this.current.y=this.current.lineY+=e}setLeadingMoveText(t,e){this.setLeading(-e),this.moveText(t,e)}setTextMatrix(t){const{current:e}=this;e.textMatrix=t,e.textMatrixScale=Math.hypot(t[0],t[1]),e.x=e.lineX=0,e.y=e.lineY=0}nextLine(){this.moveText(0,this.current.leading)}paintChar(t,e,s,i,n){const a=this.ctx,o=this.current,l=o.font,h=o.textRenderingMode,c=o.fontSize/o.fontSizeScale,u=h&Yt.FILL_STROKE_MASK,p=!!(h&Yt.ADD_TO_PATH_FLAG),y=o.patternFill&&!l.missingFile,A=o.patternStroke&&!l.missingFile;let b;if((l.disableFontFace||p||y||A)&&!l.missingFile&&(b=l.getPathGenerator(this.commonObjs,t)),b&&(l.disableFontFace||y||A)){a.save(),a.translate(e,s),a.scale(c,-c);let w;if((u===Yt.FILL||u===Yt.FILL_STROKE)&&(i?(w=a.getTransform(),a.setTransform(...i),a.fill(m(this,cs,Ld).call(this,b,w,i))):a.fill(b)),u===Yt.STROKE||u===Yt.FILL_STROKE)if(n){w||(w=a.getTransform()),a.setTransform(...n);const{a:v,b:E,c:S,d:_}=w,C=H.inverseTransform(n),T=H.transform([v,E,S,_,0,0],C);H.singularValueDecompose2dScale(T,Me),a.lineWidth*=Math.max(Me[0],Me[1])/c,a.stroke(m(this,cs,Ld).call(this,b,w,n))}else a.lineWidth/=c,a.stroke(b);a.restore()}else(u===Yt.FILL||u===Yt.FILL_STROKE)&&a.fillText(t,e,s),(u===Yt.STROKE||u===Yt.FILL_STROKE)&&a.strokeText(t,e,s);p&&(this.pendingTextPaths||(this.pendingTextPaths=[])).push({transform:pt(a),x:e,y:s,fontSize:c,path:b})}get isFontSubpixelAAEnabled(){const{context:t}=this.cachedCanvases.getCanvas("isFontSubpixelAAEnabled",10,10);t.scale(1.5,1),t.fillText("I",0,10);const e=t.getImageData(0,0,10,10).data;let s=!1;for(let i=3;i<e.length;i+=4)if(e[i]>0&&e[i]<255){s=!0;break}return q(this,"isFontSubpixelAAEnabled",s)}showText(t){const e=this.current,s=e.font;if(s.isType3Font)return this.showType3Text(t);const i=e.fontSize;if(i===0)return;const n=this.ctx,a=e.fontSizeScale,o=e.charSpacing,l=e.wordSpacing,h=e.fontDirection,c=e.textHScale*h,u=t.length,p=s.vertical,y=p?1:-1,A=s.defaultVMetrics,b=i*e.fontMatrix[0],w=e.textRenderingMode===Yt.FILL&&!s.disableFontFace&&!e.patternFill;n.save(),e.textMatrix&&n.transform(...e.textMatrix),n.translate(e.x,e.y+e.textRise),h>0?n.scale(c,-1):n.scale(c,1);let v,E;if(e.patternFill){n.save();const x=e.fillColor.getPattern(n,this,us(n),jt.FILL);v=pt(n),n.restore(),n.fillStyle=x}if(e.patternStroke){n.save();const x=e.strokeColor.getPattern(n,this,us(n),jt.STROKE);E=pt(n),n.restore(),n.strokeStyle=x}let S=e.lineWidth;const _=e.textMatrixScale;if(_===0||S===0){const x=e.textRenderingMode&Yt.FILL_STROKE_MASK;(x===Yt.STROKE||x===Yt.FILL_STROKE)&&(S=this.getSinglePixelWidth())}else S/=_;if(a!==1&&(n.scale(a,a),S/=a),n.lineWidth=S,s.isInvalidPDFjsFont){const x=[];let I=0;for(const P of t)x.push(P.unicode),I+=P.width;n.fillText(x.join(""),0,0),e.x+=I*b*c,n.restore(),this.compose();return}let C=0,T;for(T=0;T<u;++T){const x=t[T];if(typeof x=="number"){C+=y*x*i/1e3;continue}let I=!1;const P=(x.isSpace?l:0)+o,D=x.fontChar,k=x.accent;let Z,it,X=x.width;if(p){const B=x.vmetric||A,$=-(x.vmetric?B[1]:X*.5)*b,Be=B[2]*b;X=B?-B[0]:X,Z=$/a,it=(C+Be)/a}else Z=C/a,it=0;if(s.remeasure&&X>0){const B=n.measureText(D).width*1e3/i*a;if(X<B&&this.isFontSubpixelAAEnabled){const $=X/B;I=!0,n.save(),n.scale($,1),Z/=$}else X!==B&&(Z+=(X-B)/2e3*i/a)}if(this.contentVisible&&(x.isInFont||s.missingFile)){if(w&&!k)n.fillText(D,Z,it);else if(this.paintChar(D,Z,it,v,E),k){const B=Z+i*k.offset.x/a,$=it-i*k.offset.y/a;this.paintChar(k.fontChar,B,$,v,E)}}const te=p?X*b-P*h:X*b+P*h;C+=te,I&&n.restore()}p?e.y-=C:e.x+=C*c,n.restore(),this.compose()}showType3Text(t){const e=this.ctx,s=this.current,i=s.font,n=s.fontSize,a=s.fontDirection,o=i.vertical?1:-1,l=s.charSpacing,h=s.wordSpacing,c=s.textHScale*a,u=s.fontMatrix||td,p=t.length,y=s.textRenderingMode===Yt.INVISIBLE;let A,b,w,v;if(!(y||n===0)){for(this._cachedScaleForStroking[0]=-1,this._cachedGetSinglePixelWidth=null,e.save(),s.textMatrix&&e.transform(...s.textMatrix),e.translate(s.x,s.y+s.textRise),e.scale(c,a),A=0;A<p;++A){if(b=t[A],typeof b=="number"){v=o*b*n/1e3,this.ctx.translate(v,0),s.x+=v*c;continue}const E=(b.isSpace?h:0)+l,S=i.charProcOperatorList[b.operatorListId];S?this.contentVisible&&(this.save(),e.scale(n,n),e.transform(...u),this.executeOperatorList(S),this.restore()):V(`Type3 character "${b.operatorListId}" is not available.`);const _=[b.width,0];H.applyTransform(_,u),w=_[0]*n+E,e.translate(w,0),s.x+=w*c}e.restore()}}setCharWidth(t,e){}setCharWidthAndBounds(t,e,s,i,n,a){const o=new Path2D;o.rect(s,i,n-s,a-i),this.ctx.clip(o),this.endPath()}getColorN_Pattern(t){let e;if(t[0]==="TilingPattern"){const s=this.baseTransform||pt(this.ctx),i={createCanvasGraphics:n=>new Pu(n,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:this.optionalContentConfig,markedContentStack:this.markedContentStack})};e=new Cd(t,this.ctx,i,s)}else e=this._getPattern(t[1],t[2]);return e}setStrokeColorN(){this.current.strokeColor=this.getColorN_Pattern(arguments),this.current.patternStroke=!0}setFillColorN(){this.current.fillColor=this.getColorN_Pattern(arguments),this.current.patternFill=!0}setStrokeRGBColor(t){this.ctx.strokeStyle=this.current.strokeColor=t,this.current.patternStroke=!1}setStrokeTransparent(){this.ctx.strokeStyle=this.current.strokeColor="transparent",this.current.patternStroke=!1}setFillRGBColor(t){this.ctx.fillStyle=this.current.fillColor=t,this.current.patternFill=!1}setFillTransparent(){this.ctx.fillStyle=this.current.fillColor="transparent",this.current.patternFill=!1}_getPattern(t,e=null){let s;return this.cachedPatterns.has(t)?s=this.cachedPatterns.get(t):(s=nm(this.getObject(t)),this.cachedPatterns.set(t,s)),e&&(s.matrix=e),s}shadingFill(t){if(!this.contentVisible)return;const e=this.ctx;this.save();const s=this._getPattern(t);e.fillStyle=s.getPattern(e,this,us(e),jt.SHADING);const i=us(e);if(i){const{width:n,height:a}=e.canvas,o=Jr.slice();H.axialAlignedBoundingBox([0,0,n,a],i,o);const[l,h,c,u]=o;this.ctx.fillRect(l,h,c-l,u-h)}else this.ctx.fillRect(-1e10,-1e10,2e10,2e10);this.compose(this.current.getClippedPathBoundingBox()),this.restore()}beginInlineImage(){at("Should not call beginInlineImage")}beginImageData(){at("Should not call beginImageData")}paintFormXObjectBegin(t,e){if(this.contentVisible&&(this.save(),this.baseTransformStack.push(this.baseTransform),t&&this.transform(...t),this.baseTransform=pt(this.ctx),e)){H.axialAlignedBoundingBox(e,this.baseTransform,this.current.minMax);const[s,i,n,a]=e,o=new Path2D;o.rect(s,i,n-s,a-i),this.ctx.clip(o),this.endPath()}}paintFormXObjectEnd(){this.contentVisible&&(this.restore(),this.baseTransform=this.baseTransformStack.pop())}beginGroup(t){if(!this.contentVisible)return;this.save(),this.inSMaskMode&&(this.endSMaskMode(),this.current.activeSMask=null);const e=this.ctx;t.isolated||Bc("TODO: Support non-isolated groups."),t.knockout&&V("Knockout groups not supported.");const s=pt(e);if(t.matrix&&e.transform(...t.matrix),!t.bbox)throw new Error("Bounding box is required.");let i=Jr.slice();H.axialAlignedBoundingBox(t.bbox,pt(e),i);const n=[0,0,e.canvas.width,e.canvas.height];i=H.intersect(i,n)||[0,0,0,0];const a=Math.floor(i[0]),o=Math.floor(i[1]),l=Math.max(Math.ceil(i[2])-a,1),h=Math.max(Math.ceil(i[3])-o,1);this.current.startNewPathAndClipBox([0,0,l,h]);let c="groupAt"+this.groupLevel;t.smask&&(c+="_smask_"+this.smaskCounter++%2);const u=this.cachedCanvases.getCanvas(c,l,h),p=u.context;p.translate(-a,-o),p.transform(...s);let y=new Path2D;const[A,b,w,v]=t.bbox;if(y.rect(A,b,w-A,v-b),t.matrix){const E=new Path2D;E.addPath(y,new DOMMatrix(t.matrix)),y=E}p.clip(y),t.smask?this.smaskStack.push({canvas:u.canvas,context:p,offsetX:a,offsetY:o,subtype:t.smask.subtype,backdrop:t.smask.backdrop,transferMap:t.smask.transferMap||null,startTransformInverse:null}):(e.setTransform(1,0,0,1,0,0),e.translate(a,o),e.save()),uo(e,p),this.ctx=p,this.setGState([["BM","source-over"],["ca",1],["CA",1]]),this.groupStack.push(e),this.groupLevel++}endGroup(t){if(!this.contentVisible)return;this.groupLevel--;const e=this.ctx,s=this.groupStack.pop();if(this.ctx=s,this.ctx.imageSmoothingEnabled=!1,t.smask)this.tempSMask=this.smaskStack.pop(),this.restore();else{this.ctx.restore();const i=pt(this.ctx);this.restore(),this.ctx.save(),this.ctx.setTransform(...i);const n=Jr.slice();H.axialAlignedBoundingBox([0,0,e.canvas.width,e.canvas.height],i,n),this.ctx.drawImage(e.canvas,0,0),this.ctx.restore(),this.compose(n)}}beginAnnotation(t,e,s,i,n){if(m(this,cs,Td).call(this),_h(this.ctx),this.ctx.save(),this.save(),this.baseTransform&&this.ctx.setTransform(...this.baseTransform),e){const a=e[2]-e[0],o=e[3]-e[1];if(n&&this.annotationCanvasMap){s=s.slice(),s[4]-=e[0],s[5]-=e[1],e=e.slice(),e[0]=e[1]=0,e[2]=a,e[3]=o,H.singularValueDecompose2dScale(pt(this.ctx),Me);const{viewportScale:l}=this,h=Math.ceil(a*this.outputScaleX*l),c=Math.ceil(o*this.outputScaleY*l);this.annotationCanvas=this.canvasFactory.create(h,c);const{canvas:u,context:p}=this.annotationCanvas;this.annotationCanvasMap.set(t,u),this.annotationCanvas.savedCtx=this.ctx,this.ctx=p,this.ctx.save(),this.ctx.setTransform(Me[0],0,0,-Me[1],0,o*Me[1]),_h(this.ctx)}else{_h(this.ctx),this.endPath();const l=new Path2D;l.rect(e[0],e[1],a,o),this.ctx.clip(l)}}this.current=new qu(this.ctx.canvas.width,this.ctx.canvas.height),this.transform(...s),this.transform(...i)}endAnnotation(){this.annotationCanvas&&(this.ctx.restore(),m(this,cs,xd).call(this),this.ctx=this.annotationCanvas.savedCtx,delete this.annotationCanvas.savedCtx,delete this.annotationCanvas)}paintImageMaskXObject(t){if(!this.contentVisible)return;const e=t.count;t=this.getObject(t.data,t),t.count=e;const s=this.ctx,i=this._createMaskCanvas(t),n=i.canvas;s.save(),s.setTransform(1,0,0,1,0,0),s.drawImage(n,i.offsetX,i.offsetY),s.restore(),this.compose()}paintImageMaskXObjectRepeat(t,e,s=0,i=0,n,a){if(!this.contentVisible)return;t=this.getObject(t.data,t);const o=this.ctx;o.save();const l=pt(o);o.transform(e,s,i,n,0,0);const h=this._createMaskCanvas(t);o.setTransform(1,0,0,1,h.offsetX-l[4],h.offsetY-l[5]);for(let c=0,u=a.length;c<u;c+=2){const p=H.transform(l,[e,s,i,n,a[c],a[c+1]]);o.drawImage(h.canvas,p[4],p[5])}o.restore(),this.compose()}paintImageMaskXObjectGroup(t){if(!this.contentVisible)return;const e=this.ctx,s=this.current.fillColor,i=this.current.patternFill;for(const n of t){const{data:a,width:o,height:l,transform:h}=n,c=this.cachedCanvases.getCanvas("maskCanvas",o,l),u=c.context;u.save();const p=this.getObject(a,n);Yu(u,p),u.globalCompositeOperation="source-in",u.fillStyle=i?s.getPattern(u,this,us(e),jt.FILL):s,u.fillRect(0,0,o,l),u.restore(),e.save(),e.transform(...h),e.scale(1,-1),Eh(e,c.canvas,0,0,o,l,0,-1,1,1),e.restore()}this.compose()}paintImageXObject(t){if(!this.contentVisible)return;const e=this.getObject(t);if(!e){V("Dependent image isn't ready yet");return}this.paintInlineImageXObject(e)}paintImageXObjectRepeat(t,e,s,i){if(!this.contentVisible)return;const n=this.getObject(t);if(!n){V("Dependent image isn't ready yet");return}const a=n.width,o=n.height,l=[];for(let h=0,c=i.length;h<c;h+=2)l.push({transform:[e,0,0,s,i[h],i[h+1]],x:0,y:0,w:a,h:o});this.paintInlineImageXObjectGroup(n,l)}applyTransferMapsToCanvas(t){return this.current.transferMaps!=="none"&&(t.filter=this.current.transferMaps,t.drawImage(t.canvas,0,0),t.filter="none"),t.canvas}applyTransferMapsToBitmap(t){if(this.current.transferMaps==="none")return t.bitmap;const{bitmap:e,width:s,height:i}=t,n=this.cachedCanvases.getCanvas("inlineImage",s,i),a=n.context;return a.filter=this.current.transferMaps,a.drawImage(e,0,0),a.filter="none",n.canvas}paintInlineImageXObject(t){if(!this.contentVisible)return;const e=t.width,s=t.height,i=this.ctx;this.save();const{filter:n}=i;n!=="none"&&n!==""&&(i.filter="none"),i.scale(1/e,-1/s);let a;if(t.bitmap)a=this.applyTransferMapsToBitmap(t);else if(typeof HTMLElement=="function"&&t instanceof HTMLElement||!t.data)a=t;else{const h=this.cachedCanvases.getCanvas("inlineImage",e,s).context;Xu(h,t),a=this.applyTransferMapsToCanvas(h)}const o=this._scaleImage(a,us(i));i.imageSmoothingEnabled=Ku(pt(i),t.interpolate),Eh(i,o.img,0,0,o.paintWidth,o.paintHeight,0,-s,e,s),this.compose(),this.restore()}paintInlineImageXObjectGroup(t,e){if(!this.contentVisible)return;const s=this.ctx;let i;if(t.bitmap)i=t.bitmap;else{const n=t.width,a=t.height,l=this.cachedCanvases.getCanvas("inlineImage",n,a).context;Xu(l,t),i=this.applyTransferMapsToCanvas(l)}for(const n of e)s.save(),s.transform(...n.transform),s.scale(1,-1),Eh(s,i,n.x,n.y,n.w,n.h,0,-1,1,1),s.restore();this.compose()}paintSolidColorImageMask(){this.contentVisible&&(this.ctx.fillRect(0,0,1,1),this.compose())}markPoint(t){}markPointProps(t,e){}beginMarkedContent(t){this.markedContentStack.push({visible:!0})}beginMarkedContentProps(t,e){t==="OC"?this.markedContentStack.push({visible:this.optionalContentConfig.isVisible(e)}):this.markedContentStack.push({visible:!0}),this.contentVisible=this.isContentVisible()}endMarkedContent(){this.markedContentStack.pop(),this.contentVisible=this.isContentVisible()}beginCompat(){}endCompat(){}consumePath(t,e){const s=this.current.isEmptyClip();this.pendingClip&&this.current.updateClipFromPath(),this.pendingClip||this.compose(e);const i=this.ctx;this.pendingClip&&(s||(this.pendingClip===Ju?i.clip(t,"evenodd"):i.clip(t)),this.pendingClip=null),this.current.startNewPathAndClipBox(this.current.clipBox)}getSinglePixelWidth(){if(!this._cachedGetSinglePixelWidth){const t=pt(this.ctx);if(t[1]===0&&t[2]===0)this._cachedGetSinglePixelWidth=1/Math.min(Math.abs(t[0]),Math.abs(t[3]));else{const e=Math.abs(t[0]*t[3]-t[2]*t[1]),s=Math.hypot(t[0],t[2]),i=Math.hypot(t[1],t[3]);this._cachedGetSinglePixelWidth=Math.max(s,i)/e}}return this._cachedGetSinglePixelWidth}getScaleForStroking(){if(this._cachedScaleForStroking[0]===-1){const{lineWidth:t}=this.current,{a:e,b:s,c:i,d:n}=this.ctx.getTransform();let a,o;if(s===0&&i===0){const l=Math.abs(e),h=Math.abs(n);if(l===h)if(t===0)a=o=1/l;else{const c=l*t;a=o=c<1?1/c:1}else if(t===0)a=1/l,o=1/h;else{const c=l*t,u=h*t;a=c<1?1/c:1,o=u<1?1/u:1}}else{const l=Math.abs(e*n-s*i),h=Math.hypot(e,s),c=Math.hypot(i,n);if(t===0)a=c/l,o=h/l;else{const u=t*l;a=c>u?c/u:1,o=h>u?h/u:1}}this._cachedScaleForStroking[0]=a,this._cachedScaleForStroking[1]=o}return this._cachedScaleForStroking}rescaleAndStroke(t,e){const{ctx:s,current:{lineWidth:i}}=this,[n,a]=this.getScaleForStroking();if(n===a){s.lineWidth=(i||1)*n,s.stroke(t);return}const o=s.getLineDash();e&&s.save(),s.scale(n,a),Kc.a=1/n,Kc.d=1/a;const l=new Path2D;if(l.addPath(t,Kc),o.length>0){const h=Math.max(n,a);s.setLineDash(o.map(c=>c/h)),s.lineDashOffset/=h}s.lineWidth=i||1,s.stroke(l),e&&s.restore()}isContentVisible(){for(let t=this.markedContentStack.length-1;t>=0;t--)if(!this.markedContentStack[t].visible)return!1;return!0}};cs=new WeakSet,Td=function(){for(;this.stateStack.length||this.inSMaskMode;)this.restore();this.current.activeSMask=null,this.ctx.restore(),this.transparentCanvas&&(this.ctx=this.compositeCtx,this.ctx.save(),this.ctx.setTransform(1,0,0,1,0,0),this.ctx.drawImage(this.transparentCanvas,0,0),this.ctx.restore(),this.transparentCanvas=null)},xd=function(){if(this.pageColors){const t=this.filterFactory.addHCMFilter(this.pageColors.foreground,this.pageColors.background);if(t!=="none"){const e=this.ctx.filter;this.ctx.filter=t,this.ctx.drawImage(this.ctx.canvas,0,0),this.ctx.filter=e}}},Ld=function(t,e,s){const i=new Path2D;return i.addPath(t,new DOMMatrix(s).invertSelf().multiplySelf(e)),i};let ta=Pu;for(const d in nc)ta.prototype[d]!==void 0&&(ta.prototype[nc[d]]=ta.prototype[d]);var ul,fl;class Ns{static get workerPort(){return r(this,ul)}static set workerPort(t){if(!(typeof Worker<"u"&&t instanceof Worker)&&t!==null)throw new Error("Invalid `workerPort` type.");f(this,ul,t)}static get workerSrc(){return r(this,fl)}static set workerSrc(t){if(typeof t!="string")throw new Error("Invalid `workerSrc` type.");f(this,fl,t)}}ul=new WeakMap,fl=new WeakMap,g(Ns,ul,null),g(Ns,fl,"");var Sa,pl;class um{constructor({parsedData:t,rawData:e}){g(this,Sa);g(this,pl);f(this,Sa,t),f(this,pl,e)}getRaw(){return r(this,pl)}get(t){return r(this,Sa).get(t)??null}[Symbol.iterator](){return r(this,Sa).entries()}}Sa=new WeakMap,pl=new WeakMap;const Xr=Symbol("INTERNAL");var gl,ml,yl,Ea;class fm{constructor(t,{name:e,intent:s,usage:i,rbGroups:n}){g(this,gl,!1);g(this,ml,!1);g(this,yl,!1);g(this,Ea,!0);f(this,gl,!!(t&De.DISPLAY)),f(this,ml,!!(t&De.PRINT)),this.name=e,this.intent=s,this.usage=i,this.rbGroups=n}get visible(){if(r(this,yl))return r(this,Ea);if(!r(this,Ea))return!1;const{print:t,view:e}=this.usage;return r(this,gl)?(e==null?void 0:e.viewState)!=="OFF":r(this,ml)?(t==null?void 0:t.printState)!=="OFF":!0}_setVisible(t,e,s=!1){t!==Xr&&at("Internal method `_setVisible` called."),f(this,yl,s),f(this,Ea,e)}}gl=new WeakMap,ml=new WeakMap,yl=new WeakMap,Ea=new WeakMap;var qi,nt,_a,Ca,bl,Id;class pm{constructor(t,e=De.DISPLAY){g(this,bl);g(this,qi,null);g(this,nt,new Map);g(this,_a,null);g(this,Ca,null);if(this.renderingIntent=e,this.name=null,this.creator=null,t!==null){this.name=t.name,this.creator=t.creator,f(this,Ca,t.order);for(const s of t.groups)r(this,nt).set(s.id,new fm(e,s));if(t.baseState==="OFF")for(const s of r(this,nt).values())s._setVisible(Xr,!1);for(const s of t.on)r(this,nt).get(s)._setVisible(Xr,!0);for(const s of t.off)r(this,nt).get(s)._setVisible(Xr,!1);f(this,_a,this.getHash())}}isVisible(t){if(r(this,nt).size===0)return!0;if(!t)return Bc("Optional content group not defined."),!0;if(t.type==="OCG")return r(this,nt).has(t.id)?r(this,nt).get(t.id).visible:(V(`Optional content group not found: ${t.id}`),!0);if(t.type==="OCMD"){if(t.expression)return m(this,bl,Id).call(this,t.expression);if(!t.policy||t.policy==="AnyOn"){for(const e of t.ids){if(!r(this,nt).has(e))return V(`Optional content group not found: ${e}`),!0;if(r(this,nt).get(e).visible)return!0}return!1}else if(t.policy==="AllOn"){for(const e of t.ids){if(!r(this,nt).has(e))return V(`Optional content group not found: ${e}`),!0;if(!r(this,nt).get(e).visible)return!1}return!0}else if(t.policy==="AnyOff"){for(const e of t.ids){if(!r(this,nt).has(e))return V(`Optional content group not found: ${e}`),!0;if(!r(this,nt).get(e).visible)return!0}return!1}else if(t.policy==="AllOff"){for(const e of t.ids){if(!r(this,nt).has(e))return V(`Optional content group not found: ${e}`),!0;if(r(this,nt).get(e).visible)return!1}return!0}return V(`Unknown optional content policy ${t.policy}.`),!0}return V(`Unknown group type ${t.type}.`),!0}setVisibility(t,e=!0,s=!0){var n;const i=r(this,nt).get(t);if(!i){V(`Optional content group not found: ${t}`);return}if(s&&e&&i.rbGroups.length)for(const a of i.rbGroups)for(const o of a)o!==t&&((n=r(this,nt).get(o))==null||n._setVisible(Xr,!1,!0));i._setVisible(Xr,!!e,!0),f(this,qi,null)}setOCGState({state:t,preserveRB:e}){let s;for(const i of t){switch(i){case"ON":case"OFF":case"Toggle":s=i;continue}const n=r(this,nt).get(i);if(n)switch(s){case"ON":this.setVisibility(i,!0,e);break;case"OFF":this.setVisibility(i,!1,e);break;case"Toggle":this.setVisibility(i,!n.visible,e);break}}f(this,qi,null)}get hasInitialVisibility(){return r(this,_a)===null||this.getHash()===r(this,_a)}getOrder(){return r(this,nt).size?r(this,Ca)?r(this,Ca).slice():[...r(this,nt).keys()]:null}getGroup(t){return r(this,nt).get(t)||null}getHash(){if(r(this,qi)!==null)return r(this,qi);const t=new Hf;for(const[e,s]of r(this,nt))t.update(`${e}:${s.visible}`);return f(this,qi,t.hexdigest())}[Symbol.iterator](){return r(this,nt).entries()}}qi=new WeakMap,nt=new WeakMap,_a=new WeakMap,Ca=new WeakMap,bl=new WeakSet,Id=function(t){const e=t.length;if(e<2)return!0;const s=t[0];for(let i=1;i<e;i++){const n=t[i];let a;if(Array.isArray(n))a=m(this,bl,Id).call(this,n);else if(r(this,nt).has(n))a=r(this,nt).get(n).visible;else return V(`Optional content group not found: ${n}`),!0;switch(s){case"And":if(!a)return!1;break;case"Or":if(a)return!0;break;case"Not":return!a;default:return!0}}return s==="And"};class gm{constructor(t,{disableRange:e=!1,disableStream:s=!1}){_t(t,'PDFDataTransportStream - missing required "pdfDataRangeTransport" argument.');const{length:i,initialData:n,progressiveDone:a,contentDispositionFilename:o}=t;if(this._queuedChunks=[],this._progressiveDone=a,this._contentDispositionFilename=o,(n==null?void 0:n.length)>0){const l=n instanceof Uint8Array&&n.byteLength===n.buffer.byteLength?n.buffer:new Uint8Array(n).buffer;this._queuedChunks.push(l)}this._pdfDataRangeTransport=t,this._isStreamingSupported=!s,this._isRangeSupported=!e,this._contentLength=i,this._fullRequestReader=null,this._rangeReaders=[],t.addRangeListener((l,h)=>{this._onReceiveData({begin:l,chunk:h})}),t.addProgressListener((l,h)=>{this._onProgress({loaded:l,total:h})}),t.addProgressiveReadListener(l=>{this._onReceiveData({chunk:l})}),t.addProgressiveDoneListener(()=>{this._onProgressiveDone()}),t.transportReady()}_onReceiveData({begin:t,chunk:e}){const s=e instanceof Uint8Array&&e.byteLength===e.buffer.byteLength?e.buffer:new Uint8Array(e).buffer;if(t===void 0)this._fullRequestReader?this._fullRequestReader._enqueue(s):this._queuedChunks.push(s);else{const i=this._rangeReaders.some(function(n){return n._begin!==t?!1:(n._enqueue(s),!0)});_t(i,"_onReceiveData - no `PDFDataTransportStreamRangeReader` instance found.")}}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}_onProgress(t){var e,s,i,n;t.total===void 0?(s=(e=this._rangeReaders[0])==null?void 0:e.onProgress)==null||s.call(e,{loaded:t.loaded}):(n=(i=this._fullRequestReader)==null?void 0:i.onProgress)==null||n.call(i,{loaded:t.loaded,total:t.total})}_onProgressiveDone(){var t;(t=this._fullRequestReader)==null||t.progressiveDone(),this._progressiveDone=!0}_removeRangeReader(t){const e=this._rangeReaders.indexOf(t);e>=0&&this._rangeReaders.splice(e,1)}getFullReader(){_t(!this._fullRequestReader,"PDFDataTransportStream.getFullReader can only be called once.");const t=this._queuedChunks;return this._queuedChunks=null,new mm(this,t,this._progressiveDone,this._contentDispositionFilename)}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new ym(this,t,e);return this._pdfDataRangeTransport.requestDataRange(t,e),this._rangeReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeReaders.slice(0))s.cancel(t);this._pdfDataRangeTransport.abort()}}class mm{constructor(t,e,s=!1,i=null){this._stream=t,this._done=s||!1,this._filename=vu(i)?i:null,this._queuedChunks=e||[],this._loaded=0;for(const n of this._queuedChunks)this._loaded+=n.byteLength;this._requests=[],this._headersReady=Promise.resolve(),t._fullRequestReader=this,this.onProgress=null}_enqueue(t){this._done||(this._requests.length>0?this._requests.shift().resolve({value:t,done:!1}):this._queuedChunks.push(t),this._loaded+=t.byteLength)}get headersReady(){return this._headersReady}get filename(){return this._filename}get isRangeSupported(){return this._stream._isRangeSupported}get isStreamingSupported(){return this._stream._isStreamingSupported}get contentLength(){return this._stream._contentLength}async read(){if(this._queuedChunks.length>0)return{value:this._queuedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}progressiveDone(){this._done||(this._done=!0)}}class ym{constructor(t,e,s){this._stream=t,this._begin=e,this._end=s,this._queuedChunk=null,this._requests=[],this._done=!1,this.onProgress=null}_enqueue(t){if(!this._done){if(this._requests.length===0)this._queuedChunk=t;else{this._requests.shift().resolve({value:t,done:!1});for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0}this._done=!0,this._stream._removeRangeReader(this)}}get isStreamingSupported(){return!1}async read(){if(this._queuedChunk){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._stream._removeRangeReader(this)}}function bm(d){let t=!0,e=s("filename\\*","i").exec(d);if(e){e=e[1];let c=o(e);return c=unescape(c),c=l(c),c=h(c),n(c)}if(e=a(d),e){const c=h(e);return n(c)}if(e=s("filename","i").exec(d),e){e=e[1];let c=o(e);return c=h(c),n(c)}function s(c,u){return new RegExp("(?:^|;)\\s*"+c+'\\s*=\\s*([^";\\s][^;\\s]*|"(?:[^"\\\\]|\\\\"?)+"?)',u)}function i(c,u){if(c){if(!/^[\x00-\xFF]+$/.test(u))return u;try{const p=new TextDecoder(c,{fatal:!0}),y=fh(u);u=p.decode(y),t=!1}catch{}}return u}function n(c){return t&&/[\x80-\xff]/.test(c)&&(c=i("utf-8",c),t&&(c=i("iso-8859-1",c))),c}function a(c){const u=[];let p;const y=s("filename\\*((?!0\\d)\\d+)(\\*?)","ig");for(;(p=y.exec(c))!==null;){let[,b,w,v]=p;if(b=parseInt(b,10),b in u){if(b===0)break;continue}u[b]=[w,v]}const A=[];for(let b=0;b<u.length&&b in u;++b){let[w,v]=u[b];v=o(v),w&&(v=unescape(v),b===0&&(v=l(v))),A.push(v)}return A.join("")}function o(c){if(c.startsWith('"')){const u=c.slice(1).split('\\"');for(let p=0;p<u.length;++p){const y=u[p].indexOf('"');y!==-1&&(u[p]=u[p].slice(0,y),u.length=p+1),u[p]=u[p].replaceAll(/\\(.)/g,"$1")}c=u.join('"')}return c}function l(c){const u=c.indexOf("'");if(u===-1)return c;const p=c.slice(0,u),A=c.slice(u+1).replace(/^[^']*'/,"");return i(p,A)}function h(c){return!c.startsWith("=?")||/[\x00-\x19\x80-\xff]/.test(c)?c:c.replaceAll(/=\?([\w-]*)\?([QqBb])\?((?:[^?]|\?(?!=))*)\?=/g,function(u,p,y,A){if(y==="q"||y==="Q")return A=A.replaceAll("_"," "),A=A.replaceAll(/=([0-9a-fA-F]{2})/g,function(b,w){return String.fromCharCode(parseInt(w,16))}),i(p,A);try{A=atob(A)}catch{}return i(p,A)})}return""}function Qf(d,t){const e=new Headers;if(!d||!t||typeof t!="object")return e;for(const s in t){const i=t[s];i!==void 0&&e.append(s,i)}return e}function Hc(d){var t;return((t=URL.parse(d))==null?void 0:t.origin)??null}function Zf({responseHeaders:d,isHttp:t,rangeChunkSize:e,disableRange:s}){const i={allowRangeRequests:!1,suggestedLength:void 0},n=parseInt(d.get("Content-Length"),10);return!Number.isInteger(n)||(i.suggestedLength=n,n<=2*e)||s||!t||d.get("Accept-Ranges")!=="bytes"||(d.get("Content-Encoding")||"identity")!=="identity"||(i.allowRangeRequests=!0),i}function tp(d){const t=d.get("Content-Disposition");if(t){let e=bm(t);if(e.includes("%"))try{e=decodeURIComponent(e)}catch{}if(vu(e))return e}return null}function yh(d,t){return new rc(`Unexpected server response (${d}) while retrieving PDF "${t}".`,d,d===404||d===0&&t.startsWith("file:"))}function ep(d){return d===200||d===206}function sp(d,t,e){return{method:"GET",headers:d,signal:e.signal,mode:"cors",credentials:t?"include":"same-origin",redirect:"follow"}}function ip(d){return d instanceof Uint8Array?d.buffer:d instanceof ArrayBuffer?d:(V(`getArrayBuffer - unexpected data format: ${d}`),new Uint8Array(d).buffer)}class Am{constructor(t){L(this,"_responseOrigin",null);this.source=t,this.isHttp=/^https?:/i.test(t.url),this.headers=Qf(this.isHttp,t.httpHeaders),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return _t(!this._fullRequestReader,"PDFFetchStream.getFullReader can only be called once."),this._fullRequestReader=new vm(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new wm(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class vm{constructor(t){this._stream=t,this._reader=null,this._loaded=0,this._filename=null;const e=t.source;this._withCredentials=e.withCredentials||!1,this._contentLength=e.length,this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._abortController=new AbortController,this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange;const s=new Headers(t.headers),i=e.url;fetch(i,sp(s,this._withCredentials,this._abortController)).then(n=>{if(t._responseOrigin=Hc(n.url),!ep(n.status))throw yh(n.status,i);this._reader=n.body.getReader(),this._headersCapability.resolve();const a=n.headers,{allowRangeRequests:o,suggestedLength:l}=Zf({responseHeaders:a,isHttp:t.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});this._isRangeSupported=o,this._contentLength=l||this._contentLength,this._filename=tp(a),!this._isStreamingSupported&&this._isRangeSupported&&this.cancel(new An("Streaming is disabled."))}).catch(this._headersCapability.reject),this.onProgress=null}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._headersCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:ip(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}class wm{constructor(t,e,s){this._stream=t,this._reader=null,this._loaded=0;const i=t.source;this._withCredentials=i.withCredentials||!1,this._readCapability=Promise.withResolvers(),this._isStreamingSupported=!i.disableStream,this._abortController=new AbortController;const n=new Headers(t.headers);n.append("Range",`bytes=${e}-${s-1}`);const a=i.url;fetch(a,sp(n,this._withCredentials,this._abortController)).then(o=>{const l=Hc(o.url);if(l!==t._responseOrigin)throw new Error(`Expected range response-origin "${l}" to match "${t._responseOrigin}".`);if(!ep(o.status))throw yh(o.status,a);this._readCapability.resolve(),this._reader=o.body.getReader()}).catch(this._readCapability.reject),this.onProgress=null}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;await this._readCapability.promise;const{value:t,done:e}=await this._reader.read();return e?{value:t,done:e}:(this._loaded+=t.byteLength,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:ip(t),done:!1})}cancel(t){var e;(e=this._reader)==null||e.cancel(t),this._abortController.abort()}}const Jc=200,Qc=206;function Sm(d){const t=d.response;return typeof t!="string"?t:fh(t).buffer}class Em{constructor({url:t,httpHeaders:e,withCredentials:s}){L(this,"_responseOrigin",null);this.url=t,this.isHttp=/^https?:/i.test(t),this.headers=Qf(this.isHttp,e),this.withCredentials=s||!1,this.currXhrId=0,this.pendingRequests=Object.create(null)}request(t){const e=new XMLHttpRequest,s=this.currXhrId++,i=this.pendingRequests[s]={xhr:e};e.open("GET",this.url),e.withCredentials=this.withCredentials;for(const[n,a]of this.headers)e.setRequestHeader(n,a);return this.isHttp&&"begin"in t&&"end"in t?(e.setRequestHeader("Range",`bytes=${t.begin}-${t.end-1}`),i.expectedStatus=Qc):i.expectedStatus=Jc,e.responseType="arraybuffer",_t(t.onError,"Expected `onError` callback to be provided."),e.onerror=()=>{t.onError(e.status)},e.onreadystatechange=this.onStateChange.bind(this,s),e.onprogress=this.onProgress.bind(this,s),i.onHeadersReceived=t.onHeadersReceived,i.onDone=t.onDone,i.onError=t.onError,i.onProgress=t.onProgress,e.send(null),s}onProgress(t,e){var i;const s=this.pendingRequests[t];s&&((i=s.onProgress)==null||i.call(s,e))}onStateChange(t,e){const s=this.pendingRequests[t];if(!s)return;const i=s.xhr;if(i.readyState>=2&&s.onHeadersReceived&&(s.onHeadersReceived(),delete s.onHeadersReceived),i.readyState!==4||!(t in this.pendingRequests))return;if(delete this.pendingRequests[t],i.status===0&&this.isHttp){s.onError(i.status);return}const n=i.status||Jc;if(!(n===Jc&&s.expectedStatus===Qc)&&n!==s.expectedStatus){s.onError(i.status);return}const o=Sm(i);if(n===Qc){const l=i.getResponseHeader("Content-Range"),h=/bytes (\d+)-(\d+)\/(\d+)/.exec(l);h?s.onDone({begin:parseInt(h[1],10),chunk:o}):(V('Missing or invalid "Content-Range" header.'),s.onError(0))}else o?s.onDone({begin:0,chunk:o}):s.onError(i.status)}getRequestXhr(t){return this.pendingRequests[t].xhr}isPendingRequest(t){return t in this.pendingRequests}abortRequest(t){const e=this.pendingRequests[t].xhr;delete this.pendingRequests[t],e.abort()}}class _m{constructor(t){this._source=t,this._manager=new Em(t),this._rangeChunkSize=t.rangeChunkSize,this._fullRequestReader=null,this._rangeRequestReaders=[]}_onRangeRequestReaderClosed(t){const e=this._rangeRequestReaders.indexOf(t);e>=0&&this._rangeRequestReaders.splice(e,1)}getFullReader(){return _t(!this._fullRequestReader,"PDFNetworkStream.getFullReader can only be called once."),this._fullRequestReader=new Cm(this._manager,this._source),this._fullRequestReader}getRangeReader(t,e){const s=new Tm(this._manager,t,e);return s.onClosed=this._onRangeRequestReaderClosed.bind(this),this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class Cm{constructor(t,e){this._manager=t,this._url=e.url,this._fullRequestId=t.request({onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._headersCapability=Promise.withResolvers(),this._disableRange=e.disableRange||!1,this._contentLength=e.length,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!1,this._isRangeSupported=!1,this._cachedChunks=[],this._requests=[],this._done=!1,this._storedError=void 0,this._filename=null,this.onProgress=null}_onHeadersReceived(){const t=this._fullRequestId,e=this._manager.getRequestXhr(t);this._manager._responseOrigin=Hc(e.responseURL);const s=e.getAllResponseHeaders(),i=new Headers(s?s.trimStart().replace(/[^\S ]+$/,"").split(/[\r\n]+/).map(o=>{const[l,...h]=o.split(": ");return[l,h.join(": ")]}):[]),{allowRangeRequests:n,suggestedLength:a}=Zf({responseHeaders:i,isHttp:this._manager.isHttp,rangeChunkSize:this._rangeChunkSize,disableRange:this._disableRange});n&&(this._isRangeSupported=!0),this._contentLength=a||this._contentLength,this._filename=tp(i),this._isRangeSupported&&this._manager.abortRequest(t),this._headersCapability.resolve()}_onDone(t){if(t&&(this._requests.length>0?this._requests.shift().resolve({value:t.chunk,done:!1}):this._cachedChunks.push(t.chunk)),this._done=!0,!(this._cachedChunks.length>0)){for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0}}_onError(t){this._storedError=yh(t,this._url),this._headersCapability.reject(this._storedError);for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._cachedChunks.length=0}_onProgress(t){var e;(e=this.onProgress)==null||e.call(this,{loaded:t.loaded,total:t.lengthComputable?t.total:this._contentLength})}get filename(){return this._filename}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}get contentLength(){return this._contentLength}get headersReady(){return this._headersCapability.promise}async read(){if(await this._headersCapability.promise,this._storedError)throw this._storedError;if(this._cachedChunks.length>0)return{value:this._cachedChunks.shift(),done:!1};if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0,this._headersCapability.reject(t);for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._fullRequestId)&&this._manager.abortRequest(this._fullRequestId),this._fullRequestReader=null}}class Tm{constructor(t,e,s){this._manager=t,this._url=t.url,this._requestId=t.request({begin:e,end:s,onHeadersReceived:this._onHeadersReceived.bind(this),onDone:this._onDone.bind(this),onError:this._onError.bind(this),onProgress:this._onProgress.bind(this)}),this._requests=[],this._queuedChunk=null,this._done=!1,this._storedError=void 0,this.onProgress=null,this.onClosed=null}_onHeadersReceived(){var e;const t=Hc((e=this._manager.getRequestXhr(this._requestId))==null?void 0:e.responseURL);t!==this._manager._responseOrigin&&(this._storedError=new Error(`Expected range response-origin "${t}" to match "${this._manager._responseOrigin}".`),this._onError(0))}_close(){var t;(t=this.onClosed)==null||t.call(this,this)}_onDone(t){const e=t.chunk;this._requests.length>0?this._requests.shift().resolve({value:e,done:!1}):this._queuedChunk=e,this._done=!0;for(const s of this._requests)s.resolve({value:void 0,done:!0});this._requests.length=0,this._close()}_onError(t){this._storedError??(this._storedError=yh(t,this._url));for(const e of this._requests)e.reject(this._storedError);this._requests.length=0,this._queuedChunk=null}_onProgress(t){var e;this.isStreamingSupported||(e=this.onProgress)==null||e.call(this,{loaded:t.loaded})}get isStreamingSupported(){return!1}async read(){if(this._storedError)throw this._storedError;if(this._queuedChunk!==null){const e=this._queuedChunk;return this._queuedChunk=null,{value:e,done:!1}}if(this._done)return{value:void 0,done:!0};const t=Promise.withResolvers();return this._requests.push(t),t.promise}cancel(t){this._done=!0;for(const e of this._requests)e.resolve({value:void 0,done:!0});this._requests.length=0,this._manager.isPendingRequest(this._requestId)&&this._manager.abortRequest(this._requestId),this._close()}}const xm=/^[a-z][a-z0-9\-+.]+:/i;function Lm(d){if(xm.test(d))return new URL(d);const t=process.getBuiltinModule("url");return new URL(t.pathToFileURL(d))}class Im{constructor(t){this.source=t,this.url=Lm(t.url),_t(this.url.protocol==="file:","PDFNodeStream only supports file:// URLs."),this._fullRequestReader=null,this._rangeRequestReaders=[]}get _progressiveDataLength(){var t;return((t=this._fullRequestReader)==null?void 0:t._loaded)??0}getFullReader(){return _t(!this._fullRequestReader,"PDFNodeStream.getFullReader can only be called once."),this._fullRequestReader=new Pm(this),this._fullRequestReader}getRangeReader(t,e){if(e<=this._progressiveDataLength)return null;const s=new Rm(this,t,e);return this._rangeRequestReaders.push(s),s}cancelAllRequests(t){var e;(e=this._fullRequestReader)==null||e.cancel(t);for(const s of this._rangeRequestReaders.slice(0))s.cancel(t)}}class Pm{constructor(t){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null;const e=t.source;this._contentLength=e.length,this._loaded=0,this._filename=null,this._disableRange=e.disableRange||!1,this._rangeChunkSize=e.rangeChunkSize,!this._rangeChunkSize&&!this._disableRange&&(this._disableRange=!0),this._isStreamingSupported=!e.disableStream,this._isRangeSupported=!e.disableRange,this._readableStream=null,this._readCapability=Promise.withResolvers(),this._headersCapability=Promise.withResolvers();const s=process.getBuiltinModule("fs");s.promises.lstat(this._url).then(i=>{this._contentLength=i.size,this._setReadableStream(s.createReadStream(this._url)),this._headersCapability.resolve()},i=>{i.code==="ENOENT"&&(i=yh(0,this._url.href)),this._storedError=i,this._headersCapability.reject(i)})}get headersReady(){return this._headersCapability.promise}get filename(){return this._filename}get contentLength(){return this._contentLength}get isRangeSupported(){return this._isRangeSupported}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded,total:this._contentLength}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),!this._isStreamingSupported&&this._isRangeSupported&&this._error(new An("streaming is disabled")),this._storedError&&this._readableStream.destroy(this._storedError)}}class Rm{constructor(t,e,s){this._url=t.url,this._done=!1,this._storedError=null,this.onProgress=null,this._loaded=0,this._readableStream=null,this._readCapability=Promise.withResolvers();const i=t.source;this._isStreamingSupported=!i.disableStream;const n=process.getBuiltinModule("fs");this._setReadableStream(n.createReadStream(this._url,{start:e,end:s-1}))}get isStreamingSupported(){return this._isStreamingSupported}async read(){var s;if(await this._readCapability.promise,this._done)return{value:void 0,done:!0};if(this._storedError)throw this._storedError;const t=this._readableStream.read();return t===null?(this._readCapability=Promise.withResolvers(),this.read()):(this._loaded+=t.length,(s=this.onProgress)==null||s.call(this,{loaded:this._loaded}),{value:new Uint8Array(t).buffer,done:!1})}cancel(t){if(!this._readableStream){this._error(t);return}this._readableStream.destroy(t)}_error(t){this._storedError=t,this._readCapability.resolve()}_setReadableStream(t){this._readableStream=t,t.on("readable",()=>{this._readCapability.resolve()}),t.on("end",()=>{t.destroy(),this._done=!0,this._readCapability.resolve()}),t.on("error",e=>{this._error(e)}),this._storedError&&this._readableStream.destroy(this._storedError)}}const fo=Symbol("INITIAL_DATA");var we,Al,Pd;class np{constructor(){g(this,Al);g(this,we,Object.create(null))}get(t,e=null){if(e){const i=m(this,Al,Pd).call(this,t);return i.promise.then(()=>e(i.data)),null}const s=r(this,we)[t];if(!s||s.data===fo)throw new Error(`Requesting object that isn't resolved yet ${t}.`);return s.data}has(t){const e=r(this,we)[t];return!!e&&e.data!==fo}delete(t){const e=r(this,we)[t];return!e||e.data===fo?!1:(delete r(this,we)[t],!0)}resolve(t,e=null){const s=m(this,Al,Pd).call(this,t);s.data=e,s.resolve()}clear(){var t;for(const e in r(this,we)){const{data:s}=r(this,we)[e];(t=s==null?void 0:s.bitmap)==null||t.close()}f(this,we,Object.create(null))}*[Symbol.iterator](){for(const t in r(this,we)){const{data:e}=r(this,we)[t];e!==fo&&(yield[t,e])}}}we=new WeakMap,Al=new WeakSet,Pd=function(t){var e;return(e=r(this,we))[t]||(e[t]={...Promise.withResolvers(),data:fo})};const km=1e5,Qu=30;var sf,Xi,pe,vl,wl,Zn,ni,Sl,El,tr,Ta,xa,Yi,La,_l,Ia,er,Cl,Tl,Pa,sr,xl,Ki,Ra,Ci,rp,ap,Rd,Fe,Bh,kd,op,lp;const Tt=class Tt{constructor({textContentSource:t,container:e,viewport:s}){g(this,Ci);g(this,Xi,Promise.withResolvers());g(this,pe,null);g(this,vl,!1);g(this,wl,!!((sf=globalThis.FontInspector)!=null&&sf.enabled));g(this,Zn,null);g(this,ni,null);g(this,Sl,0);g(this,El,0);g(this,tr,null);g(this,Ta,null);g(this,xa,0);g(this,Yi,0);g(this,La,Object.create(null));g(this,_l,[]);g(this,Ia,null);g(this,er,[]);g(this,Cl,new WeakMap);g(this,Tl,null);var l;if(t instanceof ReadableStream)f(this,Ia,t);else if(typeof t=="object")f(this,Ia,new ReadableStream({start(h){h.enqueue(t),h.close()}}));else throw new Error('No "textContentSource" parameter specified.');f(this,pe,f(this,Ta,e)),f(this,Yi,s.scale*Fs.pixelRatio),f(this,xa,s.rotation),f(this,ni,{div:null,properties:null,ctx:null});const{pageWidth:i,pageHeight:n,pageX:a,pageY:o}=s.rawDims;f(this,Tl,[1,0,0,-1,-a,o+n]),f(this,El,i),f(this,Sl,n),m(l=Tt,Fe,op).call(l),Fr(e,s),r(this,Xi).promise.finally(()=>{r(Tt,Ra).delete(this),f(this,ni,null),f(this,La,null)}).catch(()=>{})}static get fontFamilyMap(){const{isWindows:t,isFirefox:e}=Xt.platform;return q(this,"fontFamilyMap",new Map([["sans-serif",`${t&&e?"Calibri, ":""}sans-serif`],["monospace",`${t&&e?"Lucida Console, ":""}monospace`]]))}render(){const t=()=>{r(this,tr).read().then(({value:e,done:s})=>{if(s){r(this,Xi).resolve();return}r(this,Zn)??f(this,Zn,e.lang),Object.assign(r(this,La),e.styles),m(this,Ci,rp).call(this,e.items),t()},r(this,Xi).reject)};return f(this,tr,r(this,Ia).getReader()),r(Tt,Ra).add(this),t(),r(this,Xi).promise}update({viewport:t,onBefore:e=null}){var n;const s=t.scale*Fs.pixelRatio,i=t.rotation;if(i!==r(this,xa)&&(e==null||e(),f(this,xa,i),Fr(r(this,Ta),{rotation:i})),s!==r(this,Yi)){e==null||e(),f(this,Yi,s);const a={div:null,properties:null,ctx:m(n=Tt,Fe,Bh).call(n,r(this,Zn))};for(const o of r(this,er))a.properties=r(this,Cl).get(o),a.div=o,m(this,Ci,Rd).call(this,a)}}cancel(){var e;const t=new An("TextLayer task cancelled.");(e=r(this,tr))==null||e.cancel(t).catch(()=>{}),f(this,tr,null),r(this,Xi).reject(t)}get textDivs(){return r(this,er)}get textContentItemsStr(){return r(this,_l)}static cleanup(){if(!(r(this,Ra).size>0)){r(this,Pa).clear();for(const{canvas:t}of r(this,sr).values())t.remove();r(this,sr).clear()}}};Xi=new WeakMap,pe=new WeakMap,vl=new WeakMap,wl=new WeakMap,Zn=new WeakMap,ni=new WeakMap,Sl=new WeakMap,El=new WeakMap,tr=new WeakMap,Ta=new WeakMap,xa=new WeakMap,Yi=new WeakMap,La=new WeakMap,_l=new WeakMap,Ia=new WeakMap,er=new WeakMap,Cl=new WeakMap,Tl=new WeakMap,Pa=new WeakMap,sr=new WeakMap,xl=new WeakMap,Ki=new WeakMap,Ra=new WeakMap,Ci=new WeakSet,rp=function(t){var i,n;if(r(this,vl))return;(n=r(this,ni)).ctx??(n.ctx=m(i=Tt,Fe,Bh).call(i,r(this,Zn)));const e=r(this,er),s=r(this,_l);for(const a of t){if(e.length>km){V("Ignoring additional textDivs for performance reasons."),f(this,vl,!0);return}if(a.str===void 0){if(a.type==="beginMarkedContentProps"||a.type==="beginMarkedContent"){const o=r(this,pe);f(this,pe,document.createElement("span")),r(this,pe).classList.add("markedContent"),a.id&&r(this,pe).setAttribute("id",`${a.id}`),o.append(r(this,pe))}else a.type==="endMarkedContent"&&f(this,pe,r(this,pe).parentNode);continue}s.push(a.str),m(this,Ci,ap).call(this,a)}},ap=function(t){var b;const e=document.createElement("span"),s={angle:0,canvasWidth:0,hasText:t.str!=="",hasEOL:t.hasEOL,fontSize:0};r(this,er).push(e);const i=H.transform(r(this,Tl),t.transform);let n=Math.atan2(i[1],i[0]);const a=r(this,La)[t.fontName];a.vertical&&(n+=Math.PI/2);let o=r(this,wl)&&a.fontSubstitution||a.fontFamily;o=Tt.fontFamilyMap.get(o)||o;const l=Math.hypot(i[2],i[3]),h=l*m(b=Tt,Fe,lp).call(b,o,a,r(this,Zn));let c,u;n===0?(c=i[4],u=i[5]-h):(c=i[4]+h*Math.sin(n),u=i[5]-h*Math.cos(n));const p="calc(var(--total-scale-factor) *",y=e.style;r(this,pe)===r(this,Ta)?(y.left=`${(100*c/r(this,El)).toFixed(2)}%`,y.top=`${(100*u/r(this,Sl)).toFixed(2)}%`):(y.left=`${p}${c.toFixed(2)}px)`,y.top=`${p}${u.toFixed(2)}px)`),y.fontSize=`${p}${(r(Tt,Ki)*l).toFixed(2)}px)`,y.fontFamily=o,s.fontSize=l,e.setAttribute("role","presentation"),e.textContent=t.str,e.dir=t.dir,r(this,wl)&&(e.dataset.fontName=a.fontSubstitutionLoadedName||t.fontName),n!==0&&(s.angle=n*(180/Math.PI));let A=!1;if(t.str.length>1)A=!0;else if(t.str!==" "&&t.transform[0]!==t.transform[3]){const w=Math.abs(t.transform[0]),v=Math.abs(t.transform[3]);w!==v&&Math.max(w,v)/Math.min(w,v)>1.5&&(A=!0)}if(A&&(s.canvasWidth=a.vertical?t.height:t.width),r(this,Cl).set(e,s),r(this,ni).div=e,r(this,ni).properties=s,m(this,Ci,Rd).call(this,r(this,ni)),s.hasText&&r(this,pe).append(e),s.hasEOL){const w=document.createElement("br");w.setAttribute("role","presentation"),r(this,pe).append(w)}},Rd=function(t){var o;const{div:e,properties:s,ctx:i}=t,{style:n}=e;let a="";if(r(Tt,Ki)>1&&(a=`scale(${1/r(Tt,Ki)})`),s.canvasWidth!==0&&s.hasText){const{fontFamily:l}=n,{canvasWidth:h,fontSize:c}=s;m(o=Tt,Fe,kd).call(o,i,c*r(this,Yi),l);const{width:u}=i.measureText(e.textContent);u>0&&(a=`scaleX(${h*r(this,Yi)/u}) ${a}`)}s.angle!==0&&(a=`rotate(${s.angle}deg) ${a}`),a.length>0&&(n.transform=a)},Fe=new WeakSet,Bh=function(t=null){let e=r(this,sr).get(t||(t=""));if(!e){const s=document.createElement("canvas");s.className="hiddenCanvasElement",s.lang=t,document.body.append(s),e=s.getContext("2d",{alpha:!1,willReadFrequently:!0}),r(this,sr).set(t,e),r(this,xl).set(e,{size:0,family:""})}return e},kd=function(t,e,s){const i=r(this,xl).get(t);e===i.size&&s===i.family||(t.font=`${e}px ${s}`,i.size=e,i.family=s)},op=function(){if(r(this,Ki)!==null)return;const t=document.createElement("div");t.style.opacity=0,t.style.lineHeight=1,t.style.fontSize="1px",t.style.position="absolute",t.textContent="X",document.body.append(t),f(this,Ki,t.getBoundingClientRect().height),t.remove()},lp=function(t,e,s){const i=r(this,Pa).get(t);if(i)return i;const n=m(this,Fe,Bh).call(this,s);n.canvas.width=n.canvas.height=Qu,m(this,Fe,kd).call(this,n,Qu,t);const a=n.measureText(""),o=a.fontBoundingBoxAscent,l=Math.abs(a.fontBoundingBoxDescent);n.canvas.width=n.canvas.height=0;let h=.8;return o?h=o/(o+l):(Xt.platform.isFirefox&&V("Enable the `dom.textMetrics.fontBoundingBox.enabled` preference in `about:config` to improve TextLayer rendering."),e.ascent?h=e.ascent:e.descent&&(h=1+e.descent)),r(this,Pa).set(t,h),h},g(Tt,Fe),g(Tt,Pa,new Map),g(Tt,sr,new Map),g(Tt,xl,new WeakMap),g(Tt,Ki,null),g(Tt,Ra,new Set);let No=Tt;class Fo{static textContent(t){const e=[],s={items:e,styles:Object.create(null)};function i(n){var l;if(!n)return;let a=null;const o=n.name;if(o==="#text")a=n.value;else if(Fo.shouldBuildText(o))(l=n==null?void 0:n.attributes)!=null&&l.textContent?a=n.attributes.textContent:n.value&&(a=n.value);else return;if(a!==null&&e.push({str:a}),!!n.children)for(const h of n.children)i(h)}return i(t),s}static shouldBuildText(t){return!(t==="textarea"||t==="input"||t==="option"||t==="select")}}const Dm=100;function hc(d={}){typeof d=="string"||d instanceof URL?d={url:d}:(d instanceof ArrayBuffer||ArrayBuffer.isView(d))&&(d={data:d});const t=new Dd,{docId:e}=t,s=d.url?zg(d.url):null,i=d.data?Vg(d.data):null,n=d.httpHeaders||null,a=d.withCredentials===!0,o=d.password??null,l=d.range instanceof hp?d.range:null,h=Number.isInteger(d.rangeChunkSize)&&d.rangeChunkSize>0?d.rangeChunkSize:2**16;let c=d.worker instanceof Bo?d.worker:null;const u=d.verbosity,p=typeof d.docBaseUrl=="string"&&!Oc(d.docBaseUrl)?d.docBaseUrl:null,y=wh(d.cMapUrl),A=d.cMapPacked!==!1,b=d.CMapReaderFactory||(oe?Jg:Hu),w=wh(d.iccUrl),v=wh(d.standardFontDataUrl),E=d.StandardFontDataFactory||(oe?Qg:Uu),S=wh(d.wasmUrl),_=d.WasmFactory||(oe?Zg:zu),C=d.stopAtErrors!==!0,T=Number.isInteger(d.maxImageSize)&&d.maxImageSize>-1?d.maxImageSize:-1,x=d.isEvalSupported!==!1,I=typeof d.isOffscreenCanvasSupported=="boolean"?d.isOffscreenCanvasSupported:!oe,P=typeof d.isImageDecoderSupported=="boolean"?d.isImageDecoderSupported:!oe&&(Xt.platform.isFirefox||!globalThis.chrome),D=Number.isInteger(d.canvasMaxAreaInBytes)?d.canvasMaxAreaInBytes:-1,k=typeof d.disableFontFace=="boolean"?d.disableFontFace:oe,Z=d.fontExtraProperties===!0,it=d.enableXfa===!0,X=d.ownerDocument||globalThis.document,te=d.disableRange===!0,B=d.disableStream===!0,$=d.disableAutoFetch===!0,Be=d.pdfBug===!0,Os=d.CanvasFactory||(oe?Kg:qg),_n=d.FilterFactory||(oe?Yg:Xg),ds=d.enableHWA===!0,Rt=d.useWasm!==!1,yt=l?l.length:d.length??NaN,Ur=typeof d.useSystemFonts=="boolean"?d.useSystemFonts:!oe&&!k,Ti=typeof d.useWorkerFetch=="boolean"?d.useWorkerFetch:!!(b===Hu&&E===Uu&&_===zu&&y&&v&&S&&mo(y,document.baseURI)&&mo(v,document.baseURI)&&mo(S,document.baseURI)),xi=null;vg(u);const gt={canvasFactory:new Os({ownerDocument:X,enableHWA:ds}),filterFactory:new _n({docId:e,ownerDocument:X}),cMapReaderFactory:Ti?null:new b({baseUrl:y,isCompressed:A}),standardFontDataFactory:Ti?null:new E({baseUrl:v}),wasmFactory:Ti?null:new _({baseUrl:S})};c||(c=Bo.create({verbosity:u,port:Ns.workerPort}),t._worker=c);const co={docId:e,apiVersion:"5.4.54",data:i,password:o,disableAutoFetch:$,rangeChunkSize:h,length:yt,docBaseUrl:p,enableXfa:it,evaluatorOptions:{maxImageSize:T,disableFontFace:k,ignoreErrors:C,isEvalSupported:x,isOffscreenCanvasSupported:I,isImageDecoderSupported:P,canvasMaxAreaInBytes:D,fontExtraProperties:Z,useSystemFonts:Ur,useWasm:Rt,useWorkerFetch:Ti,cMapUrl:y,iccUrl:w,standardFontDataUrl:v,wasmUrl:S}},fg={ownerDocument:X,pdfBug:Be,styleElement:xi,loadingParams:{disableAutoFetch:$,enableXfa:it}};return c.promise.then(function(){if(t.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const pg=c.messageHandler.sendWithPromise("GetDocRequest",co,i?[i.buffer]:null);let zc;if(l)zc=new gm(l,{disableRange:te,disableStream:B});else if(!i){if(!s)throw new Error("getDocument - no `url` parameter provided.");const Vc=mo(s)?Am:oe?Im:_m;zc=new Vc({url:s,length:yt,httpHeaders:n,withCredentials:a,rangeChunkSize:h,disableRange:te,disableStream:B})}return pg.then(Vc=>{if(t.destroyed)throw new Error("Loading aborted");if(c.destroyed)throw new Error("Worker was destroyed");const Du=new wo(e,Vc,c.port),gg=new Fm(Du,t,zc,fg,gt,ds);t._transport=gg,Du.send("Ready",null)})}).catch(t._capability.reject),t}var Cc;const Tc=class Tc{constructor(){L(this,"_capability",Promise.withResolvers());L(this,"_transport",null);L(this,"_worker",null);L(this,"docId",`d${ee(Tc,Cc)._++}`);L(this,"destroyed",!1);L(this,"onPassword",null);L(this,"onProgress",null)}get promise(){return this._capability.promise}async destroy(){var t,e,s,i;this.destroyed=!0;try{(t=this._worker)!=null&&t.port&&(this._worker._pendingDestroy=!0),await((e=this._transport)==null?void 0:e.destroy())}catch(n){throw(s=this._worker)!=null&&s.port&&delete this._worker._pendingDestroy,n}this._transport=null,(i=this._worker)==null||i.destroy(),this._worker=null}async getData(){return this._transport.getData()}};Cc=new WeakMap,g(Tc,Cc,0);let Dd=Tc;var ir,Ll,Il,Pl,Rl;class hp{constructor(t,e,s=!1,i=null){g(this,ir,Promise.withResolvers());g(this,Ll,[]);g(this,Il,[]);g(this,Pl,[]);g(this,Rl,[]);this.length=t,this.initialData=e,this.progressiveDone=s,this.contentDispositionFilename=i}addRangeListener(t){r(this,Rl).push(t)}addProgressListener(t){r(this,Pl).push(t)}addProgressiveReadListener(t){r(this,Il).push(t)}addProgressiveDoneListener(t){r(this,Ll).push(t)}onDataRange(t,e){for(const s of r(this,Rl))s(t,e)}onDataProgress(t,e){r(this,ir).promise.then(()=>{for(const s of r(this,Pl))s(t,e)})}onDataProgressiveRead(t){r(this,ir).promise.then(()=>{for(const e of r(this,Il))e(t)})}onDataProgressiveDone(){r(this,ir).promise.then(()=>{for(const t of r(this,Ll))t()})}transportReady(){r(this,ir).resolve()}requestDataRange(t,e){at("Abstract method PDFDataRangeTransport.requestDataRange")}abort(){}}ir=new WeakMap,Ll=new WeakMap,Il=new WeakMap,Pl=new WeakMap,Rl=new WeakMap;class Mm{constructor(t,e){this._pdfInfo=t,this._transport=e}get annotationStorage(){return this._transport.annotationStorage}get canvasFactory(){return this._transport.canvasFactory}get filterFactory(){return this._transport.filterFactory}get numPages(){return this._pdfInfo.numPages}get fingerprints(){return this._pdfInfo.fingerprints}get isPureXfa(){return q(this,"isPureXfa",!!this._transport._htmlForXfa)}get allXfaHtml(){return this._transport._htmlForXfa}getPage(t){return this._transport.getPage(t)}getPageIndex(t){return this._transport.getPageIndex(t)}getDestinations(){return this._transport.getDestinations()}getDestination(t){return this._transport.getDestination(t)}getPageLabels(){return this._transport.getPageLabels()}getPageLayout(){return this._transport.getPageLayout()}getPageMode(){return this._transport.getPageMode()}getViewerPreferences(){return this._transport.getViewerPreferences()}getOpenAction(){return this._transport.getOpenAction()}getAttachments(){return this._transport.getAttachments()}getJSActions(){return this._transport.getDocJSActions()}getOutline(){return this._transport.getOutline()}getOptionalContentConfig({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getOptionalContentConfig(e)}getPermissions(){return this._transport.getPermissions()}getMetadata(){return this._transport.getMetadata()}getMarkInfo(){return this._transport.getMarkInfo()}getData(){return this._transport.getData()}saveDocument(){return this._transport.saveDocument()}getDownloadInfo(){return this._transport.downloadInfoCapability.promise}cleanup(t=!1){return this._transport.startCleanup(t||this.isPureXfa)}destroy(){return this.loadingTask.destroy()}cachedPageNumber(t){return this._transport.cachedPageNumber(t)}get loadingParams(){return this._transport.loadingParams}get loadingTask(){return this._transport.loadingTask}getFieldObjects(){return this._transport.getFieldObjects()}hasJSActions(){return this._transport.hasJSActions()}getCalculationOrderIds(){return this._transport.getCalculationOrderIds()}}var ri,nr,To;class Nm{constructor(t,e,s,i=!1){g(this,nr);g(this,ri,!1);this._pageIndex=t,this._pageInfo=e,this._transport=s,this._stats=i?new Bu:null,this._pdfBug=i,this.commonObjs=s.commonObjs,this.objs=new np,this._intentStates=new Map,this.destroyed=!1}get pageNumber(){return this._pageIndex+1}get rotate(){return this._pageInfo.rotate}get ref(){return this._pageInfo.ref}get userUnit(){return this._pageInfo.userUnit}get view(){return this._pageInfo.view}getViewport({scale:t,rotation:e=this.rotate,offsetX:s=0,offsetY:i=0,dontFlip:n=!1}={}){return new gh({viewBox:this.view,userUnit:this.userUnit,scale:t,rotation:e,offsetX:s,offsetY:i,dontFlip:n})}getAnnotations({intent:t="display"}={}){const{renderingIntent:e}=this._transport.getRenderingIntent(t);return this._transport.getAnnotations(this._pageIndex,e)}getJSActions(){return this._transport.getPageJSActions(this._pageIndex)}get filterFactory(){return this._transport.filterFactory}get isPureXfa(){return q(this,"isPureXfa",!!this._transport._htmlForXfa)}async getXfa(){var t;return((t=this._transport._htmlForXfa)==null?void 0:t.children[this._pageIndex])||null}render({canvasContext:t,canvas:e=t.canvas,viewport:s,intent:i="display",annotationMode:n=Ii.ENABLE,transform:a=null,background:o=null,optionalContentConfigPromise:l=null,annotationCanvasMap:h=null,pageColors:c=null,printAnnotationStorage:u=null,isEditing:p=!1}){var C,T;(C=this._stats)==null||C.time("Overall");const y=this._transport.getRenderingIntent(i,n,u,p),{renderingIntent:A,cacheKey:b}=y;f(this,ri,!1),l||(l=this._transport.getOptionalContentConfig(A));let w=this._intentStates.get(b);w||(w=Object.create(null),this._intentStates.set(b,w)),w.streamReaderCancelTimeout&&(clearTimeout(w.streamReaderCancelTimeout),w.streamReaderCancelTimeout=null);const v=!!(A&De.PRINT);w.displayReadyCapability||(w.displayReadyCapability=Promise.withResolvers(),w.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(T=this._stats)==null||T.time("Page Request"),this._pumpOperatorList(y));const E=x=>{var I;w.renderTasks.delete(S),v&&f(this,ri,!0),m(this,nr,To).call(this),x?(S.capability.reject(x),this._abortOperatorList({intentState:w,reason:x instanceof Error?x:new Error(x)})):S.capability.resolve(),this._stats&&(this._stats.timeEnd("Rendering"),this._stats.timeEnd("Overall"),(I=globalThis.Stats)!=null&&I.enabled&&globalThis.Stats.add(this.pageNumber,this._stats))},S=new Md({callback:E,params:{canvas:e,canvasContext:t,viewport:s,transform:a,background:o},objs:this.objs,commonObjs:this.commonObjs,annotationCanvasMap:h,operatorList:w.operatorList,pageIndex:this._pageIndex,canvasFactory:this._transport.canvasFactory,filterFactory:this._transport.filterFactory,useRequestAnimationFrame:!v,pdfBug:this._pdfBug,pageColors:c,enableHWA:this._transport.enableHWA});(w.renderTasks||(w.renderTasks=new Set)).add(S);const _=S.task;return Promise.all([w.displayReadyCapability.promise,l]).then(([x,I])=>{var P;if(this.destroyed){E();return}if((P=this._stats)==null||P.time("Rendering"),!(I.renderingIntent&A))throw new Error("Must use the same `intent`-argument when calling the `PDFPageProxy.render` and `PDFDocumentProxy.getOptionalContentConfig` methods.");S.initializeGraphics({transparency:x,optionalContentConfig:I}),S.operatorListChanged()}).catch(E),_}getOperatorList({intent:t="display",annotationMode:e=Ii.ENABLE,printAnnotationStorage:s=null,isEditing:i=!1}={}){var h;function n(){o.operatorList.lastChunk&&(o.opListReadCapability.resolve(o.operatorList),o.renderTasks.delete(l))}const a=this._transport.getRenderingIntent(t,e,s,i,!0);let o=this._intentStates.get(a.cacheKey);o||(o=Object.create(null),this._intentStates.set(a.cacheKey,o));let l;return o.opListReadCapability||(l=Object.create(null),l.operatorListChanged=n,o.opListReadCapability=Promise.withResolvers(),(o.renderTasks||(o.renderTasks=new Set)).add(l),o.operatorList={fnArray:[],argsArray:[],lastChunk:!1,separateAnnots:null},(h=this._stats)==null||h.time("Page Request"),this._pumpOperatorList(a)),o.opListReadCapability.promise}streamTextContent({includeMarkedContent:t=!1,disableNormalization:e=!1}={}){return this._transport.messageHandler.sendWithStream("GetTextContent",{pageIndex:this._pageIndex,includeMarkedContent:t===!0,disableNormalization:e===!0},{highWaterMark:100,size(i){return i.items.length}})}getTextContent(t={}){if(this._transport._htmlForXfa)return this.getXfa().then(s=>Fo.textContent(s));const e=this.streamTextContent(t);return new Promise(function(s,i){function n(){a.read().then(function({value:l,done:h}){if(h){s(o);return}o.lang??(o.lang=l.lang),Object.assign(o.styles,l.styles),o.items.push(...l.items),n()},i)}const a=e.getReader(),o={items:[],styles:Object.create(null),lang:null};n()})}getStructTree(){return this._transport.getStructTree(this._pageIndex)}_destroy(){this.destroyed=!0;const t=[];for(const e of this._intentStates.values())if(this._abortOperatorList({intentState:e,reason:new Error("Page was destroyed."),force:!0}),!e.opListReadCapability)for(const s of e.renderTasks)t.push(s.completed),s.cancel();return this.objs.clear(),f(this,ri,!1),Promise.all(t)}cleanup(t=!1){f(this,ri,!0);const e=m(this,nr,To).call(this);return t&&e&&this._stats&&(this._stats=new Bu),e}_startRenderPage(t,e){var i,n;const s=this._intentStates.get(e);s&&((i=this._stats)==null||i.timeEnd("Page Request"),(n=s.displayReadyCapability)==null||n.resolve(t))}_renderPageChunk(t,e){for(let s=0,i=t.length;s<i;s++)e.operatorList.fnArray.push(t.fnArray[s]),e.operatorList.argsArray.push(t.argsArray[s]);e.operatorList.lastChunk=t.lastChunk,e.operatorList.separateAnnots=t.separateAnnots;for(const s of e.renderTasks)s.operatorListChanged();t.lastChunk&&m(this,nr,To).call(this)}_pumpOperatorList({renderingIntent:t,cacheKey:e,annotationStorageSerializable:s,modifiedIds:i}){const{map:n,transfer:a}=s,l=this._transport.messageHandler.sendWithStream("GetOperatorList",{pageIndex:this._pageIndex,intent:t,cacheKey:e,annotationStorage:n,modifiedIds:i},a).getReader(),h=this._intentStates.get(e);h.streamReader=l;const c=()=>{l.read().then(({value:u,done:p})=>{if(p){h.streamReader=null;return}this._transport.destroyed||(this._renderPageChunk(u,h),c())},u=>{if(h.streamReader=null,!this._transport.destroyed){if(h.operatorList){h.operatorList.lastChunk=!0;for(const p of h.renderTasks)p.operatorListChanged();m(this,nr,To).call(this)}if(h.displayReadyCapability)h.displayReadyCapability.reject(u);else if(h.opListReadCapability)h.opListReadCapability.reject(u);else throw u}})};c()}_abortOperatorList({intentState:t,reason:e,force:s=!1}){if(t.streamReader){if(t.streamReaderCancelTimeout&&(clearTimeout(t.streamReaderCancelTimeout),t.streamReaderCancelTimeout=null),!s){if(t.renderTasks.size>0)return;if(e instanceof Au){let i=Dm;e.extraDelay>0&&e.extraDelay<1e3&&(i+=e.extraDelay),t.streamReaderCancelTimeout=setTimeout(()=>{t.streamReaderCancelTimeout=null,this._abortOperatorList({intentState:t,reason:e,force:!0})},i);return}}if(t.streamReader.cancel(new An(e.message)).catch(()=>{}),t.streamReader=null,!this._transport.destroyed){for(const[i,n]of this._intentStates)if(n===t){this._intentStates.delete(i);break}this.cleanup()}}}get stats(){return this._stats}}ri=new WeakMap,nr=new WeakSet,To=function(){if(!r(this,ri)||this.destroyed)return!1;for(const{renderTasks:t,operatorList:e}of this._intentStates.values())if(t.size>0||!e.lastChunk)return!1;return this._intentStates.clear(),this.objs.clear(),f(this,ri,!1),!0};var Ji,es,ai,rr,xc,ar,or,he,Oh,cp,dp,xo,ka,$h;const ht=class ht{constructor({name:t=null,port:e=null,verbosity:s=wg()}={}){g(this,he);g(this,Ji,Promise.withResolvers());g(this,es,null);g(this,ai,null);g(this,rr,null);if(this.name=t,this.destroyed=!1,this.verbosity=s,e){if(r(ht,or).has(e))throw new Error("Cannot use more than one PDFWorker per port.");r(ht,or).set(e,this),m(this,he,cp).call(this,e)}else m(this,he,dp).call(this)}get promise(){return r(this,Ji).promise}get port(){return r(this,ai)}get messageHandler(){return r(this,es)}destroy(){var t,e;this.destroyed=!0,(t=r(this,rr))==null||t.terminate(),f(this,rr,null),r(ht,or).delete(r(this,ai)),f(this,ai,null),(e=r(this,es))==null||e.destroy(),f(this,es,null)}static create(t){const e=r(this,or).get(t==null?void 0:t.port);if(e){if(e._pendingDestroy)throw new Error("PDFWorker.create - the worker is being destroyed.\nPlease remember to await `PDFDocumentLoadingTask.destroy()`-calls.");return e}return new ht(t)}static get workerSrc(){if(Ns.workerSrc)return Ns.workerSrc;throw new Error('No "GlobalWorkerOptions.workerSrc" specified.')}static get _setupFakeWorkerGlobal(){return q(this,"_setupFakeWorkerGlobal",(async()=>r(this,ka,$h)?r(this,ka,$h):(await import(this.workerSrc)).WorkerMessageHandler)())}};Ji=new WeakMap,es=new WeakMap,ai=new WeakMap,rr=new WeakMap,xc=new WeakMap,ar=new WeakMap,or=new WeakMap,he=new WeakSet,Oh=function(){r(this,Ji).resolve(),r(this,es).send("configure",{verbosity:this.verbosity})},cp=function(t){f(this,ai,t),f(this,es,new wo("main","worker",t)),r(this,es).on("ready",()=>{}),m(this,he,Oh).call(this)},dp=function(){if(r(ht,ar)||r(ht,ka,$h)){m(this,he,xo).call(this);return}let{workerSrc:t}=ht;try{ht._isSameOrigin(window.location,t)||(t=ht._createCDNWrapper(new URL(t,window.location).href));const e=new Worker(t,{type:"module"}),s=new wo("main","worker",e),i=()=>{n.abort(),s.destroy(),e.terminate(),this.destroyed?r(this,Ji).reject(new Error("Worker was destroyed")):m(this,he,xo).call(this)},n=new AbortController;e.addEventListener("error",()=>{r(this,rr)||i()},{signal:n.signal}),s.on("test",o=>{if(n.abort(),this.destroyed||!o){i();return}f(this,es,s),f(this,ai,e),f(this,rr,e),m(this,he,Oh).call(this)}),s.on("ready",o=>{if(n.abort(),this.destroyed){i();return}try{a()}catch{m(this,he,xo).call(this)}});const a=()=>{const o=new Uint8Array;s.send("test",o,[o.buffer])};a();return}catch{Bc("The worker has been disabled.")}m(this,he,xo).call(this)},xo=function(){r(ht,ar)||(V("Setting up fake worker."),f(ht,ar,!0)),ht._setupFakeWorkerGlobal.then(t=>{if(this.destroyed){r(this,Ji).reject(new Error("Worker was destroyed"));return}const e=new Wg;f(this,ai,e);const s=`fake${ee(ht,xc)._++}`,i=new wo(s+"_worker",s,e);t.setup(i,e),f(this,es,new wo(s,s+"_worker",e)),m(this,he,Oh).call(this)}).catch(t=>{r(this,Ji).reject(new Error(`Setting up fake worker failed: "${t.message}".`))})},ka=new WeakSet,$h=function(){var t;try{return((t=globalThis.pdfjsWorker)==null?void 0:t.WorkerMessageHandler)||null}catch{return null}},g(ht,ka),g(ht,xc,0),g(ht,ar,!1),g(ht,or,new WeakMap),oe&&(f(ht,ar,!0),Ns.workerSrc||(Ns.workerSrc="./pdf.worker.mjs")),ht._isSameOrigin=(t,e)=>{const s=URL.parse(t);if(!(s!=null&&s.origin)||s.origin==="null")return!1;const i=new URL(e,s);return s.origin===i.origin},ht._createCDNWrapper=t=>{const e=`await import("${t}");`;return URL.createObjectURL(new Blob([e],{type:"text/javascript"}))},ht.fromPort=t=>{if(Dg("`PDFWorker.fromPort` - please use `PDFWorker.create` instead."),!(t!=null&&t.port))throw new Error("PDFWorker.fromPort - invalid method signature.");return ht.create(t)};let Bo=ht;var oi,Cs,Da,Ma,li,lr,Lo;class Fm{constructor(t,e,s,i,n,a){g(this,lr);g(this,oi,new Map);g(this,Cs,new Map);g(this,Da,new Map);g(this,Ma,new Map);g(this,li,null);this.messageHandler=t,this.loadingTask=e,this.commonObjs=new np,this.fontLoader=new Hg({ownerDocument:i.ownerDocument,styleElement:i.styleElement}),this.loadingParams=i.loadingParams,this._params=i,this.canvasFactory=n.canvasFactory,this.filterFactory=n.filterFactory,this.cMapReaderFactory=n.cMapReaderFactory,this.standardFontDataFactory=n.standardFontDataFactory,this.wasmFactory=n.wasmFactory,this.destroyed=!1,this.destroyCapability=null,this._networkStream=s,this._fullReader=null,this._lastProgress=null,this.downloadInfoCapability=Promise.withResolvers(),this.enableHWA=a,this.setupMessageHandler()}get annotationStorage(){return q(this,"annotationStorage",new wu)}getRenderingIntent(t,e=Ii.ENABLE,s=null,i=!1,n=!1){let a=De.DISPLAY,o=vd;switch(t){case"any":a=De.ANY;break;case"display":break;case"print":a=De.PRINT;break;default:V(`getRenderingIntent - invalid intent: ${t}`)}const l=a&De.PRINT&&s instanceof zf?s:this.annotationStorage;switch(e){case Ii.DISABLE:a+=De.ANNOTATIONS_DISABLE;break;case Ii.ENABLE:break;case Ii.ENABLE_FORMS:a+=De.ANNOTATIONS_FORMS;break;case Ii.ENABLE_STORAGE:a+=De.ANNOTATIONS_STORAGE,o=l.serializable;break;default:V(`getRenderingIntent - invalid annotationMode: ${e}`)}i&&(a+=De.IS_EDITING),n&&(a+=De.OPLIST);const{ids:h,hash:c}=l.modifiedIds,u=[a,o.hash,c];return{renderingIntent:a,cacheKey:u.join("_"),annotationStorageSerializable:o,modifiedIds:h}}destroy(){var s;if(this.destroyCapability)return this.destroyCapability.promise;this.destroyed=!0,this.destroyCapability=Promise.withResolvers(),(s=r(this,li))==null||s.reject(new Error("Worker was destroyed during onPassword callback"));const t=[];for(const i of r(this,Cs).values())t.push(i._destroy());r(this,Cs).clear(),r(this,Da).clear(),r(this,Ma).clear(),this.hasOwnProperty("annotationStorage")&&this.annotationStorage.resetModified();const e=this.messageHandler.sendWithPromise("Terminate",null);return t.push(e),Promise.all(t).then(()=>{var i,n;this.commonObjs.clear(),this.fontLoader.clear(),r(this,oi).clear(),this.filterFactory.destroy(),No.cleanup(),(i=this._networkStream)==null||i.cancelAllRequests(new An("Worker was terminated.")),(n=this.messageHandler)==null||n.destroy(),this.messageHandler=null,this.destroyCapability.resolve()},this.destroyCapability.reject),this.destroyCapability.promise}setupMessageHandler(){const{messageHandler:t,loadingTask:e}=this;t.on("GetReader",(s,i)=>{_t(this._networkStream,"GetReader - no `IPDFStream` instance available."),this._fullReader=this._networkStream.getFullReader(),this._fullReader.onProgress=n=>{this._lastProgress={loaded:n.loaded,total:n.total}},i.onPull=()=>{this._fullReader.read().then(function({value:n,done:a}){if(a){i.close();return}_t(n instanceof ArrayBuffer,"GetReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(n),1,[n])}).catch(n=>{i.error(n)})},i.onCancel=n=>{this._fullReader.cancel(n),i.ready.catch(a=>{if(!this.destroyed)throw a})}}),t.on("ReaderHeadersReady",async s=>{var o;await this._fullReader.headersReady;const{isStreamingSupported:i,isRangeSupported:n,contentLength:a}=this._fullReader;return(!i||!n)&&(this._lastProgress&&((o=e.onProgress)==null||o.call(e,this._lastProgress)),this._fullReader.onProgress=l=>{var h;(h=e.onProgress)==null||h.call(e,{loaded:l.loaded,total:l.total})}),{isStreamingSupported:i,isRangeSupported:n,contentLength:a}}),t.on("GetRangeReader",(s,i)=>{_t(this._networkStream,"GetRangeReader - no `IPDFStream` instance available.");const n=this._networkStream.getRangeReader(s.begin,s.end);if(!n){i.close();return}i.onPull=()=>{n.read().then(function({value:a,done:o}){if(o){i.close();return}_t(a instanceof ArrayBuffer,"GetRangeReader - expected an ArrayBuffer."),i.enqueue(new Uint8Array(a),1,[a])}).catch(a=>{i.error(a)})},i.onCancel=a=>{n.cancel(a),i.ready.catch(o=>{if(!this.destroyed)throw o})}}),t.on("GetDoc",({pdfInfo:s})=>{this._numPages=s.numPages,this._htmlForXfa=s.htmlForXfa,delete s.htmlForXfa,e._capability.resolve(new Mm(s,this))}),t.on("DocException",s=>{e._capability.reject(de(s))}),t.on("PasswordRequest",s=>{f(this,li,Promise.withResolvers());try{if(!e.onPassword)throw de(s);const i=n=>{n instanceof Error?r(this,li).reject(n):r(this,li).resolve({password:n})};e.onPassword(i,s.code)}catch(i){r(this,li).reject(i)}return r(this,li).promise}),t.on("DataLoaded",s=>{var i;(i=e.onProgress)==null||i.call(e,{loaded:s.length,total:s.length}),this.downloadInfoCapability.resolve(s)}),t.on("StartRenderPage",s=>{if(this.destroyed)return;r(this,Cs).get(s.pageIndex)._startRenderPage(s.transparency,s.cacheKey)}),t.on("commonobj",([s,i,n])=>{var a;if(this.destroyed||this.commonObjs.has(s))return null;switch(i){case"Font":if("error"in n){const c=n.error;V(`Error during font loading: ${c}`),this.commonObjs.resolve(s,c);break}const o=this._params.pdfBug&&((a=globalThis.FontInspector)!=null&&a.enabled)?(c,u)=>globalThis.FontInspector.fontAdded(c,u):null,l=new Ug(n,o);this.fontLoader.bind(l).catch(()=>t.sendWithPromise("FontFallback",{id:s})).finally(()=>{!l.fontExtraProperties&&l.data&&(l.data=null),this.commonObjs.resolve(s,l)});break;case"CopyLocalImage":const{imageRef:h}=n;_t(h,"The imageRef must be defined.");for(const c of r(this,Cs).values())for(const[,u]of c.objs)if((u==null?void 0:u.ref)===h)return u.dataLen?(this.commonObjs.resolve(s,structuredClone(u)),u.dataLen):null;break;case"FontPath":case"Image":case"Pattern":this.commonObjs.resolve(s,n);break;default:throw new Error(`Got unknown common object type ${i}`)}return null}),t.on("obj",([s,i,n,a])=>{var l;if(this.destroyed)return;const o=r(this,Cs).get(i);if(!o.objs.has(s)){if(o._intentStates.size===0){(l=a==null?void 0:a.bitmap)==null||l.close();return}switch(n){case"Image":case"Pattern":o.objs.resolve(s,a);break;default:throw new Error(`Got unknown object type ${n}`)}}}),t.on("DocProgress",s=>{var i;this.destroyed||(i=e.onProgress)==null||i.call(e,{loaded:s.loaded,total:s.total})}),t.on("FetchBinaryData",async s=>{if(this.destroyed)throw new Error("Worker was destroyed.");const i=this[s.type];if(!i)throw new Error(`${s.type} not initialized, see the \`useWorkerFetch\` parameter.`);return i.fetch(s)})}getData(){return this.messageHandler.sendWithPromise("GetData",null)}saveDocument(){var s;this.annotationStorage.size<=0&&V("saveDocument called while `annotationStorage` is empty, please use the getData-method instead.");const{map:t,transfer:e}=this.annotationStorage.serializable;return this.messageHandler.sendWithPromise("SaveDocument",{isPureXfa:!!this._htmlForXfa,numPages:this._numPages,annotationStorage:t,filename:((s=this._fullReader)==null?void 0:s.filename)??null},e).finally(()=>{this.annotationStorage.resetModified()})}getPage(t){if(!Number.isInteger(t)||t<=0||t>this._numPages)return Promise.reject(new Error("Invalid page request."));const e=t-1,s=r(this,Da).get(e);if(s)return s;const i=this.messageHandler.sendWithPromise("GetPage",{pageIndex:e}).then(n=>{if(this.destroyed)throw new Error("Transport destroyed");n.refStr&&r(this,Ma).set(n.refStr,t);const a=new Nm(e,n,this,this._params.pdfBug);return r(this,Cs).set(e,a),a});return r(this,Da).set(e,i),i}getPageIndex(t){return wd(t)?this.messageHandler.sendWithPromise("GetPageIndex",{num:t.num,gen:t.gen}):Promise.reject(new Error("Invalid pageIndex request."))}getAnnotations(t,e){return this.messageHandler.sendWithPromise("GetAnnotations",{pageIndex:t,intent:e})}getFieldObjects(){return m(this,lr,Lo).call(this,"GetFieldObjects")}hasJSActions(){return m(this,lr,Lo).call(this,"HasJSActions")}getCalculationOrderIds(){return this.messageHandler.sendWithPromise("GetCalculationOrderIds",null)}getDestinations(){return this.messageHandler.sendWithPromise("GetDestinations",null)}getDestination(t){return typeof t!="string"?Promise.reject(new Error("Invalid destination request.")):this.messageHandler.sendWithPromise("GetDestination",{id:t})}getPageLabels(){return this.messageHandler.sendWithPromise("GetPageLabels",null)}getPageLayout(){return this.messageHandler.sendWithPromise("GetPageLayout",null)}getPageMode(){return this.messageHandler.sendWithPromise("GetPageMode",null)}getViewerPreferences(){return this.messageHandler.sendWithPromise("GetViewerPreferences",null)}getOpenAction(){return this.messageHandler.sendWithPromise("GetOpenAction",null)}getAttachments(){return this.messageHandler.sendWithPromise("GetAttachments",null)}getDocJSActions(){return m(this,lr,Lo).call(this,"GetDocJSActions")}getPageJSActions(t){return this.messageHandler.sendWithPromise("GetPageJSActions",{pageIndex:t})}getStructTree(t){return this.messageHandler.sendWithPromise("GetStructTree",{pageIndex:t})}getOutline(){return this.messageHandler.sendWithPromise("GetOutline",null)}getOptionalContentConfig(t){return m(this,lr,Lo).call(this,"GetOptionalContentConfig").then(e=>new pm(e,t))}getPermissions(){return this.messageHandler.sendWithPromise("GetPermissions",null)}getMetadata(){const t="GetMetadata",e=r(this,oi).get(t);if(e)return e;const s=this.messageHandler.sendWithPromise(t,null).then(i=>{var n,a;return{info:i[0],metadata:i[1]?new um(i[1]):null,contentDispositionFilename:((n=this._fullReader)==null?void 0:n.filename)??null,contentLength:((a=this._fullReader)==null?void 0:a.contentLength)??null}});return r(this,oi).set(t,s),s}getMarkInfo(){return this.messageHandler.sendWithPromise("GetMarkInfo",null)}async startCleanup(t=!1){if(!this.destroyed){await this.messageHandler.sendWithPromise("Cleanup",null);for(const e of r(this,Cs).values())if(!e.cleanup())throw new Error(`startCleanup: Page ${e.pageNumber} is currently rendering.`);this.commonObjs.clear(),t||this.fontLoader.clear(),r(this,oi).clear(),this.filterFactory.destroy(!0),No.cleanup()}}cachedPageNumber(t){if(!wd(t))return null;const e=t.gen===0?`${t.num}R`:`${t.num}R${t.gen}`;return r(this,Ma).get(e)??null}}oi=new WeakMap,Cs=new WeakMap,Da=new WeakMap,Ma=new WeakMap,li=new WeakMap,lr=new WeakSet,Lo=function(t,e=null){const s=r(this,oi).get(t);if(s)return s;const i=this.messageHandler.sendWithPromise(t,e);return r(this,oi).set(t,i),i};var Qi;class Bm{constructor(t){g(this,Qi,null);L(this,"onContinue",null);L(this,"onError",null);f(this,Qi,t)}get promise(){return r(this,Qi).capability.promise}cancel(t=0){r(this,Qi).cancel(null,t)}get separateAnnots(){const{separateAnnots:t}=r(this,Qi).operatorList;if(!t)return!1;const{annotationCanvasMap:e}=r(this,Qi);return t.form||t.canvas&&(e==null?void 0:e.size)>0}}Qi=new WeakMap;var Zi,hr;const In=class In{constructor({callback:t,params:e,objs:s,commonObjs:i,annotationCanvasMap:n,operatorList:a,pageIndex:o,canvasFactory:l,filterFactory:h,useRequestAnimationFrame:c=!1,pdfBug:u=!1,pageColors:p=null,enableHWA:y=!1}){g(this,Zi,null);this.callback=t,this.params=e,this.objs=s,this.commonObjs=i,this.annotationCanvasMap=n,this.operatorListIdx=null,this.operatorList=a,this._pageIndex=o,this.canvasFactory=l,this.filterFactory=h,this._pdfBug=u,this.pageColors=p,this.running=!1,this.graphicsReadyCallback=null,this.graphicsReady=!1,this._useRequestAnimationFrame=c===!0&&typeof window<"u",this.cancelled=!1,this.capability=Promise.withResolvers(),this.task=new Bm(this),this._cancelBound=this.cancel.bind(this),this._continueBound=this._continue.bind(this),this._scheduleNextBound=this._scheduleNext.bind(this),this._nextBound=this._next.bind(this),this._canvas=e.canvas,this._canvasContext=e.canvas?null:e.canvasContext,this._enableHWA=y}get completed(){return this.capability.promise.catch(function(){})}initializeGraphics({transparency:t=!1,optionalContentConfig:e}){var o,l;if(this.cancelled)return;if(this._canvas){if(r(In,hr).has(this._canvas))throw new Error("Cannot use the same canvas during multiple render() operations. Use different canvas or ensure previous operations were cancelled or completed.");r(In,hr).add(this._canvas)}this._pdfBug&&((o=globalThis.StepperManager)!=null&&o.enabled)&&(this.stepper=globalThis.StepperManager.create(this._pageIndex),this.stepper.init(this.operatorList),this.stepper.nextBreakPoint=this.stepper.getNextBreakPoint());const{viewport:s,transform:i,background:n}=this.params,a=this._canvasContext||this._canvas.getContext("2d",{alpha:!1,willReadFrequently:!this._enableHWA});this.gfx=new ta(a,this.commonObjs,this.objs,this.canvasFactory,this.filterFactory,{optionalContentConfig:e},this.annotationCanvasMap,this.pageColors),this.gfx.beginDrawing({transform:i,viewport:s,transparency:t,background:n}),this.operatorListIdx=0,this.graphicsReady=!0,(l=this.graphicsReadyCallback)==null||l.call(this)}cancel(t=null,e=0){var s,i,n;this.running=!1,this.cancelled=!0,(s=this.gfx)==null||s.endDrawing(),r(this,Zi)&&(window.cancelAnimationFrame(r(this,Zi)),f(this,Zi,null)),r(In,hr).delete(this._canvas),t||(t=new Au(`Rendering cancelled, page ${this._pageIndex+1}`,e)),this.callback(t),(n=(i=this.task).onError)==null||n.call(i,t)}operatorListChanged(){var t;if(!this.graphicsReady){this.graphicsReadyCallback||(this.graphicsReadyCallback=this._continueBound);return}(t=this.stepper)==null||t.updateOperatorList(this.operatorList),!this.running&&this._continue()}_continue(){this.running=!0,!this.cancelled&&(this.task.onContinue?this.task.onContinue(this._scheduleNextBound):this._scheduleNext())}_scheduleNext(){this._useRequestAnimationFrame?f(this,Zi,window.requestAnimationFrame(()=>{f(this,Zi,null),this._nextBound().catch(this._cancelBound)})):Promise.resolve().then(this._nextBound).catch(this._cancelBound)}async _next(){this.cancelled||(this.operatorListIdx=this.gfx.executeOperatorList(this.operatorList,this.operatorListIdx,this._continueBound,this.stepper),this.operatorListIdx===this.operatorList.argsArray.length&&(this.running=!1,this.operatorList.lastChunk&&(this.gfx.endDrawing(),r(In,hr).delete(this._canvas),this.callback())))}};Zi=new WeakMap,hr=new WeakMap,g(In,hr,new WeakSet);let Md=In;const Om="5.4.54",$m="295fb3ec4";var Se,cr,Na,It,kl,Fa,hi,Dl,tn,ss,Ml,rt,Nd,Fd,Bd,Cn,up,Li;const ue=class ue{constructor({editor:t=null,uiManager:e=null}){g(this,rt);g(this,Se,null);g(this,cr,null);g(this,Na);g(this,It,null);g(this,kl,!1);g(this,Fa,!1);g(this,hi,null);g(this,Dl);g(this,tn,null);g(this,ss,null);var s,i;t?(f(this,Fa,!1),f(this,hi,t)):f(this,Fa,!0),f(this,ss,(t==null?void 0:t._uiManager)||e),f(this,Dl,r(this,ss)._eventBus),f(this,Na,((s=t==null?void 0:t.color)==null?void 0:s.toUpperCase())||((i=r(this,ss))==null?void 0:i.highlightColors.values().next().value)||"#FFFF98"),r(ue,Ml)||f(ue,Ml,Object.freeze({blue:"pdfjs-editor-colorpicker-blue",green:"pdfjs-editor-colorpicker-green",pink:"pdfjs-editor-colorpicker-pink",red:"pdfjs-editor-colorpicker-red",yellow:"pdfjs-editor-colorpicker-yellow"}))}static get _keyboardManager(){return q(this,"_keyboardManager",new mh([[["Escape","mac+Escape"],ue.prototype._hideDropdownFromKeyboard],[[" ","mac+ "],ue.prototype._colorSelectFromKeyboard],[["ArrowDown","ArrowRight","mac+ArrowDown","mac+ArrowRight"],ue.prototype._moveToNext],[["ArrowUp","ArrowLeft","mac+ArrowUp","mac+ArrowLeft"],ue.prototype._moveToPrevious],[["Home","mac+Home"],ue.prototype._moveToBeginning],[["End","mac+End"],ue.prototype._moveToEnd]]))}renderButton(){const t=f(this,Se,document.createElement("button"));t.className="colorPicker",t.tabIndex="0",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-button"),t.ariaHasPopup="true",r(this,hi)&&(t.ariaControls=`${r(this,hi).id}_colorpicker_dropdown`);const e=r(this,ss)._signal;t.addEventListener("click",m(this,rt,Cn).bind(this),{signal:e}),t.addEventListener("keydown",m(this,rt,Bd).bind(this),{signal:e});const s=f(this,cr,document.createElement("span"));return s.className="swatch",s.ariaHidden="true",s.style.backgroundColor=r(this,Na),t.append(s),t}renderMainDropdown(){const t=f(this,It,m(this,rt,Nd).call(this));return t.ariaOrientation="horizontal",t.ariaLabelledBy="highlightColorPickerLabel",t}_colorSelectFromKeyboard(t){if(t.target===r(this,Se)){m(this,rt,Cn).call(this,t);return}const e=t.target.getAttribute("data-color");e&&m(this,rt,Fd).call(this,e,t)}_moveToNext(t){var e,s;if(!r(this,rt,Li)){m(this,rt,Cn).call(this,t);return}if(t.target===r(this,Se)){(e=r(this,It).firstChild)==null||e.focus();return}(s=t.target.nextSibling)==null||s.focus()}_moveToPrevious(t){var e,s;if(t.target===((e=r(this,It))==null?void 0:e.firstChild)||t.target===r(this,Se)){r(this,rt,Li)&&this._hideDropdownFromKeyboard();return}r(this,rt,Li)||m(this,rt,Cn).call(this,t),(s=t.target.previousSibling)==null||s.focus()}_moveToBeginning(t){var e;if(!r(this,rt,Li)){m(this,rt,Cn).call(this,t);return}(e=r(this,It).firstChild)==null||e.focus()}_moveToEnd(t){var e;if(!r(this,rt,Li)){m(this,rt,Cn).call(this,t);return}(e=r(this,It).lastChild)==null||e.focus()}hideDropdown(){var t,e;(t=r(this,It))==null||t.classList.add("hidden"),r(this,Se).ariaExpanded="false",(e=r(this,tn))==null||e.abort(),f(this,tn,null)}_hideDropdownFromKeyboard(){var t;if(!r(this,Fa)){if(!r(this,rt,Li)){(t=r(this,hi))==null||t.unselect();return}this.hideDropdown(),r(this,Se).focus({preventScroll:!0,focusVisible:r(this,kl)})}}updateColor(t){if(r(this,cr)&&(r(this,cr).style.backgroundColor=t),!r(this,It))return;const e=r(this,ss).highlightColors.values();for(const s of r(this,It).children)s.ariaSelected=e.next().value===t.toUpperCase()}destroy(){var t,e;(t=r(this,Se))==null||t.remove(),f(this,Se,null),f(this,cr,null),(e=r(this,It))==null||e.remove(),f(this,It,null)}};Se=new WeakMap,cr=new WeakMap,Na=new WeakMap,It=new WeakMap,kl=new WeakMap,Fa=new WeakMap,hi=new WeakMap,Dl=new WeakMap,tn=new WeakMap,ss=new WeakMap,Ml=new WeakMap,rt=new WeakSet,Nd=function(){const t=document.createElement("div"),e=r(this,ss)._signal;t.addEventListener("contextmenu",Ye,{signal:e}),t.className="dropdown",t.role="listbox",t.ariaMultiSelectable="false",t.ariaOrientation="vertical",t.setAttribute("data-l10n-id","pdfjs-editor-colorpicker-dropdown"),r(this,hi)&&(t.id=`${r(this,hi).id}_colorpicker_dropdown`);for(const[s,i]of r(this,ss).highlightColors){const n=document.createElement("button");n.tabIndex="0",n.role="option",n.setAttribute("data-color",i),n.title=s,n.setAttribute("data-l10n-id",r(ue,Ml)[s]);const a=document.createElement("span");n.append(a),a.className="swatch",a.style.backgroundColor=i,n.ariaSelected=i===r(this,Na),n.addEventListener("click",m(this,rt,Fd).bind(this,i),{signal:e}),t.append(n)}return t.addEventListener("keydown",m(this,rt,Bd).bind(this),{signal:e}),t},Fd=function(t,e){e.stopPropagation(),r(this,Dl).dispatch("switchannotationeditorparams",{source:this,type:Y.HIGHLIGHT_COLOR,value:t}),this.updateColor(t)},Bd=function(t){ue._keyboardManager.exec(this,t)},Cn=function(t){if(r(this,rt,Li)){this.hideDropdown();return}if(f(this,kl,t.detail===0),r(this,tn)||(f(this,tn,new AbortController),window.addEventListener("pointerdown",m(this,rt,up).bind(this),{signal:r(this,ss).combinedSignal(r(this,tn))})),r(this,Se).ariaExpanded="true",r(this,It)){r(this,It).classList.remove("hidden");return}const e=f(this,It,m(this,rt,Nd).call(this));r(this,Se).append(e)},up=function(t){var e;(e=r(this,It))!=null&&e.contains(t.target)||this.hideDropdown()},Li=function(){return r(this,It)&&!r(this,It).classList.contains("hidden")},g(ue,Ml,null);let cc=ue;var Ts,Nl,Ba,Fl;const Pn=class Pn{constructor(t){g(this,Ts,null);g(this,Nl,null);g(this,Ba,null);f(this,Nl,t),f(this,Ba,t._uiManager),r(Pn,Fl)||f(Pn,Fl,Object.freeze({freetext:"pdfjs-editor-color-picker-free-text-input",ink:"pdfjs-editor-color-picker-ink-input"}))}renderButton(){if(r(this,Ts))return r(this,Ts);const{editorType:t,colorType:e,colorValue:s}=r(this,Nl),i=f(this,Ts,document.createElement("input"));return i.type="color",i.value=s||"#000000",i.className="basicColorPicker",i.tabIndex=0,i.setAttribute("data-l10n-id",r(Pn,Fl)[t]),i.addEventListener("input",()=>{r(this,Ba).updateParams(e,i.value)},{signal:r(this,Ba)._signal}),i}update(t){r(this,Ts)&&(r(this,Ts).value=t)}destroy(){var t;(t=r(this,Ts))==null||t.remove(),f(this,Ts,null)}hideDropdown(){}};Ts=new WeakMap,Nl=new WeakMap,Ba=new WeakMap,Fl=new WeakMap,g(Pn,Fl,null);let dc=Pn;function Zu(d){return Math.floor(Math.max(0,Math.min(1,d))*255).toString(16).padStart(2,"0")}function po(d){return Math.max(0,Math.min(255,255*d))}class tf{static CMYK_G([t,e,s,i]){return["G",1-Math.min(1,.3*t+.59*s+.11*e+i)]}static G_CMYK([t]){return["CMYK",0,0,0,1-t]}static G_RGB([t]){return["RGB",t,t,t]}static G_rgb([t]){return t=po(t),[t,t,t]}static G_HTML([t]){const e=Zu(t);return`#${e}${e}${e}`}static RGB_G([t,e,s]){return["G",.3*t+.59*e+.11*s]}static RGB_rgb(t){return t.map(po)}static RGB_HTML(t){return`#${t.map(Zu).join("")}`}static T_HTML(){return"#00000000"}static T_rgb(){return[null]}static CMYK_RGB([t,e,s,i]){return["RGB",1-Math.min(1,t+i),1-Math.min(1,s+i),1-Math.min(1,e+i)]}static CMYK_rgb([t,e,s,i]){return[po(1-Math.min(1,t+i)),po(1-Math.min(1,s+i)),po(1-Math.min(1,e+i))]}static CMYK_HTML(t){const e=this.CMYK_RGB(t).slice(1);return this.RGB_HTML(e)}static RGB_CMYK([t,e,s]){const i=1-t,n=1-e,a=1-s,o=Math.min(i,n,a);return["CMYK",i,n,a,o]}}class Hm{create(t,e,s=!1){if(t<=0||e<=0)throw new Error("Invalid SVG dimensions");const i=this._createSVG("svg:svg");return i.setAttribute("version","1.1"),s||(i.setAttribute("width",`${t}px`),i.setAttribute("height",`${e}px`)),i.setAttribute("preserveAspectRatio","none"),i.setAttribute("viewBox",`0 0 ${t} ${e}`),i}createElement(t){if(typeof t!="string")throw new Error("Invalid SVG element type");return this._createSVG(t)}_createSVG(t){at("Abstract method `_createSVG` called.")}}class uc extends Hm{_createSVG(t){return document.createElementNS($s,t)}}class fp{static setupStorage(t,e,s,i,n){const a=i.getValue(e,{value:null});switch(s.name){case"textarea":if(a.value!==null&&(t.textContent=a.value),n==="print")break;t.addEventListener("input",o=>{i.setValue(e,{value:o.target.value})});break;case"input":if(s.attributes.type==="radio"||s.attributes.type==="checkbox"){if(a.value===s.attributes.xfaOn?t.setAttribute("checked",!0):a.value===s.attributes.xfaOff&&t.removeAttribute("checked"),n==="print")break;t.addEventListener("change",o=>{i.setValue(e,{value:o.target.checked?o.target.getAttribute("xfaOn"):o.target.getAttribute("xfaOff")})})}else{if(a.value!==null&&t.setAttribute("value",a.value),n==="print")break;t.addEventListener("input",o=>{i.setValue(e,{value:o.target.value})})}break;case"select":if(a.value!==null){t.setAttribute("value",a.value);for(const o of s.children)o.attributes.value===a.value?o.attributes.selected=!0:o.attributes.hasOwnProperty("selected")&&delete o.attributes.selected}t.addEventListener("input",o=>{const l=o.target.options,h=l.selectedIndex===-1?"":l[l.selectedIndex].value;i.setValue(e,{value:h})});break}}static setAttributes({html:t,element:e,storage:s=null,intent:i,linkService:n}){const{attributes:a}=e,o=t instanceof HTMLAnchorElement;a.type==="radio"&&(a.name=`${a.name}-${i}`);for(const[l,h]of Object.entries(a))if(h!=null)switch(l){case"class":h.length&&t.setAttribute(l,h.join(" "));break;case"dataId":break;case"id":t.setAttribute("data-element-id",h);break;case"style":Object.assign(t.style,h);break;case"textContent":t.textContent=h;break;default:(!o||l!=="href"&&l!=="newWindow")&&t.setAttribute(l,h)}o&&n.addLinkAttributes(t,a.href,a.newWindow),s&&a.dataId&&this.setupStorage(t,a.dataId,e,s)}static render(t){var u,p;const e=t.annotationStorage,s=t.linkService,i=t.xfaHtml,n=t.intent||"display",a=document.createElement(i.name);i.attributes&&this.setAttributes({html:a,element:i,intent:n,linkService:s});const o=n!=="richText",l=t.div;if(l.append(a),t.viewport){const y=`matrix(${t.viewport.transform.join(",")})`;l.style.transform=y}o&&l.setAttribute("class","xfaLayer xfaFont");const h=[];if(i.children.length===0){if(i.value){const y=document.createTextNode(i.value);a.append(y),o&&Fo.shouldBuildText(i.name)&&h.push(y)}return{textDivs:h}}const c=[[i,-1,a]];for(;c.length>0;){const[y,A,b]=c.at(-1);if(A+1===y.children.length){c.pop();continue}const w=y.children[++c.at(-1)[1]];if(w===null)continue;const{name:v}=w;if(v==="#text"){const S=document.createTextNode(w.value);h.push(S),b.append(S);continue}const E=(u=w==null?void 0:w.attributes)!=null&&u.xmlns?document.createElementNS(w.attributes.xmlns,v):document.createElement(v);if(b.append(E),w.attributes&&this.setAttributes({html:E,element:w,storage:e,intent:n,linkService:s}),((p=w.children)==null?void 0:p.length)>0)c.push([w,-1,E]);else if(w.value){const S=document.createTextNode(w.value);o&&Fo.shouldBuildText(v)&&h.push(S),E.append(S)}}for(const y of l.querySelectorAll(".xfaNonInteractive input, .xfaNonInteractive textarea"))y.setAttribute("readOnly",!0);return{textDivs:h}}static update(t){const e=`matrix(${t.viewport.transform.join(",")})`;t.div.style.transform=e,t.div.hidden=!1}}const Um=9,Or=new WeakSet,zm=new Date().getTimezoneOffset()*60*1e3;class ef{static create(t){switch(t.data.annotationType){case St.LINK:return new _u(t);case St.TEXT:return new Vm(t);case St.WIDGET:switch(t.data.fieldType){case"Tx":return new Gm(t);case"Btn":return t.data.radioButton?new mp(t):t.data.checkBox?new Wm(t):new qm(t);case"Ch":return new Xm(t);case"Sig":return new jm(t)}return new Hr(t);case St.POPUP:return new $d(t);case St.FREETEXT:return new wp(t);case St.LINE:return new Km(t);case St.SQUARE:return new Jm(t);case St.CIRCLE:return new Qm(t);case St.POLYLINE:return new Sp(t);case St.CARET:return new ty(t);case St.INK:return new Cu(t);case St.POLYGON:return new Zm(t);case St.HIGHLIGHT:return new Ep(t);case St.UNDERLINE:return new ey(t);case St.SQUIGGLY:return new sy(t);case St.STRIKEOUT:return new iy(t);case St.STAMP:return new _p(t);case St.FILEATTACHMENT:return new ny(t);default:return new vt(t)}}}var dr,Oa,ci,Bl,Od;const Ru=class Ru{constructor(t,{isRenderable:e=!1,ignoreBorder:s=!1,createQuadrilaterals:i=!1}={}){g(this,Bl);g(this,dr,null);g(this,Oa,!1);g(this,ci,null);this.isRenderable=e,this.data=t.data,this.layer=t.layer,this.linkService=t.linkService,this.downloadManager=t.downloadManager,this.imageResourcesPath=t.imageResourcesPath,this.renderForms=t.renderForms,this.svgFactory=t.svgFactory,this.annotationStorage=t.annotationStorage,this.enableScripting=t.enableScripting,this.hasJSActions=t.hasJSActions,this._fieldObjects=t.fieldObjects,this.parent=t.parent,e&&(this.container=this._createContainer(s)),i&&this._createQuadrilaterals()}static _hasPopupData({contentsObj:t,richText:e}){return!!(t!=null&&t.str||e!=null&&e.str)}get _isEditable(){return this.data.isEditable}get hasPopupData(){return Ru._hasPopupData(this.data)}updateEdited(t){var n;if(!this.container)return;t.rect&&(r(this,dr)||f(this,dr,{rect:this.data.rect.slice(0)}));const{rect:e,popup:s}=t;e&&m(this,Bl,Od).call(this,e);let i=((n=r(this,ci))==null?void 0:n.popup)||this.popup;!i&&(s!=null&&s.text)&&(this._createPopup(s),i=r(this,ci).popup),i&&(i.updateEdited(t),s!=null&&s.deleted&&(i.remove(),f(this,ci,null),this.popup=null))}resetEdited(){var t;r(this,dr)&&(m(this,Bl,Od).call(this,r(this,dr).rect),(t=r(this,ci))==null||t.popup.resetEdited(),f(this,dr,null))}_createContainer(t){const{data:e,parent:{page:s,viewport:i}}=this,n=document.createElement("section");n.setAttribute("data-annotation-id",e.id),!(this instanceof Hr)&&!(this instanceof _u)&&(n.tabIndex=0);const{style:a}=n;if(a.zIndex=this.parent.zIndex++,e.alternativeText&&(n.title=e.alternativeText),e.noRotate&&n.classList.add("norotate"),!e.rect||this instanceof $d){const{rotation:b}=e;return!e.hasOwnCanvas&&b!==0&&this.setRotation(b,n),n}const{width:o,height:l}=this;if(!t&&e.borderStyle.width>0){a.borderWidth=`${e.borderStyle.width}px`;const b=e.borderStyle.horizontalCornerRadius,w=e.borderStyle.verticalCornerRadius;if(b>0||w>0){const E=`calc(${b}px * var(--total-scale-factor)) / calc(${w}px * var(--total-scale-factor))`;a.borderRadius=E}else if(this instanceof mp){const E=`calc(${o}px * var(--total-scale-factor)) / calc(${l}px * var(--total-scale-factor))`;a.borderRadius=E}switch(e.borderStyle.style){case Vr.SOLID:a.borderStyle="solid";break;case Vr.DASHED:a.borderStyle="dashed";break;case Vr.BEVELED:V("Unimplemented border style: beveled");break;case Vr.INSET:V("Unimplemented border style: inset");break;case Vr.UNDERLINE:a.borderBottomStyle="solid";break}const v=e.borderColor||null;v?(f(this,Oa,!0),a.borderColor=H.makeHexColor(v[0]|0,v[1]|0,v[2]|0)):a.borderWidth=0}const h=H.normalizeRect([e.rect[0],s.view[3]-e.rect[1]+s.view[1],e.rect[2],s.view[3]-e.rect[3]+s.view[1]]),{pageWidth:c,pageHeight:u,pageX:p,pageY:y}=i.rawDims;a.left=`${100*(h[0]-p)/c}%`,a.top=`${100*(h[1]-y)/u}%`;const{rotation:A}=e;return e.hasOwnCanvas||A===0?(a.width=`${100*o/c}%`,a.height=`${100*l/u}%`):this.setRotation(A,n),n}setRotation(t,e=this.container){if(!this.data.rect)return;const{pageWidth:s,pageHeight:i}=this.parent.viewport.rawDims;let{width:n,height:a}=this;t%180!==0&&([n,a]=[a,n]),e.style.width=`${100*n/s}%`,e.style.height=`${100*a/i}%`,e.setAttribute("data-main-rotation",(360-t)%360)}get _commonActions(){const t=(e,s,i)=>{const n=i.detail[e],a=n[0],o=n.slice(1);i.target.style[s]=tf[`${a}_HTML`](o),this.annotationStorage.setValue(this.data.id,{[s]:tf[`${a}_rgb`](o)})};return q(this,"_commonActions",{display:e=>{const{display:s}=e.detail,i=s%2===1;this.container.style.visibility=i?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noView:i,noPrint:s===1||s===2})},print:e=>{this.annotationStorage.setValue(this.data.id,{noPrint:!e.detail.print})},hidden:e=>{const{hidden:s}=e.detail;this.container.style.visibility=s?"hidden":"visible",this.annotationStorage.setValue(this.data.id,{noPrint:s,noView:s})},focus:e=>{setTimeout(()=>e.target.focus({preventScroll:!1}),0)},userName:e=>{e.target.title=e.detail.userName},readonly:e=>{e.target.disabled=e.detail.readonly},required:e=>{this._setRequired(e.target,e.detail.required)},bgColor:e=>{t("bgColor","backgroundColor",e)},fillColor:e=>{t("fillColor","backgroundColor",e)},fgColor:e=>{t("fgColor","color",e)},textColor:e=>{t("textColor","color",e)},borderColor:e=>{t("borderColor","borderColor",e)},strokeColor:e=>{t("strokeColor","borderColor",e)},rotation:e=>{const s=e.detail.rotation;this.setRotation(s),this.annotationStorage.setValue(this.data.id,{rotation:s})}})}_dispatchEventFromSandbox(t,e){const s=this._commonActions;for(const i of Object.keys(e.detail)){const n=t[i]||s[i];n==null||n(e)}}_setDefaultPropertiesFromJS(t){if(!this.enableScripting)return;const e=this.annotationStorage.getRawValue(this.data.id);if(!e)return;const s=this._commonActions;for(const[i,n]of Object.entries(e)){const a=s[i];if(a){const o={detail:{[i]:n},target:t};a(o),delete e[i]}}}_createQuadrilaterals(){if(!this.container)return;const{quadPoints:t}=this.data;if(!t)return;const[e,s,i,n]=this.data.rect.map(b=>Math.fround(b));if(t.length===8){const[b,w,v,E]=t.subarray(2,6);if(i===b&&n===w&&e===v&&s===E)return}const{style:a}=this.container;let o;if(r(this,Oa)){const{borderColor:b,borderWidth:w}=a;a.borderWidth=0,o=["url('data:image/svg+xml;utf8,",'<svg xmlns="http://www.w3.org/2000/svg"',' preserveAspectRatio="none" viewBox="0 0 1 1">',`<g fill="transparent" stroke="${b}" stroke-width="${w}">`],this.container.classList.add("hasBorder")}const l=i-e,h=n-s,{svgFactory:c}=this,u=c.createElement("svg");u.classList.add("quadrilateralsContainer"),u.setAttribute("width",0),u.setAttribute("height",0),u.role="none";const p=c.createElement("defs");u.append(p);const y=c.createElement("clipPath"),A=`clippath_${this.data.id}`;y.setAttribute("id",A),y.setAttribute("clipPathUnits","objectBoundingBox"),p.append(y);for(let b=2,w=t.length;b<w;b+=8){const v=t[b],E=t[b+1],S=t[b+2],_=t[b+3],C=c.createElement("rect"),T=(S-e)/l,x=(n-E)/h,I=(v-S)/l,P=(E-_)/h;C.setAttribute("x",T),C.setAttribute("y",x),C.setAttribute("width",I),C.setAttribute("height",P),y.append(C),o==null||o.push(`<rect vector-effect="non-scaling-stroke" x="${T}" y="${x}" width="${I}" height="${P}"/>`)}r(this,Oa)&&(o.push("</g></svg>')"),a.backgroundImage=o.join("")),this.container.append(u),this.container.style.clipPath=`url(#${A})`}_createPopup(t=null){const{data:e}=this;let s,i;t?(s={str:t.text},i=t.date):(s=e.contentsObj,i=e.modificationDate);const n=f(this,ci,new $d({data:{color:e.color,titleObj:e.titleObj,modificationDate:i,contentsObj:s,richText:e.richText,parentRect:e.rect,borderStyle:0,id:`popup_${e.id}`,rotation:e.rotation,noRotate:!0},linkService:this.linkService,parent:this.parent,elements:[this]}));this.parent.div.append(n.render())}get hasPopupElement(){return!!(r(this,ci)||this.popup||this.data.popupRef)}render(){at("Abstract method `AnnotationElement.render` called")}_getElementsByName(t,e=null){const s=[];if(this._fieldObjects){const i=this._fieldObjects[t];if(i)for(const{page:n,id:a,exportValues:o}of i){if(n===-1||a===e)continue;const l=typeof o=="string"?o:null,h=document.querySelector(`[data-element-id="${a}"]`);if(h&&!Or.has(h)){V(`_getElementsByName - element not allowed: ${a}`);continue}s.push({id:a,exportValue:l,domElement:h})}return s}for(const i of document.getElementsByName(t)){const{exportValue:n}=i,a=i.getAttribute("data-element-id");a!==e&&Or.has(i)&&s.push({id:a,exportValue:n,domElement:i})}return s}show(){var t;this.container&&(this.container.hidden=!1),(t=this.popup)==null||t.maybeShow()}hide(){var t;this.container&&(this.container.hidden=!0),(t=this.popup)==null||t.forceHide()}getElementsToTriggerPopup(){return this.container}addHighlightArea(){const t=this.getElementsToTriggerPopup();if(Array.isArray(t))for(const e of t)e.classList.add("highlightArea");else t.classList.add("highlightArea")}_editOnDoubleClick(){if(!this._isEditable)return;const{annotationEditorType:t,data:{id:e}}=this;this.container.addEventListener("dblclick",()=>{var s;(s=this.linkService.eventBus)==null||s.dispatch("switchannotationeditormode",{source:this,mode:t,editId:e,mustEnterInEditMode:!0})})}get width(){return this.data.rect[2]-this.data.rect[0]}get height(){return this.data.rect[3]-this.data.rect[1]}};dr=new WeakMap,Oa=new WeakMap,ci=new WeakMap,Bl=new WeakSet,Od=function(t){const{container:{style:e},data:{rect:s,rotation:i},parent:{viewport:{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:l}}}}=this;s==null||s.splice(0,4,...t),e.left=`${100*(t[0]-o)/n}%`,e.top=`${100*(a-t[3]+l)/a}%`,i===0?(e.width=`${100*(t[2]-t[0])/n}%`,e.height=`${100*(t[3]-t[1])/a}%`):this.setRotation(i)};let vt=Ru;var Ne,Tn,pp,gp;class _u extends vt{constructor(e,s=null){super(e,{isRenderable:!0,ignoreBorder:!!(s!=null&&s.ignoreBorder),createQuadrilaterals:!0});g(this,Ne);this.isTooltipOnly=e.data.isTooltipOnly}render(){const{data:e,linkService:s}=this,i=document.createElement("a");i.setAttribute("data-element-id",e.id);let n=!1;return e.url?(s.addLinkAttributes(i,e.url,e.newWindow),n=!0):e.action?(this._bindNamedAction(i,e.action,e.overlaidText),n=!0):e.attachment?(m(this,Ne,pp).call(this,i,e.attachment,e.overlaidText,e.attachmentDest),n=!0):e.setOCGState?(m(this,Ne,gp).call(this,i,e.setOCGState,e.overlaidText),n=!0):e.dest?(this._bindLink(i,e.dest,e.overlaidText),n=!0):(e.actions&&(e.actions.Action||e.actions["Mouse Up"]||e.actions["Mouse Down"])&&this.enableScripting&&this.hasJSActions&&(this._bindJSAction(i,e),n=!0),e.resetForm?(this._bindResetFormAction(i,e.resetForm),n=!0):this.isTooltipOnly&&!n&&(this._bindLink(i,""),n=!0)),this.container.classList.add("linkAnnotation"),n&&this.container.append(i),this.container}_bindLink(e,s,i=""){e.href=this.linkService.getDestinationHash(s),e.onclick=()=>(s&&this.linkService.goToDestination(s),!1),(s||s==="")&&m(this,Ne,Tn).call(this),i&&(e.title=i)}_bindNamedAction(e,s,i=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeNamedAction(s),!1),i&&(e.title=i),m(this,Ne,Tn).call(this)}_bindJSAction(e,s){e.href=this.linkService.getAnchorUrl("");const i=new Map([["Action","onclick"],["Mouse Up","onmouseup"],["Mouse Down","onmousedown"]]);for(const n of Object.keys(s.actions)){const a=i.get(n);a&&(e[a]=()=>{var o;return(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:s.id,name:n}}),!1})}s.overlaidText&&(e.title=s.overlaidText),e.onclick||(e.onclick=()=>!1),m(this,Ne,Tn).call(this)}_bindResetFormAction(e,s){const i=e.onclick;if(i||(e.href=this.linkService.getAnchorUrl("")),m(this,Ne,Tn).call(this),!this._fieldObjects){V('_bindResetFormAction - "resetForm" action not supported, ensure that the `fieldObjects` parameter is provided.'),i||(e.onclick=()=>!1);return}e.onclick=()=>{var u;i==null||i();const{fields:n,refs:a,include:o}=s,l=[];if(n.length!==0||a.length!==0){const p=new Set(a);for(const y of n){const A=this._fieldObjects[y]||[];for(const{id:b}of A)p.add(b)}for(const y of Object.values(this._fieldObjects))for(const A of y)p.has(A.id)===o&&l.push(A)}else for(const p of Object.values(this._fieldObjects))l.push(...p);const h=this.annotationStorage,c=[];for(const p of l){const{id:y}=p;switch(c.push(y),p.type){case"text":{const b=p.defaultValue||"";h.setValue(y,{value:b});break}case"checkbox":case"radiobutton":{const b=p.defaultValue===p.exportValues;h.setValue(y,{value:b});break}case"combobox":case"listbox":{const b=p.defaultValue||"";h.setValue(y,{value:b});break}default:continue}const A=document.querySelector(`[data-element-id="${y}"]`);if(A){if(!Or.has(A)){V(`_bindResetFormAction - element not allowed: ${y}`);continue}}else continue;A.dispatchEvent(new Event("resetform"))}return this.enableScripting&&((u=this.linkService.eventBus)==null||u.dispatch("dispatcheventinsandbox",{source:this,detail:{id:"app",ids:c,name:"ResetForm"}})),!1}}}Ne=new WeakSet,Tn=function(){this.container.setAttribute("data-internal-link","")},pp=function(e,s,i="",n=null){e.href=this.linkService.getAnchorUrl(""),s.description?e.title=s.description:i&&(e.title=i),e.onclick=()=>{var a;return(a=this.downloadManager)==null||a.openOrDownloadData(s.content,s.filename,n),!1},m(this,Ne,Tn).call(this)},gp=function(e,s,i=""){e.href=this.linkService.getAnchorUrl(""),e.onclick=()=>(this.linkService.executeSetOCGState(s),!1),i&&(e.title=i),m(this,Ne,Tn).call(this)};class Vm extends vt{constructor(t){super(t,{isRenderable:!0})}render(){this.container.classList.add("textAnnotation");const t=document.createElement("img");return t.src=this.imageResourcesPath+"annotation-"+this.data.name.toLowerCase()+".svg",t.setAttribute("data-l10n-id","pdfjs-text-annotation-type"),t.setAttribute("data-l10n-args",JSON.stringify({type:this.data.name})),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container.append(t),this.container}}class Hr extends vt{render(){return this.container}showElementAndHideCanvas(t){var e;this.data.hasOwnCanvas&&(((e=t.previousSibling)==null?void 0:e.nodeName)==="CANVAS"&&(t.previousSibling.hidden=!0),t.hidden=!1)}_getKeyModifier(t){return Xt.platform.isMac?t.metaKey:t.ctrlKey}_setEventListener(t,e,s,i,n){s.includes("mouse")?t.addEventListener(s,a=>{var o;(o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(a),shift:a.shiftKey,modifier:this._getKeyModifier(a)}})}):t.addEventListener(s,a=>{var o;if(s==="blur"){if(!e.focused||!a.relatedTarget)return;e.focused=!1}else if(s==="focus"){if(e.focused)return;e.focused=!0}n&&((o=this.linkService.eventBus)==null||o.dispatch("dispatcheventinsandbox",{source:this,detail:{id:this.data.id,name:i,value:n(a)}}))})}_setEventListeners(t,e,s,i){var n,a,o;for(const[l,h]of s)(h==="Action"||(n=this.data.actions)!=null&&n[h])&&((h==="Focus"||h==="Blur")&&(e||(e={focused:!1})),this._setEventListener(t,e,l,h,i),h==="Focus"&&!((a=this.data.actions)!=null&&a.Blur)?this._setEventListener(t,e,"blur","Blur",null):h==="Blur"&&!((o=this.data.actions)!=null&&o.Focus)&&this._setEventListener(t,e,"focus","Focus",null))}_setBackgroundColor(t){const e=this.data.backgroundColor||null;t.style.backgroundColor=e===null?"transparent":H.makeHexColor(e[0],e[1],e[2])}_setTextStyle(t){const e=["left","center","right"],{fontColor:s}=this.data.defaultAppearanceData,i=this.data.defaultAppearanceData.fontSize||Um,n=t.style;let a;const o=2,l=h=>Math.round(10*h)/10;if(this.data.multiLine){const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o),c=Math.round(h/(jc*i))||1,u=h/c;a=Math.min(i,l(u/jc))}else{const h=Math.abs(this.data.rect[3]-this.data.rect[1]-o);a=Math.min(i,l(h/jc))}n.fontSize=`calc(${a}px * var(--total-scale-factor))`,n.color=H.makeHexColor(s[0],s[1],s[2]),this.data.textAlignment!==null&&(n.textAlign=e[this.data.textAlignment])}_setRequired(t,e){e?t.setAttribute("required",!0):t.removeAttribute("required"),t.setAttribute("aria-required",e)}}class Gm extends Hr{constructor(t){const e=t.renderForms||t.data.hasOwnCanvas||!t.data.hasAppearance&&!!t.data.fieldValue;super(t,{isRenderable:e})}setPropertyOnSiblings(t,e,s,i){const n=this.annotationStorage;for(const a of this._getElementsByName(t.name,t.id))a.domElement&&(a.domElement[e]=s),n.setValue(a.id,{[i]:s})}render(){var i,n;const t=this.annotationStorage,e=this.data.id;this.container.classList.add("textWidgetAnnotation");let s=null;if(this.renderForms){const a=t.getValue(e,{value:this.data.fieldValue});let o=a.value||"";const l=t.getValue(e,{charLimit:this.data.maxLen}).charLimit;l&&o.length>l&&(o=o.slice(0,l));let h=a.formattedValue||((i=this.data.textContent)==null?void 0:i.join(`
`))||null;h&&this.data.comb&&(h=h.replaceAll(/\s+/g,""));const c={userValue:o,formattedValue:h,lastCommittedValue:null,commitKey:1,focused:!1};this.data.multiLine?(s=document.createElement("textarea"),s.textContent=h??o,this.data.doNotScroll&&(s.style.overflowY="hidden")):(s=document.createElement("input"),s.type=this.data.password?"password":"text",s.setAttribute("value",h??o),this.data.doNotScroll&&(s.style.overflowX="hidden")),this.data.hasOwnCanvas&&(s.hidden=!0),Or.add(s),s.setAttribute("data-element-id",e),s.disabled=this.data.readOnly,s.name=this.data.fieldName,s.tabIndex=0;const{datetimeFormat:u,datetimeType:p,timeStep:y}=this.data,A=!!p&&this.enableScripting;u&&(s.title=u),this._setRequired(s,this.data.required),l&&(s.maxLength=l),s.addEventListener("input",w=>{t.setValue(e,{value:w.target.value}),this.setPropertyOnSiblings(s,"value",w.target.value,"value"),c.formattedValue=null}),s.addEventListener("resetform",w=>{const v=this.data.defaultFieldValue??"";s.value=c.userValue=v,c.formattedValue=null});let b=w=>{const{formattedValue:v}=c;v!=null&&(w.target.value=v),w.target.scrollLeft=0};if(this.enableScripting&&this.hasJSActions){s.addEventListener("focus",v=>{var S;if(c.focused)return;const{target:E}=v;if(A&&(E.type=p,y&&(E.step=y)),c.userValue){const _=c.userValue;if(A)if(p==="time"){const C=new Date(_),T=[C.getHours(),C.getMinutes(),C.getSeconds()];E.value=T.map(x=>x.toString().padStart(2,"0")).join(":")}else E.value=new Date(_-zm).toISOString().split(p==="date"?"T":".",1)[0];else E.value=_}c.lastCommittedValue=E.value,c.commitKey=1,(S=this.data.actions)!=null&&S.Focus||(c.focused=!0)}),s.addEventListener("updatefromsandbox",v=>{this.showElementAndHideCanvas(v.target);const E={value(S){c.userValue=S.detail.value??"",A||t.setValue(e,{value:c.userValue.toString()}),S.target.value=c.userValue},formattedValue(S){const{formattedValue:_}=S.detail;c.formattedValue=_,_!=null&&S.target!==document.activeElement&&(S.target.value=_);const C={formattedValue:_};A&&(C.value=_),t.setValue(e,C)},selRange(S){S.target.setSelectionRange(...S.detail.selRange)},charLimit:S=>{var x;const{charLimit:_}=S.detail,{target:C}=S;if(_===0){C.removeAttribute("maxLength");return}C.setAttribute("maxLength",_);let T=c.userValue;!T||T.length<=_||(T=T.slice(0,_),C.value=c.userValue=T,t.setValue(e,{value:T}),(x=this.linkService.eventBus)==null||x.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:T,willCommit:!0,commitKey:1,selStart:C.selectionStart,selEnd:C.selectionEnd}}))}};this._dispatchEventFromSandbox(E,v)}),s.addEventListener("keydown",v=>{var _;c.commitKey=1;let E=-1;if(v.key==="Escape"?E=0:v.key==="Enter"&&!this.data.multiLine?E=2:v.key==="Tab"&&(c.commitKey=3),E===-1)return;const{value:S}=v.target;c.lastCommittedValue!==S&&(c.lastCommittedValue=S,c.userValue=S,(_=this.linkService.eventBus)==null||_.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:S,willCommit:!0,commitKey:E,selStart:v.target.selectionStart,selEnd:v.target.selectionEnd}}))});const w=b;b=null,s.addEventListener("blur",v=>{var _,C;if(!c.focused||!v.relatedTarget)return;(_=this.data.actions)!=null&&_.Blur||(c.focused=!1);const{target:E}=v;let{value:S}=E;if(A){if(S&&p==="time"){const T=S.split(":").map(x=>parseInt(x,10));S=new Date(2e3,0,1,T[0],T[1],T[2]||0).valueOf(),E.step=""}else S=new Date(S).valueOf();E.type="text"}c.userValue=S,c.lastCommittedValue!==S&&((C=this.linkService.eventBus)==null||C.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:S,willCommit:!0,commitKey:c.commitKey,selStart:v.target.selectionStart,selEnd:v.target.selectionEnd}})),w(v)}),(n=this.data.actions)!=null&&n.Keystroke&&s.addEventListener("beforeinput",v=>{var P;c.lastCommittedValue=null;const{data:E,target:S}=v,{value:_,selectionStart:C,selectionEnd:T}=S;let x=C,I=T;switch(v.inputType){case"deleteWordBackward":{const D=_.substring(0,C).match(/\w*[^\w]*$/);D&&(x-=D[0].length);break}case"deleteWordForward":{const D=_.substring(C).match(/^[^\w]*\w*/);D&&(I+=D[0].length);break}case"deleteContentBackward":C===T&&(x-=1);break;case"deleteContentForward":C===T&&(I+=1);break}v.preventDefault(),(P=this.linkService.eventBus)==null||P.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:_,change:E||"",willCommit:!1,selStart:x,selEnd:I}})}),this._setEventListeners(s,c,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],v=>v.target.value)}if(b&&s.addEventListener("blur",b),this.data.comb){const v=(this.data.rect[2]-this.data.rect[0])/l;s.classList.add("comb"),s.style.letterSpacing=`calc(${v}px * var(--total-scale-factor) - 1ch)`}}else s=document.createElement("div"),s.textContent=this.data.fieldValue,s.style.verticalAlign="middle",s.style.display="table-cell",this.data.hasOwnCanvas&&(s.hidden=!0);return this._setTextStyle(s),this._setBackgroundColor(s),this._setDefaultPropertiesFromJS(s),this.container.append(s),this.container}}class jm extends Hr{constructor(t){super(t,{isRenderable:!!t.data.hasOwnCanvas})}}class Wm extends Hr{constructor(t){super(t,{isRenderable:t.renderForms})}render(){const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.exportValue===e.fieldValue}).value;typeof i=="string"&&(i=i!=="Off",t.setValue(s,{value:i})),this.container.classList.add("buttonWidgetAnnotation","checkBox");const n=document.createElement("input");return Or.add(n),n.setAttribute("data-element-id",s),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="checkbox",n.name=e.fieldName,i&&n.setAttribute("checked",!0),n.setAttribute("exportValue",e.exportValue),n.tabIndex=0,n.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const h of this._getElementsByName(o,s)){const c=l&&h.exportValue===e.exportValue;h.domElement&&(h.domElement.checked=c),t.setValue(h.id,{value:c})}t.setValue(s,{value:l})}),n.addEventListener("resetform",a=>{const o=e.defaultFieldValue||"Off";a.target.checked=o===e.exportValue}),this.enableScripting&&this.hasJSActions&&(n.addEventListener("updatefromsandbox",a=>{const o={value(l){l.target.checked=l.detail.value!=="Off",t.setValue(s,{value:l.target.checked})}};this._dispatchEventFromSandbox(o,a)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],a=>a.target.checked)),this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class mp extends Hr{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("buttonWidgetAnnotation","radioButton");const t=this.annotationStorage,e=this.data,s=e.id;let i=t.getValue(s,{value:e.fieldValue===e.buttonValue}).value;if(typeof i=="string"&&(i=i!==e.buttonValue,t.setValue(s,{value:i})),i)for(const a of this._getElementsByName(e.fieldName,s))t.setValue(a.id,{value:!1});const n=document.createElement("input");if(Or.add(n),n.setAttribute("data-element-id",s),n.disabled=e.readOnly,this._setRequired(n,this.data.required),n.type="radio",n.name=e.fieldName,i&&n.setAttribute("checked",!0),n.tabIndex=0,n.addEventListener("change",a=>{const{name:o,checked:l}=a.target;for(const h of this._getElementsByName(o,s))t.setValue(h.id,{value:!1});t.setValue(s,{value:l})}),n.addEventListener("resetform",a=>{const o=e.defaultFieldValue;a.target.checked=o!=null&&o===e.buttonValue}),this.enableScripting&&this.hasJSActions){const a=e.buttonValue;n.addEventListener("updatefromsandbox",o=>{const l={value:h=>{const c=a===h.detail.value;for(const u of this._getElementsByName(h.target.name)){const p=c&&u.id===s;u.domElement&&(u.domElement.checked=p),t.setValue(u.id,{value:p})}}};this._dispatchEventFromSandbox(l,o)}),this._setEventListeners(n,null,[["change","Validate"],["change","Action"],["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"]],o=>o.target.checked)}return this._setBackgroundColor(n),this._setDefaultPropertiesFromJS(n),this.container.append(n),this.container}}class qm extends _u{constructor(t){super(t,{ignoreBorder:t.data.hasAppearance})}render(){const t=super.render();t.classList.add("buttonWidgetAnnotation","pushButton");const e=t.lastChild;return this.enableScripting&&this.hasJSActions&&e&&(this._setDefaultPropertiesFromJS(e),e.addEventListener("updatefromsandbox",s=>{this._dispatchEventFromSandbox({},s)})),t}}class Xm extends Hr{constructor(t){super(t,{isRenderable:t.renderForms})}render(){this.container.classList.add("choiceWidgetAnnotation");const t=this.annotationStorage,e=this.data.id,s=t.getValue(e,{value:this.data.fieldValue}),i=document.createElement("select");Or.add(i),i.setAttribute("data-element-id",e),i.disabled=this.data.readOnly,this._setRequired(i,this.data.required),i.name=this.data.fieldName,i.tabIndex=0;let n=this.data.combo&&this.data.options.length>0;this.data.combo||(i.size=this.data.options.length,this.data.multiSelect&&(i.multiple=!0)),i.addEventListener("resetform",c=>{const u=this.data.defaultFieldValue;for(const p of i.options)p.selected=p.value===u});for(const c of this.data.options){const u=document.createElement("option");u.textContent=c.displayValue,u.value=c.exportValue,s.value.includes(c.exportValue)&&(u.setAttribute("selected",!0),n=!1),i.append(u)}let a=null;if(n){const c=document.createElement("option");c.value=" ",c.setAttribute("hidden",!0),c.setAttribute("selected",!0),i.prepend(c),a=()=>{c.remove(),i.removeEventListener("input",a),a=null},i.addEventListener("input",a)}const o=c=>{const u=c?"value":"textContent",{options:p,multiple:y}=i;return y?Array.prototype.filter.call(p,A=>A.selected).map(A=>A[u]):p.selectedIndex===-1?null:p[p.selectedIndex][u]};let l=o(!1);const h=c=>{const u=c.target.options;return Array.prototype.map.call(u,p=>({displayValue:p.textContent,exportValue:p.value}))};return this.enableScripting&&this.hasJSActions?(i.addEventListener("updatefromsandbox",c=>{const u={value(p){a==null||a();const y=p.detail.value,A=new Set(Array.isArray(y)?y:[y]);for(const b of i.options)b.selected=A.has(b.value);t.setValue(e,{value:o(!0)}),l=o(!1)},multipleSelection(p){i.multiple=!0},remove(p){const y=i.options,A=p.detail.remove;y[A].selected=!1,i.remove(A),y.length>0&&Array.prototype.findIndex.call(y,w=>w.selected)===-1&&(y[0].selected=!0),t.setValue(e,{value:o(!0),items:h(p)}),l=o(!1)},clear(p){for(;i.length!==0;)i.remove(0);t.setValue(e,{value:null,items:[]}),l=o(!1)},insert(p){const{index:y,displayValue:A,exportValue:b}=p.detail.insert,w=i.children[y],v=document.createElement("option");v.textContent=A,v.value=b,w?w.before(v):i.append(v),t.setValue(e,{value:o(!0),items:h(p)}),l=o(!1)},items(p){const{items:y}=p.detail;for(;i.length!==0;)i.remove(0);for(const A of y){const{displayValue:b,exportValue:w}=A,v=document.createElement("option");v.textContent=b,v.value=w,i.append(v)}i.options.length>0&&(i.options[0].selected=!0),t.setValue(e,{value:o(!0),items:h(p)}),l=o(!1)},indices(p){const y=new Set(p.detail.indices);for(const A of p.target.options)A.selected=y.has(A.index);t.setValue(e,{value:o(!0)}),l=o(!1)},editable(p){p.target.disabled=!p.detail.editable}};this._dispatchEventFromSandbox(u,c)}),i.addEventListener("input",c=>{var y;const u=o(!0),p=o(!1);t.setValue(e,{value:u}),c.preventDefault(),(y=this.linkService.eventBus)==null||y.dispatch("dispatcheventinsandbox",{source:this,detail:{id:e,name:"Keystroke",value:l,change:p,changeEx:u,willCommit:!1,commitKey:1,keyDown:!1}})}),this._setEventListeners(i,null,[["focus","Focus"],["blur","Blur"],["mousedown","Mouse Down"],["mouseenter","Mouse Enter"],["mouseleave","Mouse Exit"],["mouseup","Mouse Up"],["input","Action"],["input","Validate"]],c=>c.target.value)):i.addEventListener("input",function(c){t.setValue(e,{value:o(!0)})}),this.data.combo&&this._setTextStyle(i),this._setBackgroundColor(i),this._setDefaultPropertiesFromJS(i),this.container.append(i),this.container}}class $d extends vt{constructor(t){const{data:e,elements:s}=t;super(t,{isRenderable:vt._hasPopupData(e)}),this.elements=s,this.popup=null}render(){const{container:t}=this;t.classList.add("popupAnnotation"),t.role="comment";const e=this.popup=new Ym({container:this.container,color:this.data.color,titleObj:this.data.titleObj,modificationDate:this.data.modificationDate||this.data.creationDate,contentsObj:this.data.contentsObj,richText:this.data.richText,rect:this.data.rect,parentRect:this.data.parentRect||null,parent:this.parent,elements:this.elements,open:this.data.open}),s=[];for(const i of this.elements)i.popup=e,i.container.ariaHasPopup="dialog",s.push(i.data.id),i.addHighlightArea();return this.container.setAttribute("aria-controls",s.map(i=>`${bu}${i}`).join(",")),this.container}}var $a,Lc,Ic,Ha,Ua,mt,di,en,za,Ol,Va,xs,Ee,sn,ui,$l,fi,Ga,ur,nn,Q,Hh,Uh,Hd,yp,bp,Ap,vp,zh,Vh,Ud;class Ym{constructor({container:t,color:e,elements:s,titleObj:i,modificationDate:n,contentsObj:a,richText:o,parent:l,rect:h,parentRect:c,open:u}){g(this,Q);g(this,$a,m(this,Q,Ap).bind(this));g(this,Lc,m(this,Q,Ud).bind(this));g(this,Ic,m(this,Q,Vh).bind(this));g(this,Ha,m(this,Q,zh).bind(this));g(this,Ua,null);g(this,mt,null);g(this,di,null);g(this,en,null);g(this,za,null);g(this,Ol,null);g(this,Va,null);g(this,xs,!1);g(this,Ee,null);g(this,sn,null);g(this,ui,null);g(this,$l,null);g(this,fi,null);g(this,Ga,null);g(this,ur,null);g(this,nn,!1);f(this,mt,t),f(this,Ga,i),f(this,di,a),f(this,fi,o),f(this,Ol,l),f(this,Ua,e),f(this,$l,h),f(this,Va,c),f(this,za,s),f(this,en,ac.toDateObject(n)),this.trigger=s.flatMap(p=>p.getElementsToTriggerPopup()),m(this,Q,Hh).call(this),r(this,mt).hidden=!0,u&&m(this,Q,zh).call(this)}render(){var i;if(r(this,Ee))return;const t=f(this,Ee,document.createElement("div"));if(t.className="popup",r(this,Ua)){const n=t.style.outlineColor=H.makeHexColor(...r(this,Ua));t.style.backgroundColor=`color-mix(in srgb, ${n} 30%, white)`}const e=document.createElement("span");if(e.className="header",(i=r(this,Ga))!=null&&i.str){const n=document.createElement("span");n.className="title",e.append(n),{dir:n.dir,str:n.textContent}=r(this,Ga)}if(t.append(e),r(this,en)){const n=document.createElement("time");n.className="popupDate",n.setAttribute("data-l10n-id","pdfjs-annotation-date-time-string"),n.setAttribute("data-l10n-args",JSON.stringify({dateObj:r(this,en).valueOf()})),n.dateTime=r(this,en).toISOString(),e.append(n)}const s=r(this,Q,Uh);if(s)fp.render({xfaHtml:s,intent:"richText",div:t}),t.lastChild.classList.add("richText","popupContent");else{const n=this._formatContents(r(this,di));t.append(n)}r(this,mt).append(t)}_formatContents({str:t,dir:e}){const s=document.createElement("p");s.classList.add("popupContent"),s.dir=e;const i=t.split(/(?:\r\n?|\n)/);for(let n=0,a=i.length;n<a;++n){const o=i[n];s.append(document.createTextNode(o)),n<a-1&&s.append(document.createElement("br"))}return s}updateEdited({rect:t,popup:e,deleted:s}){var i;if(s||e!=null&&e.deleted){this.remove();return}m(this,Q,Hh).call(this),r(this,ur)||f(this,ur,{contentsObj:r(this,di),richText:r(this,fi)}),t&&f(this,ui,null),e&&(f(this,fi,m(this,Q,bp).call(this,e.text)),f(this,en,ac.toDateObject(e.date)),f(this,di,null)),(i=r(this,Ee))==null||i.remove(),f(this,Ee,null)}resetEdited(){var t;r(this,ur)&&({contentsObj:ee(this,di)._,richText:ee(this,fi)._}=r(this,ur),f(this,ur,null),(t=r(this,Ee))==null||t.remove(),f(this,Ee,null),f(this,ui,null))}remove(){var t,e;(t=r(this,sn))==null||t.abort(),f(this,sn,null),(e=r(this,Ee))==null||e.remove(),f(this,Ee,null),f(this,nn,!1),f(this,xs,!1);for(const s of this.trigger)s.classList.remove("popupTriggerArea")}forceHide(){f(this,nn,this.isVisible),r(this,nn)&&(r(this,mt).hidden=!0)}maybeShow(){m(this,Q,Hh).call(this),r(this,nn)&&(r(this,Ee)||m(this,Q,Vh).call(this),f(this,nn,!1),r(this,mt).hidden=!1)}get isVisible(){return r(this,mt).hidden===!1}}$a=new WeakMap,Lc=new WeakMap,Ic=new WeakMap,Ha=new WeakMap,Ua=new WeakMap,mt=new WeakMap,di=new WeakMap,en=new WeakMap,za=new WeakMap,Ol=new WeakMap,Va=new WeakMap,xs=new WeakMap,Ee=new WeakMap,sn=new WeakMap,ui=new WeakMap,$l=new WeakMap,fi=new WeakMap,Ga=new WeakMap,ur=new WeakMap,nn=new WeakMap,Q=new WeakSet,Hh=function(){var e;if(r(this,sn))return;f(this,sn,new AbortController);const{signal:t}=r(this,sn);for(const s of this.trigger)s.addEventListener("click",r(this,Ha),{signal:t}),s.addEventListener("mouseenter",r(this,Ic),{signal:t}),s.addEventListener("mouseleave",r(this,Lc),{signal:t}),s.classList.add("popupTriggerArea");for(const s of r(this,za))(e=s.container)==null||e.addEventListener("keydown",r(this,$a),{signal:t})},Uh=function(){const t=r(this,fi),e=r(this,di);return t!=null&&t.str&&(!(e!=null&&e.str)||e.str===t.str)&&r(this,fi).html||null},Hd=function(){var t,e,s;return((s=(e=(t=r(this,Q,Uh))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:s.fontSize)||0},yp=function(){var t,e,s;return((s=(e=(t=r(this,Q,Uh))==null?void 0:t.attributes)==null?void 0:e.style)==null?void 0:s.color)||null},bp=function(t){const e=[],s={str:t,html:{name:"div",attributes:{dir:"auto"},children:[{name:"p",children:e}]}},i={style:{color:r(this,Q,yp),fontSize:r(this,Q,Hd)?`calc(${r(this,Q,Hd)}px * var(--total-scale-factor))`:""}};for(const n of t.split(`
`))e.push({name:"span",value:n,attributes:i});return s},Ap=function(t){t.altKey||t.shiftKey||t.ctrlKey||t.metaKey||(t.key==="Enter"||t.key==="Escape"&&r(this,xs))&&m(this,Q,zh).call(this)},vp=function(){if(r(this,ui)!==null)return;const{page:{view:t},viewport:{rawDims:{pageWidth:e,pageHeight:s,pageX:i,pageY:n}}}=r(this,Ol);let a=!!r(this,Va),o=a?r(this,Va):r(this,$l);for(const A of r(this,za))if(!o||H.intersect(A.data.rect,o)!==null){o=A.data.rect,a=!0;break}const l=H.normalizeRect([o[0],t[3]-o[1]+t[1],o[2],t[3]-o[3]+t[1]]),c=a?o[2]-o[0]+5:0,u=l[0]+c,p=l[1];f(this,ui,[100*(u-i)/e,100*(p-n)/s]);const{style:y}=r(this,mt);y.left=`${r(this,ui)[0]}%`,y.top=`${r(this,ui)[1]}%`},zh=function(){f(this,xs,!r(this,xs)),r(this,xs)?(m(this,Q,Vh).call(this),r(this,mt).addEventListener("click",r(this,Ha)),r(this,mt).addEventListener("keydown",r(this,$a))):(m(this,Q,Ud).call(this),r(this,mt).removeEventListener("click",r(this,Ha)),r(this,mt).removeEventListener("keydown",r(this,$a)))},Vh=function(){r(this,Ee)||this.render(),this.isVisible?r(this,xs)&&r(this,mt).classList.add("focused"):(m(this,Q,vp).call(this),r(this,mt).hidden=!1,r(this,mt).style.zIndex=parseInt(r(this,mt).style.zIndex)+1e3)},Ud=function(){r(this,mt).classList.remove("focused"),!(r(this,xs)||!this.isVisible)&&(r(this,mt).hidden=!0,r(this,mt).style.zIndex=parseInt(r(this,mt).style.zIndex)-1e3)};class wp extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.textContent=t.data.textContent,this.textPosition=t.data.textPosition,this.annotationEditorType=z.FREETEXT}render(){if(this.container.classList.add("freeTextAnnotation"),this.textContent){const t=document.createElement("div");t.classList.add("annotationTextContent"),t.setAttribute("role","comment");for(const e of this.textContent){const s=document.createElement("span");s.textContent=e,t.append(s)}this.container.append(t)}return!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Hl;class Km extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});g(this,Hl,null)}render(){this.container.classList.add("lineAnnotation");const{data:e,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),a=f(this,Hl,this.svgFactory.createElement("svg:line"));return a.setAttribute("x1",e.rect[2]-e.lineCoordinates[0]),a.setAttribute("y1",e.rect[3]-e.lineCoordinates[1]),a.setAttribute("x2",e.rect[2]-e.lineCoordinates[2]),a.setAttribute("y2",e.rect[3]-e.lineCoordinates[3]),a.setAttribute("stroke-width",e.borderStyle.width||1),a.setAttribute("stroke","transparent"),a.setAttribute("fill","transparent"),n.append(a),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,Hl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Hl=new WeakMap;var Ul;class Jm extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});g(this,Ul,null)}render(){this.container.classList.add("squareAnnotation");const{data:e,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),a=e.borderStyle.width,o=f(this,Ul,this.svgFactory.createElement("svg:rect"));return o.setAttribute("x",a/2),o.setAttribute("y",a/2),o.setAttribute("width",s-a),o.setAttribute("height",i-a),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,Ul)}addHighlightArea(){this.container.classList.add("highlightArea")}}Ul=new WeakMap;var zl;class Qm extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});g(this,zl,null)}render(){this.container.classList.add("circleAnnotation");const{data:e,width:s,height:i}=this,n=this.svgFactory.create(s,i,!0),a=e.borderStyle.width,o=f(this,zl,this.svgFactory.createElement("svg:ellipse"));return o.setAttribute("cx",s/2),o.setAttribute("cy",i/2),o.setAttribute("rx",s/2-a/2),o.setAttribute("ry",i/2-a/2),o.setAttribute("stroke-width",a||1),o.setAttribute("stroke","transparent"),o.setAttribute("fill","transparent"),n.append(o),this.container.append(n),!e.popupRef&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,zl)}addHighlightArea(){this.container.classList.add("highlightArea")}}zl=new WeakMap;var Vl;class Sp extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});g(this,Vl,null);this.containerClassName="polylineAnnotation",this.svgElementName="svg:polyline"}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,vertices:s,borderStyle:i,popupRef:n},width:a,height:o}=this;if(!s)return this.container;const l=this.svgFactory.create(a,o,!0);let h=[];for(let u=0,p=s.length;u<p;u+=2){const y=s[u]-e[0],A=e[3]-s[u+1];h.push(`${y},${A}`)}h=h.join(" ");const c=f(this,Vl,this.svgFactory.createElement(this.svgElementName));return c.setAttribute("points",h),c.setAttribute("stroke-width",i.width||1),c.setAttribute("stroke","transparent"),c.setAttribute("fill","transparent"),l.append(c),this.container.append(l),!n&&this.hasPopupData&&this._createPopup(),this.container}getElementsToTriggerPopup(){return r(this,Vl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Vl=new WeakMap;class Zm extends Sp{constructor(t){super(t),this.containerClassName="polygonAnnotation",this.svgElementName="svg:polygon"}}class ty extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0})}render(){return this.container.classList.add("caretAnnotation"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this.container}}var Gl,fr,jl,zd;class Cu extends vt{constructor(e){super(e,{isRenderable:!0,ignoreBorder:!0});g(this,jl);g(this,Gl,null);g(this,fr,[]);this.containerClassName="inkAnnotation",this.svgElementName="svg:polyline",this.annotationEditorType=this.data.it==="InkHighlight"?z.HIGHLIGHT:z.INK}render(){this.container.classList.add(this.containerClassName);const{data:{rect:e,rotation:s,inkLists:i,borderStyle:n,popupRef:a}}=this,{transform:o,width:l,height:h}=m(this,jl,zd).call(this,s,e),c=this.svgFactory.create(l,h,!0),u=f(this,Gl,this.svgFactory.createElement("svg:g"));c.append(u),u.setAttribute("stroke-width",n.width||1),u.setAttribute("stroke-linecap","round"),u.setAttribute("stroke-linejoin","round"),u.setAttribute("stroke-miterlimit",10),u.setAttribute("stroke","transparent"),u.setAttribute("fill","transparent"),u.setAttribute("transform",o);for(let p=0,y=i.length;p<y;p++){const A=this.svgFactory.createElement(this.svgElementName);r(this,fr).push(A),A.setAttribute("points",i[p].join(",")),u.append(A)}return!a&&this.hasPopupData&&this._createPopup(),this.container.append(c),this._editOnDoubleClick(),this.container}updateEdited(e){super.updateEdited(e);const{thickness:s,points:i,rect:n}=e,a=r(this,Gl);if(s>=0&&a.setAttribute("stroke-width",s||1),i)for(let o=0,l=r(this,fr).length;o<l;o++)r(this,fr)[o].setAttribute("points",i[o].join(","));if(n){const{transform:o,width:l,height:h}=m(this,jl,zd).call(this,this.data.rotation,n);a.parentElement.setAttribute("viewBox",`0 0 ${l} ${h}`),a.setAttribute("transform",o)}}getElementsToTriggerPopup(){return r(this,fr)}addHighlightArea(){this.container.classList.add("highlightArea")}}Gl=new WeakMap,fr=new WeakMap,jl=new WeakSet,zd=function(e,s){switch(e){case 90:return{transform:`rotate(90) translate(${-s[0]},${s[1]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};case 180:return{transform:`rotate(180) translate(${-s[2]},${s[1]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]};case 270:return{transform:`rotate(270) translate(${-s[2]},${s[3]}) scale(1,-1)`,width:s[3]-s[1],height:s[2]-s[0]};default:return{transform:`translate(${-s[0]},${s[3]}) scale(1,-1)`,width:s[2]-s[0],height:s[3]-s[1]}}};class Ep extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0}),this.annotationEditorType=z.HIGHLIGHT}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("highlightAnnotation"),this._editOnDoubleClick(),t){const s=document.createElement("mark");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class ey extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("underlineAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class sy extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("squigglyAnnotation"),t){const s=document.createElement("u");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class iy extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0,createQuadrilaterals:!0})}render(){const{data:{overlaidText:t,popupRef:e}}=this;if(!e&&this.hasPopupData&&this._createPopup(),this.container.classList.add("strikeoutAnnotation"),t){const s=document.createElement("s");s.classList.add("overlaidText"),s.textContent=t,this.container.append(s)}return this.container}}class _p extends vt{constructor(t){super(t,{isRenderable:!0,ignoreBorder:!0}),this.annotationEditorType=z.STAMP}render(){return this.container.classList.add("stampAnnotation"),this.container.setAttribute("role","img"),!this.data.popupRef&&this.hasPopupData&&this._createPopup(),this._editOnDoubleClick(),this.container}}var Wl,ql,Vd;class ny extends vt{constructor(e){var i;super(e,{isRenderable:!0});g(this,ql);g(this,Wl,null);const{file:s}=this.data;this.filename=s.filename,this.content=s.content,(i=this.linkService.eventBus)==null||i.dispatch("fileattachmentannotation",{source:this,...s})}render(){this.container.classList.add("fileAttachmentAnnotation");const{container:e,data:s}=this;let i;s.hasAppearance||s.fillAlpha===0?i=document.createElement("div"):(i=document.createElement("img"),i.src=`${this.imageResourcesPath}annotation-${/paperclip/i.test(s.name)?"paperclip":"pushpin"}.svg`,s.fillAlpha&&s.fillAlpha<1&&(i.style=`filter: opacity(${Math.round(s.fillAlpha*100)}%);`)),i.addEventListener("dblclick",m(this,ql,Vd).bind(this)),f(this,Wl,i);const{isMac:n}=Xt.platform;return e.addEventListener("keydown",a=>{a.key==="Enter"&&(n?a.metaKey:a.ctrlKey)&&m(this,ql,Vd).call(this)}),!s.popupRef&&this.hasPopupData?this._createPopup():i.classList.add("popupTriggerArea"),e.append(i),e}getElementsToTriggerPopup(){return r(this,Wl)}addHighlightArea(){this.container.classList.add("highlightArea")}}Wl=new WeakMap,ql=new WeakSet,Vd=function(){var e;(e=this.downloadManager)==null||e.openOrDownloadData(this.content,this.filename)};var Xl,pr,rn,Yl,En,jd,Wd;const ku=class ku{constructor({div:t,accessibilityManager:e,annotationCanvasMap:s,annotationEditorUIManager:i,page:n,viewport:a,structTreeLayer:o}){g(this,En);g(this,Xl,null);g(this,pr,null);g(this,rn,new Map);g(this,Yl,null);this.div=t,f(this,Xl,e),f(this,pr,s),f(this,Yl,o||null),this.page=n,this.viewport=a,this.zIndex=0,this._annotationEditorUIManager=i}hasEditableAnnotations(){return r(this,rn).size>0}async render(t){var a;const{annotations:e}=t,s=this.div;Fr(s,this.viewport);const i=new Map,n={data:null,layer:s,linkService:t.linkService,downloadManager:t.downloadManager,imageResourcesPath:t.imageResourcesPath||"",renderForms:t.renderForms!==!1,svgFactory:new uc,annotationStorage:t.annotationStorage||new wu,enableScripting:t.enableScripting===!0,hasJSActions:t.hasJSActions,fieldObjects:t.fieldObjects,parent:this,elements:null};for(const o of e){if(o.noHTML)continue;const l=o.annotationType===St.POPUP;if(l){const u=i.get(o.id);if(!u)continue;n.elements=u}else if(o.rect[2]===o.rect[0]||o.rect[3]===o.rect[1])continue;n.data=o;const h=ef.create(n);if(!h.isRenderable)continue;if(!l&&o.popupRef){const u=i.get(o.popupRef);u?u.push(h):i.set(o.popupRef,[h])}const c=h.render();o.hidden&&(c.style.visibility="hidden"),await m(this,En,jd).call(this,c,o.id,n.elements),h._isEditable&&(r(this,rn).set(h.data.id,h),(a=this._annotationEditorUIManager)==null||a.renderAnnotationElement(h))}m(this,En,Wd).call(this)}async addLinkAnnotations(t,e){const s={data:null,layer:this.div,linkService:e,svgFactory:new uc,parent:this};for(const i of t){i.borderStyle||(i.borderStyle=ku._defaultBorderStyle),s.data=i;const n=ef.create(s);if(!n.isRenderable)continue;const a=n.render();await m(this,En,jd).call(this,a,i.id,null)}}update({viewport:t}){const e=this.div;this.viewport=t,Fr(e,{rotation:t.rotation}),m(this,En,Wd).call(this),e.hidden=!1}getEditableAnnotations(){return Array.from(r(this,rn).values())}getEditableAnnotation(t){return r(this,rn).get(t)}static get _defaultBorderStyle(){return q(this,"_defaultBorderStyle",Object.freeze({width:1,rawWidth:1,style:Vr.SOLID,dashArray:[3],horizontalCornerRadius:0,verticalCornerRadius:0}))}};Xl=new WeakMap,pr=new WeakMap,rn=new WeakMap,Yl=new WeakMap,En=new WeakSet,jd=async function(t,e,s){var o,l;const i=t.firstChild||t,n=i.id=`${bu}${e}`,a=await((o=r(this,Yl))==null?void 0:o.getAriaAttributes(n));if(a)for(const[h,c]of a)i.setAttribute(h,c);s?s.at(-1).container.after(t):(this.div.append(t),(l=r(this,Xl))==null||l.moveElementInDOM(this.div,t,i,!1))},Wd=function(){var e;if(!r(this,pr))return;const t=this.div;for(const[s,i]of r(this,pr)){const n=t.querySelector(`[data-annotation-id="${s}"]`);if(!n)continue;i.className="annotationContent";const{firstChild:a}=n;a?a.nodeName==="CANVAS"?a.replaceWith(i):a.classList.contains("annotationContent")?a.after(i):a.before(i):n.append(i);const o=r(this,rn).get(s);o&&(o._hasNoCanvas?((e=this._annotationEditorUIManager)==null||e.setMissingCanvas(s,n.id,i),o._hasNoCanvas=!1):o.canvas=i)}r(this,pr).clear()};let Gd=ku;const Ch=/\r\n?|\n/g;var Ve,_e,Kl,gr,Ce,Ct,Cp,Tp,xp,Gh,_i,jh,Wh,Lp,Xd,Ip;const ot=class ot extends lt{constructor(e){super({...e,name:"freeTextEditor"});g(this,Ct);g(this,Ve);g(this,_e,"");g(this,Kl,`${this.id}-editor`);g(this,gr,null);g(this,Ce);L(this,"_colorPicker",null);f(this,Ve,e.color||ot._defaultColor||lt._defaultLineColor),f(this,Ce,e.fontSize||ot._defaultFontSize),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-freetext-added-alert")}static get _keyboardManager(){const e=ot.prototype,s=a=>a.isEmpty(),i=Br.TRANSLATE_SMALL,n=Br.TRANSLATE_BIG;return q(this,"_keyboardManager",new mh([[["ctrl+s","mac+meta+s","ctrl+p","mac+meta+p"],e.commitOrRemove,{bubbles:!0}],[["ctrl+Enter","mac+meta+Enter","Escape","mac+Escape"],e.commitOrRemove],[["ArrowLeft","mac+ArrowLeft"],e._translateEmpty,{args:[-i,0],checker:s}],[["ctrl+ArrowLeft","mac+shift+ArrowLeft"],e._translateEmpty,{args:[-n,0],checker:s}],[["ArrowRight","mac+ArrowRight"],e._translateEmpty,{args:[i,0],checker:s}],[["ctrl+ArrowRight","mac+shift+ArrowRight"],e._translateEmpty,{args:[n,0],checker:s}],[["ArrowUp","mac+ArrowUp"],e._translateEmpty,{args:[0,-i],checker:s}],[["ctrl+ArrowUp","mac+shift+ArrowUp"],e._translateEmpty,{args:[0,-n],checker:s}],[["ArrowDown","mac+ArrowDown"],e._translateEmpty,{args:[0,i],checker:s}],[["ctrl+ArrowDown","mac+shift+ArrowDown"],e._translateEmpty,{args:[0,n],checker:s}]]))}static initialize(e,s){lt.initialize(e,s);const i=getComputedStyle(document.documentElement);this._internalPadding=parseFloat(i.getPropertyValue("--freetext-padding"))}static updateDefaultParams(e,s){switch(e){case Y.FREETEXT_SIZE:ot._defaultFontSize=s;break;case Y.FREETEXT_COLOR:ot._defaultColor=s;break}}updateParams(e,s){switch(e){case Y.FREETEXT_SIZE:m(this,Ct,Cp).call(this,s);break;case Y.FREETEXT_COLOR:m(this,Ct,Tp).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Y.FREETEXT_SIZE,ot._defaultFontSize],[Y.FREETEXT_COLOR,ot._defaultColor||lt._defaultLineColor]]}get propertiesToUpdate(){return[[Y.FREETEXT_SIZE,r(this,Ce)],[Y.FREETEXT_COLOR,r(this,Ve)]]}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new dc(this)),[["colorPicker",this._colorPicker]]}get colorType(){return Y.FREETEXT_COLOR}get colorValue(){return r(this,Ve)}_translateEmpty(e,s){this._uiManager.translateSelectedEditors(e,s,!0)}getInitialTranslation(){const e=this.parentScale;return[-ot._internalPadding*e,-(ot._internalPadding+r(this,Ce))*e]}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(this.isAttachedToDOM||this.parent.add(this)))}enableEditMode(){if(!super.enableEditMode())return!1;this.overlayDiv.classList.remove("enabled"),this.editorDiv.contentEditable=!0,this._isDraggable=!1,this.div.removeAttribute("aria-activedescendant"),f(this,gr,new AbortController);const e=this._uiManager.combinedSignal(r(this,gr));return this.editorDiv.addEventListener("keydown",this.editorDivKeydown.bind(this),{signal:e}),this.editorDiv.addEventListener("focus",this.editorDivFocus.bind(this),{signal:e}),this.editorDiv.addEventListener("blur",this.editorDivBlur.bind(this),{signal:e}),this.editorDiv.addEventListener("input",this.editorDivInput.bind(this),{signal:e}),this.editorDiv.addEventListener("paste",this.editorDivPaste.bind(this),{signal:e}),!0}disableEditMode(){var e;return super.disableEditMode()?(this.overlayDiv.classList.add("enabled"),this.editorDiv.contentEditable=!1,this.div.setAttribute("aria-activedescendant",r(this,Kl)),this._isDraggable=!0,(e=r(this,gr))==null||e.abort(),f(this,gr,null),this.div.focus({preventScroll:!0}),this.isEditing=!1,this.parent.div.classList.add("freetextEditing"),!0):!1}focusin(e){this._focusEventsAllowed&&(super.focusin(e),e.target!==this.editorDiv&&this.editorDiv.focus())}onceAdded(e){var s;this.width||(this.enableEditMode(),e&&this.editorDiv.focus(),(s=this._initialOptions)!=null&&s.isCentered&&this.center(),this._initialOptions=null)}isEmpty(){return!this.editorDiv||this.editorDiv.innerText.trim()===""}remove(){this.isEditing=!1,this.parent&&(this.parent.setEditingState(!0),this.parent.div.classList.add("freetextEditing")),super.remove()}commit(){if(!this.isInEditMode())return;super.commit(),this.disableEditMode();const e=r(this,_e),s=f(this,_e,m(this,Ct,xp).call(this).trimEnd());if(e===s)return;const i=n=>{if(f(this,_e,n),!n){this.remove();return}m(this,Ct,Wh).call(this),this._uiManager.rebuild(this),m(this,Ct,Gh).call(this)};this.addCommands({cmd:()=>{i(s)},undo:()=>{i(e)},mustExec:!1}),m(this,Ct,Gh).call(this)}shouldGetKeyboardEvents(){return this.isInEditMode()}enterInEditMode(){this.enableEditMode(),this.editorDiv.focus()}keydown(e){e.target===this.div&&e.key==="Enter"&&(this.enterInEditMode(),e.preventDefault())}editorDivKeydown(e){ot._keyboardManager.exec(this,e)}editorDivFocus(e){this.isEditing=!0}editorDivBlur(e){this.isEditing=!1}editorDivInput(e){this.parent.div.classList.toggle("freetextEditing",this.isEmpty())}disableEditing(){this.editorDiv.setAttribute("role","comment"),this.editorDiv.removeAttribute("aria-multiline")}enableEditing(){this.editorDiv.setAttribute("role","textbox"),this.editorDiv.setAttribute("aria-multiline",!0)}get canChangeContent(){return!0}render(){if(this.div)return this.div;let e,s;(this._isCopy||this.annotationElementId)&&(e=this.x,s=this.y),super.render(),this.editorDiv=document.createElement("div"),this.editorDiv.className="internal",this.editorDiv.setAttribute("id",r(this,Kl)),this.editorDiv.setAttribute("data-l10n-id","pdfjs-free-text2"),this.editorDiv.setAttribute("data-l10n-attrs","default-content"),this.enableEditing(),this.editorDiv.contentEditable=!0;const{style:i}=this.editorDiv;if(i.fontSize=`calc(${r(this,Ce)}px * var(--total-scale-factor))`,i.color=r(this,Ve),this.div.append(this.editorDiv),this.overlayDiv=document.createElement("div"),this.overlayDiv.classList.add("overlay","enabled"),this.div.append(this.overlayDiv),this._isCopy||this.annotationElementId){const[n,a]=this.parentDimensions;if(this.annotationElementId){const{position:o}=this._initialData;let[l,h]=this.getInitialTranslation();[l,h]=this.pageTranslationToScreen(l,h);const[c,u]=this.pageDimensions,[p,y]=this.pageTranslation;let A,b;switch(this.rotation){case 0:A=e+(o[0]-p)/c,b=s+this.height-(o[1]-y)/u;break;case 90:A=e+(o[0]-p)/c,b=s-(o[1]-y)/u,[l,h]=[h,-l];break;case 180:A=e-this.width+(o[0]-p)/c,b=s-(o[1]-y)/u,[l,h]=[-l,-h];break;case 270:A=e+(o[0]-p-this.height*u)/c,b=s+(o[1]-y-this.width*c)/u,[l,h]=[-h,l];break}this.setAt(A*n,b*a,l,h)}else this._moveAfterPaste(e,s);m(this,Ct,Wh).call(this),this._isDraggable=!0,this.editorDiv.contentEditable=!1}else this._isDraggable=!1,this.editorDiv.contentEditable=!0;return this.div}editorDivPaste(e){var A,b,w;const s=e.clipboardData||window.clipboardData,{types:i}=s;if(i.length===1&&i[0]==="text/plain")return;e.preventDefault();const n=m(A=ot,_i,Xd).call(A,s.getData("text")||"").replaceAll(Ch,`
`);if(!n)return;const a=window.getSelection();if(!a.rangeCount)return;this.editorDiv.normalize(),a.deleteFromDocument();const o=a.getRangeAt(0);if(!n.includes(`
`)){o.insertNode(document.createTextNode(n)),this.editorDiv.normalize(),a.collapseToStart();return}const{startContainer:l,startOffset:h}=o,c=[],u=[];if(l.nodeType===Node.TEXT_NODE){const v=l.parentElement;if(u.push(l.nodeValue.slice(h).replaceAll(Ch,"")),v!==this.editorDiv){let E=c;for(const S of this.editorDiv.childNodes){if(S===v){E=u;continue}E.push(m(b=ot,_i,jh).call(b,S))}}c.push(l.nodeValue.slice(0,h).replaceAll(Ch,""))}else if(l===this.editorDiv){let v=c,E=0;for(const S of this.editorDiv.childNodes)E++===h&&(v=u),v.push(m(w=ot,_i,jh).call(w,S))}f(this,_e,`${c.join(`
`)}${n}${u.join(`
`)}`),m(this,Ct,Wh).call(this);const p=new Range;let y=Math.sumPrecise(c.map(v=>v.length));for(const{firstChild:v}of this.editorDiv.childNodes)if(v.nodeType===Node.TEXT_NODE){const E=v.nodeValue.length;if(y<=E){p.setStart(v,y),p.setEnd(v,y);break}y-=E}a.removeAllRanges(),a.addRange(p)}get contentDiv(){return this.editorDiv}static async deserialize(e,s,i){var o;let n=null;if(e instanceof wp){const{data:{defaultAppearanceData:{fontSize:l,fontColor:h},rect:c,rotation:u,id:p,popupRef:y,contentsObj:A},textContent:b,textPosition:w,parent:{page:{pageNumber:v}}}=e;if(!b||b.length===0)return null;n=e={annotationType:z.FREETEXT,color:Array.from(h),fontSize:l,value:b.join(`
`),position:w,pageIndex:v-1,rect:c.slice(0),rotation:u,annotationElementId:p,id:p,deleted:!1,popupRef:y,comment:(A==null?void 0:A.str)||null}}const a=await super.deserialize(e,s,i);return f(a,Ce,e.fontSize),f(a,Ve,H.makeHexColor(...e.color)),f(a,_e,m(o=ot,_i,Xd).call(o,e.value)),a._initialData=n,e.comment&&a.setCommentData(e.comment),a}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const s=ot._internalPadding*this.parentScale,i=this.getRect(s,s),n=lt._colorManager.convert(this.isAttachedToDOM?getComputedStyle(this.editorDiv).color:r(this,Ve)),a={annotationType:z.FREETEXT,color:n,fontSize:r(this,Ce),value:m(this,Ct,Lp).call(this),pageIndex:this.pageIndex,rect:i,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(a),e?(a.isCopy=!0,a):this.annotationElementId&&!m(this,Ct,Ip).call(this,a)?null:(a.id=this.annotationElementId,a)}renderAnnotationElement(e){const s=super.renderAnnotationElement(e),{style:i}=s;i.fontSize=`calc(${r(this,Ce)}px * var(--total-scale-factor))`,i.color=r(this,Ve),s.replaceChildren();for(const o of r(this,_e).split(`
`)){const l=document.createElement("div");l.append(o?document.createTextNode(o):document.createElement("br")),s.append(l)}const n=ot._internalPadding*this.parentScale,a={rect:this.getRect(n,n)};return a.popup=this.hasEditedComment?this.comment:{text:r(this,_e)},e.updateEdited(a),s}resetAnnotationElement(e){super.resetAnnotationElement(e),e.resetEdited()}};Ve=new WeakMap,_e=new WeakMap,Kl=new WeakMap,gr=new WeakMap,Ce=new WeakMap,Ct=new WeakSet,Cp=function(e){const s=n=>{this.editorDiv.style.fontSize=`calc(${n}px * var(--total-scale-factor))`,this.translate(0,-(n-r(this,Ce))*this.parentScale),f(this,Ce,n),m(this,Ct,Gh).call(this)},i=r(this,Ce);this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Y.FREETEXT_SIZE,overwriteIfSameType:!0,keepUndo:!0})},Tp=function(e){const s=n=>{var a;f(this,Ve,this.editorDiv.style.color=n),(a=this._colorPicker)==null||a.update(n)},i=r(this,Ve);this.addCommands({cmd:s.bind(this,e),undo:s.bind(this,i),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Y.FREETEXT_COLOR,overwriteIfSameType:!0,keepUndo:!0})},xp=function(){var i;const e=[];this.editorDiv.normalize();let s=null;for(const n of this.editorDiv.childNodes)(s==null?void 0:s.nodeType)===Node.TEXT_NODE&&n.nodeName==="BR"||(e.push(m(i=ot,_i,jh).call(i,n)),s=n);return e.join(`
`)},Gh=function(){const[e,s]=this.parentDimensions;let i;if(this.isAttachedToDOM)i=this.div.getBoundingClientRect();else{const{currentLayer:n,div:a}=this,o=a.style.display,l=a.classList.contains("hidden");a.classList.remove("hidden"),a.style.display="hidden",n.div.append(this.div),i=a.getBoundingClientRect(),a.remove(),a.style.display=o,a.classList.toggle("hidden",l)}this.rotation%180===this.parentRotation%180?(this.width=i.width/e,this.height=i.height/s):(this.width=i.height/e,this.height=i.width/s),this.fixAndSetPosition()},_i=new WeakSet,jh=function(e){return(e.nodeType===Node.TEXT_NODE?e.nodeValue:e.innerText).replaceAll(Ch,"")},Wh=function(){if(this.editorDiv.replaceChildren(),!!r(this,_e))for(const e of r(this,_e).split(`
`)){const s=document.createElement("div");s.append(e?document.createTextNode(e):document.createElement("br")),this.editorDiv.append(s)}},Lp=function(){return r(this,_e).replaceAll(" "," ")},Xd=function(e){return e.replaceAll(" "," ")},Ip=function(e){const{value:s,fontSize:i,color:n,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||e.value!==s||e.fontSize!==i||e.color.some((o,l)=>o!==n[l])||e.pageIndex!==a},g(ot,_i),L(ot,"_freeTextDefaultContent",""),L(ot,"_internalPadding",0),L(ot,"_defaultColor",null),L(ot,"_defaultFontSize",10),L(ot,"_type","freetext"),L(ot,"_editorType",z.FREETEXT);let qd=ot;class N{toSVGPath(){at("Abstract method `toSVGPath` must be implemented.")}get box(){at("Abstract getter `box` must be implemented.")}serialize(t,e){at("Abstract method `serialize` must be implemented.")}static _rescale(t,e,s,i,n,a){a||(a=new Float32Array(t.length));for(let o=0,l=t.length;o<l;o+=2)a[o]=e+t[o]*i,a[o+1]=s+t[o+1]*n;return a}static _rescaleAndSwap(t,e,s,i,n,a){a||(a=new Float32Array(t.length));for(let o=0,l=t.length;o<l;o+=2)a[o]=e+t[o+1]*i,a[o+1]=s+t[o]*n;return a}static _translate(t,e,s,i){i||(i=new Float32Array(t.length));for(let n=0,a=t.length;n<a;n+=2)i[n]=e+t[n],i[n+1]=s+t[n+1];return i}static svgRound(t){return Math.round(t*1e4)}static _normalizePoint(t,e,s,i,n){switch(n){case 90:return[1-e/s,t/i];case 180:return[1-t/s,1-e/i];case 270:return[e/s,1-t/i];default:return[t/s,e/i]}}static _normalizePagePoint(t,e,s){switch(s){case 90:return[1-e,t];case 180:return[1-t,1-e];case 270:return[e,1-t];default:return[t,e]}}static createBezierPoints(t,e,s,i,n,a){return[(t+5*s)/6,(e+5*i)/6,(5*s+n)/6,(5*i+a)/6,(s+n)/2,(i+a)/2]}}L(N,"PRECISION",1e-4);var Te,is,ja,Wa,Ls,W,mr,yr,Jl,Ql,qa,Xa,an,Zl,Pc,Rc,Pt,Io,Pp,Rp,kp,Dp,Mp,Np;const Vs=class Vs{constructor({x:t,y:e},s,i,n,a,o=0){g(this,Pt);g(this,Te);g(this,is,[]);g(this,ja);g(this,Wa);g(this,Ls,[]);g(this,W,new Float32Array(18));g(this,mr);g(this,yr);g(this,Jl);g(this,Ql);g(this,qa);g(this,Xa);g(this,an,[]);f(this,Te,s),f(this,Xa,n*i),f(this,Wa,a),r(this,W).set([NaN,NaN,NaN,NaN,t,e],6),f(this,ja,o),f(this,Ql,r(Vs,Zl)*i),f(this,Jl,r(Vs,Rc)*i),f(this,qa,i),r(this,an).push(t,e)}isEmpty(){return isNaN(r(this,W)[8])}add({x:t,y:e}){var P;f(this,mr,t),f(this,yr,e);const[s,i,n,a]=r(this,Te);let[o,l,h,c]=r(this,W).subarray(8,12);const u=t-h,p=e-c,y=Math.hypot(u,p);if(y<r(this,Jl))return!1;const A=y-r(this,Ql),b=A/y,w=b*u,v=b*p;let E=o,S=l;o=h,l=c,h+=w,c+=v,(P=r(this,an))==null||P.push(t,e);const _=-v/A,C=w/A,T=_*r(this,Xa),x=C*r(this,Xa);return r(this,W).set(r(this,W).subarray(2,8),0),r(this,W).set([h+T,c+x],4),r(this,W).set(r(this,W).subarray(14,18),12),r(this,W).set([h-T,c-x],16),isNaN(r(this,W)[6])?(r(this,Ls).length===0&&(r(this,W).set([o+T,l+x],2),r(this,Ls).push(NaN,NaN,NaN,NaN,(o+T-s)/n,(l+x-i)/a),r(this,W).set([o-T,l-x],14),r(this,is).push(NaN,NaN,NaN,NaN,(o-T-s)/n,(l-x-i)/a)),r(this,W).set([E,S,o,l,h,c],6),!this.isEmpty()):(r(this,W).set([E,S,o,l,h,c],6),Math.abs(Math.atan2(S-l,E-o)-Math.atan2(v,w))<Math.PI/2?([o,l,h,c]=r(this,W).subarray(2,6),r(this,Ls).push(NaN,NaN,NaN,NaN,((o+h)/2-s)/n,((l+c)/2-i)/a),[o,l,E,S]=r(this,W).subarray(14,18),r(this,is).push(NaN,NaN,NaN,NaN,((E+o)/2-s)/n,((S+l)/2-i)/a),!0):([E,S,o,l,h,c]=r(this,W).subarray(0,6),r(this,Ls).push(((E+5*o)/6-s)/n,((S+5*l)/6-i)/a,((5*o+h)/6-s)/n,((5*l+c)/6-i)/a,((o+h)/2-s)/n,((l+c)/2-i)/a),[h,c,o,l,E,S]=r(this,W).subarray(12,18),r(this,is).push(((E+5*o)/6-s)/n,((S+5*l)/6-i)/a,((5*o+h)/6-s)/n,((5*l+c)/6-i)/a,((o+h)/2-s)/n,((l+c)/2-i)/a),!0))}toSVGPath(){if(this.isEmpty())return"";const t=r(this,Ls),e=r(this,is);if(isNaN(r(this,W)[6])&&!this.isEmpty())return m(this,Pt,Pp).call(this);const s=[];s.push(`M${t[4]} ${t[5]}`);for(let i=6;i<t.length;i+=6)isNaN(t[i])?s.push(`L${t[i+4]} ${t[i+5]}`):s.push(`C${t[i]} ${t[i+1]} ${t[i+2]} ${t[i+3]} ${t[i+4]} ${t[i+5]}`);m(this,Pt,kp).call(this,s);for(let i=e.length-6;i>=6;i-=6)isNaN(e[i])?s.push(`L${e[i+4]} ${e[i+5]}`):s.push(`C${e[i]} ${e[i+1]} ${e[i+2]} ${e[i+3]} ${e[i+4]} ${e[i+5]}`);return m(this,Pt,Rp).call(this,s),s.join(" ")}newFreeDrawOutline(t,e,s,i,n,a){return new Fp(t,e,s,i,n,a)}getOutlines(){var u;const t=r(this,Ls),e=r(this,is),s=r(this,W),[i,n,a,o]=r(this,Te),l=new Float32Array((((u=r(this,an))==null?void 0:u.length)??0)+2);for(let p=0,y=l.length-2;p<y;p+=2)l[p]=(r(this,an)[p]-i)/a,l[p+1]=(r(this,an)[p+1]-n)/o;if(l[l.length-2]=(r(this,mr)-i)/a,l[l.length-1]=(r(this,yr)-n)/o,isNaN(s[6])&&!this.isEmpty())return m(this,Pt,Dp).call(this,l);const h=new Float32Array(r(this,Ls).length+24+r(this,is).length);let c=t.length;for(let p=0;p<c;p+=2){if(isNaN(t[p])){h[p]=h[p+1]=NaN;continue}h[p]=t[p],h[p+1]=t[p+1]}c=m(this,Pt,Np).call(this,h,c);for(let p=e.length-6;p>=6;p-=6)for(let y=0;y<6;y+=2){if(isNaN(e[p+y])){h[c]=h[c+1]=NaN,c+=2;continue}h[c]=e[p+y],h[c+1]=e[p+y+1],c+=2}return m(this,Pt,Mp).call(this,h,c),this.newFreeDrawOutline(h,l,r(this,Te),r(this,qa),r(this,ja),r(this,Wa))}};Te=new WeakMap,is=new WeakMap,ja=new WeakMap,Wa=new WeakMap,Ls=new WeakMap,W=new WeakMap,mr=new WeakMap,yr=new WeakMap,Jl=new WeakMap,Ql=new WeakMap,qa=new WeakMap,Xa=new WeakMap,an=new WeakMap,Zl=new WeakMap,Pc=new WeakMap,Rc=new WeakMap,Pt=new WeakSet,Io=function(){const t=r(this,W).subarray(4,6),e=r(this,W).subarray(16,18),[s,i,n,a]=r(this,Te);return[(r(this,mr)+(t[0]-e[0])/2-s)/n,(r(this,yr)+(t[1]-e[1])/2-i)/a,(r(this,mr)+(e[0]-t[0])/2-s)/n,(r(this,yr)+(e[1]-t[1])/2-i)/a]},Pp=function(){const[t,e,s,i]=r(this,Te),[n,a,o,l]=m(this,Pt,Io).call(this);return`M${(r(this,W)[2]-t)/s} ${(r(this,W)[3]-e)/i} L${(r(this,W)[4]-t)/s} ${(r(this,W)[5]-e)/i} L${n} ${a} L${o} ${l} L${(r(this,W)[16]-t)/s} ${(r(this,W)[17]-e)/i} L${(r(this,W)[14]-t)/s} ${(r(this,W)[15]-e)/i} Z`},Rp=function(t){const e=r(this,is);t.push(`L${e[4]} ${e[5]} Z`)},kp=function(t){const[e,s,i,n]=r(this,Te),a=r(this,W).subarray(4,6),o=r(this,W).subarray(16,18),[l,h,c,u]=m(this,Pt,Io).call(this);t.push(`L${(a[0]-e)/i} ${(a[1]-s)/n} L${l} ${h} L${c} ${u} L${(o[0]-e)/i} ${(o[1]-s)/n}`)},Dp=function(t){const e=r(this,W),[s,i,n,a]=r(this,Te),[o,l,h,c]=m(this,Pt,Io).call(this),u=new Float32Array(36);return u.set([NaN,NaN,NaN,NaN,(e[2]-s)/n,(e[3]-i)/a,NaN,NaN,NaN,NaN,(e[4]-s)/n,(e[5]-i)/a,NaN,NaN,NaN,NaN,o,l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,(e[16]-s)/n,(e[17]-i)/a,NaN,NaN,NaN,NaN,(e[14]-s)/n,(e[15]-i)/a],0),this.newFreeDrawOutline(u,t,r(this,Te),r(this,qa),r(this,ja),r(this,Wa))},Mp=function(t,e){const s=r(this,is);return t.set([NaN,NaN,NaN,NaN,s[4],s[5]],e),e+=6},Np=function(t,e){const s=r(this,W).subarray(4,6),i=r(this,W).subarray(16,18),[n,a,o,l]=r(this,Te),[h,c,u,p]=m(this,Pt,Io).call(this);return t.set([NaN,NaN,NaN,NaN,(s[0]-n)/o,(s[1]-a)/l,NaN,NaN,NaN,NaN,h,c,NaN,NaN,NaN,NaN,u,p,NaN,NaN,NaN,NaN,(i[0]-n)/o,(i[1]-a)/l],e),e+=24},g(Vs,Zl,8),g(Vs,Pc,2),g(Vs,Rc,r(Vs,Zl)+r(Vs,Pc));let fc=Vs;var Ya,br,pi,th,xe,eh,At,kc,Bp;class Fp extends N{constructor(e,s,i,n,a,o){super();g(this,kc);g(this,Ya);g(this,br,new Float32Array(4));g(this,pi);g(this,th);g(this,xe);g(this,eh);g(this,At);f(this,At,e),f(this,xe,s),f(this,Ya,i),f(this,eh,n),f(this,pi,a),f(this,th,o),this.lastPoint=[NaN,NaN],m(this,kc,Bp).call(this,o);const[l,h,c,u]=r(this,br);for(let p=0,y=e.length;p<y;p+=2)e[p]=(e[p]-l)/c,e[p+1]=(e[p+1]-h)/u;for(let p=0,y=s.length;p<y;p+=2)s[p]=(s[p]-l)/c,s[p+1]=(s[p+1]-h)/u}toSVGPath(){const e=[`M${r(this,At)[4]} ${r(this,At)[5]}`];for(let s=6,i=r(this,At).length;s<i;s+=6){if(isNaN(r(this,At)[s])){e.push(`L${r(this,At)[s+4]} ${r(this,At)[s+5]}`);continue}e.push(`C${r(this,At)[s]} ${r(this,At)[s+1]} ${r(this,At)[s+2]} ${r(this,At)[s+3]} ${r(this,At)[s+4]} ${r(this,At)[s+5]}`)}return e.push("Z"),e.join(" ")}serialize([e,s,i,n],a){const o=i-e,l=n-s;let h,c;switch(a){case 0:h=N._rescale(r(this,At),e,n,o,-l),c=N._rescale(r(this,xe),e,n,o,-l);break;case 90:h=N._rescaleAndSwap(r(this,At),e,s,o,l),c=N._rescaleAndSwap(r(this,xe),e,s,o,l);break;case 180:h=N._rescale(r(this,At),i,s,-o,l),c=N._rescale(r(this,xe),i,s,-o,l);break;case 270:h=N._rescaleAndSwap(r(this,At),i,n,-o,-l),c=N._rescaleAndSwap(r(this,xe),i,n,-o,-l);break}return{outline:Array.from(h),points:[Array.from(c)]}}get box(){return r(this,br)}newOutliner(e,s,i,n,a,o=0){return new fc(e,s,i,n,a,o)}getNewOutline(e,s){const[i,n,a,o]=r(this,br),[l,h,c,u]=r(this,Ya),p=a*c,y=o*u,A=i*c+l,b=n*u+h,w=this.newOutliner({x:r(this,xe)[0]*p+A,y:r(this,xe)[1]*y+b},r(this,Ya),r(this,eh),e,r(this,th),s??r(this,pi));for(let v=2;v<r(this,xe).length;v+=2)w.add({x:r(this,xe)[v]*p+A,y:r(this,xe)[v+1]*y+b});return w.getOutlines()}}Ya=new WeakMap,br=new WeakMap,pi=new WeakMap,th=new WeakMap,xe=new WeakMap,eh=new WeakMap,At=new WeakMap,kc=new WeakSet,Bp=function(e){const s=r(this,At);let i=s[4],n=s[5];const a=[i,n,i,n];let o=i,l=n;const h=e?Math.max:Math.min;for(let u=6,p=s.length;u<p;u+=6){const y=s[u+4],A=s[u+5];if(isNaN(s[u]))H.pointBoundingBox(y,A,a),l<A?(o=y,l=A):l===A&&(o=h(o,y));else{const b=[1/0,1/0,-1/0,-1/0];H.bezierBoundingBox(i,n,...s.slice(u,u+6),b),H.rectBoundingBox(...b,a),l<b[3]?(o=b[2],l=b[3]):l===b[3]&&(o=h(o,b[2]))}i=y,n=A}const c=r(this,br);c[0]=a[0]-r(this,pi),c[1]=a[1]-r(this,pi),c[2]=a[2]-a[0]+2*r(this,pi),c[3]=a[3]-a[1]+2*r(this,pi),this.lastPoint=[o,l]};var sh,ih,on,ns,ce,Op,qh,$p,Hp,Kd;class Yd{constructor(t,e=0,s=0,i=!0){g(this,ce);g(this,sh);g(this,ih);g(this,on,[]);g(this,ns,[]);const n=[1/0,1/0,-1/0,-1/0],a=10**-4;for(const{x:y,y:A,width:b,height:w}of t){const v=Math.floor((y-e)/a)*a,E=Math.ceil((y+b+e)/a)*a,S=Math.floor((A-e)/a)*a,_=Math.ceil((A+w+e)/a)*a,C=[v,S,_,!0],T=[E,S,_,!1];r(this,on).push(C,T),H.rectBoundingBox(v,S,E,_,n)}const o=n[2]-n[0]+2*s,l=n[3]-n[1]+2*s,h=n[0]-s,c=n[1]-s,u=r(this,on).at(i?-1:-2),p=[u[0],u[2]];for(const y of r(this,on)){const[A,b,w]=y;y[0]=(A-h)/o,y[1]=(b-c)/l,y[2]=(w-c)/l}f(this,sh,new Float32Array([h,c,o,l])),f(this,ih,p)}getOutlines(){r(this,on).sort((e,s)=>e[0]-s[0]||e[1]-s[1]||e[2]-s[2]);const t=[];for(const e of r(this,on))e[3]?(t.push(...m(this,ce,Kd).call(this,e)),m(this,ce,$p).call(this,e)):(m(this,ce,Hp).call(this,e),t.push(...m(this,ce,Kd).call(this,e)));return m(this,ce,Op).call(this,t)}}sh=new WeakMap,ih=new WeakMap,on=new WeakMap,ns=new WeakMap,ce=new WeakSet,Op=function(t){const e=[],s=new Set;for(const a of t){const[o,l,h]=a;e.push([o,l,a],[o,h,a])}e.sort((a,o)=>a[1]-o[1]||a[0]-o[0]);for(let a=0,o=e.length;a<o;a+=2){const l=e[a][2],h=e[a+1][2];l.push(h),h.push(l),s.add(l),s.add(h)}const i=[];let n;for(;s.size>0;){const a=s.values().next().value;let[o,l,h,c,u]=a;s.delete(a);let p=o,y=l;for(n=[o,h],i.push(n);;){let A;if(s.has(c))A=c;else if(s.has(u))A=u;else break;s.delete(A),[o,l,h,c,u]=A,p!==o&&(n.push(p,y,o,y===l?l:h),p=o),y=y===l?h:l}n.push(p,y)}return new ry(i,r(this,sh),r(this,ih))},qh=function(t){const e=r(this,ns);let s=0,i=e.length-1;for(;s<=i;){const n=s+i>>1,a=e[n][0];if(a===t)return n;a<t?s=n+1:i=n-1}return i+1},$p=function([,t,e]){const s=m(this,ce,qh).call(this,t);r(this,ns).splice(s,0,[t,e])},Hp=function([,t,e]){const s=m(this,ce,qh).call(this,t);for(let i=s;i<r(this,ns).length;i++){const[n,a]=r(this,ns)[i];if(n!==t)break;if(n===t&&a===e){r(this,ns).splice(i,1);return}}for(let i=s-1;i>=0;i--){const[n,a]=r(this,ns)[i];if(n!==t)break;if(n===t&&a===e){r(this,ns).splice(i,1);return}}},Kd=function(t){const[e,s,i]=t,n=[[e,s,i]],a=m(this,ce,qh).call(this,i);for(let o=0;o<a;o++){const[l,h]=r(this,ns)[o];for(let c=0,u=n.length;c<u;c++){const[,p,y]=n[c];if(!(h<=p||y<=l)){if(p>=l){if(y>h)n[c][1]=h;else{if(u===1)return[];n.splice(c,1),c--,u--}continue}n[c][2]=l,y>h&&n.push([e,h,y])}}}return n};var nh,Ka;class ry extends N{constructor(e,s,i){super();g(this,nh);g(this,Ka);f(this,Ka,e),f(this,nh,s),this.lastPoint=i}toSVGPath(){const e=[];for(const s of r(this,Ka)){let[i,n]=s;e.push(`M${i} ${n}`);for(let a=2;a<s.length;a+=2){const o=s[a],l=s[a+1];o===i?(e.push(`V${l}`),n=l):l===n&&(e.push(`H${o}`),i=o)}e.push("Z")}return e.join(" ")}serialize([e,s,i,n],a){const o=[],l=i-e,h=n-s;for(const c of r(this,Ka)){const u=new Array(c.length);for(let p=0;p<c.length;p+=2)u[p]=e+c[p]*l,u[p+1]=n-c[p+1]*h;o.push(u)}return o}get box(){return r(this,nh)}get classNamesForOutlining(){return["highlightOutline"]}}nh=new WeakMap,Ka=new WeakMap;class Jd extends fc{newFreeDrawOutline(t,e,s,i,n,a){return new ay(t,e,s,i,n,a)}}class ay extends Fp{newOutliner(t,e,s,i,n,a=0){return new Jd(t,e,s,i,n,a)}}var Ja,rh,gi,Ar,ah,ge,oh,lh,vr,Ge,Le,Vt,Qa,mi,Zt,Za,je,hh,G,Qd,Xh,Up,zp,Vp,Zd,xn,qe,Yr,Gp,Yh,Po,jp,Wp,qp,Xp,Yp;const tt=class tt extends lt{constructor(e){super({...e,name:"highlightEditor"});g(this,G);g(this,Ja,null);g(this,rh,0);g(this,gi);g(this,Ar,null);g(this,ah,null);g(this,ge,null);g(this,oh,null);g(this,lh,0);g(this,vr,null);g(this,Ge,null);g(this,Le,null);g(this,Vt,!1);g(this,Qa,null);g(this,mi);g(this,Zt,null);g(this,Za,"");g(this,je);g(this,hh,"");this.color=e.color||tt._defaultColor,f(this,je,e.thickness||tt._defaultThickness),f(this,mi,e.opacity||tt._defaultOpacity),f(this,gi,e.boxes||null),f(this,hh,e.methodOfCreation||""),f(this,Za,e.text||""),this._isDraggable=!1,this.defaultL10nId="pdfjs-editor-highlight-editor",e.highlightId>-1?(f(this,Vt,!0),m(this,G,Xh).call(this,e),m(this,G,xn).call(this)):r(this,gi)&&(f(this,Ja,e.anchorNode),f(this,rh,e.anchorOffset),f(this,oh,e.focusNode),f(this,lh,e.focusOffset),m(this,G,Qd).call(this),m(this,G,xn).call(this),this.rotate(this.rotation)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-highlight-added-alert")}static get _keyboardManager(){const e=tt.prototype;return q(this,"_keyboardManager",new mh([[["ArrowLeft","mac+ArrowLeft"],e._moveCaret,{args:[0]}],[["ArrowRight","mac+ArrowRight"],e._moveCaret,{args:[1]}],[["ArrowUp","mac+ArrowUp"],e._moveCaret,{args:[2]}],[["ArrowDown","mac+ArrowDown"],e._moveCaret,{args:[3]}]]))}get telemetryInitialData(){return{action:"added",type:r(this,Vt)?"free_highlight":"highlight",color:this._uiManager.getNonHCMColorName(this.color),thickness:r(this,je),methodOfCreation:r(this,hh)}}get telemetryFinalData(){return{type:"highlight",color:this._uiManager.getNonHCMColorName(this.color)}}get commentColor(){return this.color}static computeTelemetryFinalData(e){return{numberOfColors:e.get("color").size}}static initialize(e,s){var i;lt.initialize(e,s),tt._defaultColor||(tt._defaultColor=((i=s.highlightColors)==null?void 0:i.values().next().value)||"#fff066")}static updateDefaultParams(e,s){switch(e){case Y.HIGHLIGHT_COLOR:tt._defaultColor=s;break;case Y.HIGHLIGHT_THICKNESS:tt._defaultThickness=s;break}}translateInPage(e,s){}get toolbarPosition(){return r(this,Qa)}updateParams(e,s){switch(e){case Y.HIGHLIGHT_COLOR:m(this,G,Up).call(this,s);break;case Y.HIGHLIGHT_THICKNESS:m(this,G,zp).call(this,s);break}}static get defaultPropertiesToUpdate(){return[[Y.HIGHLIGHT_COLOR,tt._defaultColor],[Y.HIGHLIGHT_THICKNESS,tt._defaultThickness]]}get propertiesToUpdate(){return[[Y.HIGHLIGHT_COLOR,this.color||tt._defaultColor],[Y.HIGHLIGHT_THICKNESS,r(this,je)||tt._defaultThickness],[Y.HIGHLIGHT_FREE,r(this,Vt)]]}get toolbarButtons(){return this._uiManager.highlightColors?[["colorPicker",f(this,ah,new cc({editor:this}))]]:super.toolbarButtons}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}fixAndSetPosition(){return super.fixAndSetPosition(m(this,G,Po).call(this))}getBaseTranslation(){return[0,0]}getRect(e,s){return super.getRect(e,s,m(this,G,Po).call(this))}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),e&&this.div.focus()}remove(){m(this,G,Zd).call(this),this._reportTelemetry({action:"deleted"}),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(m(this,G,xn).call(this),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var i;let s=!1;this.parent&&!e?m(this,G,Zd).call(this):e&&(m(this,G,xn).call(this,e),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(e),this.show(this._isVisible),s&&this.select()}rotate(e){var n,a,o;const{drawLayer:s}=this.parent;let i;r(this,Vt)?(e=(e-this.rotation+360)%360,i=m(n=tt,qe,Yr).call(n,r(this,Ge).box,e)):i=m(a=tt,qe,Yr).call(a,[this.x,this.y,this.width,this.height],e),s.updateProperties(r(this,Le),{bbox:i,root:{"data-main-rotation":e}}),s.updateProperties(r(this,Zt),{bbox:m(o=tt,qe,Yr).call(o,r(this,ge).box,e),root:{"data-main-rotation":e}})}render(){if(this.div)return this.div;const e=super.render();r(this,Za)&&(e.setAttribute("aria-label",r(this,Za)),e.setAttribute("role","mark")),r(this,Vt)?e.classList.add("free"):this.div.addEventListener("keydown",m(this,G,Gp).bind(this),{signal:this._uiManager._signal});const s=f(this,vr,document.createElement("div"));e.append(s),s.setAttribute("aria-hidden","true"),s.className="internal",s.style.clipPath=r(this,Ar);const[i,n]=this.parentDimensions;return this.setDims(this.width*i,this.height*n),mf(this,r(this,vr),["pointerover","pointerleave"]),this.enableEditing(),e}pointerover(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(r(this,Zt),{rootClass:{hovered:!0}})}pointerleave(){var e;this.isSelected||(e=this.parent)==null||e.drawLayer.updateProperties(r(this,Zt),{rootClass:{hovered:!1}})}_moveCaret(e){switch(this.parent.unselect(this),e){case 0:case 2:m(this,G,Yh).call(this,!0);break;case 1:case 3:m(this,G,Yh).call(this,!1);break}}select(){var e;super.select(),r(this,Zt)&&((e=this.parent)==null||e.drawLayer.updateProperties(r(this,Zt),{rootClass:{hovered:!1,selected:!0}}))}unselect(){var e;super.unselect(),r(this,Zt)&&((e=this.parent)==null||e.drawLayer.updateProperties(r(this,Zt),{rootClass:{selected:!1}}),r(this,Vt)||m(this,G,Yh).call(this,!1))}get _mustFixPosition(){return!r(this,Vt)}show(e=this._isVisible){super.show(e),this.parent&&(this.parent.drawLayer.updateProperties(r(this,Le),{rootClass:{hidden:!e}}),this.parent.drawLayer.updateProperties(r(this,Zt),{rootClass:{hidden:!e}}))}static startHighlighting(e,s,{target:i,x:n,y:a}){const{x:o,y:l,width:h,height:c}=i.getBoundingClientRect(),u=new AbortController,p=e.combinedSignal(u),y=A=>{u.abort(),m(this,qe,Xp).call(this,e,A)};window.addEventListener("blur",y,{signal:p}),window.addEventListener("pointerup",y,{signal:p}),window.addEventListener("pointerdown",Et,{capture:!0,passive:!1,signal:p}),window.addEventListener("contextmenu",Ye,{signal:p}),i.addEventListener("pointermove",m(this,qe,qp).bind(this,e),{signal:p}),this._freeHighlight=new Jd({x:n,y:a},[o,l,h,c],e.scale,this._defaultThickness/2,s,.001),{id:this._freeHighlightId,clipPathId:this._freeHighlightClipId}=e.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:this._defaultColor,"fill-opacity":this._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:this._freeHighlight.toSVGPath()}},!0,!0)}static async deserialize(e,s,i){var b,w,v,E;let n=null;if(e instanceof Ep){const{data:{quadPoints:S,rect:_,rotation:C,id:T,color:x,opacity:I,popupRef:P,contentsObj:D},parent:{page:{pageNumber:k}}}=e;n=e={annotationType:z.HIGHLIGHT,color:Array.from(x),opacity:I,quadPoints:S,boxes:null,pageIndex:k-1,rect:_.slice(0),rotation:C,annotationElementId:T,id:T,deleted:!1,popupRef:P,comment:(D==null?void 0:D.str)||null}}else if(e instanceof Cu){const{data:{inkLists:S,rect:_,rotation:C,id:T,color:x,borderStyle:{rawWidth:I},popupRef:P,contentsObj:D},parent:{page:{pageNumber:k}}}=e;n=e={annotationType:z.HIGHLIGHT,color:Array.from(x),thickness:I,inkLists:S,boxes:null,pageIndex:k-1,rect:_.slice(0),rotation:C,annotationElementId:T,id:T,deleted:!1,popupRef:P,comment:(D==null?void 0:D.str)||null}}const{color:a,quadPoints:o,inkLists:l,opacity:h}=e,c=await super.deserialize(e,s,i);c.color=H.makeHexColor(...a),f(c,mi,h||1),l&&f(c,je,e.thickness),c._initialData=n,e.comment&&c.setCommentData(e.comment);const[u,p]=c.pageDimensions,[y,A]=c.pageTranslation;if(o){const S=f(c,gi,[]);for(let _=0;_<o.length;_+=8)S.push({x:(o[_]-y)/u,y:1-(o[_+1]-A)/p,width:(o[_+2]-o[_])/u,height:(o[_+1]-o[_+5])/p});m(b=c,G,Qd).call(b),m(w=c,G,xn).call(w),c.rotate(c.rotation)}else if(l){f(c,Vt,!0);const S=l[0],_={x:S[0]-y,y:p-(S[1]-A)},C=new Jd(_,[0,0,u,p],1,r(c,je)/2,!0,.001);for(let I=0,P=S.length;I<P;I+=2)_.x=S[I]-y,_.y=p-(S[I+1]-A),C.add(_);const{id:T,clipPathId:x}=s.drawLayer.draw({bbox:[0,0,1,1],root:{viewBox:"0 0 1 1",fill:c.color,"fill-opacity":c._defaultOpacity},rootClass:{highlight:!0,free:!0},path:{d:C.toSVGPath()}},!0,!0);m(v=c,G,Xh).call(v,{highlightOutlines:C.getOutlines(),highlightId:T,clipPathId:x}),m(E=c,G,xn).call(E),c.rotate(c.parentRotation)}return c}serialize(e=!1){if(this.isEmpty()||e)return null;if(this.deleted)return this.serializeDeleted();const s=this.getRect(0,0),i=lt._colorManager.convert(this._uiManager.getNonHCMColor(this.color)),n={annotationType:z.HIGHLIGHT,color:i,opacity:r(this,mi),thickness:r(this,je),quadPoints:m(this,G,jp).call(this),outlines:m(this,G,Wp).call(this,s),pageIndex:this.pageIndex,rect:s,rotation:m(this,G,Po).call(this),structTreeParentId:this._structTreeParentId};return this.addComment(n),this.annotationElementId&&!m(this,G,Yp).call(this,n)?null:(n.id=this.annotationElementId,n)}renderAnnotationElement(e){const s={rect:this.getRect(0,0)};return this.hasEditedComment&&(s.popup=this.comment),e.updateEdited(s),null}static canCreateNewEmptyEditor(){return!1}};Ja=new WeakMap,rh=new WeakMap,gi=new WeakMap,Ar=new WeakMap,ah=new WeakMap,ge=new WeakMap,oh=new WeakMap,lh=new WeakMap,vr=new WeakMap,Ge=new WeakMap,Le=new WeakMap,Vt=new WeakMap,Qa=new WeakMap,mi=new WeakMap,Zt=new WeakMap,Za=new WeakMap,je=new WeakMap,hh=new WeakMap,G=new WeakSet,Qd=function(){const e=new Yd(r(this,gi),.001);f(this,Ge,e.getOutlines()),[this.x,this.y,this.width,this.height]=r(this,Ge).box;const s=new Yd(r(this,gi),.0025,.001,this._uiManager.direction==="ltr");f(this,ge,s.getOutlines());const{lastPoint:i}=r(this,ge);f(this,Qa,[(i[0]-this.x)/this.width,(i[1]-this.y)/this.height])},Xh=function({highlightOutlines:e,highlightId:s,clipPathId:i}){var u,p;if(f(this,Ge,e),f(this,ge,e.getNewOutline(r(this,je)/2+1.5,.0025)),s>=0)f(this,Le,s),f(this,Ar,i),this.parent.drawLayer.finalizeDraw(s,{bbox:e.box,path:{d:e.toSVGPath()}}),f(this,Zt,this.parent.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:!0},bbox:r(this,ge).box,path:{d:r(this,ge).toSVGPath()}},!0));else if(this.parent){const y=this.parent.viewport.rotation;this.parent.drawLayer.updateProperties(r(this,Le),{bbox:m(u=tt,qe,Yr).call(u,r(this,Ge).box,(y-this.rotation+360)%360),path:{d:e.toSVGPath()}}),this.parent.drawLayer.updateProperties(r(this,Zt),{bbox:m(p=tt,qe,Yr).call(p,r(this,ge).box,y),path:{d:r(this,ge).toSVGPath()}})}const[a,o,l,h]=e.box;switch(this.rotation){case 0:this.x=a,this.y=o,this.width=l,this.height=h;break;case 90:{const[y,A]=this.parentDimensions;this.x=o,this.y=1-a,this.width=l*A/y,this.height=h*y/A;break}case 180:this.x=1-a,this.y=1-o,this.width=l,this.height=h;break;case 270:{const[y,A]=this.parentDimensions;this.x=1-o,this.y=a,this.width=l*A/y,this.height=h*y/A;break}}const{lastPoint:c}=r(this,ge);f(this,Qa,[(c[0]-a)/l,(c[1]-o)/h])},Up=function(e){const s=(a,o)=>{var l,h;this.color=a,f(this,mi,o),(l=this.parent)==null||l.drawLayer.updateProperties(r(this,Le),{root:{fill:a,"fill-opacity":o}}),(h=r(this,ah))==null||h.updateColor(a)},i=this.color,n=r(this,mi);this.addCommands({cmd:s.bind(this,e,tt._defaultOpacity),undo:s.bind(this,i,n),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Y.HIGHLIGHT_COLOR,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"color_changed",color:this._uiManager.getNonHCMColorName(e)},!0)},zp=function(e){const s=r(this,je),i=n=>{f(this,je,n),m(this,G,Vp).call(this,n)};this.addCommands({cmd:i.bind(this,e),undo:i.bind(this,s),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:Y.INK_THICKNESS,overwriteIfSameType:!0,keepUndo:!0}),this._reportTelemetry({action:"thickness_changed",thickness:e},!0)},Vp=function(e){if(!r(this,Vt))return;m(this,G,Xh).call(this,{highlightOutlines:r(this,Ge).getNewOutline(e/2)}),this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)},Zd=function(){r(this,Le)===null||!this.parent||(this.parent.drawLayer.remove(r(this,Le)),f(this,Le,null),this.parent.drawLayer.remove(r(this,Zt)),f(this,Zt,null))},xn=function(e=this.parent){r(this,Le)===null&&({id:ee(this,Le)._,clipPathId:ee(this,Ar)._}=e.drawLayer.draw({bbox:r(this,Ge).box,root:{viewBox:"0 0 1 1",fill:this.color,"fill-opacity":r(this,mi)},rootClass:{highlight:!0,free:r(this,Vt)},path:{d:r(this,Ge).toSVGPath()}},!1,!0),f(this,Zt,e.drawLayer.drawOutline({rootClass:{highlightOutline:!0,free:r(this,Vt)},bbox:r(this,ge).box,path:{d:r(this,ge).toSVGPath()}},r(this,Vt))),r(this,vr)&&(r(this,vr).style.clipPath=r(this,Ar)))},qe=new WeakSet,Yr=function([e,s,i,n],a){switch(a){case 90:return[1-s-n,e,n,i];case 180:return[1-e-i,1-s-n,i,n];case 270:return[s,1-e-i,n,i]}return[e,s,i,n]},Gp=function(e){tt._keyboardManager.exec(this,e)},Yh=function(e){if(!r(this,Ja))return;const s=window.getSelection();e?s.setPosition(r(this,Ja),r(this,rh)):s.setPosition(r(this,oh),r(this,lh))},Po=function(){return r(this,Vt)?this.rotation:0},jp=function(){if(r(this,Vt))return null;const[e,s]=this.pageDimensions,[i,n]=this.pageTranslation,a=r(this,gi),o=new Float32Array(a.length*8);let l=0;for(const{x:h,y:c,width:u,height:p}of a){const y=h*e+i,A=(1-c)*s+n;o[l]=o[l+4]=y,o[l+1]=o[l+3]=A,o[l+2]=o[l+6]=y+u*e,o[l+5]=o[l+7]=A-p*s,l+=8}return o},Wp=function(e){return r(this,Ge).serialize(e,m(this,G,Po).call(this))},qp=function(e,s){this._freeHighlight.add(s)&&e.drawLayer.updateProperties(this._freeHighlightId,{path:{d:this._freeHighlight.toSVGPath()}})},Xp=function(e,s){this._freeHighlight.isEmpty()?e.drawLayer.remove(this._freeHighlightId):e.createAndAddNewEditor(s,!1,{highlightId:this._freeHighlightId,highlightOutlines:this._freeHighlight.getOutlines(),clipPathId:this._freeHighlightClipId,methodOfCreation:"main_toolbar"}),this._freeHighlightId=-1,this._freeHighlight=null,this._freeHighlightClipId=""},Yp=function(e){const{color:s}=this._initialData;return this.hasEditedComment||e.color.some((i,n)=>i!==s[n])},g(tt,qe),L(tt,"_defaultColor",null),L(tt,"_defaultOpacity",1),L(tt,"_defaultThickness",12),L(tt,"_type","highlight"),L(tt,"_editorType",z.HIGHLIGHT),L(tt,"_freeHighlightId",-1),L(tt,"_freeHighlight",null),L(tt,"_freeHighlightClipId","");let pc=tt;var wr;class Kp{constructor(){g(this,wr,Object.create(null))}updateProperty(t,e){this[t]=e,this.updateSVGProperty(t,e)}updateProperties(t){if(t)for(const[e,s]of Object.entries(t))e.startsWith("_")||this.updateProperty(e,s)}updateSVGProperty(t,e){r(this,wr)[t]=e}toSVGProperties(){const t=r(this,wr);return f(this,wr,Object.create(null)),{root:t}}reset(){f(this,wr,Object.create(null))}updateAll(t=this){this.updateProperties(t)}clone(){at("Not implemented")}}wr=new WeakMap;var Ie,to,Mt,Sr,Er,ln,hn,cn,_r,K,tu,eu,su,Ro,Jp,Kh,ko,Kr;const F=class F extends lt{constructor(e){super(e);g(this,K);g(this,Ie,null);g(this,to);L(this,"_colorPicker",null);L(this,"_drawId",null);f(this,to,e.mustBeCommitted||!1),this._addOutlines(e)}_addOutlines(e){e.drawOutlines&&(m(this,K,tu).call(this,e),m(this,K,Ro).call(this))}static _mergeSVGProperties(e,s){const i=new Set(Object.keys(e));for(const[n,a]of Object.entries(s))i.has(n)?Object.assign(e[n],a):e[n]=a;return e}static getDefaultDrawingOptions(e){at("Not implemented")}static get typesMap(){at("Not implemented")}static get isDrawer(){return!0}static get supportMultipleDrawings(){return!1}static updateDefaultParams(e,s){const i=this.typesMap.get(e);i&&this._defaultDrawingOptions.updateProperty(i,s),this._currentParent&&(r(F,Mt).updateProperty(i,s),this._currentParent.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}updateParams(e,s){const i=this.constructor.typesMap.get(e);i&&this._updateProperty(e,i,s)}static get defaultPropertiesToUpdate(){const e=[],s=this._defaultDrawingOptions;for(const[i,n]of this.typesMap)e.push([i,s[n]]);return e}get propertiesToUpdate(){const e=[],{_drawingOptions:s}=this;for(const[i,n]of this.constructor.typesMap)e.push([i,s[n]]);return e}_updateProperty(e,s,i){const n=this._drawingOptions,a=n[s],o=l=>{var c,u;n.updateProperty(s,l);const h=r(this,Ie).updateProperty(s,l);h&&m(this,K,ko).call(this,h),(c=this.parent)==null||c.drawLayer.updateProperties(this._drawId,n.toSVGProperties()),e===this.colorType&&((u=this._colorPicker)==null||u.update(l))};this.addCommands({cmd:o.bind(this,i),undo:o.bind(this,a),post:this._uiManager.updateUI.bind(this._uiManager,this),mustExec:!0,type:e,overwriteIfSameType:!0,keepUndo:!0})}_onResizing(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(r(this,Ie).getPathResizingSVGProperties(m(this,K,Kh).call(this)),{bbox:m(this,K,Kr).call(this)}))}_onResized(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(r(this,Ie).getPathResizedSVGProperties(m(this,K,Kh).call(this)),{bbox:m(this,K,Kr).call(this)}))}_onTranslating(e,s){var i;(i=this.parent)==null||i.drawLayer.updateProperties(this._drawId,{bbox:m(this,K,Kr).call(this)})}_onTranslated(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties(r(this,Ie).getPathTranslatedSVGProperties(m(this,K,Kh).call(this),this.parentDimensions),{bbox:m(this,K,Kr).call(this)}))}_onStartDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!0}})}_onStopDragging(){var e;(e=this.parent)==null||e.drawLayer.updateProperties(this._drawId,{rootClass:{moving:!1}})}commit(){super.commit(),this.disableEditMode(),this.disableEditing()}disableEditing(){super.disableEditing(),this.div.classList.toggle("disabled",!0)}enableEditing(){super.enableEditing(),this.div.classList.toggle("disabled",!1)}getBaseTranslation(){return[0,0]}get isResizable(){return!0}onceAdded(e){this.annotationElementId||this.parent.addUndoableEditor(this),this._isDraggable=!0,r(this,to)&&(f(this,to,!1),this.commit(),this.parent.setSelected(this),e&&this.isOnScreen&&this.div.focus())}remove(){m(this,K,su).call(this),super.remove()}rebuild(){this.parent&&(super.rebuild(),this.div!==null&&(m(this,K,Ro).call(this),m(this,K,ko).call(this,r(this,Ie).box),this.isAttachedToDOM||this.parent.add(this)))}setParent(e){var i;let s=!1;this.parent&&!e?(this._uiManager.removeShouldRescale(this),m(this,K,su).call(this)):e&&(this._uiManager.addShouldRescale(this),m(this,K,Ro).call(this,e),s=!this.parent&&((i=this.div)==null?void 0:i.classList.contains("selectedEditor"))),super.setParent(e),s&&this.select()}rotate(){this.parent&&this.parent.drawLayer.updateProperties(this._drawId,F._mergeSVGProperties({bbox:m(this,K,Kr).call(this)},r(this,Ie).updateRotation((this.parentRotation-this.rotation+360)%360)))}onScaleChanging(){this.parent&&m(this,K,ko).call(this,r(this,Ie).updateParentDimensions(this.parentDimensions,this.parent.scale))}static onScaleChangingWhenDrawing(){}render(){if(this.div)return this.div;let e,s;this._isCopy&&(e=this.x,s=this.y);const i=super.render();i.classList.add("draw");const n=document.createElement("div");i.append(n),n.setAttribute("aria-hidden","true"),n.className="internal";const[a,o]=this.parentDimensions;return this.setDims(this.width*a,this.height*o),this._uiManager.addShouldRescale(this),this.disableEditing(),this._isCopy&&this._moveAfterPaste(e,s),i}static createDrawerInstance(e,s,i,n,a){at("Not implemented")}static startDrawing(e,s,i,n){var w;const{target:a,offsetX:o,offsetY:l,pointerId:h,pointerType:c}=n;if(r(F,hn)&&r(F,hn)!==c)return;const{viewport:{rotation:u}}=e,{width:p,height:y}=a.getBoundingClientRect(),A=f(F,Sr,new AbortController),b=e.combinedSignal(A);if(r(F,ln)||f(F,ln,h),r(F,hn)??f(F,hn,c),window.addEventListener("pointerup",v=>{var E;r(F,ln)===v.pointerId?this._endDraw(v):(E=r(F,cn))==null||E.delete(v.pointerId)},{signal:b}),window.addEventListener("pointercancel",v=>{var E;r(F,ln)===v.pointerId?this._currentParent.endDrawingSession():(E=r(F,cn))==null||E.delete(v.pointerId)},{signal:b}),window.addEventListener("pointerdown",v=>{r(F,hn)===v.pointerType&&((r(F,cn)||f(F,cn,new Set)).add(v.pointerId),r(F,Mt).isCancellable()&&(r(F,Mt).removeLastElement(),r(F,Mt).isEmpty()?this._currentParent.endDrawingSession(!0):this._endDraw(null)))},{capture:!0,passive:!1,signal:b}),window.addEventListener("contextmenu",Ye,{signal:b}),a.addEventListener("pointermove",this._drawMove.bind(this),{signal:b}),a.addEventListener("touchmove",v=>{v.timeStamp===r(F,_r)&&Et(v)},{signal:b}),e.toggleDrawing(),(w=s._editorUndoBar)==null||w.hide(),r(F,Mt)){e.drawLayer.updateProperties(this._currentDrawId,r(F,Mt).startNew(o,l,p,y,u));return}s.updateUIForDefaultProperties(this),f(F,Mt,this.createDrawerInstance(o,l,p,y,u)),f(F,Er,this.getDefaultDrawingOptions()),this._currentParent=e,{id:this._currentDrawId}=e.drawLayer.draw(this._mergeSVGProperties(r(F,Er).toSVGProperties(),r(F,Mt).defaultSVGProperties),!0,!1)}static _drawMove(e){var a;if(f(F,_r,-1),!r(F,Mt))return;const{offsetX:s,offsetY:i,pointerId:n}=e;if(r(F,ln)===n){if(((a=r(F,cn))==null?void 0:a.size)>=1){this._endDraw(e);return}this._currentParent.drawLayer.updateProperties(this._currentDrawId,r(F,Mt).add(s,i)),f(F,_r,e.timeStamp),Et(e)}}static _cleanup(e){e&&(this._currentDrawId=-1,this._currentParent=null,f(F,Mt,null),f(F,Er,null),f(F,hn,null),f(F,_r,NaN)),r(F,Sr)&&(r(F,Sr).abort(),f(F,Sr,null),f(F,ln,NaN),f(F,cn,null))}static _endDraw(e){const s=this._currentParent;if(s){if(s.toggleDrawing(!0),this._cleanup(!1),(e==null?void 0:e.target)===s.div&&s.drawLayer.updateProperties(this._currentDrawId,r(F,Mt).end(e.offsetX,e.offsetY)),this.supportMultipleDrawings){const i=r(F,Mt),n=this._currentDrawId,a=i.getLastElement();s.addCommands({cmd:()=>{s.drawLayer.updateProperties(n,i.setLastElement(a))},undo:()=>{s.drawLayer.updateProperties(n,i.removeLastElement())},mustExec:!1,type:Y.DRAW_STEP});return}this.endDrawing(!1)}}static endDrawing(e){const s=this._currentParent;if(!s)return null;if(s.toggleDrawing(!0),s.cleanUndoStack(Y.DRAW_STEP),!r(F,Mt).isEmpty()){const{pageDimensions:[i,n],scale:a}=s,o=s.createAndAddNewEditor({offsetX:0,offsetY:0},!1,{drawId:this._currentDrawId,drawOutlines:r(F,Mt).getOutlines(i*a,n*a,a,this._INNER_MARGIN),drawingOptions:r(F,Er),mustBeCommitted:!e});return this._cleanup(!0),o}return s.drawLayer.remove(this._currentDrawId),this._cleanup(!0),null}createDrawingOptions(e){}static deserializeDraw(e,s,i,n,a,o){at("Not implemented")}static async deserialize(e,s,i){var u,p;const{rawDims:{pageWidth:n,pageHeight:a,pageX:o,pageY:l}}=s.viewport,h=this.deserializeDraw(o,l,n,a,this._INNER_MARGIN,e),c=await super.deserialize(e,s,i);return c.createDrawingOptions(e),m(u=c,K,tu).call(u,{drawOutlines:h}),m(p=c,K,Ro).call(p),c.onScaleChanging(),c.rotate(),c}serializeDraw(e){const[s,i]=this.pageTranslation,[n,a]=this.pageDimensions;return r(this,Ie).serialize([s,i,n,a],e)}renderAnnotationElement(e){return e.updateEdited({rect:this.getRect(0,0)}),null}static canCreateNewEmptyEditor(){return!1}};Ie=new WeakMap,to=new WeakMap,Mt=new WeakMap,Sr=new WeakMap,Er=new WeakMap,ln=new WeakMap,hn=new WeakMap,cn=new WeakMap,_r=new WeakMap,K=new WeakSet,tu=function({drawOutlines:e,drawId:s,drawingOptions:i}){f(this,Ie,e),this._drawingOptions||(this._drawingOptions=i),this.annotationElementId||this._uiManager.a11yAlert(`pdfjs-editor-${this.editorType}-added-alert`),s>=0?(this._drawId=s,this.parent.drawLayer.finalizeDraw(s,e.defaultProperties)):this._drawId=m(this,K,eu).call(this,e,this.parent),m(this,K,ko).call(this,e.box)},eu=function(e,s){const{id:i}=s.drawLayer.draw(F._mergeSVGProperties(this._drawingOptions.toSVGProperties(),e.defaultSVGProperties),!1,!1);return i},su=function(){this._drawId===null||!this.parent||(this.parent.drawLayer.remove(this._drawId),this._drawId=null,this._drawingOptions.reset())},Ro=function(e=this.parent){if(!(this._drawId!==null&&this.parent===e)){if(this._drawId!==null){this.parent.drawLayer.updateParent(this._drawId,e.drawLayer);return}this._drawingOptions.updateAll(),this._drawId=m(this,K,eu).call(this,r(this,Ie),e)}},Jp=function([e,s,i,n]){const{parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[s,1-e,i*(o/a),n*(a/o)];case 180:return[1-e,1-s,i,n];case 270:return[1-s,e,i*(o/a),n*(a/o)];default:return[e,s,i,n]}},Kh=function(){const{x:e,y:s,width:i,height:n,parentDimensions:[a,o],rotation:l}=this;switch(l){case 90:return[1-s,e,i*(a/o),n*(o/a)];case 180:return[1-e,1-s,i,n];case 270:return[s,1-e,i*(a/o),n*(o/a)];default:return[e,s,i,n]}},ko=function(e){if([this.x,this.y,this.width,this.height]=m(this,K,Jp).call(this,e),this.div){this.fixAndSetPosition();const[s,i]=this.parentDimensions;this.setDims(this.width*s,this.height*i)}this._onResized()},Kr=function(){const{x:e,y:s,width:i,height:n,rotation:a,parentRotation:o,parentDimensions:[l,h]}=this;switch((a*4+o)/90){case 1:return[1-s-n,e,n,i];case 2:return[1-e-i,1-s-n,i,n];case 3:return[s,1-e-i,n,i];case 4:return[e,s-i*(l/h),n*(h/l),i*(l/h)];case 5:return[1-s,e,i*(l/h),n*(h/l)];case 6:return[1-e-n*(h/l),1-s,n*(h/l),i*(l/h)];case 7:return[s-i*(l/h),1-e-n*(h/l),i*(l/h),n*(h/l)];case 8:return[e-i,s-n,i,n];case 9:return[1-s,e-i,n,i];case 10:return[1-e,1-s,i,n];case 11:return[s-n,1-e,n,i];case 12:return[e-n*(h/l),s,n*(h/l),i*(l/h)];case 13:return[1-s-i*(l/h),e-n*(h/l),i*(l/h),n*(h/l)];case 14:return[1-e,1-s-i*(l/h),n*(h/l),i*(l/h)];case 15:return[s,1-e,i*(l/h),n*(h/l)];default:return[e,s,i,n]}},L(F,"_currentDrawId",-1),L(F,"_currentParent",null),g(F,Mt,null),g(F,Sr,null),g(F,Er,null),g(F,ln,NaN),g(F,hn,null),g(F,cn,null),g(F,_r,NaN),L(F,"_INNER_MARGIN",3);let gc=F;var Is,Nt,Ft,Cr,eo,ne,Gt,We,Tr,xr,Lr,so,Jh;class oy{constructor(t,e,s,i,n,a){g(this,so);g(this,Is,new Float64Array(6));g(this,Nt);g(this,Ft);g(this,Cr);g(this,eo);g(this,ne);g(this,Gt,"");g(this,We,0);g(this,Tr,new bh);g(this,xr);g(this,Lr);f(this,xr,s),f(this,Lr,i),f(this,Cr,n),f(this,eo,a),[t,e]=m(this,so,Jh).call(this,t,e);const o=f(this,Nt,[NaN,NaN,NaN,NaN,t,e]);f(this,ne,[t,e]),f(this,Ft,[{line:o,points:r(this,ne)}]),r(this,Is).set(o,0)}updateProperty(t,e){t==="stroke-width"&&f(this,eo,e)}isEmpty(){return!r(this,Ft)||r(this,Ft).length===0}isCancellable(){return r(this,ne).length<=10}add(t,e){[t,e]=m(this,so,Jh).call(this,t,e);const[s,i,n,a]=r(this,Is).subarray(2,6),o=t-n,l=e-a;return Math.hypot(r(this,xr)*o,r(this,Lr)*l)<=2?null:(r(this,ne).push(t,e),isNaN(s)?(r(this,Is).set([n,a,t,e],2),r(this,Nt).push(NaN,NaN,NaN,NaN,t,e),{path:{d:this.toSVGPath()}}):(isNaN(r(this,Is)[0])&&r(this,Nt).splice(6,6),r(this,Is).set([s,i,n,a,t,e],0),r(this,Nt).push(...N.createBezierPoints(s,i,n,a,t,e)),{path:{d:this.toSVGPath()}}))}end(t,e){const s=this.add(t,e);return s||(r(this,ne).length===2?{path:{d:this.toSVGPath()}}:null)}startNew(t,e,s,i,n){f(this,xr,s),f(this,Lr,i),f(this,Cr,n),[t,e]=m(this,so,Jh).call(this,t,e);const a=f(this,Nt,[NaN,NaN,NaN,NaN,t,e]);f(this,ne,[t,e]);const o=r(this,Ft).at(-1);return o&&(o.line=new Float32Array(o.line),o.points=new Float32Array(o.points)),r(this,Ft).push({line:a,points:r(this,ne)}),r(this,Is).set(a,0),f(this,We,0),this.toSVGPath(),null}getLastElement(){return r(this,Ft).at(-1)}setLastElement(t){return r(this,Ft)?(r(this,Ft).push(t),f(this,Nt,t.line),f(this,ne,t.points),f(this,We,0),{path:{d:this.toSVGPath()}}):r(this,Tr).setLastElement(t)}removeLastElement(){if(!r(this,Ft))return r(this,Tr).removeLastElement();r(this,Ft).pop(),f(this,Gt,"");for(let t=0,e=r(this,Ft).length;t<e;t++){const{line:s,points:i}=r(this,Ft)[t];f(this,Nt,s),f(this,ne,i),f(this,We,0),this.toSVGPath()}return{path:{d:r(this,Gt)}}}toSVGPath(){const t=N.svgRound(r(this,Nt)[4]),e=N.svgRound(r(this,Nt)[5]);if(r(this,ne).length===2)return f(this,Gt,`${r(this,Gt)} M ${t} ${e} Z`),r(this,Gt);if(r(this,ne).length<=6){const i=r(this,Gt).lastIndexOf("M");f(this,Gt,`${r(this,Gt).slice(0,i)} M ${t} ${e}`),f(this,We,6)}if(r(this,ne).length===4){const i=N.svgRound(r(this,Nt)[10]),n=N.svgRound(r(this,Nt)[11]);return f(this,Gt,`${r(this,Gt)} L ${i} ${n}`),f(this,We,12),r(this,Gt)}const s=[];r(this,We)===0&&(s.push(`M ${t} ${e}`),f(this,We,6));for(let i=r(this,We),n=r(this,Nt).length;i<n;i+=6){const[a,o,l,h,c,u]=r(this,Nt).slice(i,i+6).map(N.svgRound);s.push(`C${a} ${o} ${l} ${h} ${c} ${u}`)}return f(this,Gt,r(this,Gt)+s.join(" ")),f(this,We,r(this,Nt).length),r(this,Gt)}getOutlines(t,e,s,i){const n=r(this,Ft).at(-1);return n.line=new Float32Array(n.line),n.points=new Float32Array(n.points),r(this,Tr).build(r(this,Ft),t,e,s,r(this,Cr),r(this,eo),i),f(this,Is,null),f(this,Nt,null),f(this,Ft,null),f(this,Gt,null),r(this,Tr)}get defaultSVGProperties(){return{root:{viewBox:"0 0 10000 10000"},rootClass:{draw:!0},bbox:[0,0,1,1]}}}Is=new WeakMap,Nt=new WeakMap,Ft=new WeakMap,Cr=new WeakMap,eo=new WeakMap,ne=new WeakMap,Gt=new WeakMap,We=new WeakMap,Tr=new WeakMap,xr=new WeakMap,Lr=new WeakMap,so=new WeakSet,Jh=function(t,e){return N._normalizePoint(t,e,r(this,xr),r(this,Lr),r(this,Cr))};var re,ch,dh,Pe,Ps,Rs,io,no,Ir,Wt,Us,Qp,Zp,tg;class bh extends N{constructor(){super(...arguments);g(this,Wt);g(this,re);g(this,ch,0);g(this,dh);g(this,Pe);g(this,Ps);g(this,Rs);g(this,io);g(this,no);g(this,Ir)}build(e,s,i,n,a,o,l){f(this,Ps,s),f(this,Rs,i),f(this,io,n),f(this,no,a),f(this,Ir,o),f(this,dh,l??0),f(this,Pe,e),m(this,Wt,Zp).call(this)}get thickness(){return r(this,Ir)}setLastElement(e){return r(this,Pe).push(e),{path:{d:this.toSVGPath()}}}removeLastElement(){return r(this,Pe).pop(),{path:{d:this.toSVGPath()}}}toSVGPath(){const e=[];for(const{line:s}of r(this,Pe)){if(e.push(`M${N.svgRound(s[4])} ${N.svgRound(s[5])}`),s.length===6){e.push("Z");continue}if(s.length===12&&isNaN(s[6])){e.push(`L${N.svgRound(s[10])} ${N.svgRound(s[11])}`);continue}for(let i=6,n=s.length;i<n;i+=6){const[a,o,l,h,c,u]=s.subarray(i,i+6).map(N.svgRound);e.push(`C${a} ${o} ${l} ${h} ${c} ${u}`)}}return e.join("")}serialize([e,s,i,n],a){const o=[],l=[],[h,c,u,p]=m(this,Wt,Qp).call(this);let y,A,b,w,v,E,S,_,C;switch(r(this,no)){case 0:C=N._rescale,y=e,A=s+n,b=i,w=-n,v=e+h*i,E=s+(1-c-p)*n,S=e+(h+u)*i,_=s+(1-c)*n;break;case 90:C=N._rescaleAndSwap,y=e,A=s,b=i,w=n,v=e+c*i,E=s+h*n,S=e+(c+p)*i,_=s+(h+u)*n;break;case 180:C=N._rescale,y=e+i,A=s,b=-i,w=n,v=e+(1-h-u)*i,E=s+c*n,S=e+(1-h)*i,_=s+(c+p)*n;break;case 270:C=N._rescaleAndSwap,y=e+i,A=s+n,b=-i,w=-n,v=e+(1-c-p)*i,E=s+(1-h-u)*n,S=e+(1-c)*i,_=s+(1-h)*n;break}for(const{line:T,points:x}of r(this,Pe))o.push(C(T,y,A,b,w,a?new Array(T.length):null)),l.push(C(x,y,A,b,w,a?new Array(x.length):null));return{lines:o,points:l,rect:[v,E,S,_]}}static deserialize(e,s,i,n,a,{paths:{lines:o,points:l},rotation:h,thickness:c}){const u=[];let p,y,A,b,w;switch(h){case 0:w=N._rescale,p=-e/i,y=s/n+1,A=1/i,b=-1/n;break;case 90:w=N._rescaleAndSwap,p=-s/n,y=-e/i,A=1/n,b=1/i;break;case 180:w=N._rescale,p=e/i+1,y=-s/n,A=-1/i,b=1/n;break;case 270:w=N._rescaleAndSwap,p=s/n+1,y=e/i+1,A=-1/n,b=-1/i;break}if(!o){o=[];for(const E of l){const S=E.length;if(S===2){o.push(new Float32Array([NaN,NaN,NaN,NaN,E[0],E[1]]));continue}if(S===4){o.push(new Float32Array([NaN,NaN,NaN,NaN,E[0],E[1],NaN,NaN,NaN,NaN,E[2],E[3]]));continue}const _=new Float32Array(3*(S-2));o.push(_);let[C,T,x,I]=E.subarray(0,4);_.set([NaN,NaN,NaN,NaN,C,T],0);for(let P=4;P<S;P+=2){const D=E[P],k=E[P+1];_.set(N.createBezierPoints(C,T,x,I,D,k),(P-2)*3),[C,T,x,I]=[x,I,D,k]}}}for(let E=0,S=o.length;E<S;E++)u.push({line:w(o[E].map(_=>_??NaN),p,y,A,b),points:w(l[E].map(_=>_??NaN),p,y,A,b)});const v=new this.prototype.constructor;return v.build(u,i,n,1,h,c,a),v}get box(){return r(this,re)}updateProperty(e,s){return e==="stroke-width"?m(this,Wt,tg).call(this,s):null}updateParentDimensions([e,s],i){const[n,a]=m(this,Wt,Us).call(this);f(this,Ps,e),f(this,Rs,s),f(this,io,i);const[o,l]=m(this,Wt,Us).call(this),h=o-n,c=l-a,u=r(this,re);return u[0]-=h,u[1]-=c,u[2]+=2*h,u[3]+=2*c,u}updateRotation(e){return f(this,ch,e),{path:{transform:this.rotationTransform}}}get viewBox(){return r(this,re).map(N.svgRound).join(" ")}get defaultProperties(){const[e,s]=r(this,re);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${N.svgRound(e)} ${N.svgRound(s)}`}}}get rotationTransform(){const[,,e,s]=r(this,re);let i=0,n=0,a=0,o=0,l=0,h=0;switch(r(this,ch)){case 90:n=s/e,a=-e/s,l=e;break;case 180:i=-1,o=-1,l=e,h=s;break;case 270:n=-s/e,a=e/s,h=s;break;default:return""}return`matrix(${i} ${n} ${a} ${o} ${N.svgRound(l)} ${N.svgRound(h)})`}getPathResizingSVGProperties([e,s,i,n]){const[a,o]=m(this,Wt,Us).call(this),[l,h,c,u]=r(this,re);if(Math.abs(c-a)<=N.PRECISION||Math.abs(u-o)<=N.PRECISION){const w=e+i/2-(l+c/2),v=s+n/2-(h+u/2);return{path:{"transform-origin":`${N.svgRound(e)} ${N.svgRound(s)}`,transform:`${this.rotationTransform} translate(${w} ${v})`}}}const p=(i-2*a)/(c-2*a),y=(n-2*o)/(u-2*o),A=c/i,b=u/n;return{path:{"transform-origin":`${N.svgRound(l)} ${N.svgRound(h)}`,transform:`${this.rotationTransform} scale(${A} ${b}) translate(${N.svgRound(a)} ${N.svgRound(o)}) scale(${p} ${y}) translate(${N.svgRound(-a)} ${N.svgRound(-o)})`}}}getPathResizedSVGProperties([e,s,i,n]){const[a,o]=m(this,Wt,Us).call(this),l=r(this,re),[h,c,u,p]=l;if(l[0]=e,l[1]=s,l[2]=i,l[3]=n,Math.abs(u-a)<=N.PRECISION||Math.abs(p-o)<=N.PRECISION){const v=e+i/2-(h+u/2),E=s+n/2-(c+p/2);for(const{line:S,points:_}of r(this,Pe))N._translate(S,v,E,S),N._translate(_,v,E,_);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${N.svgRound(e)} ${N.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}const y=(i-2*a)/(u-2*a),A=(n-2*o)/(p-2*o),b=-y*(h+a)+e+a,w=-A*(c+o)+s+o;if(y!==1||A!==1||b!==0||w!==0)for(const{line:v,points:E}of r(this,Pe))N._rescale(v,b,w,y,A,v),N._rescale(E,b,w,y,A,E);return{root:{viewBox:this.viewBox},path:{"transform-origin":`${N.svgRound(e)} ${N.svgRound(s)}`,transform:this.rotationTransform||null,d:this.toSVGPath()}}}getPathTranslatedSVGProperties([e,s],i){const[n,a]=i,o=r(this,re),l=e-o[0],h=s-o[1];if(r(this,Ps)===n&&r(this,Rs)===a)for(const{line:c,points:u}of r(this,Pe))N._translate(c,l,h,c),N._translate(u,l,h,u);else{const c=r(this,Ps)/n,u=r(this,Rs)/a;f(this,Ps,n),f(this,Rs,a);for(const{line:p,points:y}of r(this,Pe))N._rescale(p,l,h,c,u,p),N._rescale(y,l,h,c,u,y);o[2]*=c,o[3]*=u}return o[0]=e,o[1]=s,{root:{viewBox:this.viewBox},path:{d:this.toSVGPath(),"transform-origin":`${N.svgRound(e)} ${N.svgRound(s)}`}}}get defaultSVGProperties(){const e=r(this,re);return{root:{viewBox:this.viewBox},rootClass:{draw:!0},path:{d:this.toSVGPath(),"transform-origin":`${N.svgRound(e[0])} ${N.svgRound(e[1])}`,transform:this.rotationTransform||null},bbox:e}}}re=new WeakMap,ch=new WeakMap,dh=new WeakMap,Pe=new WeakMap,Ps=new WeakMap,Rs=new WeakMap,io=new WeakMap,no=new WeakMap,Ir=new WeakMap,Wt=new WeakSet,Us=function(e=r(this,Ir)){const s=r(this,dh)+e/2*r(this,io);return r(this,no)%180===0?[s/r(this,Ps),s/r(this,Rs)]:[s/r(this,Rs),s/r(this,Ps)]},Qp=function(){const[e,s,i,n]=r(this,re),[a,o]=m(this,Wt,Us).call(this,0);return[e+a,s+o,i-2*a,n-2*o]},Zp=function(){const e=f(this,re,new Float32Array([1/0,1/0,-1/0,-1/0]));for(const{line:n}of r(this,Pe)){if(n.length<=12){for(let l=4,h=n.length;l<h;l+=6)H.pointBoundingBox(n[l],n[l+1],e);continue}let a=n[4],o=n[5];for(let l=6,h=n.length;l<h;l+=6){const[c,u,p,y,A,b]=n.subarray(l,l+6);H.bezierBoundingBox(a,o,c,u,p,y,A,b,e),a=A,o=b}}const[s,i]=m(this,Wt,Us).call(this);e[0]=le(e[0]-s,0,1),e[1]=le(e[1]-i,0,1),e[2]=le(e[2]+s,0,1),e[3]=le(e[3]+i,0,1),e[2]-=e[0],e[3]-=e[1]},tg=function(e){const[s,i]=m(this,Wt,Us).call(this);f(this,Ir,e);const[n,a]=m(this,Wt,Us).call(this),[o,l]=[n-s,a-i],h=r(this,re);return h[0]-=o,h[1]-=l,h[2]+=2*o,h[3]+=2*l,h};class Uc extends Kp{constructor(t){super(),this._viewParameters=t,super.updateProperties({fill:"none",stroke:lt._defaultLineColor,"stroke-opacity":1,"stroke-width":1,"stroke-linecap":"round","stroke-linejoin":"round","stroke-miterlimit":10})}updateSVGProperty(t,e){t==="stroke-width"&&(e??(e=this["stroke-width"]),e*=this._viewParameters.realScale),super.updateSVGProperty(t,e)}clone(){const t=new Uc(this._viewParameters);return t.updateAll(this),t}}var Dc,eg;const Zr=class Zr extends gc{constructor(e){super({...e,name:"inkEditor"});g(this,Dc);this._willKeepAspectRatio=!0,this.defaultL10nId="pdfjs-editor-ink-editor"}static initialize(e,s){lt.initialize(e,s),this._defaultDrawingOptions=new Uc(s.viewParameters)}static getDefaultDrawingOptions(e){const s=this._defaultDrawingOptions.clone();return s.updateProperties(e),s}static get supportMultipleDrawings(){return!0}static get typesMap(){return q(this,"typesMap",new Map([[Y.INK_THICKNESS,"stroke-width"],[Y.INK_COLOR,"stroke"],[Y.INK_OPACITY,"stroke-opacity"]]))}static createDrawerInstance(e,s,i,n,a){return new oy(e,s,i,n,a,this._defaultDrawingOptions["stroke-width"])}static deserializeDraw(e,s,i,n,a,o){return bh.deserialize(e,s,i,n,a,o)}static async deserialize(e,s,i){let n=null;if(e instanceof Cu){const{data:{inkLists:o,rect:l,rotation:h,id:c,color:u,opacity:p,borderStyle:{rawWidth:y},popupRef:A,contentsObj:b},parent:{page:{pageNumber:w}}}=e;n=e={annotationType:z.INK,color:Array.from(u),thickness:y,opacity:p,paths:{points:o},boxes:null,pageIndex:w-1,rect:l.slice(0),rotation:h,annotationElementId:c,id:c,deleted:!1,popupRef:A,comment:(b==null?void 0:b.str)||null}}const a=await super.deserialize(e,s,i);return a._initialData=n,e.comment&&a.setCommentData(e.comment),a}get toolbarButtons(){return this._colorPicker||(this._colorPicker=new dc(this)),[["colorPicker",this._colorPicker]]}get colorType(){return Y.INK_COLOR}get colorValue(){return this._drawingOptions.stroke}onScaleChanging(){if(!this.parent)return;super.onScaleChanging();const{_drawId:e,_drawingOptions:s,parent:i}=this;s.updateSVGProperty("stroke-width"),i.drawLayer.updateProperties(e,s.toSVGProperties())}static onScaleChangingWhenDrawing(){const e=this._currentParent;e&&(super.onScaleChangingWhenDrawing(),this._defaultDrawingOptions.updateSVGProperty("stroke-width"),e.drawLayer.updateProperties(this._currentDrawId,this._defaultDrawingOptions.toSVGProperties()))}createDrawingOptions({color:e,thickness:s,opacity:i}){this._drawingOptions=Zr.getDefaultDrawingOptions({stroke:H.makeHexColor(...e),"stroke-width":s,"stroke-opacity":i})}serialize(e=!1){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const{lines:s,points:i,rect:n}=this.serializeDraw(e),{_drawingOptions:{stroke:a,"stroke-opacity":o,"stroke-width":l}}=this,h={annotationType:z.INK,color:lt._colorManager.convert(a),opacity:o,thickness:l,paths:{lines:s,points:i},pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(h),e?(h.isCopy=!0,h):this.annotationElementId&&!m(this,Dc,eg).call(this,h)?null:(h.id=this.annotationElementId,h)}renderAnnotationElement(e){const{points:s,rect:i}=this.serializeDraw(!1),n={rect:i,thickness:this._drawingOptions["stroke-width"],points:s};return this.hasEditedComment&&(n.popup=this.comment),e.updateEdited(n),null}};Dc=new WeakSet,eg=function(e){const{color:s,thickness:i,opacity:n,pageIndex:a}=this._initialData;return this.hasEditedComment||this._hasBeenMoved||this._hasBeenResized||e.color.some((o,l)=>o!==s[l])||e.thickness!==i||e.opacity!==n||e.pageIndex!==a},L(Zr,"_type","ink"),L(Zr,"_editorType",z.INK),L(Zr,"_defaultDrawingOptions",null);let iu=Zr;class nu extends bh{toSVGPath(){let t=super.toSVGPath();return t.endsWith("Z")||(t+="Z"),t}}const Th=8,go=3;var Pr,et,ru,rs,sg,ig,au,Qh,ng,rg,ag,ou,lu,og;class Si{static extractContoursFromText(t,{fontFamily:e,fontStyle:s,fontWeight:i},n,a,o,l){let h=new OffscreenCanvas(1,1),c=h.getContext("2d",{alpha:!1});const u=200,p=c.font=`${s} ${i} ${u}px ${e}`,{actualBoundingBoxLeft:y,actualBoundingBoxRight:A,actualBoundingBoxAscent:b,actualBoundingBoxDescent:w,fontBoundingBoxAscent:v,fontBoundingBoxDescent:E,width:S}=c.measureText(t),_=1.5,C=Math.ceil(Math.max(Math.abs(y)+Math.abs(A)||0,S)*_),T=Math.ceil(Math.max(Math.abs(b)+Math.abs(w)||u,Math.abs(v)+Math.abs(E)||u)*_);h=new OffscreenCanvas(C,T),c=h.getContext("2d",{alpha:!0,willReadFrequently:!0}),c.font=p,c.filter="grayscale(1)",c.fillStyle="white",c.fillRect(0,0,C,T),c.fillStyle="black",c.fillText(t,C*(_-1)/2,T*(3-_)/2);const x=m(this,et,ou).call(this,c.getImageData(0,0,C,T).data),I=m(this,et,ag).call(this,x),P=m(this,et,lu).call(this,I),D=m(this,et,au).call(this,x,C,T,P);return this.processDrawnLines({lines:{curves:D,width:C,height:T},pageWidth:n,pageHeight:a,rotation:o,innerMargin:l,mustSmooth:!0,areContours:!0})}static process(t,e,s,i,n){const[a,o,l]=m(this,et,og).call(this,t),[h,c]=m(this,et,rg).call(this,a,o,l,Math.hypot(o,l)*r(this,Pr).sigmaSFactor,r(this,Pr).sigmaR,r(this,Pr).kernelSize),u=m(this,et,lu).call(this,c),p=m(this,et,au).call(this,h,o,l,u);return this.processDrawnLines({lines:{curves:p,width:o,height:l},pageWidth:e,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:!0,areContours:!0})}static processDrawnLines({lines:t,pageWidth:e,pageHeight:s,rotation:i,innerMargin:n,mustSmooth:a,areContours:o}){i%180!==0&&([e,s]=[s,e]);const{curves:l,width:h,height:c}=t,u=t.thickness??0,p=[],y=Math.min(e/h,s/c),A=y/e,b=y/s,w=[];for(const{points:E}of l){const S=a?m(this,et,ng).call(this,E):E;if(!S)continue;w.push(S);const _=S.length,C=new Float32Array(_),T=new Float32Array(3*(_===2?2:_-2));if(p.push({line:T,points:C}),_===2){C[0]=S[0]*A,C[1]=S[1]*b,T.set([NaN,NaN,NaN,NaN,C[0],C[1]],0);continue}let[x,I,P,D]=S;x*=A,I*=b,P*=A,D*=b,C.set([x,I,P,D],0),T.set([NaN,NaN,NaN,NaN,x,I],0);for(let k=4;k<_;k+=2){const Z=C[k]=S[k]*A,it=C[k+1]=S[k+1]*b;T.set(N.createBezierPoints(x,I,P,D,Z,it),(k-2)*3),[x,I,P,D]=[P,D,Z,it]}}if(p.length===0)return null;const v=o?new nu:new bh;return v.build(p,e,s,1,i,o?0:u,n),{outline:v,newCurves:w,areContours:o,thickness:u,width:h,height:c}}static async compressSignature({outlines:t,areContours:e,thickness:s,width:i,height:n}){let a=1/0,o=-1/0,l=0;for(const S of t){l+=S.length;for(let _=2,C=S.length;_<C;_++){const T=S[_]-S[_-2];a=Math.min(a,T),o=Math.max(o,T)}}let h;a>=-128&&o<=127?h=Int8Array:a>=-32768&&o<=32767?h=Int16Array:h=Int32Array;const c=t.length,u=Th+go*c,p=new Uint32Array(u);let y=0;p[y++]=u*Uint32Array.BYTES_PER_ELEMENT+(l-2*c)*h.BYTES_PER_ELEMENT,p[y++]=0,p[y++]=i,p[y++]=n,p[y++]=e?0:1,p[y++]=Math.max(0,Math.floor(s??0)),p[y++]=c,p[y++]=h.BYTES_PER_ELEMENT;for(const S of t)p[y++]=S.length-2,p[y++]=S[0],p[y++]=S[1];const A=new CompressionStream("deflate-raw"),b=A.writable.getWriter();await b.ready,b.write(p);const w=h.prototype.constructor;for(const S of t){const _=new w(S.length-2);for(let C=2,T=S.length;C<T;C++)_[C-2]=S[C]-S[C-2];b.write(_)}b.close();const v=await new Response(A.readable).arrayBuffer(),E=new Uint8Array(v);return hf(E)}static async decompressSignature(t){try{const e=Pg(t),{readable:s,writable:i}=new DecompressionStream("deflate-raw"),n=i.getWriter();await n.ready,n.write(e).then(async()=>{await n.ready,await n.close()}).catch(()=>{});let a=null,o=0;for await(const S of s)a||(a=new Uint8Array(new Uint32Array(S.buffer,0,4)[0])),a.set(S,o),o+=S.length;const l=new Uint32Array(a.buffer,0,a.length>>2),h=l[1];if(h!==0)throw new Error(`Invalid version: ${h}`);const c=l[2],u=l[3],p=l[4]===0,y=l[5],A=l[6],b=l[7],w=[],v=(Th+go*A)*Uint32Array.BYTES_PER_ELEMENT;let E;switch(b){case Int8Array.BYTES_PER_ELEMENT:E=new Int8Array(a.buffer,v);break;case Int16Array.BYTES_PER_ELEMENT:E=new Int16Array(a.buffer,v);break;case Int32Array.BYTES_PER_ELEMENT:E=new Int32Array(a.buffer,v);break}o=0;for(let S=0;S<A;S++){const _=l[go*S+Th],C=new Float32Array(_+2);w.push(C);for(let T=0;T<go-1;T++)C[T]=l[go*S+Th+T+1];for(let T=0;T<_;T++)C[T+2]=C[T]+E[o++]}return{areContours:p,thickness:y,outlines:w,width:c,height:u}}catch(e){return V(`decompressSignature: ${e}`),null}}}Pr=new WeakMap,et=new WeakSet,ru=function(t,e,s,i){return s-=t,i-=e,s===0?i>0?0:4:s===1?i+6:2-i},rs=new WeakMap,sg=function(t,e,s,i,n,a,o){const l=m(this,et,ru).call(this,s,i,n,a);for(let h=0;h<8;h++){const c=(-h+l-o+16)%8,u=r(this,rs)[2*c],p=r(this,rs)[2*c+1];if(t[(s+u)*e+(i+p)]!==0)return c}return-1},ig=function(t,e,s,i,n,a,o){const l=m(this,et,ru).call(this,s,i,n,a);for(let h=0;h<8;h++){const c=(h+l+o+16)%8,u=r(this,rs)[2*c],p=r(this,rs)[2*c+1];if(t[(s+u)*e+(i+p)]!==0)return c}return-1},au=function(t,e,s,i){const n=t.length,a=new Int32Array(n);for(let c=0;c<n;c++)a[c]=t[c]<=i?1:0;for(let c=1;c<s-1;c++)a[c*e]=a[c*e+e-1]=0;for(let c=0;c<e;c++)a[c]=a[e*s-1-c]=0;let o=1,l;const h=[];for(let c=1;c<s-1;c++){l=1;for(let u=1;u<e-1;u++){const p=c*e+u,y=a[p];if(y===0)continue;let A=c,b=u;if(y===1&&a[p-1]===0)o+=1,b-=1;else if(y>=1&&a[p+1]===0)o+=1,b+=1,y>1&&(l=y);else{y!==1&&(l=Math.abs(y));continue}const w=[u,c],v=b===u+1,E={isHole:v,points:w,id:o,parent:0};h.push(E);let S;for(const k of h)if(k.id===l){S=k;break}S?S.isHole?E.parent=v?S.parent:l:E.parent=v?l:S.parent:E.parent=v?l:0;const _=m(this,et,sg).call(this,a,e,c,u,A,b,0);if(_===-1){a[p]=-o,a[p]!==1&&(l=Math.abs(a[p]));continue}let C=r(this,rs)[2*_],T=r(this,rs)[2*_+1];const x=c+C,I=u+T;A=x,b=I;let P=c,D=u;for(;;){const k=m(this,et,ig).call(this,a,e,P,D,A,b,1);C=r(this,rs)[2*k],T=r(this,rs)[2*k+1];const Z=P+C,it=D+T;w.push(it,Z);const X=P*e+D;if(a[X+1]===0?a[X]=-o:a[X]===1&&(a[X]=o),Z===c&&it===u&&P===x&&D===I){a[p]!==1&&(l=Math.abs(a[p]));break}else A=P,b=D,P=Z,D=it}}}return h},Qh=function(t,e,s,i){if(s-e<=4){for(let x=e;x<s-2;x+=2)i.push(t[x],t[x+1]);return}const n=t[e],a=t[e+1],o=t[s-4]-n,l=t[s-3]-a,h=Math.hypot(o,l),c=o/h,u=l/h,p=c*a-u*n,y=l/o,A=1/h,b=Math.atan(y),w=Math.cos(b),v=Math.sin(b),E=A*(Math.abs(w)+Math.abs(v)),S=A*(1-E+E**2),_=Math.max(Math.atan(Math.abs(v+w)*S),Math.atan(Math.abs(v-w)*S));let C=0,T=e;for(let x=e+2;x<s-2;x+=2){const I=Math.abs(p-c*t[x+1]+u*t[x]);I>C&&(T=x,C=I)}C>(h*_)**2?(m(this,et,Qh).call(this,t,e,T+2,i),m(this,et,Qh).call(this,t,T,s,i)):i.push(n,a)},ng=function(t){const e=[],s=t.length;return m(this,et,Qh).call(this,t,0,s,e),e.push(t[s-2],t[s-1]),e.length<=4?null:e},rg=function(t,e,s,i,n,a){const o=new Float32Array(a**2),l=-2*i**2,h=a>>1;for(let b=0;b<a;b++){const w=(b-h)**2;for(let v=0;v<a;v++)o[b*a+v]=Math.exp((w+(v-h)**2)/l)}const c=new Float32Array(256),u=-2*n**2;for(let b=0;b<256;b++)c[b]=Math.exp(b**2/u);const p=t.length,y=new Uint8Array(p),A=new Uint32Array(256);for(let b=0;b<s;b++)for(let w=0;w<e;w++){const v=b*e+w,E=t[v];let S=0,_=0;for(let T=0;T<a;T++){const x=b+T-h;if(!(x<0||x>=s))for(let I=0;I<a;I++){const P=w+I-h;if(P<0||P>=e)continue;const D=t[x*e+P],k=o[T*a+I]*c[Math.abs(D-E)];S+=D*k,_+=k}}const C=y[v]=Math.round(S/_);A[C]++}return[y,A]},ag=function(t){const e=new Uint32Array(256);for(const s of t)e[s]++;return e},ou=function(t){const e=t.length,s=new Uint8ClampedArray(e>>2);let i=-1/0,n=1/0;for(let o=0,l=s.length;o<l;o++){const h=s[o]=t[o<<2];i=Math.max(i,h),n=Math.min(n,h)}const a=255/(i-n);for(let o=0,l=s.length;o<l;o++)s[o]=(s[o]-n)*a;return s},lu=function(t){let e,s=-1/0,i=-1/0;const n=t.findIndex(l=>l!==0);let a=n,o=n;for(e=n;e<256;e++){const l=t[e];l>s&&(e-a>i&&(i=e-a,o=e-1),s=l,a=e)}for(e=o-1;e>=0&&!(t[e]>t[e+1]);e--);return e},og=function(t){const e=t,{width:s,height:i}=t,{maxDim:n}=r(this,Pr);let a=s,o=i;if(s>n||i>n){let p=s,y=i,A=Math.log2(Math.max(s,i)/n);const b=Math.floor(A);A=A===b?b-1:b;for(let v=0;v<A;v++){a=Math.ceil(p/2),o=Math.ceil(y/2);const E=new OffscreenCanvas(a,o);E.getContext("2d").drawImage(t,0,0,p,y,0,0,a,o),p=a,y=o,t!==e&&t.close(),t=E.transferToImageBitmap()}const w=Math.min(n/a,n/o);a=Math.round(a*w),o=Math.round(o*w)}const h=new OffscreenCanvas(a,o).getContext("2d",{willReadFrequently:!0});h.fillStyle="white",h.fillRect(0,0,a,o),h.filter="grayscale(1)",h.drawImage(t,0,0,t.width,t.height,0,0,a,o);const c=h.getImageData(0,0,a,o).data;return[m(this,et,ou).call(this,c),a,o]},g(Si,et),g(Si,Pr,{maxDim:512,sigmaSFactor:.02,sigmaR:25,kernelSize:16}),g(Si,rs,new Int32Array([0,1,-1,1,-1,0,-1,-1,0,-1,1,-1,1,0,1,1]));class Tu extends Kp{constructor(){super(),super.updateProperties({fill:lt._defaultLineColor,"stroke-width":0})}clone(){const t=new Tu;return t.updateAll(this),t}}class xu extends Uc{constructor(t){super(t),super.updateProperties({stroke:lt._defaultLineColor,"stroke-width":1})}clone(){const t=new xu(this._viewParameters);return t.updateAll(this),t}}var dn,ks,un,Rr;const ye=class ye extends gc{constructor(e){super({...e,mustBeCommitted:!0,name:"signatureEditor"});g(this,dn,!1);g(this,ks,null);g(this,un,null);g(this,Rr,null);this._willKeepAspectRatio=!0,f(this,un,e.signatureData||null),f(this,ks,null),this.defaultL10nId="pdfjs-editor-signature-editor1"}static initialize(e,s){lt.initialize(e,s),this._defaultDrawingOptions=new Tu,this._defaultDrawnSignatureOptions=new xu(s.viewParameters)}static getDefaultDrawingOptions(e){const s=this._defaultDrawingOptions.clone();return s.updateProperties(e),s}static get supportMultipleDrawings(){return!1}static get typesMap(){return q(this,"typesMap",new Map)}static get isDrawer(){return!1}get telemetryFinalData(){return{type:"signature",hasDescription:!!r(this,ks)}}static computeTelemetryFinalData(e){const s=e.get("hasDescription");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}get isResizable(){return!0}onScaleChanging(){this._drawId!==null&&super.onScaleChanging()}render(){if(this.div)return this.div;let e,s;const{_isCopy:i}=this;if(i&&(this._isCopy=!1,e=this.x,s=this.y),super.render(),this._drawId===null)if(r(this,un)){const{lines:n,mustSmooth:a,areContours:o,description:l,uuid:h,heightInPage:c}=r(this,un),{rawDims:{pageWidth:u,pageHeight:p},rotation:y}=this.parent.viewport,A=Si.processDrawnLines({lines:n,pageWidth:u,pageHeight:p,rotation:y,innerMargin:ye._INNER_MARGIN,mustSmooth:a,areContours:o});this.addSignature(A,c,l,h)}else this.div.setAttribute("data-l10n-args",JSON.stringify({description:""})),this.div.hidden=!0,this._uiManager.getSignature(this);else this.div.setAttribute("data-l10n-args",JSON.stringify({description:r(this,ks)||""}));return i&&(this._isCopy=!0,this._moveAfterPaste(e,s)),this.div}setUuid(e){f(this,Rr,e),this.addEditToolbar()}getUuid(){return r(this,Rr)}get description(){return r(this,ks)}set description(e){f(this,ks,e),this.div&&(this.div.setAttribute("data-l10n-args",JSON.stringify({description:e})),super.addEditToolbar().then(s=>{s==null||s.updateEditSignatureButton(e)}))}getSignaturePreview(){const{newCurves:e,areContours:s,thickness:i,width:n,height:a}=r(this,un),o=Math.max(n,a),l=Si.processDrawnLines({lines:{curves:e.map(h=>({points:h})),thickness:i,width:n,height:a},pageWidth:o,pageHeight:o,rotation:0,innerMargin:0,mustSmooth:!1,areContours:s});return{areContours:s,outline:l.outline}}get toolbarButtons(){return this._uiManager.signatureManager?[["editSignature",this._uiManager.signatureManager]]:super.toolbarButtons}addSignature(e,s,i,n){const{x:a,y:o}=this,{outline:l}=f(this,un,e);f(this,dn,l instanceof nu),this.description=i;let h;r(this,dn)?h=ye.getDefaultDrawingOptions():(h=ye._defaultDrawnSignatureOptions.clone(),h.updateProperties({"stroke-width":l.thickness})),this._addOutlines({drawOutlines:l,drawingOptions:h});const[c,u]=this.parentDimensions,[,p]=this.pageDimensions;let y=s/p;y=y>=1?.5:y,this.width*=y/this.height,this.width>=1&&(y*=.9/this.width,this.width=.9),this.height=y,this.setDims(c*this.width,u*this.height),this.x=a,this.y=o,this.center(),this._onResized(),this.onScaleChanging(),this.rotate(),this._uiManager.addToAnnotationStorage(this),this.setUuid(n),this._reportTelemetry({action:"pdfjs.signature.inserted",data:{hasBeenSaved:!!n,hasDescription:!!i}}),this.div.hidden=!1}getFromImage(e){const{rawDims:{pageWidth:s,pageHeight:i},rotation:n}=this.parent.viewport;return Si.process(e,s,i,n,ye._INNER_MARGIN)}getFromText(e,s){const{rawDims:{pageWidth:i,pageHeight:n},rotation:a}=this.parent.viewport;return Si.extractContoursFromText(e,s,i,n,a,ye._INNER_MARGIN)}getDrawnSignature(e){const{rawDims:{pageWidth:s,pageHeight:i},rotation:n}=this.parent.viewport;return Si.processDrawnLines({lines:e,pageWidth:s,pageHeight:i,rotation:n,innerMargin:ye._INNER_MARGIN,mustSmooth:!1,areContours:!1})}createDrawingOptions({areContours:e,thickness:s}){e?this._drawingOptions=ye.getDefaultDrawingOptions():(this._drawingOptions=ye._defaultDrawnSignatureOptions.clone(),this._drawingOptions.updateProperties({"stroke-width":s}))}serialize(e=!1){if(this.isEmpty())return null;const{lines:s,points:i,rect:n}=this.serializeDraw(e),{_drawingOptions:{"stroke-width":a}}=this,o={annotationType:z.SIGNATURE,isSignature:!0,areContours:r(this,dn),color:[0,0,0],thickness:r(this,dn)?0:a,pageIndex:this.pageIndex,rect:n,rotation:this.rotation,structTreeParentId:this._structTreeParentId};return this.addComment(o),e?(o.paths={lines:s,points:i},o.uuid=r(this,Rr),o.isCopy=!0):o.lines=s,r(this,ks)&&(o.accessibilityData={type:"Figure",alt:r(this,ks)}),o}static deserializeDraw(e,s,i,n,a,o){return o.areContours?nu.deserialize(e,s,i,n,a,o):bh.deserialize(e,s,i,n,a,o)}static async deserialize(e,s,i){var a;const n=await super.deserialize(e,s,i);return f(n,dn,e.areContours),n.description=((a=e.accessibilityData)==null?void 0:a.alt)||"",f(n,Rr,e.uuid),n}};dn=new WeakMap,ks=new WeakMap,un=new WeakMap,Rr=new WeakMap,L(ye,"_type","signature"),L(ye,"_editorType",z.SIGNATURE),L(ye,"_defaultDrawingOptions",null);let hu=ye;var dt,Bt,fn,yi,pn,ro,bi,kr,Ds,Re,ao,J,Do,Mo,Zh,tc,ec,du,sc,lg;class cu extends lt{constructor(e){super({...e,name:"stampEditor"});g(this,J);g(this,dt,null);g(this,Bt,null);g(this,fn,null);g(this,yi,null);g(this,pn,null);g(this,ro,"");g(this,bi,null);g(this,kr,!1);g(this,Ds,null);g(this,Re,!1);g(this,ao,!1);f(this,yi,e.bitmapUrl),f(this,pn,e.bitmapFile),this.defaultL10nId="pdfjs-editor-stamp-editor"}static initialize(e,s){lt.initialize(e,s)}static isHandlingMimeForPasting(e){return id.includes(e)}static paste(e,s){s.pasteEditor({mode:z.STAMP},{bitmapFile:e.getAsFile()})}altTextFinish(){this._uiManager.useNewAltTextFlow&&(this.div.hidden=!1),super.altTextFinish()}get telemetryFinalData(){var e;return{type:"stamp",hasAltText:!!((e=this.altTextData)!=null&&e.altText)}}static computeTelemetryFinalData(e){const s=e.get("hasAltText");return{hasAltText:s.get(!0)??0,hasNoAltText:s.get(!1)??0}}async mlGuessAltText(e=null,s=!0){if(this.hasAltTextData())return null;const{mlManager:i}=this._uiManager;if(!i)throw new Error("No ML.");if(!await i.isEnabledFor("altText"))throw new Error("ML isn't enabled for alt text.");const{data:n,width:a,height:o}=e||this.copyCanvas(null,null,!0).imageData,l=await i.guess({name:"altText",request:{data:n,width:a,height:o,channels:n.length/(a*o)}});if(!l)throw new Error("No response from the AI service.");if(l.error)throw new Error("Error from the AI service.");if(l.cancel)return null;if(!l.output)throw new Error("No valid response from the AI service.");const h=l.output;return await this.setGuessedAltText(h),s&&!this.hasAltTextData()&&(this.altTextData={alt:h,decorative:!1}),h}remove(){var e;r(this,Bt)&&(f(this,dt,null),this._uiManager.imageManager.deleteId(r(this,Bt)),(e=r(this,bi))==null||e.remove(),f(this,bi,null),r(this,Ds)&&(clearTimeout(r(this,Ds)),f(this,Ds,null))),super.remove()}rebuild(){if(!this.parent){r(this,Bt)&&m(this,J,Zh).call(this);return}super.rebuild(),this.div!==null&&(r(this,Bt)&&r(this,bi)===null&&m(this,J,Zh).call(this),this.isAttachedToDOM||this.parent.add(this))}onceAdded(e){this._isDraggable=!0,e&&this.div.focus()}isEmpty(){return!(r(this,fn)||r(this,dt)||r(this,yi)||r(this,pn)||r(this,Bt)||r(this,kr))}get toolbarButtons(){return[["altText",this.createAltText()]]}get isResizable(){return!0}render(){if(this.div)return this.div;let e,s;return this._isCopy&&(e=this.x,s=this.y),super.render(),this.div.hidden=!0,this.createAltText(),r(this,kr)||(r(this,dt)?m(this,J,tc).call(this):m(this,J,Zh).call(this)),this._isCopy&&this._moveAfterPaste(e,s),this._uiManager.addShouldRescale(this),this.div}setCanvas(e,s){const{id:i,bitmap:n}=this._uiManager.imageManager.getFromCanvas(e,s);s.remove(),i&&this._uiManager.imageManager.isValidId(i)&&(f(this,Bt,i),n&&f(this,dt,n),f(this,kr,!1),m(this,J,tc).call(this))}_onResized(){this.onScaleChanging()}onScaleChanging(){if(!this.parent)return;r(this,Ds)!==null&&clearTimeout(r(this,Ds)),f(this,Ds,setTimeout(()=>{f(this,Ds,null),m(this,J,du).call(this)},200))}copyCanvas(e,s,i=!1){var y;e||(e=224);const{width:n,height:a}=r(this,dt),o=new Fs;let l=r(this,dt),h=n,c=a,u=null;if(s){if(n>s||a>s){const I=Math.min(s/n,s/a);h=Math.floor(n*I),c=Math.floor(a*I)}u=document.createElement("canvas");const A=u.width=Math.ceil(h*o.sx),b=u.height=Math.ceil(c*o.sy);r(this,Re)||(l=m(this,J,ec).call(this,A,b));const w=u.getContext("2d");w.filter=this._uiManager.hcmFilter;let v="white",E="#cfcfd8";this._uiManager.hcmFilter!=="none"?E="black":(y=window.matchMedia)!=null&&y.call(window,"(prefers-color-scheme: dark)").matches&&(v="#8f8f9d",E="#42414d");const S=15,_=S*o.sx,C=S*o.sy,T=new OffscreenCanvas(_*2,C*2),x=T.getContext("2d");x.fillStyle=v,x.fillRect(0,0,_*2,C*2),x.fillStyle=E,x.fillRect(0,0,_,C),x.fillRect(_,C,_,C),w.fillStyle=w.createPattern(T,"repeat"),w.fillRect(0,0,A,b),w.drawImage(l,0,0,l.width,l.height,0,0,A,b)}let p=null;if(i){let A,b;if(o.symmetric&&l.width<e&&l.height<e)A=l.width,b=l.height;else if(l=r(this,dt),n>e||a>e){const E=Math.min(e/n,e/a);A=Math.floor(n*E),b=Math.floor(a*E),r(this,Re)||(l=m(this,J,ec).call(this,A,b))}const v=new OffscreenCanvas(A,b).getContext("2d",{willReadFrequently:!0});v.drawImage(l,0,0,l.width,l.height,0,0,A,b),p={width:A,height:b,data:v.getImageData(0,0,A,b).data}}return{canvas:u,width:h,height:c,imageData:p}}static async deserialize(e,s,i){var w;let n=null,a=!1;if(e instanceof _p){const{data:{rect:v,rotation:E,id:S,structParent:_,popupRef:C,contentsObj:T},container:x,parent:{page:{pageNumber:I}},canvas:P}=e;let D,k;P?(delete e.canvas,{id:D,bitmap:k}=i.imageManager.getFromCanvas(x.id,P),P.remove()):(a=!0,e._hasNoCanvas=!0);const Z=((w=await s._structTree.getAriaAttributes(`${bu}${S}`))==null?void 0:w.get("aria-label"))||"";n=e={annotationType:z.STAMP,bitmapId:D,bitmap:k,pageIndex:I-1,rect:v.slice(0),rotation:E,annotationElementId:S,id:S,deleted:!1,accessibilityData:{decorative:!1,altText:Z},isSvg:!1,structParent:_,popupRef:C,comment:(T==null?void 0:T.str)||null}}const o=await super.deserialize(e,s,i),{rect:l,bitmap:h,bitmapUrl:c,bitmapId:u,isSvg:p,accessibilityData:y}=e;a?(i.addMissingCanvas(e.id,o),f(o,kr,!0)):u&&i.imageManager.isValidId(u)?(f(o,Bt,u),h&&f(o,dt,h)):f(o,yi,c),f(o,Re,p);const[A,b]=o.pageDimensions;return o.width=(l[2]-l[0])/A,o.height=(l[3]-l[1])/b,y&&(o.altTextData=y),o._initialData=n,e.comment&&o.setCommentData(e.comment),f(o,ao,!!n),o}serialize(e=!1,s=null){if(this.isEmpty())return null;if(this.deleted)return this.serializeDeleted();const i={annotationType:z.STAMP,bitmapId:r(this,Bt),pageIndex:this.pageIndex,rect:this.getRect(0,0),rotation:this.rotation,isSvg:r(this,Re),structTreeParentId:this._structTreeParentId};if(this.addComment(i),e)return i.bitmapUrl=m(this,J,sc).call(this,!0),i.accessibilityData=this.serializeAltText(!0),i.isCopy=!0,i;const{decorative:n,altText:a}=this.serializeAltText(!1);if(!n&&a&&(i.accessibilityData={type:"Figure",alt:a}),this.annotationElementId){const l=m(this,J,lg).call(this,i);if(l.isSame)return null;l.isSameAltText?delete i.accessibilityData:i.accessibilityData.structParent=this._initialData.structParent??-1}if(i.id=this.annotationElementId,s===null)return i;s.stamps||(s.stamps=new Map);const o=r(this,Re)?(i.rect[2]-i.rect[0])*(i.rect[3]-i.rect[1]):null;if(!s.stamps.has(r(this,Bt)))s.stamps.set(r(this,Bt),{area:o,serialized:i}),i.bitmap=m(this,J,sc).call(this,!1);else if(r(this,Re)){const l=s.stamps.get(r(this,Bt));o>l.area&&(l.area=o,l.serialized.bitmap.close(),l.serialized.bitmap=m(this,J,sc).call(this,!1))}return i}renderAnnotationElement(e){const s={rect:this.getRect(0,0)};return this.hasEditedComment&&(s.popup=this.comment),e.updateEdited(s),null}}dt=new WeakMap,Bt=new WeakMap,fn=new WeakMap,yi=new WeakMap,pn=new WeakMap,ro=new WeakMap,bi=new WeakMap,kr=new WeakMap,Ds=new WeakMap,Re=new WeakMap,ao=new WeakMap,J=new WeakSet,Do=function(e,s=!1){if(!e){this.remove();return}f(this,dt,e.bitmap),s||(f(this,Bt,e.id),f(this,Re,e.isSvg)),e.file&&f(this,ro,e.file.name),m(this,J,tc).call(this)},Mo=function(){if(f(this,fn,null),this._uiManager.enableWaiting(!1),!!r(this,bi)){if(this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&r(this,dt)){this.addEditToolbar().then(()=>{this._editToolbar.hide(),this._uiManager.editAltText(this,!0)});return}if(!this._uiManager.useNewAltTextWhenAddingImage&&this._uiManager.useNewAltTextFlow&&r(this,dt)){this._reportTelemetry({action:"pdfjs.image.image_added",data:{alt_text_modal:!1,alt_text_type:"empty"}});try{this.mlGuessAltText()}catch{}}this.div.focus()}},Zh=function(){if(r(this,Bt)){this._uiManager.enableWaiting(!0),this._uiManager.imageManager.getFromId(r(this,Bt)).then(i=>m(this,J,Do).call(this,i,!0)).finally(()=>m(this,J,Mo).call(this));return}if(r(this,yi)){const i=r(this,yi);f(this,yi,null),this._uiManager.enableWaiting(!0),f(this,fn,this._uiManager.imageManager.getFromUrl(i).then(n=>m(this,J,Do).call(this,n)).finally(()=>m(this,J,Mo).call(this)));return}if(r(this,pn)){const i=r(this,pn);f(this,pn,null),this._uiManager.enableWaiting(!0),f(this,fn,this._uiManager.imageManager.getFromFile(i).then(n=>m(this,J,Do).call(this,n)).finally(()=>m(this,J,Mo).call(this)));return}const e=document.createElement("input");e.type="file",e.accept=id.join(",");const s=this._uiManager._signal;f(this,fn,new Promise(i=>{e.addEventListener("change",async()=>{if(!e.files||e.files.length===0)this.remove();else{this._uiManager.enableWaiting(!0);const n=await this._uiManager.imageManager.getFromFile(e.files[0]);this._reportTelemetry({action:"pdfjs.image.image_selected",data:{alt_text_modal:this._uiManager.useNewAltTextFlow}}),m(this,J,Do).call(this,n)}i()},{signal:s}),e.addEventListener("cancel",()=>{this.remove(),i()},{signal:s})}).finally(()=>m(this,J,Mo).call(this))),e.click()},tc=function(){var u;const{div:e}=this;let{width:s,height:i}=r(this,dt);const[n,a]=this.pageDimensions,o=.75;if(this.width)s=this.width*n,i=this.height*a;else if(s>o*n||i>o*a){const p=Math.min(o*n/s,o*a/i);s*=p,i*=p}const[l,h]=this.parentDimensions;this.setDims(s*l/n,i*h/a),this._uiManager.enableWaiting(!1);const c=f(this,bi,document.createElement("canvas"));c.setAttribute("role","img"),this.addContainer(c),this.width=s/n,this.height=i/a,(u=this._initialOptions)!=null&&u.isCentered?this.center():this.fixAndSetPosition(),this._initialOptions=null,(!this._uiManager.useNewAltTextWhenAddingImage||!this._uiManager.useNewAltTextFlow||this.annotationElementId)&&(e.hidden=!1),m(this,J,du).call(this),r(this,ao)||(this.parent.addUndoableEditor(this),f(this,ao,!0)),this._reportTelemetry({action:"inserted_image"}),r(this,ro)&&this.div.setAttribute("aria-description",r(this,ro)),this.annotationElementId||this._uiManager.a11yAlert("pdfjs-editor-stamp-added-alert")},ec=function(e,s){const{width:i,height:n}=r(this,dt);let a=i,o=n,l=r(this,dt);for(;a>2*e||o>2*s;){const h=a,c=o;a>2*e&&(a=a>=16384?Math.floor(a/2)-1:Math.ceil(a/2)),o>2*s&&(o=o>=16384?Math.floor(o/2)-1:Math.ceil(o/2));const u=new OffscreenCanvas(a,o);u.getContext("2d").drawImage(l,0,0,h,c,0,0,a,o),l=u.transferToImageBitmap()}return l},du=function(){const[e,s]=this.parentDimensions,{width:i,height:n}=this,a=new Fs,o=Math.ceil(i*e*a.sx),l=Math.ceil(n*s*a.sy),h=r(this,bi);if(!h||h.width===o&&h.height===l)return;h.width=o,h.height=l;const c=r(this,Re)?r(this,dt):m(this,J,ec).call(this,o,l),u=h.getContext("2d");u.filter=this._uiManager.hcmFilter,u.drawImage(c,0,0,c.width,c.height,0,0,o,l)},sc=function(e){if(e){if(r(this,Re)){const n=this._uiManager.imageManager.getSvgUrl(r(this,Bt));if(n)return n}const s=document.createElement("canvas");return{width:s.width,height:s.height}=r(this,dt),s.getContext("2d").drawImage(r(this,dt),0,0),s.toDataURL()}if(r(this,Re)){const[s,i]=this.pageDimensions,n=Math.round(this.width*s*vn.PDF_TO_CSS_UNITS),a=Math.round(this.height*i*vn.PDF_TO_CSS_UNITS),o=new OffscreenCanvas(n,a);return o.getContext("2d").drawImage(r(this,dt),0,0,r(this,dt).width,r(this,dt).height,0,0,n,a),o.transferToImageBitmap()}return structuredClone(r(this,dt))},lg=function(e){var o;const{pageIndex:s,accessibilityData:{altText:i}}=this._initialData,n=e.pageIndex===s,a=(((o=e.accessibilityData)==null?void 0:o.alt)||"")===i;return{isSame:!this.hasEditedComment&&!this._hasBeenMoved&&!this._hasBeenResized&&n&&a,isSameAltText:a}},L(cu,"_type","stamp"),L(cu,"_editorType",z.STAMP);var Dr,oo,Ms,gn,Ai,ke,mn,lo,Mr,as,vi,Ot,wi,yn,ho,O,bn,ut,hg,ps,fu,pu,ic;const Ke=class Ke{constructor({uiManager:t,pageIndex:e,div:s,structTreeLayer:i,accessibilityManager:n,annotationLayer:a,drawLayer:o,textLayer:l,viewport:h,l10n:c}){g(this,ut);g(this,Dr);g(this,oo,!1);g(this,Ms,null);g(this,gn,null);g(this,Ai,null);g(this,ke,new Map);g(this,mn,!1);g(this,lo,!1);g(this,Mr,!1);g(this,as,null);g(this,vi,null);g(this,Ot,null);g(this,wi,null);g(this,yn,null);g(this,ho,-1);g(this,O);const u=[...r(Ke,bn).values()];if(!Ke._initialized){Ke._initialized=!0;for(const p of u)p.initialize(c,t)}t.registerEditorTypes(u),f(this,O,t),this.pageIndex=e,this.div=s,f(this,Dr,n),f(this,Ms,a),this.viewport=h,f(this,Ot,l),this.drawLayer=o,this._structTree=i,r(this,O).addLayer(this)}get isEmpty(){return r(this,ke).size===0}get isInvisible(){return this.isEmpty&&r(this,O).getMode()===z.NONE}updateToolbar(t){r(this,O).updateToolbar(t)}updateMode(t=r(this,O).getMode()){switch(m(this,ut,ic).call(this),t){case z.NONE:this.disableTextSelection(),this.togglePointerEvents(!1),this.toggleAnnotationLayerPointerEvents(!0),this.disableClick();return;case z.INK:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick();break;case z.HIGHLIGHT:this.enableTextSelection(),this.togglePointerEvents(!1),this.disableClick();break;default:this.disableTextSelection(),this.togglePointerEvents(!0),this.enableClick()}this.toggleAnnotationLayerPointerEvents(!1);const{classList:e}=this.div;for(const s of r(Ke,bn).values())e.toggle(`${s._type}Editing`,t===s._editorType);this.div.hidden=!1}hasTextLayer(t){var e;return t===((e=r(this,Ot))==null?void 0:e.div)}setEditingState(t){r(this,O).setEditingState(t)}addCommands(t){r(this,O).addCommands(t)}cleanUndoStack(t){r(this,O).cleanUndoStack(t)}toggleDrawing(t=!1){this.div.classList.toggle("drawing",!t)}togglePointerEvents(t=!1){this.div.classList.toggle("disabled",!t)}toggleAnnotationLayerPointerEvents(t=!1){var e;(e=r(this,Ms))==null||e.div.classList.toggle("disabled",!t)}async enable(){var s;f(this,Mr,!0),this.div.tabIndex=0,this.togglePointerEvents(!0),(s=r(this,yn))==null||s.abort(),f(this,yn,null);const t=new Set;for(const i of r(this,ke).values())i.enableEditing(),i.show(!0),i.annotationElementId&&(r(this,O).removeChangedExistingAnnotation(i),t.add(i.annotationElementId));if(!r(this,Ms)){f(this,Mr,!1);return}const e=r(this,Ms).getEditableAnnotations();for(const i of e){if(i.hide(),r(this,O).isDeletedAnnotationElement(i.data.id)||t.has(i.data.id))continue;const n=await this.deserialize(i);n&&(this.addOrRebuild(n),n.enableEditing())}f(this,Mr,!1)}disable(){var i;if(f(this,lo,!0),this.div.tabIndex=-1,this.togglePointerEvents(!1),r(this,Ot)&&!r(this,yn)){f(this,yn,new AbortController);const n=r(this,O).combinedSignal(r(this,yn));r(this,Ot).div.addEventListener("pointerdown",a=>{const{clientX:l,clientY:h,timeStamp:c}=a,u=r(this,ho);if(c-u>500){f(this,ho,c);return}f(this,ho,-1);const{classList:p}=this.div;p.toggle("getElements",!0);const y=document.elementsFromPoint(l,h);if(p.toggle("getElements",!1),!this.div.contains(y[0]))return;let A;const b=new RegExp(`^${nf}[0-9]+$`);for(const v of y)if(b.test(v.id)){A=v.id;break}if(!A)return;const w=r(this,ke).get(A);(w==null?void 0:w.annotationElementId)===null&&(a.stopPropagation(),a.preventDefault(),w.dblclick())},{signal:n,capture:!0})}const t=new Map,e=new Map;for(const n of r(this,ke).values())if(n.disableEditing(),!!n.annotationElementId){if(n.serialize()!==null){t.set(n.annotationElementId,n);continue}else e.set(n.annotationElementId,n);(i=this.getEditableAnnotation(n.annotationElementId))==null||i.show(),n.remove()}if(r(this,Ms)){const n=r(this,Ms).getEditableAnnotations();for(const a of n){const{id:o}=a.data;if(r(this,O).isDeletedAnnotationElement(o)){a.updateEdited({deleted:!0});continue}let l=e.get(o);if(l){l.resetAnnotationElement(a),l.show(!1),a.show();continue}l=t.get(o),l&&(r(this,O).addChangedExistingAnnotation(l),l.renderAnnotationElement(a)&&l.show(!1)),a.show()}}m(this,ut,ic).call(this),this.isEmpty&&(this.div.hidden=!0);const{classList:s}=this.div;for(const n of r(Ke,bn).values())s.remove(`${n._type}Editing`);this.disableTextSelection(),this.toggleAnnotationLayerPointerEvents(!0),f(this,lo,!1)}getEditableAnnotation(t){var e;return((e=r(this,Ms))==null?void 0:e.getEditableAnnotation(t))||null}setActiveEditor(t){r(this,O).getActive()!==t&&r(this,O).setActiveEditor(t)}enableTextSelection(){var t;if(this.div.tabIndex=-1,(t=r(this,Ot))!=null&&t.div&&!r(this,wi)){f(this,wi,new AbortController);const e=r(this,O).combinedSignal(r(this,wi));r(this,Ot).div.addEventListener("pointerdown",m(this,ut,hg).bind(this),{signal:e}),r(this,Ot).div.classList.add("highlighting")}}disableTextSelection(){var t;this.div.tabIndex=0,(t=r(this,Ot))!=null&&t.div&&r(this,wi)&&(r(this,wi).abort(),f(this,wi,null),r(this,Ot).div.classList.remove("highlighting"))}enableClick(){if(r(this,gn))return;f(this,gn,new AbortController);const t=r(this,O).combinedSignal(r(this,gn));this.div.addEventListener("pointerdown",this.pointerdown.bind(this),{signal:t});const e=this.pointerup.bind(this);this.div.addEventListener("pointerup",e,{signal:t}),this.div.addEventListener("pointercancel",e,{signal:t})}disableClick(){var t;(t=r(this,gn))==null||t.abort(),f(this,gn,null)}attach(t){r(this,ke).set(t.id,t);const{annotationElementId:e}=t;e&&r(this,O).isDeletedAnnotationElement(e)&&r(this,O).removeDeletedAnnotationElement(t)}detach(t){var e;r(this,ke).delete(t.id),(e=r(this,Dr))==null||e.removePointerInTextLayer(t.contentDiv),!r(this,lo)&&t.annotationElementId&&r(this,O).addDeletedAnnotationElement(t)}remove(t){this.detach(t),r(this,O).removeEditor(t),t.div.remove(),t.isAttachedToDOM=!1}changeParent(t){var e;t.parent!==this&&(t.parent&&t.annotationElementId&&(r(this,O).addDeletedAnnotationElement(t.annotationElementId),lt.deleteAnnotationElement(t),t.annotationElementId=null),this.attach(t),(e=t.parent)==null||e.detach(t),t.setParent(this),t.div&&t.isAttachedToDOM&&(t.div.remove(),this.div.append(t.div)))}add(t){if(!(t.parent===this&&t.isAttachedToDOM)){if(this.changeParent(t),r(this,O).addEditor(t),this.attach(t),!t.isAttachedToDOM){const e=t.render();this.div.append(e),t.isAttachedToDOM=!0}t.fixAndSetPosition(),t.onceAdded(!r(this,Mr)),r(this,O).addToAnnotationStorage(t),t._reportTelemetry(t.telemetryInitialData)}}moveEditorInDOM(t){var s;if(!t.isAttachedToDOM)return;const{activeElement:e}=document;t.div.contains(e)&&!r(this,Ai)&&(t._focusEventsAllowed=!1,f(this,Ai,setTimeout(()=>{f(this,Ai,null),t.div.contains(document.activeElement)?t._focusEventsAllowed=!0:(t.div.addEventListener("focusin",()=>{t._focusEventsAllowed=!0},{once:!0,signal:r(this,O)._signal}),e.focus())},0))),t._structTreeParentId=(s=r(this,Dr))==null?void 0:s.moveElementInDOM(this.div,t.div,t.contentDiv,!0)}addOrRebuild(t){t.needsToBeRebuilt()?(t.parent||(t.parent=this),t.rebuild(),t.show()):this.add(t)}addUndoableEditor(t){const e=()=>t._uiManager.rebuild(t),s=()=>{t.remove()};this.addCommands({cmd:e,undo:s,mustExec:!1})}getNextId(){return r(this,O).getId()}combinedSignal(t){return r(this,O).combinedSignal(t)}canCreateNewEmptyEditor(){var t;return(t=r(this,ut,ps))==null?void 0:t.canCreateNewEmptyEditor()}async pasteEditor(t,e){this.updateToolbar(t),await r(this,O).updateMode(t.mode);const{offsetX:s,offsetY:i}=m(this,ut,pu).call(this),n=this.getNextId(),a=m(this,ut,fu).call(this,{parent:this,id:n,x:s,y:i,uiManager:r(this,O),isCentered:!0,...e});a&&this.add(a)}async deserialize(t){var e;return await((e=r(Ke,bn).get(t.annotationType??t.annotationEditorType))==null?void 0:e.deserialize(t,this,r(this,O)))||null}createAndAddNewEditor(t,e,s={}){const i=this.getNextId(),n=m(this,ut,fu).call(this,{parent:this,id:i,x:t.offsetX,y:t.offsetY,uiManager:r(this,O),isCentered:e,...s});return n&&this.add(n),n}addNewEditor(t={}){this.createAndAddNewEditor(m(this,ut,pu).call(this),!0,t)}setSelected(t){r(this,O).setSelected(t)}toggleSelected(t){r(this,O).toggleSelected(t)}unselect(t){r(this,O).unselect(t)}pointerup(t){var i;const{isMac:e}=Xt.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div||!r(this,mn)||(f(this,mn,!1),(i=r(this,ut,ps))!=null&&i.isDrawer&&r(this,ut,ps).supportMultipleDrawings))return;if(!r(this,oo)){f(this,oo,!0);return}const s=r(this,O).getMode();if(s===z.STAMP||s===z.SIGNATURE){r(this,O).unselectAll();return}this.createAndAddNewEditor(t,!1)}pointerdown(t){var i;if(r(this,O).getMode()===z.HIGHLIGHT&&this.enableTextSelection(),r(this,mn)){f(this,mn,!1);return}const{isMac:e}=Xt.platform;if(t.button!==0||t.ctrlKey&&e||t.target!==this.div)return;if(f(this,mn,!0),(i=r(this,ut,ps))!=null&&i.isDrawer){this.startDrawingSession(t);return}const s=r(this,O).getActive();f(this,oo,!s||s.isEmpty())}startDrawingSession(t){if(this.div.focus({preventScroll:!0}),r(this,as)){r(this,ut,ps).startDrawing(this,r(this,O),!1,t);return}r(this,O).setCurrentDrawingSession(this),f(this,as,new AbortController);const e=r(this,O).combinedSignal(r(this,as));this.div.addEventListener("blur",({relatedTarget:s})=>{s&&!this.div.contains(s)&&(f(this,vi,null),this.commitOrRemove())},{signal:e}),r(this,ut,ps).startDrawing(this,r(this,O),!1,t)}pause(t){if(t){const{activeElement:e}=document;this.div.contains(e)&&f(this,vi,e);return}r(this,vi)&&setTimeout(()=>{var e;(e=r(this,vi))==null||e.focus(),f(this,vi,null)},0)}endDrawingSession(t=!1){return r(this,as)?(r(this,O).setCurrentDrawingSession(null),r(this,as).abort(),f(this,as,null),f(this,vi,null),r(this,ut,ps).endDrawing(t)):null}findNewParent(t,e,s){const i=r(this,O).findParent(e,s);return i===null||i===this?!1:(i.changeParent(t),!0)}commitOrRemove(){return r(this,as)?(this.endDrawingSession(),!0):!1}onScaleChanging(){r(this,as)&&r(this,ut,ps).onScaleChangingWhenDrawing(this)}destroy(){var t,e;this.commitOrRemove(),((t=r(this,O).getActive())==null?void 0:t.parent)===this&&(r(this,O).commitOrRemove(),r(this,O).setActiveEditor(null)),r(this,Ai)&&(clearTimeout(r(this,Ai)),f(this,Ai,null));for(const s of r(this,ke).values())(e=r(this,Dr))==null||e.removePointerInTextLayer(s.contentDiv),s.setParent(null),s.isAttachedToDOM=!1,s.div.remove();this.div=null,r(this,ke).clear(),r(this,O).removeLayer(this)}render({viewport:t}){this.viewport=t,Fr(this.div,t);for(const e of r(this,O).getEditors(this.pageIndex))this.add(e),e.rebuild();this.updateMode()}update({viewport:t}){r(this,O).commitOrRemove(),m(this,ut,ic).call(this);const e=this.viewport.rotation,s=t.rotation;if(this.viewport=t,Fr(this.div,{rotation:s}),e!==s)for(const i of r(this,ke).values())i.rotate(s)}get pageDimensions(){const{pageWidth:t,pageHeight:e}=this.viewport.rawDims;return[t,e]}get scale(){return r(this,O).viewParameters.realScale}};Dr=new WeakMap,oo=new WeakMap,Ms=new WeakMap,gn=new WeakMap,Ai=new WeakMap,ke=new WeakMap,mn=new WeakMap,lo=new WeakMap,Mr=new WeakMap,as=new WeakMap,vi=new WeakMap,Ot=new WeakMap,wi=new WeakMap,yn=new WeakMap,ho=new WeakMap,O=new WeakMap,bn=new WeakMap,ut=new WeakSet,hg=function(t){r(this,O).unselectAll();const{target:e}=t;if(e===r(this,Ot).div||(e.getAttribute("role")==="img"||e.classList.contains("endOfContent"))&&r(this,Ot).div.contains(e)){const{isMac:s}=Xt.platform;if(t.button!==0||t.ctrlKey&&s)return;r(this,O).showAllEditors("highlight",!0,!0),r(this,Ot).div.classList.add("free"),this.toggleDrawing(),pc.startHighlighting(this,r(this,O).direction==="ltr",{target:r(this,Ot).div,x:t.x,y:t.y}),r(this,Ot).div.addEventListener("pointerup",()=>{r(this,Ot).div.classList.remove("free"),this.toggleDrawing(!0)},{once:!0,signal:r(this,O)._signal}),t.preventDefault()}},ps=function(){return r(Ke,bn).get(r(this,O).getMode())},fu=function(t){const e=r(this,ut,ps);return e?new e.prototype.constructor(t):null},pu=function(){const{x:t,y:e,width:s,height:i}=this.div.getBoundingClientRect(),n=Math.max(0,t),a=Math.max(0,e),o=Math.min(window.innerWidth,t+s),l=Math.min(window.innerHeight,e+i),h=(n+o)/2-t,c=(a+l)/2-e,[u,p]=this.viewport.rotation%180===0?[h,c]:[c,h];return{offsetX:u,offsetY:p}},ic=function(){for(const t of r(this,ke).values())t.isEmpty()&&t.remove()},L(Ke,"_initialized",!1),g(Ke,bn,new Map([qd,iu,cu,pc,hu].map(t=>[t._editorType,t])));let uu=Ke;var os,ae,Nr,uh,Mc,cg,Bs,mu,dg,yu;const xt=class xt{constructor({pageIndex:t}){g(this,Bs);g(this,os,null);g(this,ae,new Map);g(this,Nr,new Map);this.pageIndex=t}setParent(t){if(!r(this,os)){f(this,os,t);return}if(r(this,os)!==t){if(r(this,ae).size>0)for(const e of r(this,ae).values())e.remove(),t.append(e);f(this,os,t)}}static get _svgFactory(){return q(this,"_svgFactory",new uc)}draw(t,e=!1,s=!1){const i=ee(xt,uh)._++,n=m(this,Bs,mu).call(this),a=xt._svgFactory.createElement("defs");n.append(a);const o=xt._svgFactory.createElement("path");a.append(o);const l=`path_p${this.pageIndex}_${i}`;o.setAttribute("id",l),o.setAttribute("vector-effect","non-scaling-stroke"),e&&r(this,Nr).set(i,o);const h=s?m(this,Bs,dg).call(this,a,l):null,c=xt._svgFactory.createElement("use");return n.append(c),c.setAttribute("href",`#${l}`),this.updateProperties(n,t),r(this,ae).set(i,n),{id:i,clipPathId:`url(#${h})`}}drawOutline(t,e){const s=ee(xt,uh)._++,i=m(this,Bs,mu).call(this),n=xt._svgFactory.createElement("defs");i.append(n);const a=xt._svgFactory.createElement("path");n.append(a);const o=`path_p${this.pageIndex}_${s}`;a.setAttribute("id",o),a.setAttribute("vector-effect","non-scaling-stroke");let l;if(e){const u=xt._svgFactory.createElement("mask");n.append(u),l=`mask_p${this.pageIndex}_${s}`,u.setAttribute("id",l),u.setAttribute("maskUnits","objectBoundingBox");const p=xt._svgFactory.createElement("rect");u.append(p),p.setAttribute("width","1"),p.setAttribute("height","1"),p.setAttribute("fill","white");const y=xt._svgFactory.createElement("use");u.append(y),y.setAttribute("href",`#${o}`),y.setAttribute("stroke","none"),y.setAttribute("fill","black"),y.setAttribute("fill-rule","nonzero"),y.classList.add("mask")}const h=xt._svgFactory.createElement("use");i.append(h),h.setAttribute("href",`#${o}`),l&&h.setAttribute("mask",`url(#${l})`);const c=h.cloneNode();return i.append(c),h.classList.add("mainOutline"),c.classList.add("secondaryOutline"),this.updateProperties(i,t),r(this,ae).set(s,i),s}finalizeDraw(t,e){r(this,Nr).delete(t),this.updateProperties(t,e)}updateProperties(t,e){var l;if(!e)return;const{root:s,bbox:i,rootClass:n,path:a}=e,o=typeof t=="number"?r(this,ae).get(t):t;if(o){if(s&&m(this,Bs,yu).call(this,o,s),i&&m(l=xt,Mc,cg).call(l,o,i),n){const{classList:h}=o;for(const[c,u]of Object.entries(n))h.toggle(c,u)}if(a){const c=o.firstChild.firstChild;m(this,Bs,yu).call(this,c,a)}}}updateParent(t,e){if(e===this)return;const s=r(this,ae).get(t);s&&(r(e,os).append(s),r(this,ae).delete(t),r(e,ae).set(t,s))}remove(t){r(this,Nr).delete(t),r(this,os)!==null&&(r(this,ae).get(t).remove(),r(this,ae).delete(t))}destroy(){f(this,os,null);for(const t of r(this,ae).values())t.remove();r(this,ae).clear(),r(this,Nr).clear()}};os=new WeakMap,ae=new WeakMap,Nr=new WeakMap,uh=new WeakMap,Mc=new WeakSet,cg=function(t,[e,s,i,n]){const{style:a}=t;a.top=`${100*s}%`,a.left=`${100*e}%`,a.width=`${100*i}%`,a.height=`${100*n}%`},Bs=new WeakSet,mu=function(){const t=xt._svgFactory.create(1,1,!0);return r(this,os).append(t),t.setAttribute("aria-hidden",!0),t},dg=function(t,e){const s=xt._svgFactory.createElement("clipPath");t.append(s);const i=`clip_${e}`;s.setAttribute("id",i),s.setAttribute("clipPathUnits","objectBoundingBox");const n=xt._svgFactory.createElement("use");return s.append(n),n.setAttribute("href",`#${e}`),n.classList.add("clip"),i},yu=function(t,e){for(const[s,i]of Object.entries(e))i===null?t.removeAttribute(s):t.setAttribute(s,i)},g(xt,Mc),g(xt,uh,0);let gu=xt;globalThis._pdfjsTestingUtils={HighlightOutliner:Yd};globalThis.pdfjsLib={AbortException:An,AnnotationEditorLayer:uu,AnnotationEditorParamsType:Y,AnnotationEditorType:z,AnnotationEditorUIManager:Br,AnnotationLayer:Gd,AnnotationMode:Ii,AnnotationType:St,build:$m,ColorPicker:cc,createValidAbsoluteUrl:rf,DOMSVGFactory:uc,DrawLayer:gu,FeatureTest:Xt,fetchData:ph,getDocument:hc,getFilenameFromUrl:Rg,getPdfFilenameFromUrl:kg,getRGB:$c,getUuid:lf,getXfaPageViewport:Mg,GlobalWorkerOptions:Ns,ImageKind:xh,InvalidPDFException:ed,isDataScheme:Oc,isPdfFile:vu,isValidExplicitDest:jg,MathClamp:le,noContextMenu:Ye,normalizeUnicode:Lg,OPS:nc,OutputScale:Fs,PasswordResponses:Ag,PDFDataRangeTransport:hp,PDFDateString:ac,PDFWorker:Bo,PermissionFlag:bg,PixelsPerInch:vn,RenderingCancelledException:Au,ResponseException:rc,setLayerDimensions:Fr,shadow:q,SignatureExtractor:Si,stopEvent:Et,SupportedImageMimeTypes:id,TextLayer:No,TouchManager:lc,updateUrlHash:af,Util:H,VerbosityLevel:Nc,version:Om,XfaLayer:fp};class ly{constructor(){this.state=this._getInitialState()}_getInitialState(){const t=JSON.parse(localStorage.getItem("sovereign-creditors"))||[],e=JSON.parse(localStorage.getItem("sovereign-fdcpa-log"))||[],s=JSON.parse(localStorage.getItem("sovereign-instrument-history"))||[],i=JSON.parse(localStorage.getItem("sovereign-user-profile"))||{name:"",address:""};return{pdfPage:null,endorsement:{text:null,x:0,y:0},userProfile:i,creditors:t,history:s,loopState:"intake",validationResults:{found:[],missing:[]},uccValidationResults:{passed:[],failed:[]},fdcpaLog:e,vehicleContractFile:null,tilaMissingTerms:null,denialLetterFile:null,denialReason:null}}getState(){return this.state}updateState(t){this.state={...this.state,...t}}resetState(){localStorage.removeItem("sovereign-creditors"),localStorage.removeItem("sovereign-fdcpa-log"),localStorage.removeItem("sovereign-instrument-history"),localStorage.removeItem("sovereign-user-profile"),this.state=this._getInitialState()}}const hs={LOCAL_STORAGE:{CREDITORS:"sovereign-creditors",FDCPA_LOG:"sovereign-fdcpa-log",INSTRUMENT_HISTORY:"sovereign-instrument-history",THEME:"sovereign-theme",SOVEREIGN_OVERLAY_CONFIG_PATH_KEY:"sovereign-overlay-config-path",ACTIVE_TAB:"sovereign_active_tab"}};class hy{constructor(t){this.appState=t,this.globalLoader=document.getElementById("global-loader"),this.statusEl=document.getElementById("status"),this.instrumentLogEl=document.getElementById("instrumentLog")}showLoader(){this.globalLoader&&this.globalLoader.classList.remove("hidden")}hideLoader(){this.globalLoader&&this.globalLoader.classList.add("hidden")}setStatus(t,e=!1,s=!1){e&&alert(`Error: ${t}`),this.statusEl&&(this.statusEl.innerHTML=t,e?this.statusEl.className="status-message error":s?this.statusEl.className="status-message success":this.statusEl.className="status-message")}logAction(t){const e=new Date().toLocaleString(),s=this.appState.getState();s.history.push({timestamp:e,action:t}),this.appState.updateState({history:s.history}),localStorage.setItem(hs.LOCAL_STORAGE.INSTRUMENT_HISTORY,JSON.stringify(s.history)),this.renderHistory()}renderHistory(){if(!this.instrumentLogEl)return;const t=this.appState.getState();this.instrumentLogEl.innerHTML="<ul>"+t.history.map(e=>`
            <li><strong>[${e.timestamp}]</strong>: ${e.action}</li>
        `).join("")+"</ul>"}generateDownload(t,e){try{const s=new Blob([t],{type:"text/plain;charset=utf-8"}),i=URL.createObjectURL(s),n=document.createElement("a");n.href=i,n.download=e,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(i),this.setStatus(`File "${e}" downloaded successfully.`,!1,!0)}catch(s){console.error("Error generating download:",s),this.setStatus("Failed to generate download link.",!0)}}copyToClipboard(t,e){navigator.clipboard.writeText(t).then(()=>{this.setStatus(e,!1,!0)}).catch(s=>{console.error("Failed to copy text: ",s),this.setStatus("Failed to copy text.",!0)})}updateSovereignLoopUI(){const t=["intake","validate","remedy","log","reflect"],e=this.appState.getState();t.forEach(s=>{const i=document.getElementById(`loop-${s}`);i&&i.classList.toggle("active",s===e.loopState)})}async extractTextFromPdf(t){this.showLoader(),this.setStatus("Extracting text from PDF...",!1);try{const e=await t.arrayBuffer(),s=new Uint8Array(e),i=await hc(s).promise;let n="";for(let a=1;a<=i.numPages;a++){const l=await(await i.getPage(a)).getTextContent();n+=l.items.map(h=>h.str).join(" ")}return this.setStatus("Text extracted successfully.",!1,!0),n}catch(e){return console.error("Error extracting text from PDF:",e),this.setStatus("Failed to process PDF. It may be corrupted or encrypted.",!0),null}finally{this.hideLoader()}}}const zr={FCRA:{summary:"The Fair Credit Reporting Act (FCRA) is a federal law that promotes the accuracy, fairness, and privacy of consumer information contained in the files of consumer reporting agencies.",legalBasis:"15 U.S.C. § 1681 et seq.",rights:["Right to accuracy and verification (15 U.S.C. § 1681i)","Right to notice of information being furnished (15 U.S.C. § 1681m)","Right to obtain a copy of your file (15 U.S.C. § 1681j)","Right to dispute inaccurate or incomplete information (15 U.S.C. § 1681i)","Right to have outdated information removed (15 U.S.C. § 1681c)","Right to limit prescreened offers (15 U.S.C. § 1681b(e))","Right to obtain a security freeze (15 U.S.C. § 1681c-1)","Right to obtain a fraud alert (15 U.S.C. § 1681c-1)"],disputeProcedure:"Consumers can dispute inaccurate information directly with the credit reporting agency (CRA) or the furnisher of the information. The CRA must investigate the dispute free of charge and usually within 30 days.",violations:{inaccurate_account:{summary:"Inaccurate Account Information",template:"The account information reported is inaccurate. This account is not mine or contains incorrect details."},unauthorized_inquiry:{summary:"Unauthorized Hard Inquiry",template:"An unauthorized hard inquiry appears on my report. I did not authorize this inquiry."},outdated_information:{summary:"Outdated Information",template:"The information reported is outdated and should be removed from my report."},mixed_files:{summary:"Mixed Files",template:"My credit report contains information belonging to another individual."},reinserted_information:{summary:"Reinserted Information",template:"Previously deleted information has been reinserted on my report without proper verification."},identity_theft:{summary:"Identity Theft",template:"This account is the result of identity theft and should be removed."}}},FDCPA:{summary:"The Fair Debt Collection Practices Act (FDCPA) is a federal law that limits the actions of third-party debt collectors. It prohibits abusive, deceptive, and unfair debt collection practices.",legalBasis:"15 U.S.C. § 1692 et seq.",rights:["Right to stop communication (15 U.S.C. § 1692c(c))","Right to a validation notice (15 U.S.C. § 1692g)","Protection against harassment or abuse (15 U.S.C. § 1692d)","Protection against false or misleading representations (15 U.S.C. § 1692e)","Protection against unfair practices (15 U.S.C. § 1692f)"],prohibitedPractices:["Calling repeatedly or continuously (15 U.S.C. § 1692d(5))","Calling before 8 a.m. or after 9 p.m. local time (15 U.S.C. § 1692c(a)(1))","Contacting you at work if they know your employer prohibits it (15 U.S.C. § 1692c(a)(3))","Threatening to harm you or your property (15 U.S.C. § 1692d(1))","Using obscene or profane language (15 U.S.C. § 1692d(2))","Misrepresenting the amount of debt (15 U.S.C. § 1692e(2)(A))","Falsely implying they are attorneys or government representatives (15 U.S.C. § 1692e(3))","Contacting third parties about your debt (with limited exceptions) (15 U.S.C. § 1692c(b))"],violations:{harassment:{summary:"Harassment (e.g., repeated calls)",keywords:["call","harass","repeated","annoy"]},false_representation:{summary:"False Representation (e.g., misrepresenting debt)",keywords:["lie","false","misrepresent","threat"]},calling_unusual_times:{summary:"Calling at Unusual Times (before 8 AM or after 9 PM)",keywords:["time","early","late","hour"]},threatening_illegal_actions:{summary:"Threatening Illegal Actions (e.g., arrest, property seizure)",keywords:["threat","arrest","seize","illegal"]},contacting_third_parties:{summary:"Contacting Third Parties (e.g., employer, family)",keywords:["employer","family","friend","third party"]},failing_validation_notice:{summary:"Failing to Send Validation Notice",keywords:["validate","notice","debt","verify"]}}},TILA:{summary:"The Truth in Lending Act (TILA) is a federal law designed to promote the informed use of consumer credit by requiring disclosures about its terms and cost. It aims to protect consumers in credit transactions.",legalBasis:"15 U.S.C. § 1601 et seq. (Regulation Z)",keyDisclosures:["Annual Percentage Rate (APR)","Finance Charge","Amount Financed","Total of Payments","Total Sale Price (for credit sales)"],remedies:["Right to Rescission (for certain mortgage transactions)","Statutory Damages (for disclosure violations)","Actual Damages","Attorney's Fees and Court Costs"],enforcement:"Enforced by the Consumer Financial Protection Bureau (CFPB) and other federal agencies. Consumers can also sue in federal court."},UCC:{summary:"The Uniform Commercial Code (UCC) is a set of standardized laws governing commercial transactions in the United States. It covers areas like sales, leases, negotiable instruments, and secured transactions.",relevance:"Relevant sections for this application include Article 3 (Negotiable Instruments) and Article 9 (Secured Transactions).",articles:{"Article 3 (Negotiable Instruments)":{summary:"Governs promissory notes, drafts (checks), certificates of deposit, and other negotiable instruments.",sections:["UCC § 3-104: Definition of Negotiable Instrument","UCC § 3-203: Transfer of Instrument; Rights Acquired by Transfer","UCC § 3-302: Holder in Due Course","UCC § 3-415: Obligation of Indorser"]},"Article 9 (Secured Transactions)":{summary:"Governs transactions that combine a debt with a creditor's interest in a debtor's personal property (collateral).",sections:["UCC § 9-102: Definitions and Index of Definitions","UCC § 9-203: Attachment and Enforceability of Security Interest; Proceeds; Supporting Obligations; Formal Requisites","UCC § 9-301: Law Governing Perfection and Priority of Security Interests","UCC § 9-601: Rights After Default; Judicial Enforcement; Consignor or Buyer of Accounts, Chattel Paper, Payment Intangibles, or Promissory Notes"]}}},DenialReasons:{low_score:{summary:"Low Credit Score",keywords:["credit score","score is too low","below our minimum requirements"]},no_history:{summary:"Insufficient Credit History",keywords:["insufficient credit history","no credit file","lack of credit history"]},high_utilization:{summary:"High Credit Utilization",keywords:["high credit utilization","balances are too high","proportion of loan balances"]},late_payments:{summary:"History of Late Payments",keywords:["late payments","delinquent","payment history"]},too_many_inquiries:{summary:"Too Many Recent Inquiries",keywords:["too many inquiries","excessive applications","number of inquiries"]}},Endorsements:{WithoutRecourse:{summary:"Without Recourse (UCC § 3-415(b))",detail:"This qualifier disclaims the endorser's liability to pay the instrument if it is dishonored. The person who takes the instrument cannot sue the endorser if the original maker fails to pay."},ForDepositOnly:{summary:"For Deposit Only (UCC § 3-206(c))",detail:"This is a restrictive endorsement. It requires that the instrument be deposited into an account for the endorser. It prevents anyone else from cashing the check or depositing it into another account."},UCC_1_308:{summary:"Under Protest / Without Prejudice (UCC § 1-308)",detail:"This indicates that you are performing an action (like cashing a check) but are explicitly reserving your rights to dispute the underlying obligation. You are not agreeing that the payment satisfies the full debt."},AcceptedForValue:{summary:"Accepted for Value (A4V)",detail:'This is a controversial theory associated with sovereign citizen and redemption movements. It purports to "accept" a bill as value and use it to discharge a debt via a Treasury account. This is not recognized in mainstream commercial law and can carry legal risks.'}}};class cy{constructor(t,e){this.appState=t,this.utils=e,this.nameInput=document.getElementById("newCreditorName"),this.addressInput=document.getElementById("newCreditorAddress"),this.addBtn=document.getElementById("addCreditorBtn"),this.exportBtn=document.getElementById("exportCreditorsBtn"),this.creditorListEl=document.getElementById("creditorList"),this.init()}init(){this.addBtn.addEventListener("click",()=>this.addCreditor()),this.exportBtn.addEventListener("click",()=>this.exportCreditors()),this.creditorListEl.addEventListener("click",t=>{if(t.target.classList.contains("delete-creditor-btn")){const e=Number(t.target.dataset.id);this.deleteCreditor(e)}}),this.renderCreditorList()}exportCreditors(){const t=this.appState.getState().creditors;if(t.length===0){this.utils.setStatus("No creditors to export.",!0);return}const e=JSON.stringify(t,null,2);this.utils.generateDownload(e,"creditors.json","application/json"),this.utils.logAction("Creditors exported.")}getCreditors(){return this.appState.getState().creditors}addCreditor(){const t=this.nameInput.value.trim(),e=this.addressInput.value.trim();if(!t||!e){this.utils.setStatus("Please enter both a name and address for the creditor.",!0);return}const s={id:Date.now(),name:t,address:e},n=[...this.appState.getState().creditors,s];this.appState.updateState({creditors:n}),this.saveAndRerender(),this.utils.logAction(`Creditor added: ${t}`),this.nameInput.value="",this.addressInput.value=""}deleteCreditor(t){const e=this.appState.getState(),s=e.creditors.find(i=>i.id===t);if(s&&confirm(`Are you sure you want to delete ${s.name}?`)){const i=e.creditors.filter(n=>n.id!==t);this.appState.updateState({creditors:i}),this.saveAndRerender(),this.utils.logAction(`Creditor deleted: ${s.name}`)}}saveAndRerender(){const t=this.appState.getState();localStorage.setItem(hs.LOCAL_STORAGE.CREDITORS,JSON.stringify(t.creditors)),this.renderCreditorList(),document.dispatchEvent(new CustomEvent("creditorsUpdated"))}renderCreditorList(){const t=this.appState.getState();if(t.creditors.length===0){this.creditorListEl.innerHTML='<p class="text-muted">No creditors saved yet.</p>';return}this.creditorListEl.innerHTML=`<ul>${t.creditors.map(e=>`
            <li>
                <div><strong>${e.name}</strong><br><small>${e.address}</small></div>
                <button class="delete-creditor-btn" data-id="${e.id}" title="Delete Creditor">🗑️</button>
            </li>
        `).join("")}</ul>`}}class dy{constructor(t,e){this.appState=t,this.utils=e,this.userNameInput=document.getElementById("profileUserName"),this.userAddressInput=document.getElementById("profileUserAddress"),this.userEmailInput=document.getElementById("profileUserEmail"),this.userPhoneInput=document.getElementById("profileUserPhone"),this.saveBtn=document.getElementById("saveProfileBtn"),this.exportBtn=document.getElementById("exportProfileBtn"),this.statusDiv=document.getElementById("profile-status"),this.init()}init(){this.loadProfile(),this.saveBtn.addEventListener("click",()=>this.saveProfile()),this.exportBtn.addEventListener("click",()=>this.exportProfile())}exportProfile(){const t=this.appState.getState().userProfile;if(!t||!t.name&&!t.address&&!t.email&&!t.phone){this.utils.setStatus("No profile data to export.",!0);return}const e=JSON.stringify(t,null,2);this.utils.generateDownload(e,"user_profile.json","application/json"),this.utils.logAction("User profile exported.")}async loadProfile(){try{const t=await fetch("/api/profile");if(t.ok){const e=await t.json();e&&(this.userNameInput.value=e.name||"",this.userAddressInput.value=e.address||"",this.userEmailInput.value=e.email||"",this.userPhoneInput.value=e.phone||"",this.appState.updateState({userProfile:e}))}}catch(t){console.error("Failed to load profile:",t),this.utils.setStatus("Could not load profile from server.",!0)}}async saveProfile(){const t=this.userNameInput.value.trim(),e=this.userAddressInput.value.trim(),s=this.userEmailInput.value.trim(),i=this.userPhoneInput.value.trim();if(!t||!e){this.utils.setStatus("Please enter both your name and address.",!0);return}this.utils.showLoader(),this.statusDiv.textContent="";try{const n=await fetch("/api/profile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:t,address:e,email:s,phone:i})});if(n.ok)this.appState.updateState({userProfile:{name:t,address:e,email:s,phone:i}}),this.utils.setStatus("User profile saved successfully.",!1,!0),this.utils.logAction("User profile updated."),this.statusDiv.textContent="Profile saved successfully!",this.statusDiv.classList.add("success"),setTimeout(()=>{this.statusDiv.textContent="",this.statusDiv.classList.remove("success")},3e3);else{const a=await n.json();this.utils.setStatus(`Error saving profile: ${a.error}`,!0)}}catch(n){console.error("Failed to save profile:",n),this.utils.setStatus("An error occurred while saving the profile.",!0)}finally{this.utils.hideLoader()}}}class uy{constructor(t,e,s,i){this.appState=t,this.knowledgeBase=e,this.utils=s,this.creditorManager=i,this.letterContent="",this.contractInput=document.getElementById("vehicleContract"),this.validateBtn=document.getElementById("validateDisclosureBtn"),this.scanBtn=document.getElementById("scanContractBtn"),this.scanResultsEl=document.getElementById("scanResults"),this.remedyDetailsEl=document.getElementById("tila-remedy-details"),this.tilaValidationResultsEl=document.getElementById("tila-validation-results"),this.tilaResultsListEl=document.getElementById("tila-results-list"),this.tilaCreditorSelect=document.getElementById("tilaCreditorSelect"),this.tilaCreditorName=document.getElementById("tilaCreditorName"),this.tilaCreditorAddress=document.getElementById("tilaCreditorAddress"),this.tilaContractDate=document.getElementById("tilaContractDate"),this.tilaVehicleInfo=document.getElementById("tilaVehicleInfo"),this.generateRemedyBtn=document.getElementById("generateRemedyBtn"),this.copyTilaLetterBtn=document.getElementById("copyTilaLetterBtn"),this.init()}init(){this.validateBtn.addEventListener("click",()=>this.validateTilaDisclosures()),this.scanBtn.addEventListener("click",()=>this.scanForTerms()),this.generateRemedyBtn.addEventListener("click",()=>this.generateTilaRemedyLetter()),this.copyTilaLetterBtn.addEventListener("click",()=>this.copyTilaLetter()),this.contractInput.addEventListener("change",e=>{e.target.files.length>0&&(this.appState.updateState({vehicleContractFile:e.target.files[0]}),this.utils.logAction("Vehicle contract uploaded."))}),this.populateCreditors(),document.addEventListener("creditorsUpdated",()=>this.populateCreditors()),this.tilaCreditorSelect.addEventListener("change",()=>this.handleCreditorSelect()),this.remedyDetailsEl.querySelectorAll("input, select").forEach(e=>e.addEventListener("input",()=>{this.letterContent=""}))}populateCreditors(){const t=this.creditorManager.getCreditors();this.tilaCreditorSelect.innerHTML='<option value="">Select a Creditor</option>',t.forEach(e=>{const s=document.createElement("option");s.value=e.id,s.textContent=e.name,this.tilaCreditorSelect.appendChild(s)})}handleCreditorSelect(){const t=this.tilaCreditorSelect.value;if(t){const e=this.creditorManager.getCreditors().find(s=>s.id==t);e&&(this.tilaCreditorName.value=e.name,this.tilaCreditorAddress.value=e.address)}else this.tilaCreditorName.value="",this.tilaCreditorAddress.value=""}_getRemedyLetterText(){if(this.letterContent)return this.letterContent;const t=this.appState.getState(),{name:e,address:s}=t.userProfile;if(!e||!s)return this.utils.setStatus("Please save your name and address in the User Profile section first.",!0),null;const i=this.tilaCreditorName.value.trim(),n=this.tilaCreditorAddress.value.trim();if(!i||!n)return this.utils.setStatus("Please enter the creditor name and address.",!0),null;const a={userName:e,userAddress:s,creditorName:i,creditorAddress:n,contractDate:this.tilaContractDate.value.trim(),vehicleInfo:this.tilaVehicleInfo.value.trim(),currentDate:new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})};for(const[c,u]of Object.entries(a))if(!u){const p=c.replace(/([A-Z])/g," $1").replace(/^./,y=>y.toUpperCase());return this.utils.setStatus(`Please fill out the "${p}" field.`,!0),null}const l=(t.tilaMissingTerms||["required disclosures"]).join(", "),h=`
${a.userName}
${a.userAddress}

${a.currentDate}

${a.creditorName}
${a.creditorAddress}

VIA CERTIFIED MAIL

RE: NOTICE OF TILA VIOLATIONS AND DEMAND FOR REMEDY
Contract Date: ${a.contractDate}
Vehicle: ${a.vehicleInfo}

To Whom It May Concern:

This letter serves as a formal notice of violations of the Truth in Lending Act (TILA), 15 U.S.C. § 1601 et seq., and its implementing regulation, Regulation Z (12 C.F.R. Part 1026), in the above-referenced consumer credit transaction.

Upon review of the contract dated ${a.contractDate} for the financing of a ${a.vehicleInfo}, it has come to my attention that you have failed to provide clear and conspicuous written disclosures as required by federal law. Specifically, the following material disclosures were found to be missing or inaccurate:

- ${l}

TILA § 1638(a) mandates that for each closed-end consumer credit transaction, the creditor shall disclose specific information to the consumer before credit is extended. Your failure to provide these disclosures constitutes a clear violation of your statutory obligations.

This violation grants the consumer the right to remedies, which may include statutory damages and the right of rescission where applicable.

I hereby demand that you remedy this violation immediately by providing a corrected disclosure statement that fully complies with TILA and Regulation Z. Failure to cure these violations within a reasonable timeframe will compel me to seek all available legal remedies, including but not limited to filing a complaint with the Consumer Financial Protection Bureau (CFPB) and pursuing private litigation for damages.

Please govern yourselves accordingly.

Sincerely,

_________________________
${a.userName}
        `.trim();return this.letterContent=h,h}generateTilaRemedyLetter(){const t=this._getRemedyLetterText();if(!t)return;const e=`TILA_Remedy_Letter_${this.tilaCreditorName.value.trim().replace(/\s/g,"_")}.txt`;this.utils.generateDownload(t,e),this.utils.logAction("TILA remedy letter generated and downloaded.")}copyTilaLetter(){const t=this._getRemedyLetterText();t&&(this.utils.copyToClipboard(t,"TILA remedy letter text copied to clipboard."),this.utils.logAction("TILA remedy letter text copied."))}async validateTilaDisclosures(){const t=this.appState.getState();if(!t.vehicleContractFile){this.utils.setStatus("Please upload a vehicle contract first.",!0);return}const e=new FormData;e.append("file",t.vehicleContractFile),this.utils.showLoader(),this.utils.setStatus("Analyzing TILA disclosures...");try{const s=await fetch("/api/vehicle/validate-tila",{method:"POST",body:e});if(!s.ok){const n=await s.json();throw new Error(n.error||"Failed to validate TILA disclosures.")}const i=await s.json();this.displayTilaResults(i.results)}catch(s){console.error("Error validating TILA disclosures:",s),this.utils.setStatus(s.message,!0)}finally{this.utils.hideLoader()}}displayTilaResults(t){this.tilaValidationResultsEl.classList.remove("hidden"),this.tilaResultsListEl.innerHTML="";let e=[];for(const[s,i]of Object.entries(t)){const n=document.createElement("li");n.textContent=`${s}: `;const a=document.createElement("span");a.textContent=i?"FOUND":"MISSING",a.classList.add(i?"text-success":"text-error"),n.appendChild(a),this.tilaResultsListEl.appendChild(n),i||e.push(s)}e.length>0?(this.appState.updateState({tilaMissingTerms:e}),this.utils.setStatus(`Missing TILA disclosures: ${e.join(", ")}`,!0),this.remedyDetailsEl.classList.remove("hidden")):(this.appState.updateState({tilaMissingTerms:[]}),this.utils.setStatus("All required TILA disclosures appear to be present.",!1,!0),this.remedyDetailsEl.classList.add("hidden"))}async scanForTerms(){const t=this.appState.getState();if(!t.vehicleContractFile){this.utils.setStatus("Please upload a vehicle contract first.",!0);return}const e=document.getElementById("violationTags").value,s=new FormData;s.append("file",t.vehicleContractFile),s.append("tag",e),this.utils.showLoader(),this.scanResultsEl.innerHTML="";try{const i=await fetch("/scan-for-terms",{method:"POST",body:s});if(!i.ok){const a=await i.json();throw new Error(a.error||"Failed to scan document.")}const n=await i.json();this.displayScanResults(n.found_clauses,e)}catch(i){console.error("Error scanning document:",i),this.utils.setStatus(i.message,!0)}finally{this.utils.hideLoader()}}displayScanResults(t,e){if(t.length===0){this.scanResultsEl.innerHTML=`<p class="text-muted">No clauses containing keywords for "${e}" were found.</p>`;return}const s=t.map(i=>`
            <li class="context-clause">
                <p class="context context-before">${i.before}</p>
                <blockquote class="context-match">${this.highlightKeywords(i.match,e)}</blockquote>
                <p class="context context-after">${i.after}</p>
            </li>
        `).join("");this.scanResultsEl.innerHTML=`
            <h3>Scan Results for "${e}"</h3>
            <ul class="context-list">${s}</ul>
        `}highlightKeywords(t,e){const i={hidden_fee:["convenience fee","service charge","processing fee","undisclosed","surcharge"],misrepresentation:["misrepresented","misleading","deceptive","false statement","inaccurate"],arbitration:["arbitration","arbitrator","binding arbitration","waive your right to"]}[e]||[];let n=t;return i.forEach(a=>{const o=new RegExp(`(${a})`,"gi");n=n.replace(o,'<strong class="text-error">$1</strong>')}),n}reset(t=!0){t&&(this.contractInput.value="",this.appState.updateState({vehicleContractFile:null})),this.scanResultsEl.innerHTML="",this.remedyDetailsEl.classList.add("hidden"),this.tilaValidationResultsEl.classList.add("hidden"),this.tilaResultsListEl.innerHTML="",this.remedyDetailsEl.querySelectorAll("input").forEach(e=>e.value=""),this.letterContent="",this.appState.updateState({tilaMissingTerms:null})}}class fy{constructor(t,e,s){this.appState=t,this.knowledgeBase=e,this.utils=s,this.billUploadInput=document.getElementById("billUpload"),this.renderPreviewBtn=document.getElementById("renderPreview"),this.clearFormBtn=document.getElementById("clearEndorsementFormBtn"),this.canvas=document.getElementById("previewCanvas"),this.ctx=this.canvas.getContext("2d"),this.loader=document.getElementById("loader"),this.endorsementFieldset=document.getElementById("endorsement-fieldset"),this.endorsementText=document.getElementById("endorsementText"),this.qualifierSelect=document.getElementById("qualifier"),this.qualifierTooltip=document.getElementById("qualifier-tooltip"),this.acceptedForValueWarning=document.getElementById("acceptedForValueWarning"),this.saveBtn=document.getElementById("saveEndorsementBtn"),this.validateNegoBtn=document.getElementById("validateNegotiabilityBtn"),this.nonNegoBtn=document.getElementById("generateNonNegotiableNoticeBtn"),this.nonNegoContainer=document.getElementById("nonNegotiableNoticeContainer"),this.nonNegoText=document.getElementById("nonNegotiableNoticeText"),this.copyNoticeBtn=document.getElementById("copyNoticeBtn"),this.downloadNoticeBtn=document.getElementById("downloadNoticeBtn"),this.generateTenderLetterBtn=document.getElementById("generateTenderLetterBtn"),this.tenderLetterContainer=document.getElementById("tenderLetterContainer"),this.tenderLetterText=document.getElementById("tenderLetterText"),this.copyTenderLetterBtn=document.getElementById("copyTenderLetterBtn"),this.downloadTenderLetterBtn=document.getElementById("downloadTenderLetterBtn"),this.init()}init(){this.renderPreviewBtn.addEventListener("click",()=>this.renderPdfPreview()),this.clearFormBtn.addEventListener("click",()=>this.resetForm()),this.validateNegoBtn.addEventListener("click",()=>this.validateNegotiability()),this.saveBtn.addEventListener("click",()=>this.stampEndorsement()),this.nonNegoBtn.addEventListener("click",()=>this.generateNonNegotiableNotice()),this.generateTenderLetterBtn.addEventListener("click",()=>this.generateTenderLetter()),this.canvas.addEventListener("click",t=>this.handleCanvasClick(t)),this.copyNoticeBtn.addEventListener("click",()=>this.copyNotice()),this.downloadNoticeBtn.addEventListener("click",()=>this.downloadNotice()),this.copyTenderLetterBtn.addEventListener("click",()=>this.copyTenderLetter()),this.downloadTenderLetterBtn.addEventListener("click",()=>this.downloadTenderLetter()),this.billUploadInput.addEventListener("change",t=>{t.target.files.length>0&&(this.appState.updateState({billFile:t.target.files[0]}),this.utils.logAction("Bill/instrument uploaded."),this.endorsementFieldset.disabled=!1,this.resetEndorsementState(),this.resetTenderLetterState())}),this.qualifierSelect.addEventListener("mouseover",()=>this.showQualifierTooltip()),this.qualifierSelect.addEventListener("mouseout",()=>this.hideQualifierTooltip()),this.qualifierSelect.addEventListener("mousemove",t=>this.moveQualifierTooltip(t)),this.qualifierSelect.addEventListener("change",()=>this.showQualifierTooltip())}handleCanvasClick(t){const e=this.appState.getState();if(!e.pdfPage){this.utils.setStatus("Please render a PDF preview first.",!0);return}const s=this.endorsementText.value.trim();if(!s){this.utils.setStatus("Please enter endorsement text before selecting a position.",!0);return}const i=this.canvas.getBoundingClientRect(),n=t.clientX-i.left,a=t.clientY-i.top,o=e.pdfViewport.convertToPdfPoint(n,a);this.appState.updateState({endorsementCoords:{x:o[0],y:o[1]}}),this.utils.setStatus("Endorsement position set. Ready to save.",!1),this.utils.logAction("Endorsement position selected."),this.saveBtn.disabled=!1,this.renderPdfPreview().then(()=>{this.ctx.fillStyle="rgba(200, 0, 0, 0.8)",this.ctx.font="10px sans-serif";const l=this.qualifierSelect.value,h=`${s} - ${l}`;this.ctx.fillText(h,n,a)})}async stampEndorsement(){const t=this.appState.getState();if(!t.billFile||!t.endorsementCoords){this.utils.setStatus("Please upload a bill and select an endorsement position on the preview.",!0);return}const e=this.endorsementText.value.trim(),s=this.qualifierSelect.value;if(!e){this.utils.setStatus("Please enter endorsement text.",!0);return}this.utils.showLoader(),this.utils.setStatus("Stamping endorsement...",!1);const i=new FormData;i.append("bill",t.billFile),i.append("x",t.endorsementCoords.x),i.append("y",t.endorsementCoords.y),i.append("endorsement_text",e),i.append("qualifier",s);try{const n=await fetch("/stamp_endorsement",{method:"POST",body:i});if(!n.ok){const o=await n.json();throw new Error(o.error||"An unknown error occurred during stamping.")}const a=await n.blob();this.utils.generateDownload(a,`endorsed_${t.billFile.name}`),this.utils.setStatus("Endorsement successful! Check your downloads.",!1,!0),this.utils.logAction("Endorsement stamped and downloaded.")}catch(n){console.error("Error stamping endorsement:",n),this.utils.setStatus(`Error: ${n.message}`,!0)}finally{this.utils.hideLoader()}}showQualifierTooltip(){const e=this.qualifierSelect.options[this.qualifierSelect.selectedIndex].dataset.kbKey;if(this.acceptedForValueWarning.classList.add("hidden"),e&&this.knowledgeBase.Endorsements&&this.knowledgeBase.Endorsements[e]){const s=this.knowledgeBase.Endorsements[e];this.qualifierTooltip.innerHTML=`<strong>${s.summary}</strong><p>${s.detail}</p>`,this.qualifierTooltip.classList.remove("hidden"),e==="AcceptedForValue"&&this.acceptedForValueWarning.classList.remove("hidden")}}hideQualifierTooltip(){this.qualifierTooltip.classList.add("hidden"),this.acceptedForValueWarning.classList.add("hidden")}moveQualifierTooltip(t){this.qualifierTooltip.style.left=`${t.pageX+15}px`,this.qualifierTooltip.style.top=`${t.pageY+15}px`}async renderPdfPreview(){const t=this.appState.getState();if(!t.billFile){this.utils.setStatus("Please upload a bill/instrument first.",!0);return}this.loader.classList.remove("hidden"),this.canvas.classList.add("hidden");try{const e=await t.billFile.arrayBuffer(),i=await(await hc({data:e}).promise).getPage(1);this.appState.updateState({pdfPage:i});const n=i.getViewport({scale:this.canvas.width/i.getViewport({scale:1}).width});this.appState.updateState({pdfViewport:n}),this.canvas.height=n.height;const a={canvasContext:this.ctx,viewport:n};await i.render(a).promise,this.utils.setStatus("Preview rendered. Click on the preview to place your endorsement.",!1),this.utils.logAction("PDF preview rendered.")}catch(e){console.error("Error rendering PDF:",e),this.utils.setStatus("Failed to render PDF. It might be corrupted or in an unsupported format.",!0)}finally{this.loader.classList.add("hidden"),this.canvas.classList.remove("hidden")}}async processBillOnBackend(){const t=this.appState.getState();if(!t.billFile){this.utils.setStatus("Please upload a bill/instrument first.",!0);return}this.utils.showLoader(),this.utils.setStatus("Processing bill on the server...",!1);const e=new FormData;e.append("bill",t.billFile);try{const s=await fetch("/endorse-bill",{method:"POST",body:e}),i=await s.json();if(!s.ok)throw new Error(i.error||"An unknown error occurred.");this.utils.setStatus(i.message||"Bill processed successfully!",!1),this.utils.logAction("Backend processing complete."),i.endorsed_files&&i.endorsed_files.length>0&&this.utils.logAction(`Endorsed files created: ${i.endorsed_files.join(", ")}`)}catch(s){console.error("Error processing bill:",s),this.utils.setStatus(`Error: ${s.message}`,!0)}finally{this.utils.hideLoader()}}async _getPDFText(t){if(!t)return"";const e=await t.arrayBuffer(),s=await hc({data:e}).promise;let i="";for(let n=1;n<=s.numPages;n++){const o=await(await s.getPage(n)).getTextContent();i+=o.items.map(l=>l.str).join(" ")}return i.toLowerCase()}async validateNegotiability(){this.utils.showLoader(),this.utils.setStatus("Analyzing instrument for negotiability...",!1);const t=this.appState.getState();if(!t.billFile){this.utils.setStatus("Please upload a bill/instrument first.",!0),this.utils.hideLoader();return}try{const e=await this._getPDFText(t.billFile),s=[],i=[];if(e.includes("pay to the order of")||e.includes("pay to bearer")?i.push("Contains promise to pay to order or bearer."):s.push('Missing "Pay to the order of" or "Pay to bearer" language.'),/$\\s?[\d,]+(\\.\\d{2})?\b/.test(e)?i.push("Specifies a fixed amount of money."):s.push("Does not appear to specify a fixed amount of money (e.g., $1,234.56)."),/subject to|governed by|as per/.test(e)?s.push('The promise or order may be conditional (contains "subject to", "governed by", etc.).'):i.push("The promise or order appears to be unconditional."),e.includes("on demand")||/\bon or before\b/.test(e)||/\b\d{1,2}\/\d{1,2}\/\d{2,4}\b/.test(e)?i.push("Appears to be payable on demand or at a definite time."):s.push("Does not appear to be payable on demand or at a definite time."),this.appState.updateState({negotiabilityFailures:s}),s.length>0){let n=s.map(a=>`<li>- ${a}</li>`).join("");this.utils.setStatus(`<strong>Instrument may not be negotiable:</strong><ul>${n}</ul>`,!0),this.nonNegoBtn.classList.remove("hidden"),this.generateTenderLetterBtn.disabled=!0,this.utils.logAction("Validation failed.",{failures:s})}else{let n=i.map(a=>`<li>- ${a}</li>`).join("");this.utils.setStatus(`<strong>Instrument appears to be negotiable:</strong><ul>${n}</ul>`,!1,!0),this.nonNegoBtn.classList.add("hidden"),this.generateTenderLetterBtn.disabled=!1,this.utils.logAction("Validation succeeded.",{successes:i})}}catch(e){console.error("Error validating negotiability:",e),this.utils.setStatus("Could not analyze the document.",!0)}finally{this.utils.hideLoader()}}generateNonNegotiableNotice(){const t=this.appState.getState(),{negotiabilityFailures:e,userProfile:s,billFile:i}=t;if(!e||e.length===0){this.utils.setStatus("No negotiability failures were found.",!0);return}if(!s||!s.name||!s.address){this.utils.setStatus("Please complete your user profile first.",!0);return}const n=new Date().toLocaleDateString(),a=e.map(l=>`- ${l}`).join(`
`),o=`
[${s.name}]
[${s.address}]

[${n}]

TO: [Creditor Name and Address Here]

NOTICE OF NON-NEGOTIABLE INSTRUMENT

This letter is to inform you that the instrument titled "${i?i.name:"N/A"}" is not a negotiable instrument under the Uniform Commercial Code (UCC) for the following reasons:

${a}

This notice is to inform you of these defects. Any attempt to negotiate this instrument may be unlawful.

Sincerely,

_________________________
${s.name}
        `.trim();this.nonNegoText.value=o,this.nonNegoContainer.classList.remove("hidden"),this.utils.setStatus("Non-negotiable notice generated below.",!1),this.utils.logAction("Non-negotiable notice generated.")}copyNotice(){this.nonNegoText.select(),document.execCommand("copy"),this.utils.setStatus("Notice copied to clipboard!",!1,!0)}downloadNotice(){const t=this.nonNegoText.value,e=new Blob([t],{type:"text/plain"});this.utils.generateDownload(e,"non-negotiable-notice.txt")}resetEndorsementState(){this.saveBtn.disabled=!0,this.appState.updateState({endorsementCoords:null,pdfPage:null,pdfViewport:null,negotiabilityFailures:null}),this.nonNegoContainer.classList.add("hidden")}resetForm(){this.billUploadInput.value="",this.appState.updateState({billFile:null}),this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.endorsementFieldset.disabled=!0,this.nonNegoBtn.classList.add("hidden"),this.resetEndorsementState(),this.resetTenderLetterState(),this.endorsementText.value="",this.qualifierSelect.value="",this.saveBtn.disabled=!0,this.validateNegoBtn.disabled=!1,this.generateTenderLetterBtn.disabled=!0}resetTenderLetterState(){this.tenderLetterContainer.classList.add("hidden"),this.tenderLetterText.value=""}async generateTenderLetter(){const t=this.appState.getState(),{userProfile:e,billFile:s}=t;if(!e||!e.name||!e.address){this.utils.setStatus("Please complete your user profile (Your Information) first.",!0);return}if(!s){this.utils.setStatus("Please upload a bill/instrument first.",!0);return}const i="[Creditor Name Here]",n="[Creditor Address Here]";this.utils.showLoader(),this.utils.setStatus("Generating tender letter...",!1);try{const a=await fetch("/generate_tender_letter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({userName:e.name,userAddress:e.address,creditorName:i,creditorAddress:n,billFileName:s.name})});if(!a.ok){const l=await a.json();throw new Error(l.error||"An unknown error occurred during tender letter generation.")}const o=await a.json();this.tenderLetterText.value=o.letterContent,this.tenderLetterContainer.classList.remove("hidden"),this.utils.setStatus("Tender letter generated below.",!1,!0),this.utils.logAction("Tender letter generated.")}catch(a){console.error("Error generating tender letter:",a),this.utils.setStatus(`Error: ${a.message}`,!0)}finally{this.utils.hideLoader()}}copyTenderLetter(){this.tenderLetterText.select(),document.execCommand("copy"),this.utils.setStatus("Tender letter copied to clipboard!",!1,!0)}downloadTenderLetter(){const t=this.tenderLetterText.value,e=new Blob([t],{type:"text/plain"});this.utils.generateDownload(e,"tender-letter.txt")}}class py{constructor(){this.accountTypesChartCtx=document.getElementById("account-types-chart").getContext("2d"),this.utilizationChartCtx=document.getElementById("utilization-chart").getContext("2d"),this.charts={}}destroyCharts(){for(const t in this.charts)this.charts[t]&&this.charts[t].destroy()}createCharts(t){this.destroyCharts(),this._createAccountTypesChart(t),this._createUtilizationChart(t),document.getElementById("credit-report-summary").classList.remove("hidden")}_createAccountTypesChart(t){const e=t.reduce((s,i)=>{const n=i.type||"Unknown";return s[n]=(s[n]||0)+1,s},{});this.charts.accountTypes=new Chart(this.accountTypesChartCtx,{type:"pie",data:{labels:Object.keys(e),datasets:[{label:"Account Types",data:Object.values(e),backgroundColor:["rgba(255, 99, 132, 0.7)","rgba(54, 162, 235, 0.7)","rgba(255, 206, 86, 0.7)","rgba(75, 192, 192, 0.7)","rgba(153, 102, 255, 0.7)","rgba(255, 159, 64, 0.7)"]}]},options:{responsive:!0,plugins:{legend:{position:"top"},title:{display:!0,text:"Account Types Breakdown"}}}})}_createUtilizationChart(t){const e=t.filter(s=>s.type.toLowerCase().includes("credit")&&s.balance&&s.credit_limit&&s.balance!=="N/A"&&s.credit_limit!=="N/A").map(s=>{const i=parseFloat(s.balance.replace(/[^\d.]/g,"")),n=parseFloat(s.credit_limit.replace(/[^\d.]/g,""));return{name:s.name,utilization:n>0?i/n*100:0}});e.length!==0&&(this.charts.utilization=new Chart(this.utilizationChartCtx,{type:"bar",data:{labels:e.map(s=>s.name),datasets:[{label:"Credit Utilization (%)",data:e.map(s=>s.utilization),backgroundColor:"rgba(75, 192, 192, 0.7)"}]},options:{responsive:!0,scales:{y:{beginAtZero:!0,max:100}},plugins:{legend:{display:!1},title:{display:!0,text:"Credit Utilization"}}}}))}}class gy{constructor(t,e,s,i){this.appState=t,this.knowledgeBase=e,this.utils=s,this.creditorManager=i,this.visualizer=new py,this.letterContent="",this.creditReportUpload=document.getElementById("creditReportUpload"),this.parseReportBtn=document.getElementById("parseReportBtn"),this.generateSampleReportBtn=document.getElementById("generateSampleReportBtn"),this.parsedAccountsDiv=document.getElementById("parsed-accounts"),this.parsedAccountsList=document.getElementById("parsed-accounts-list"),this.violationSelect=document.getElementById("fcraViolationSelect"),this.fcraCreditorSelect=document.getElementById("fcraCreditorSelect"),this.fcraViolationInfo=document.getElementById("fcraViolationInfo"),this.fcraViolationDetails=document.getElementById("fcraViolationDetails"),this.accountInput=document.getElementById("accountNumberInput"),this.reasonInput=document.getElementById("disputeReasonInput"),this.generateBtn=document.getElementById("generateDisputeBtn"),this.copyBtn=document.getElementById("copyFcraLetterBtn"),this.trackDisputeBtn=document.getElementById("trackDisputeBtn"),this.disputeTrackingTable=document.getElementById("dispute-tracking-table"),this.selectCreditorBtn=document.getElementById("selectCreditorBtn"),this.resultsEl=document.getElementById("fcraResults"),this.confirmationModal=document.getElementById("confirmationModal"),this.modalTitle=document.getElementById("modalTitle"),this.modalBody=document.getElementById("modalBody"),this.modalConfirmBtn=document.getElementById("modalConfirmBtn"),this.modalCancelBtn=document.getElementById("modalCancelBtn"),this.init()}init(){this.populateViolations(),this.populateCreditors(),this.generateBtn.addEventListener("click",()=>this.generateDisputeLetter()),this.copyBtn.addEventListener("click",()=>this.copyDisputeLetter()),this.parseReportBtn.addEventListener("click",()=>this.parseReport()),this.generateSampleReportBtn.addEventListener("click",()=>this.generateSampleReport()),this.trackDisputeBtn.addEventListener("click",()=>this.trackDispute()),this.selectCreditorBtn.addEventListener("click",()=>this.showCreditorSelection()),this.fcraViolationInfo.addEventListener("click",()=>this.toggleViolationDetails()),this.loadDisputes(),this.accountInput.addEventListener("input",()=>{this.letterContent=""}),this.reasonInput.addEventListener("input",()=>{this.letterContent=""}),this.violationSelect.addEventListener("change",()=>{this.letterContent="",this.fcraViolationDetails.classList.add("hidden")}),this.modalCancelBtn.addEventListener("click",()=>this.confirmationModal.classList.add("hidden")),document.addEventListener("creditorsUpdated",()=>this.populateCreditors())}generateSampleReport(){const t=[{name:"Capital One",number:"**** **** **** 1234",type:"Credit Card",status:"Open",balance:"$1,500.00",credit_limit:"$5,000.00",payment_history:"On Time"},{name:"Wells Fargo",number:"**** **** **** 5678",type:"Auto Loan",status:"Open",balance:"$15,000.00",credit_limit:"N/A",payment_history:"On Time"},{name:"Bank of America",number:"**** **** **** 9012",type:"Credit Card",status:"Open",balance:"$800.00",credit_limit:"$2,000.00",payment_history:"On Time"},{name:"Student Loan Servicing",number:"**** **** **** 3456",type:"Student Loan",status:"Open",balance:"$25,000.00",credit_limit:"N/A",payment_history:"On Time"},{name:"Discover",number:"**** **** **** 7890",type:"Credit Card",status:"Closed",balance:"$0.00",credit_limit:"$3,000.00",payment_history:"On Time"}];this.displayAccounts(t),this.utils.setStatus("Sample credit report generated.",!1,!0)}populateCreditors(){const t=this.creditorManager.getCreditors();this.fcraCreditorSelect.innerHTML='<option value="">Select a Creditor</option>',t.forEach(e=>{const s=document.createElement("option");s.value=e.id,s.textContent=e.name,this.fcraCreditorSelect.appendChild(s)})}populateViolations(){const t=this.knowledgeBase.FCRA.violations;for(const e in t){const s=document.createElement("option");s.value=e,s.textContent=t[e].summary,this.violationSelect.appendChild(s)}}toggleViolationDetails(){if(this.fcraViolationDetails.classList.contains("hidden")){const t=this.violationSelect.value,e=this.knowledgeBase.FCRA.violations[t];e&&(this.fcraViolationDetails.innerHTML=`
                    <h4>${e.summary}</h4>
                    <p>${e.description}</p>
                    <p><strong>Legal Basis:</strong> ${e.legalBasis}</p>
                `,this.fcraViolationDetails.classList.remove("hidden"))}else this.fcraViolationDetails.classList.add("hidden")}async parseReport(){const t=this.creditReportUpload.files[0];if(!t){this.utils.setStatus("Please select a credit report file to upload.",!0);return}const e=new FormData;e.append("file",t),this.utils.showLoader();try{const s=await fetch("/api/credit-report/upload",{method:"POST",body:e});if(s.ok){const i=await s.json();this.displayAccounts(i.accounts)}else{const i=await s.json();this.utils.setStatus(`Error parsing report: ${i.error}`,!0)}}catch(s){console.error("Failed to parse report:",s),this.utils.setStatus("An error occurred while parsing the report.",!0)}finally{this.utils.hideLoader()}}displayAccounts(t){if(this.parsedAccountsDiv.classList.remove("hidden"),this.parsedAccountsList.innerHTML="",t.length===0){this.parsedAccountsList.innerHTML="<p>No accounts found in the report.</p>";return}const e=t.map(s=>`
            <div class="account-card">
                <div class="account-header">
                    <h3>${s.name}</h3>
                    <button class="start-dispute-btn" data-name="${s.name}" data-number="${s.number}">Start Dispute</button>
                </div>
                <div class="account-details">
                    <p><strong>Account Number:</strong> ${s.number}</p>
                    <p><strong>Type:</strong> ${s.type}</p>
                    <p><strong>Status:</strong> ${s.status}</p>
                    <p><strong>Balance:</strong> ${s.balance}</p>
                    <p><strong>Credit Limit:</strong> ${s.credit_limit}</p>
                    <p><strong>Payment History:</strong> ${s.payment_history}</p>
                </div>
            </div>
        `).join("");this.parsedAccountsList.innerHTML=e,this.visualizer.createCharts(t),document.querySelectorAll(".start-dispute-btn").forEach(s=>{s.addEventListener("click",i=>{const n=i.target.dataset.name,a=i.target.dataset.number;this.populateDisputeForm(n,a)})})}populateDisputeForm(t,e){this.accountInput.value=`${t} - ${e}`;const s=this.creditorManager.getCreditors(),i=t.toLowerCase(),n=s.find(o=>i.includes(o.name.toLowerCase()));n&&(this.fcraCreditorSelect.value=n.id);const a=document.getElementById("dispute-form");a&&a.scrollIntoView({behavior:"smooth"})}async trackDispute(){const t=this.accountInput.value.trim();if(!t){this.utils.setStatus("Please enter account information before tracking a dispute.",!0);return}const[e,s]=t.split(" - ");try{const i=await fetch("/api/disputes",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({account_name:e,account_number:s})});if(i.ok)this.utils.setStatus("Dispute tracked successfully.",!1,!0),this.loadDisputes();else{const n=await i.json();this.utils.setStatus(`Error tracking dispute: ${n.error}`,!0)}}catch(i){console.error("Failed to track dispute:",i),this.utils.setStatus("An error occurred while tracking the dispute.",!0)}}async loadDisputes(){try{const t=await fetch("/api/disputes");if(t.ok){const e=await t.json();this.displayDisputes(e)}else this.utils.setStatus("Could not load disputes from server.",!0)}catch(t){console.error("Failed to load disputes:",t),this.utils.setStatus("An error occurred while loading disputes.",!0)}}displayDisputes(t){if(this.appState.updateState({disputes:t}),document.dispatchEvent(new CustomEvent("disputesUpdated")),this.disputeTrackingTable.innerHTML="",t.length===0){this.disputeTrackingTable.innerHTML="<p>No disputes tracked yet.</p>";return}const e=document.createElement("table");e.innerHTML=`
            <thead>
                <tr>
                    <th>Account Name</th>
                    <th>Account Number</th>
                    <th>Date Sent</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>
                ${t.map(s=>`
                    <tr>
                        <td>${s.account_name}</td>
                        <td>${s.account_number}</td>
                        <td>${s.date_sent}</td>
                        <td>
                            <select class="dispute-status-select" data-id="${s.id}">
                                <option value="Sent" ${s.status==="Sent"?"selected":""}>Sent</option>
                                <option value="Responded" ${s.status==="Responded"?"selected":""}>Responded</option>
                                <option value="Resolved" ${s.status==="Resolved"?"selected":""}>Resolved</option>
                            </select>
                        </td>
                    </tr>
                `).join("")}
            </tbody>
        `,this.disputeTrackingTable.appendChild(e),document.querySelectorAll(".dispute-status-select").forEach(s=>{s.addEventListener("change",i=>{const n=i.target.dataset.id,a=i.target.value;this.updateDisputeStatus(n,a)})})}async updateDisputeStatus(t,e){try{const s=await fetch(`/api/disputes/${t}`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:e})});if(s.ok)this.utils.setStatus("Dispute status updated successfully.",!1,!0);else{const i=await s.json();this.utils.setStatus(`Error updating dispute status: ${i.error}`,!0)}}catch(s){console.error("Failed to update dispute status:",s),this.utils.setStatus("An error occurred while updating the dispute status.",!0)}}showCreditorSelection(){const t=this.appState.getState().creditors;if(this.modalTitle.textContent="Select a Creditor",this.modalConfirmBtn.classList.add("hidden"),t.length===0)this.modalBody.innerHTML="<p>No creditors saved yet. Please add some in the Creditors tab.</p>";else{const e=document.createElement("ul");e.style.listStyle="none",e.style.padding="0",t.forEach(s=>{const i=document.createElement("li");i.style.marginBottom="10px",i.innerHTML=`
                    <div><strong>${s.name}</strong><br><small>${s.address}</small></div>
                    <button class="select-creditor-btn" data-name="${s.name}" data-address="${s.address}">Select</button>
                `,e.appendChild(i)}),this.modalBody.innerHTML="",this.modalBody.appendChild(e),document.querySelectorAll(".select-creditor-btn").forEach(s=>{s.addEventListener("click",i=>{const n=i.target.dataset.name,a=i.target.dataset.address;this.populateDisputeForm(`${n} - ${a}`,""),this.confirmationModal.classList.add("hidden")})})}this.confirmationModal.classList.remove("hidden")}_getDisputeLetterText(){var l;if(this.letterContent)return this.letterContent;const{name:t,address:e}=this.appState.getState().userProfile,s=this.accountInput.value.trim(),i=this.reasonInput.value.trim(),n=this.violationSelect.value;if(!t||!e||!s||!i)return this.utils.setStatus("Please fill out your profile (top of page) and the account details for the dispute.",!0),null;const a=((l=this.knowledgeBase.FCRA.violations[n])==null?void 0:l.template)||"The information is inaccurate.",o=`
${t}
${e}

${new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}

Equifax Information Services LLC
P.O. Box 740256
Atlanta, GA 30374

Experian
P.O. Box 4500
Allen, TX 75013

TransUnion LLC
Consumer Dispute Center
P.O. Box 2000
Chester, PA 19016

RE: Formal Dispute of Inaccurate Information
Account: ${s}

To Whom It May Concern:

I am writing to dispute the following information in my file. The item I dispute is: ${s}.

My reason for dispute is: ${i}. ${a}

Under the Fair Credit Reporting Act (15 U.S.C. § 1681i), I request that you investigate this matter and delete the disputed information from my report. Please provide written confirmation of the results of your investigation.

Sincerely,
${t}
        `.trim();return this.letterContent=o,o}generateDisputeLetter(){const t=this._getDisputeLetterText();t&&(this.utils.generateDownload(t,`FCRA_Dispute_Letter_${this.accountInput.value.trim().replace(/\s/g,"_")}.txt`),this.utils.logAction("FCRA dispute letter generated."))}copyDisputeLetter(){const t=this._getDisputeLetterText();t&&(this.utils.copyToClipboard(t,"FCRA dispute letter text copied."),this.utils.logAction("FCRA dispute letter text copied."))}reset(){this.accountInput.value="",this.reasonInput.value="",this.resultsEl.innerHTML="",this.letterContent="",this.creditReportUpload.value="",this.parsedAccountsDiv.classList.add("hidden"),this.parsedAccountsList.innerHTML="",this.visualizer.destroyCharts()}}class my{constructor(t,e,s,i){this.appState=t,this.knowledgeBase=e,this.utils=s,this.creditorManager=i,this.letterContent="",this.logDisplay=document.getElementById("fdcpaLogDisplay"),this.violationTypeSelect=document.getElementById("fdcpaViolationType"),this.logBtn=document.getElementById("logFdcpaViolationBtn"),this.prepareBtn=document.getElementById("prepareCeaseDesistBtn"),this.exportBtn=document.getElementById("exportFdcpaLogBtn"),this.actionDetailsEl=document.getElementById("fdcpa-action-details"),this.collectorNameInput=document.getElementById("collectorName"),this.violationDateInput=document.getElementById("violationDate"),this.violationDescInput=document.getElementById("violationDescription"),this.suggestionConfidenceEl=document.getElementById("fdcpaSuggestionConfidence"),this.generateBtn=document.getElementById("generateCeaseDesistBtn"),this.copyBtn=document.getElementById("copyCeaseDesistBtn"),this.fdcpaCollectorName=document.getElementById("fdcpaCollectorName"),this.fdcpaCollectorAddress=document.getElementById("fdcpaCollectorAddress"),this.fdcpaAccountNumber=document.getElementById("fdcpaAccountNumber"),this.modal=document.getElementById("confirmationModal"),this.modalTitle=document.getElementById("modalTitle"),this.modalDetails=document.getElementById("modalDetails"),this.modalConfirmBtn=document.getElementById("modalConfirmBtn"),this.modalCancelBtn=document.getElementById("modalCancelBtn"),this.init()}init(){this.populateViolationTypes(),this.renderLog(),this.logBtn.addEventListener("click",()=>this.logViolation()),this.prepareBtn.addEventListener("click",()=>this.prepareCeaseAndDesist()),this.exportBtn.addEventListener("click",()=>this.exportLogToCsv()),this.generateBtn.addEventListener("click",()=>this.showConfirmation("generate")),this.copyBtn.addEventListener("click",()=>this.showConfirmation("copy")),this.modalCancelBtn.addEventListener("click",()=>this.hideModal()),this.violationDescInput.addEventListener("input",()=>this.suggestViolationType())}exportLogToCsv(){const t=this.appState.getState().fdcpaLog;if(t.length===0){this.utils.setStatus("There are no violations to export.",!0);return}const s=[["ID","Date","Violation Type","Collector","Description"].join(",")];t.forEach(l=>{const h=this.knowledgeBase.FDCPA.violations[l.type].summary,c=p=>`"${String(p).replace(/"/g,'""').replace(/\n/g," ")}"`,u=[l.id,l.date,c(h),c(l.collector),c(l.description)];s.push(u.join(","))});const i=s.join(`
`),n=new Blob([i],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),o=URL.createObjectURL(n);a.setAttribute("href",o),a.setAttribute("download","fdcpa_log.csv"),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a),this.utils.setStatus("FDCPA log exported to fdcpa_log.csv",!1)}hideModal(){this.modal.classList.add("hidden"),this.modalConfirmBtn.onclick=null}showConfirmation(t){const e=this._getCeaseAndDesistLetterText();e&&(this.modalTitle.textContent="Confirm Cease & Desist",this.modalDetails.innerHTML=`
            <p>You are about to create a Cease and Desist letter for:</p>
            <p><strong>${this.fdcpaCollectorName.value.trim()}</strong></p>
            <p>Please confirm you want to proceed.</p>
        `,this.modalConfirmBtn.onclick=()=>{t==="generate"?this.generateCeaseAndDesist(e):t==="copy"&&this.copyCeaseAndDesist(e),this.hideModal()},this.modal.classList.remove("hidden"))}populateViolationTypes(){const t=this.knowledgeBase.FDCPA.violations;for(const e in t){const s=document.createElement("option");s.value=e,s.textContent=t[e].summary,this.violationTypeSelect.appendChild(s)}}suggestViolationType(){const t=this.violationDescInput.value.toLowerCase();if(!t){this.suggestionConfidenceEl.textContent="";return}const e={};let s={key:null,score:0};const i=this.knowledgeBase.FDCPA.violations;for(const n in i){e[n]=0;const a=i[n];if(a.keywords&&Array.isArray(a.keywords))for(const o of a.keywords)new RegExp(`\b${o.toLowerCase()}\b`).test(t)&&e[n]++}for(const n in e)e[n]>s.score&&(s={key:n,score:e[n]});s.score>0?(this.violationTypeSelect.value=s.key,this.suggestionConfidenceEl.textContent=`Suggestion (Confidence: ${s.score})`):this.suggestionConfidenceEl.textContent=""}logViolation(){const t={id:Date.now(),type:this.violationTypeSelect.value,collector:this.collectorNameInput.value.trim(),date:this.violationDateInput.value,description:this.violationDescInput.value.trim()};if(!t.collector||!t.date||!t.description){this.utils.setStatus("Please fill out all fields to log a violation.",!0);return}const s=[...this.appState.getState().fdcpaLog,t];this.appState.updateState({fdcpaLog:s}),localStorage.setItem(hs.LOCAL_STORAGE.FDCPA_LOG,JSON.stringify(s)),this.renderLog(),document.dispatchEvent(new CustomEvent("fdcpaLogUpdated")),this.utils.logAction(`FDCPA violation logged for ${t.collector}.`),this.collectorNameInput.value="",this.violationDateInput.value="",this.violationDescInput.value="",this.suggestionConfidenceEl.textContent=""}renderLog(){const t=this.appState.getState();if(t.fdcpaLog.length===0){this.logDisplay.innerHTML='<p class="text-muted">No violations logged yet.</p>',this.prepareBtn.disabled=!0;return}const e=t.fdcpaLog.map(s=>`
            <li>
                <strong>${s.date} - ${this.knowledgeBase.FDCPA.violations[s.type].summary}</strong><br>
                <em>Collector:</em> ${s.collector}<br>
                <em>Details:</em> ${s.description}
            </li>
        `).join("");this.logDisplay.innerHTML=`<ul>${e}</ul>`,this.prepareBtn.disabled=!1}prepareCeaseAndDesist(){if(this.actionDetailsEl.classList.toggle("hidden"),!this.actionDetailsEl.classList.contains("hidden")){const t=this.appState.getState(),e=t.fdcpaLog[t.fdcpaLog.length-1];if(e){const s=e.collector;this.fdcpaCollectorName.value=s;const i=this.creditorManager.getCreditors().find(n=>n.name.toLowerCase()===s.toLowerCase());i&&(this.fdcpaCollectorAddress.value=i.address,this.utils.setStatus(`Address for ${s} auto-filled from address book.`,!1))}}}_getCeaseAndDesistLetterText(){const t=this.appState.getState(),e={userName:t.userProfile.name,userAddress:t.userProfile.address,collectorName:this.fdcpaCollectorName.value.trim(),collectorAddress:this.fdcpaCollectorAddress.value.trim(),accountNumber:this.fdcpaAccountNumber.value.trim(),currentDate:new Date().toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})};return!e.userName||!e.userAddress||!e.collectorName||!e.collectorAddress?(this.utils.setStatus("Please fill out your name, your address, and the collector's name and address.",!0),null):`
${e.userName}
${e.userAddress}

${e.currentDate}

${e.collectorName}
${e.collectorAddress}

VIA CERTIFIED MAIL

RE: Cease and Desist All Communications${e.accountNumber?`
Account/Reference Number: ${e.accountNumber}`:""}

To Whom It May Concern:

This letter is a formal notification, pursuant to my rights under the Fair Debt Collection Practices Act (FDCPA), 15 U.S.C. § 1692c(c), that I demand you cease all further communication with me regarding this matter.

This means you must not contact me by mail, telephone, email, in person, or by any other means for any reason, except for the specific purposes allowed by the statute: (1) to advise me that your further efforts are being terminated; (2) to notify me that you may invoke specified remedies which are ordinarily invoked by you or your company; or (3) where applicable, to notify me that you intend to invoke a specified remedy.

Be advised that any communication from you that does not comply with this demand will constitute a violation of the FDCPA. Such a violation will be reported to the appropriate federal and state authorities, and I will not hesitate to pursue all available legal remedies.

This demand applies to you, your company, and any attorneys, agents, or other third parties acting on your behalf.

Govern yourselves accordingly.

Sincerely,

_________________________
${e.userName}
        `.trim()}generateCeaseAndDesist(t){t&&(this.utils.generateDownload(t,`Cease_and_Desist_${this.fdcpaCollectorName.value.trim().replace(/\s/g,"_")}.txt`),this.utils.logAction("Cease and Desist letter generated and downloaded."))}copyCeaseAndDesist(t){t&&(this.utils.copyToClipboard(t,"Cease and Desist letter text copied to clipboard."),this.utils.logAction("Cease and Desist letter text copied."))}reset(){this.appState.updateState({fdcpaLog:[]}),localStorage.removeItem(hs.LOCAL_STORAGE.FDCPA_LOG),this.actionDetailsEl.classList.add("hidden"),this.renderLog()}}class yy{constructor(t,e,s){this.appState=t,this.knowledgeBase=e,this.utils=s,this.uploadInput=document.getElementById("denialLetterUpload"),this.analyzeBtn=document.getElementById("analyzeDenialBtn"),this.analysisResultsEl=document.getElementById("denial-analysis-results"),this.denialReasonEl=document.getElementById("denialReason"),this.detailsFieldset=document.getElementById("denial-details-fieldset"),this.responseOptionsEl=document.getElementById("denial-response-options"),this.letterOutputEl=document.getElementById("denial-letter-output"),this.letterTextEl=document.getElementById("denialLetterText"),this.creditorNameInput=document.getElementById("denialCreditorName"),this.creditorAddressInput=document.getElementById("denialCreditorAddress"),this.denialDateInput=document.getElementById("denialDate"),this.loanTypeInput=document.getElementById("denialLoanType"),this.genReconBtn=document.getElementById("generateReconsiderationBtn"),this.genFcraBtn=document.getElementById("generateFcraDisputeBtn"),this.copyBtn=document.getElementById("copyDenialLetterBtn"),this.downloadBtn=document.getElementById("downloadDenialLetterBtn"),this.reconInputs=document.getElementById("reconsideration-inputs"),this.fcraInputs=document.getElementById("fcra-dispute-inputs"),this.reconNote=document.getElementById("reconsiderationNote"),this.fcraItem=document.getElementById("fcraDisputeItem"),this.init()}init(){this.uploadInput.addEventListener("change",t=>{t.target.files.length>0&&(this.appState.updateState({denialLetterFile:t.target.files[0]}),this.utils.logAction("Denial letter uploaded."))}),this.analyzeBtn.addEventListener("click",()=>this.analyzeDenialLetter()),this.genReconBtn.addEventListener("click",()=>this.generateReconsiderationLetter()),this.genFcraBtn.addEventListener("click",()=>this.generateFcraDisputeLetter()),this.copyBtn.addEventListener("click",()=>this.copyLetter()),this.downloadBtn.addEventListener("click",()=>this.downloadLetter())}async analyzeDenialLetter(){var e;const{denialLetterFile:t}=this.appState.getState();if(!t){this.utils.setStatus("Please upload a denial letter first.",!0);return}this.utils.showLoader(),this.utils.setStatus("Analyzing denial letter...",!1);try{const s=await this.utils.extractTextFromPdf(t);if(!s)return;const i=s.toLowerCase();let n="unknown";for(const o in this.knowledgeBase.DenialReasons){const{keywords:l}=this.knowledgeBase.DenialReasons[o];if(l.some(h=>i.includes(h))){n=o;break}}const a=((e=this.knowledgeBase.DenialReasons[n])==null?void 0:e.summary)||"Could not determine reason.";this.appState.updateState({denialReason:n}),this.denialReasonEl.textContent=a,this.analysisResultsEl.classList.remove("hidden"),this.responseOptionsEl.classList.remove("hidden"),this.utils.setStatus("Analysis complete. Please choose a response type.",!1,!0),this.utils.logAction(`Denial reason identified: ${a}`)}catch(s){console.error("Error analyzing denial letter:",s),this.utils.setStatus("Failed to analyze the denial letter.",!0)}finally{this.utils.hideLoader()}}generateReconsiderationLetter(){const{userProfile:t}=this.appState.getState();if(!t||!t.name||!t.address){this.utils.setStatus("Please complete your user profile first.",!0);return}const e=this.reconNote.value,s=`
[Your Name]
[Your Address]
[Your Phone Number]
[Your Email]

[Date]

[Creditor Name]
[Creditor Address]

Subject: Letter of Reconsideration

To Whom It May Concern,

I am writing to request a reconsideration of my recent application for [Credit Card Name or Loan Type], which was denied on [Date of Denial].

I was disappointed to learn of your decision, and I would appreciate it if you would take a moment to review my application again. 

${e?`Specifically, I would like to bring to your attention that: ${e}`:"I believe I am a strong candidate and would be a responsible customer."}

Thank you for your time and consideration. I look forward to hearing from you soon.

Sincerely,
${t.name}
        `.trim();this.letterTextEl.value=s,this.letterOutputEl.classList.remove("hidden"),this.reconInputs.classList.remove("hidden"),this.fcraInputs.classList.add("hidden"),this.utils.setStatus("Reconsideration letter generated.",!1,!0)}generateFcraDisputeLetter(){var a;const{userProfile:t,denialReason:e}=this.appState.getState();if(!t||!t.name||!t.address){this.utils.setStatus("Please complete your user profile first.",!0);return}const s=this.fcraItem.value;if(!s){this.utils.setStatus("Please specify the item you wish to dispute.",!0);return}const n=`
[Your Name]
[Your Address]
[Your Phone Number]
[Your Email]

[Date]

[Creditor Name]
[Creditor Address]

Subject: Formal Dispute of Information Leading to Credit Denial

To Whom It May Concern,

I am writing to dispute information that led to the denial of my application for [Credit Card Name or Loan Type], as communicated to me in your letter dated [Date of Denial].

Your decision was based on ${((a=this.knowledgeBase.DenialReasons[e])==null?void 0:a.summary)||"the information in my credit report"}. I believe this is inaccurate. Specifically, I am disputing the following item:
${s}

Under the Fair Credit Reporting Act (FCRA), I am requesting that you investigate this matter and provide me with the results of your investigation.

Please provide me with a copy of the credit report you used to make your decision, and if you are unable to verify the accuracy of the disputed information, I request that you remove it from my file and reconsider my application.

Thank you for your prompt attention to this matter.

Sincerely,
${t.name}
        `.trim();this.letterTextEl.value=n,this.letterOutputEl.classList.remove("hidden"),this.fcraInputs.classList.remove("hidden"),this.reconInputs.classList.add("hidden"),this.utils.setStatus("FCRA dispute letter generated.",!1,!0)}copyLetter(){this.utils.copyToClipboard(this.letterTextEl.value,"Letter copied to clipboard.")}downloadLetter(){this.utils.generateDownload(this.letterTextEl.value,"denial_response_letter.txt")}reset(){this.uploadInput.value="",this.appState.updateState({denialLetterFile:null,denialReason:null}),this.analysisResultsEl.classList.add("hidden"),this.responseOptionsEl.classList.add("hidden"),this.letterOutputEl.classList.add("hidden"),this.reconInputs.classList.add("hidden"),this.fcraInputs.classList.add("hidden"),this.letterTextEl.value="",this.reconNote.value="",this.fcraItem.value=""}}class by{constructor(t,e,s){this.appState=t,this.utils=e,this.creditorManager=s,this.letterData=null,this.init()}init(){this.creditorSelect=document.getElementById("ptpCreditorSelect"),this.creditorNameInput=document.getElementById("ptpCreditorName"),this.creditorAddressInput=document.getElementById("ptpCreditorAddress"),this.accountNumberInput=document.getElementById("ptpAccountNumber"),this.promiseAmountInput=document.getElementById("ptpPromiseAmount"),this.promiseDateInput=document.getElementById("ptpPromiseDate"),this.generateBtn=document.getElementById("generatePtpLetterBtn"),this.letterContainer=document.getElementById("ptpLetterContainer"),this.letterTextarea=document.getElementById("ptpLetterText"),this.copyBtn=document.getElementById("copyPtpLetterBtn"),this.downloadBtn=document.getElementById("downloadPtpLetterBtn"),this.modal=document.getElementById("confirmationModal"),this.modalTitle=document.getElementById("modalTitle"),this.modalDetails=document.getElementById("modalDetails"),this.modalConfirmBtn=document.getElementById("modalConfirmBtn"),this.modalCancelBtn=document.getElementById("modalCancelBtn"),this.populateCreditors(),this.setupEventListeners(),document.addEventListener("creditorsUpdated",()=>this.populateCreditors())}populateCreditors(){const t=this.creditorManager.getCreditors();this.creditorSelect.innerHTML='<option value="">Select a Creditor</option>',t.forEach(e=>{const s=document.createElement("option");s.value=e.id,s.textContent=e.name,this.creditorSelect.appendChild(s)})}setupEventListeners(){this.generateBtn.addEventListener("click",()=>this.showConfirmation()),this.copyBtn.addEventListener("click",()=>this.utils.copyToClipboard(this.letterTextarea.value,"Promise to Pay letter copied!")),this.downloadBtn.addEventListener("click",()=>this.utils.generateDownload(this.letterTextarea.value,"promise_to_pay_letter.txt")),this.creditorSelect.addEventListener("change",()=>this.handleCreditorSelect()),this.modalCancelBtn.addEventListener("click",()=>this.hideModal())}handleCreditorSelect(){const t=this.creditorSelect.value;if(t){const e=this.creditorManager.getCreditors().find(s=>s.id==t);e&&(this.creditorNameInput.value=e.name,this.creditorAddressInput.value=e.address)}else this.creditorNameInput.value="",this.creditorAddressInput.value=""}showConfirmation(){const t=this.appState.getState().userProfile;if(!t.name||!t.address){this.utils.setStatus("Please save your user profile information first.",!0);return}const e=this.creditorNameInput.value.trim(),s=this.creditorAddressInput.value.trim(),i=this.accountNumberInput.value.trim(),n=this.promiseAmountInput.value,a=this.promiseDateInput.value;if(!e||!s||!i||!n||!a){this.utils.setStatus("Please fill in all fields for the letter.",!0);return}this.letterData={userName:t.name,userAddress:t.address,creditorName:e,creditorAddress:s,accountNumber:i,promiseAmount:n,promiseDate:a},this.modalTitle.textContent="Confirm Promise to Pay",this.modalDetails.innerHTML=`
            <p><strong>To:</strong> ${this.letterData.creditorName}</p>
            <p><strong>Account:</strong> ${this.letterData.accountNumber}</p>
            <p><strong>Amount:</strong> $${this.letterData.promiseAmount}</p>
            <p><strong>Payment Date:</strong> ${new Date(this.letterData.promiseDate).toLocaleDateString()}</p>
        `,this.modalConfirmBtn.onclick=()=>this.handleGenerateLetter(),this.modal.classList.remove("hidden")}hideModal(){this.modal.classList.add("hidden"),this.modalConfirmBtn.onclick=null,this.letterData=null}async handleGenerateLetter(){if(!this.letterData)return;const t=this.letterData;this.utils.showLoader(),this.hideModal();try{const e=await fetch("/generate-ptp-letter",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t)});if(!e.ok){const n=await e.json();throw new Error(n.error||"Failed to generate letter.")}const s=await e.json();this.letterTextarea.value=s.letterContent,this.letterContainer.classList.remove("hidden"),this.utils.setStatus("Promise to Pay letter generated successfully.",!1,!0);const i=`Generated Promise to Pay letter for ${t.creditorName} for ${t.promiseAmount}.`;this.utils.logAction(i)}catch(e){console.error("Error generating letter:",e),this.utils.setStatus(e.message,!0)}finally{this.utils.hideLoader()}}}class Ay{constructor(t){this.appState=t,this.totalCreditorsEl=document.getElementById("stats-total-creditors"),this.fdcpaViolationsEl=document.getElementById("stats-fdcpa-violations"),this.activeDisputesEl=document.getElementById("stats-active-disputes"),this.init()}init(){this.updateStats(),document.addEventListener("creditorsUpdated",()=>this.updateStats()),document.addEventListener("fdcpaLogUpdated",()=>this.updateStats()),document.addEventListener("disputesUpdated",()=>this.updateStats())}updateStats(){const t=this.appState.getState();this.totalCreditorsEl.textContent=t.creditors.length,this.fdcpaViolationsEl.textContent=t.fdcpaLog.length;const e=t.disputes.filter(s=>s.status.toLowerCase()!=="resolved").length;this.activeDisputesEl.textContent=e}}function ug(d){d.checked?(document.body.classList.add("dark-mode"),localStorage.setItem(hs.LOCAL_STORAGE.THEME,"dark")):(document.body.classList.remove("dark-mode"),localStorage.setItem(hs.LOCAL_STORAGE.THEME,"light"))}function vy(d){const t=localStorage.getItem(hs.LOCAL_STORAGE.THEME);t&&(d.checked=t==="dark"),ug(d);const e=localStorage.getItem(hs.LOCAL_STORAGE.SOVEREIGN_OVERLAY_CONFIG_PATH_KEY),s=document.getElementById("sovereignOverlayConfigPath");s&&e&&(s.value=e)}function wy(d,t){const e=t.value.trim();if(!e){d.setStatus("Please enter a note for the log.",!0);return}d.logAction(`Custom Note: "${e}"`),t.value="",d.setStatus("Custom note added to log.",!1)}function Sy(d,t,e){confirm("Are you sure you want to reset all application data? This action cannot be undone.")&&(d.resetState(),t.forEach(s=>{typeof s.reset=="function"&&s.reset()}),e.setStatus("Application has been reset.",!1,!0),t.forEach(s=>{typeof s.render=="function"?s.render():typeof s.renderLog=="function"&&s.renderLog()}),e.renderHistory())}function Zc(d){const t=document.querySelectorAll(".tab-panel"),e=document.querySelectorAll(".tab-link");t.forEach(s=>{s.classList.toggle("active",s.id===d)}),e.forEach(s=>{s.classList.toggle("active",s.dataset.tab===d)})}function Ey(){const d=document.querySelector(".tab-nav");if(!d)return;d.addEventListener("click",e=>{if(e.target.matches(".tab-link")){const s=e.target.dataset.tab;Zc(s),localStorage.setItem(hs.LOCAL_STORAGE.ACTIVE_TAB,s)}});const t=localStorage.getItem(hs.LOCAL_STORAGE.ACTIVE_TAB);t&&document.getElementById(t)?Zc(t):Zc("tab-dashboard")}function _y(d,t,e){const s=document.getElementById("resetAppBtn"),i=document.getElementById("trackInstrumentBtn"),n=document.getElementById("customLogEntry"),a=document.getElementById("themeToggle"),o=document.getElementById("saveConfigPathBtn"),l=document.getElementById("sovereignOverlayConfigPath");s&&s.addEventListener("click",()=>Sy(d,e,t)),i&&i.addEventListener("click",()=>wy(t,n)),a&&a.addEventListener("change",()=>ug(a)),o&&o.addEventListener("click",()=>{const h=l.value.trim();localStorage.setItem(hs.LOCAL_STORAGE.SOVEREIGN_OVERLAY_CONFIG_PATH_KEY,h),t.setStatus("Config path saved.",!1,!0)}),vy(a),t.renderHistory(),Ey()}Ns.workerSrc="/static/dist/pdf.worker.mjs";document.addEventListener("DOMContentLoaded",()=>{const d=new ly,t=new hy(d),e=document.getElementById("globalSearchInput"),s=document.getElementById("searchResults");t.showLoader();try{const i=new Ay(d),n=new cy(d,t),a=new dy(d,t,n),o=new uy(d,zr,t,n),l=new fy(d,zr,t),h=new gy(d,zr,t,n),c=new my(d,zr,t,n),u=new yy(d,zr,t),p=new by(d,t,n);_y(d,t,[o,l,h,c,u,a,n,p]),e.addEventListener("keyup",()=>{const y=e.value.toLowerCase();if(y.length>2){const A=Cy(y,d.getState(),zr);Ty(A,s)}else s.classList.add("hidden"),s.innerHTML=""}),console.log("Sovereign Finance Cockpit Initialized")}catch(i){console.error("Failed to initialize the application:",i),t.setStatus("Application failed to load. Check the console for errors.",!0)}finally{t.hideLoader()}});function Cy(d,t,e){const s=[];return t.creditors.forEach(i=>{(i.name.toLowerCase().includes(d)||i.address.toLowerCase().includes(d))&&s.push({type:"Creditor",name:i.name,description:i.address})}),t.fdcpaLog.forEach(i=>{(i.collector.toLowerCase().includes(d)||i.description.toLowerCase().includes(d))&&s.push({type:"FDCPA Violation",name:i.collector,description:`${e.FDCPA.violations[i.type].summary} on ${i.date}`})}),t.disputes.forEach(i=>{(i.account_name.toLowerCase().includes(d)||i.account_number.toLowerCase().includes(d))&&s.push({type:"Dispute",name:i.account_name,description:`Account: ${i.account_number}, Status: ${i.status}`})}),s}function Ty(d,t){if(t.innerHTML="",d.length===0){t.classList.add("hidden");return}const e=document.createElement("ul");d.forEach(s=>{const i=document.createElement("li");i.innerHTML=`<strong>${s.type}:</strong> ${s.name} - ${s.description}`,e.appendChild(i)}),t.appendChild(e),t.classList.remove("hidden")}
